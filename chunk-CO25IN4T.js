import{$ as xm,A as Wn,Ea as Um,H as Cm,I as $u,K as km,N as Dm,O as Nm,Pb as qm,Qb as $m,T as Om,Tb as zu,U as ju,V as Vm,Za as Bm,a as Mu,aa as Lm,b as Fu,ca as Dr,fa as Dt,g as dt,ga as et,h as _,ha as Nr,j as Uu,ja as Mm,k as ft,ka as zo,la as Fm,p as Rm,q as Pm,ra as sn,s as jo,t as Bu,u as qu,ua as Wo,v as ns,wa as pt}from"./chunk-HKMJNDLM.js";var jm=()=>{};var Gm=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},qw=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],c=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Go={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,c=o?n[i+1]:0,u=i+2<n.length,l=u?n[i+2]:0,f=s>>2,p=(s&3)<<4|c>>4,g=(c&15)<<2|l>>6,E=l&63;u||(E=64,o||(g=64)),r.push(t[f],t[p],t[g],t[E])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Gm(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qw(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let l=i<n.length?t[n.charAt(i)]:64;++i;let p=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||l==null||p==null)throw new Gu;let g=s<<2|c>>4;if(r.push(g),l!==64){let E=c<<4&240|l>>2;if(r.push(E),p!==64){let k=l<<6&192|p;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Gu=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},$w=function(n){let e=Gm(n);return Go.encodeByteArray(e,!0)},is=function(n){return $w(n).replace(/\./g,"")},Ko=function(n){try{return Go.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ho(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var jw=()=>Ho().__FIREBASE_DEFAULTS__,zw=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ww=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Ko(n[1]);return e&&JSON.parse(e)},Qo=()=>{try{return jm()||jw()||zw()||Ww()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Hu=n=>{var e,t;return(t=(e=Qo())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Km=n=>{let e=Hu(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Qu=()=>{var n;return(n=Qo())===null||n===void 0?void 0:n.config},Ju=n=>{var e;return(e=Qo())===null||e===void 0?void 0:e[`_${n}`]};var Gn=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Nt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function ss(n){return _(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Hm(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[is(JSON.stringify(t)),is(JSON.stringify(o)),""].join(".")}var rs={};function Gw(){let n={prod:[],emulator:[]};for(let e of Object.keys(rs))rs[e]?n.emulator.push(e):n.prod.push(e);return n}function Kw(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var zm=!1;function Jo(n,e){if(typeof window>"u"||typeof document>"u"||!Nt(window.location.host)||rs[n]===e||rs[n]||zm)return;rs[n]=e;function t(g){return`__firebase__banner__${g}`}let r="__firebase__banner",s=Gw().prod.length>0;function o(){let g=document.getElementById(r);g&&g.remove()}function c(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function u(g,E){g.setAttribute("width","24"),g.setAttribute("id",E),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function l(){let g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{zm=!0,o()},g}function f(g,E){g.setAttribute("id",E),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function p(){let g=Kw(r),E=t("text"),k=document.getElementById(E)||document.createElement("span"),N=t("learnmore"),O=document.getElementById(N)||document.createElement("a"),U=t("preprendIcon"),$=document.getElementById(U)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){let q=g.element;c(q),f(O,N);let H=l();u($,U),q.append($,k,O,H),document.body.appendChild(q)}s?(k.innerText="Preview backend disconnected.",$.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):($.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",E)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function _e(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Qm(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_e())}function Jm(){var n;let e=(n=Qo())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ym(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Xm(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Zm(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function eg(){let n=_e();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Yu(){return!Jm()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Xu(){return!Jm()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Or(){try{return typeof indexedDB=="object"}catch{return!1}}function tg(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var Hw="FirebaseError",He=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Hw,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,it.prototype.create)}},it=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Qw(s,r):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new He(i,c,r)}};function Qw(n,e){return n.replace(Jw,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Jw=/\{\$([^}]+)}/g;function ng(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ze(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],o=e[i];if(Wm(s)&&Wm(o)){if(!ze(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Wm(n){return n!==null&&typeof n=="object"}function Vr(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function xr(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Lr(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function rg(n,e){let t=new Ku(n,e);return t.subscribe.bind(t)}var Ku=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Yw(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Wu),i.error===void 0&&(i.error=Wu),i.complete===void 0&&(i.complete=Wu);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Yw(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Wu(){}var LP=4*60*60*1e3;function re(n){return n&&n._delegate?n._delegate:n}var qe=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Kn="[DEFAULT]";var Zu=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Gn;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Zw(e))try{this.getOrInitializeService({instanceIdentifier:Kn})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Kn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return _(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Kn){return this.instances.has(e)}getOptions(e=Kn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,o]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&o.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Xw(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Kn){return this.component?this.component.multipleInstances?e:Kn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Xw(n){return n===Kn?void 0:n}function Zw(n){return n.instantiationMode==="EAGER"}var Yo=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Zu(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var eT=[],J=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(J||{}),tT={debug:J.DEBUG,verbose:J.VERBOSE,info:J.INFO,warn:J.WARN,error:J.ERROR,silent:J.SILENT},nT=J.INFO,rT={[J.DEBUG]:"log",[J.VERBOSE]:"log",[J.INFO]:"info",[J.WARN]:"warn",[J.ERROR]:"error"},iT=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=rT[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},mt=class{constructor(e){this.name=e,this._logLevel=nT,this._logHandler=iT,this._userLogHandler=null,eT.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in J))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tT[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,J.DEBUG,...e),this._logHandler(this,J.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,J.VERBOSE,...e),this._logHandler(this,J.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,J.INFO,...e),this._logHandler(this,J.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,J.WARN,...e),this._logHandler(this,J.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,J.ERROR,...e),this._logHandler(this,J.ERROR,...e)}};var sT=(n,e)=>e.some(t=>n instanceof t),ig,sg;function oT(){return ig||(ig=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aT(){return sg||(sg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var og=new WeakMap,tl=new WeakMap,ag=new WeakMap,el=new WeakMap,rl=new WeakMap;function cT(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(gt(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&og.set(t,n)}).catch(()=>{}),rl.set(e,n),e}function uT(n){if(tl.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});tl.set(n,e)}var nl={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return tl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ag.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return gt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function cg(n){nl=n(nl)}function lT(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(Xo(this),e,...t);return ag.set(r,e.sort?e.sort():[e]),gt(r)}:aT().includes(n)?function(...e){return n.apply(Xo(this),e),gt(og.get(this))}:function(...e){return gt(n.apply(Xo(this),e))}}function hT(n){return typeof n=="function"?lT(n):(n instanceof IDBTransaction&&uT(n),sT(n,oT())?new Proxy(n,nl):n)}function gt(n){if(n instanceof IDBRequest)return cT(n);if(el.has(n))return el.get(n);let e=hT(n);return e!==n&&(el.set(n,e),rl.set(e,n)),e}var Xo=n=>rl.get(n);function lg(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,e),c=gt(o);return r&&o.addEventListener("upgradeneeded",u=>{r(gt(o.result),u.oldVersion,u.newVersion,gt(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),c}var dT=["get","getKey","getAll","getAllKeys","count"],fT=["put","add","delete","clear"],il=new Map;function ug(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(il.get(e))return il.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=fT.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||dT.includes(t)))return;let s=function(o,...c){return _(this,null,function*(){let u=this.transaction(o,i?"readwrite":"readonly"),l=u.store;return r&&(l=l.index(c.shift())),(yield Promise.all([l[t](...c),i&&u.done]))[0]})};return il.set(e,s),s}cg(n=>Fu(Mu({},n),{get:(e,t,r)=>ug(e,t)||n.get(e,t,r),has:(e,t)=>!!ug(e,t)||n.has(e,t)}));var ol=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pT(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function pT(n){let e=n.getComponent();return e?.type==="VERSION"}var al="@firebase/app",hg="0.13.2";var Ot=new mt("@firebase/app"),mT="@firebase/app-compat",gT="@firebase/analytics-compat",_T="@firebase/analytics",yT="@firebase/app-check-compat",vT="@firebase/app-check",IT="@firebase/auth",ET="@firebase/auth-compat",wT="@firebase/database",TT="@firebase/data-connect",AT="@firebase/database-compat",bT="@firebase/functions",ST="@firebase/functions-compat",RT="@firebase/installations",PT="@firebase/installations-compat",CT="@firebase/messaging",kT="@firebase/messaging-compat",DT="@firebase/performance",NT="@firebase/performance-compat",OT="@firebase/remote-config",VT="@firebase/remote-config-compat",xT="@firebase/storage",LT="@firebase/storage-compat",MT="@firebase/firestore",FT="@firebase/ai",UT="@firebase/firestore-compat",BT="firebase",qT="11.10.0";var Zo="[DEFAULT]",$T={[al]:"fire-core",[mT]:"fire-core-compat",[_T]:"fire-analytics",[gT]:"fire-analytics-compat",[vT]:"fire-app-check",[yT]:"fire-app-check-compat",[IT]:"fire-auth",[ET]:"fire-auth-compat",[wT]:"fire-rtdb",[TT]:"fire-data-connect",[AT]:"fire-rtdb-compat",[bT]:"fire-fn",[ST]:"fire-fn-compat",[RT]:"fire-iid",[PT]:"fire-iid-compat",[CT]:"fire-fcm",[kT]:"fire-fcm-compat",[DT]:"fire-perf",[NT]:"fire-perf-compat",[OT]:"fire-rc",[VT]:"fire-rc-compat",[xT]:"fire-gcs",[LT]:"fire-gcs-compat",[MT]:"fire-fst",[UT]:"fire-fst-compat",[FT]:"fire-vertex","fire-js":"fire-js",[BT]:"fire-js-all"};var os=new Map,jT=new Map,cl=new Map;function dg(n,e){try{n.container.addComponent(e)}catch(t){Ot.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function st(n){let e=n.name;if(cl.has(e))return Ot.debug(`There were multiple attempts to register component ${e}.`),!1;cl.set(e,n);for(let t of os.values())dg(t,n);for(let t of jT.values())dg(t,n);return!0}function an(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function gg(n,e,t=Zo){an(n,e).clearInstance(t)}function $e(n){return n==null?!1:n.settings!==void 0}var zT={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},on=new it("app","Firebase",zT);var ul=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new qe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw on.create("app-deleted",{appName:this._name})}};var cn=qT;function dl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:Zo,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw on.create("bad-app-name",{appName:String(i)});if(t||(t=Qu()),!t)throw on.create("no-options");let s=os.get(i);if(s){if(ze(t,s.options)&&ze(r,s.config))return s;throw on.create("duplicate-app",{appName:i})}let o=new Yo(i);for(let u of cl.values())o.addComponent(u);let c=new ul(t,r,o);return os.set(i,c),c}function Hn(n=Zo){let e=os.get(n);if(!e&&n===Zo&&Qu())return dl();if(!e)throw on.create("no-app",{appName:n});return e}function ea(){return Array.from(os.values())}function fe(n,e,t){var r;let i=(r=$T[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ot.warn(c.join(" "));return}st(new qe(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var WT="firebase-heartbeat-database",GT=1,as="firebase-heartbeat-store",sl=null;function _g(){return sl||(sl=lg(WT,GT,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(as)}catch(t){console.warn(t)}}}}).catch(n=>{throw on.create("idb-open",{originalErrorMessage:n.message})})),sl}function KT(n){return _(this,null,function*(){try{let t=(yield _g()).transaction(as),r=yield t.objectStore(as).get(yg(n));return yield t.done,r}catch(e){if(e instanceof He)Ot.warn(e.message);else{let t=on.create("idb-get",{originalErrorMessage:e?.message});Ot.warn(t.message)}}})}function fg(n,e){return _(this,null,function*(){try{let r=(yield _g()).transaction(as,"readwrite");yield r.objectStore(as).put(e,yg(n)),yield r.done}catch(t){if(t instanceof He)Ot.warn(t.message);else{let r=on.create("idb-set",{originalErrorMessage:t?.message});Ot.warn(r.message)}}})}function yg(n){return`${n.name}!${n.options.appId}`}var HT=1024,QT=30,ll=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new hl(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return _(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=pg();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>QT){let o=YT(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ot.warn(r)}})}getHeartbeatsHeader(){return _(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=pg(),{heartbeatsToSend:r,unsentEntries:i}=JT(this._heartbeatsCache.heartbeats),s=is(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Ot.warn(t),""}})}};function pg(){return new Date().toISOString().substring(0,10)}function JT(n,e=HT){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),mg(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),mg(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var hl=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return _(this,null,function*(){return Or()?tg().then(()=>!0).catch(()=>!1):!1})}read(){return _(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield KT(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return _(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return fg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return _(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return fg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function mg(n){return is(JSON.stringify({version:2,heartbeats:n})).length}function YT(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function XT(n){st(new qe("platform-logger",e=>new ol(e),"PRIVATE")),st(new qe("heartbeat",e=>new ll(e),"PRIVATE")),fe(al,hg,n),fe(al,hg,"esm2017"),fe("fire-js","")}XT("");var ZT="firebase",eA="11.10.0";fe(ZT,eA,"app");function fl(n){n===void 0&&(Fm(fl),n=Dt(sn));let e=n.get(Wo);return t=>new ft(r=>{let i=e.add(),s=!1;function o(){s||(i(),s=!0)}let c=t.subscribe({next:u=>{r.next(u),o()},complete:()=>{r.complete(),o()},error:u=>{r.error(u),o()}});return c.add(()=>{r.unsubscribe(),o()}),c})}var Vt=new qm("ANGULARFIRE2_VERSION");function cs(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Jn=(n,e)=>{let t=e?[e]:ea(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Mr=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(Mr||{}),vg=zu()&&typeof Zone<"u"?Mr.WARN:Mr.SILENT;var ta=class{zone;delegate;constructor(e,t=Pm){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i?i.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,r)}},un=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=Dt(pt);this.outsideAngular=t.runOutsideAngular(()=>new ta(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new ta(typeof Zone>"u"?void 0:Zone.current,Rm))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=xm({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ig=!1;function nA(n,e){!Ig&&(vg>Mr.SILENT||zu())&&(Ig=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),vg>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function rA(n){let e=Dt(pt,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Qn(n){let e=Dt(pt,{optional:!0});return e?e.run(()=>n()):n()}var iA=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),zo(t,()=>Qn(()=>n.apply(void 0,r)))),x=(n,e,t)=>(t||=e?Mr.WARN:Mr.VERBOSE,function(){let r,i=arguments,s,o,c;try{s=Dt(un),o=Dt(Wo),c=Dt(Mm)}catch{return nA(n,t),n.apply(this,i)}for(let l=0;l<arguments.length;l++)typeof i[l]=="function"&&(e&&(r||=Qn(()=>o.add())),i[l]=iA(i[l],r,c));let u=rA(()=>n.apply(this,i));return e?u instanceof ft?u.pipe(qu(s.outsideAngular),Bu(s.insideAngular),fl(c)):u instanceof Promise?Qn(()=>new Promise((l,f)=>{o.run(()=>u).then(p=>zo(c,()=>Qn(()=>l(p))),p=>zo(c,()=>Qn(()=>f(p))))})):typeof u=="function"&&r?function(){return setTimeout(r,0),u.apply(this,arguments)}:Qn(()=>u):u instanceof ft?u.pipe(qu(s.outsideAngular),Bu(s.insideAngular)):Qn(()=>u)});var xt=class{constructor(e){return e}},Yn=class{constructor(){return ea()}};function sA(n){return n&&n.length===1?n[0]:new xt(Hn())}var pl=new Dr("angularfire2._apps"),oA={provide:xt,useFactory:sA,deps:[[new et,pl]]},aA={provide:Yn,deps:[[new et,pl]]};function cA(n){return(e,t)=>{let r=t.get(Um);fe("angularfire",Vt.full,"core"),fe("angularfire",Vt.full,"app"),fe("angular",$m.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new xt(i)}}function UC(n,...e){return Nr([oA,aA,{provide:pl,useFactory:cA(n),multi:!0,deps:[pt,sn,un,...e]}])}var BC=x(dl,!0);var uA=new Map,lA={activated:!1,tokenObservers:[]},hA={initialized:!1,enabled:!1};function ot(n){return uA.get(n)||Object.assign({},lA)}function Ag(){return hA}var dA="https://content-firebaseappcheck.googleapis.com/v1";var fA="exchangeDebugToken",Eg={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},QC=24*60*60*1e3;var _l=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return _(this,null,function*(){this.stop();try{this.pending=new Gn,this.pending.promise.catch(t=>{}),yield pA(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Gn,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function pA(n){return new Promise(e=>{setTimeout(e,n)})}var mA={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},ln=new it("appCheck","AppCheck",mA);function bg(n){if(!ot(n).activated)throw ln.create("use-before-activation",{appName:n.name})}function Sg(r,i){return _(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let E=yield o.getHeartbeatsHeader();E&&(s["X-Firebase-Client"]=E)}let c={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,c)}catch(E){throw ln.create("fetch-network-error",{originalErrorMessage:E?.message})}if(u.status!==200)throw ln.create("fetch-status-error",{httpStatus:u.status});let l;try{l=yield u.json()}catch(E){throw ln.create("fetch-parse-error",{originalErrorMessage:E?.message})}let f=l.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw ln.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let p=Number(f[1])*1e3,g=Date.now();return{token:l.token,expireTimeMillis:g+p,issuedAtTimeMillis:g}})}function Rg(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${dA}/projects/${t}/apps/${r}:${fA}?key=${i}`,body:{debug_token:e}}}var gA="firebase-app-check-database",_A=1,yl="firebase-app-check-store";var na=null;function yA(){return na||(na=new Promise((n,e)=>{try{let t=indexedDB.open(gA,_A);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(ln.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(yl,{keyPath:"compositeKey"})}}}catch(t){e(ln.create("storage-open",{originalErrorMessage:t?.message}))}}),na)}function vA(n,e){return IA(EA(n),e)}function IA(n,e){return _(this,null,function*(){let r=(yield yA()).transaction(yl,"readwrite"),s=r.objectStore(yl).put({compositeKey:n,value:e});return new Promise((o,c)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var l;c(ln.create("storage-set",{originalErrorMessage:(l=u.target.error)===null||l===void 0?void 0:l.message}))}})})}function EA(n){return`${n.options.appId}-${n.name}`}var us=new mt("@firebase/app-check");function ml(n,e){return Or()?vA(n,e).catch(t=>{us.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Pg(){return Ag().enabled}function Cg(){return _(this,null,function*(){let n=Ag();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var wA={error:"UNKNOWN_ERROR"};function TA(n){return Go.encodeString(JSON.stringify(n),!1)}function vl(n,e=!1,t=!1){return _(this,null,function*(){let r=n.app;bg(r);let i=ot(r),s=i.token,o;if(s&&!ls(s)&&(i.token=void 0,s=void 0),!s){let l=yield i.cachedTokenPromise;l&&(ls(l)?s=l:yield ml(r,void 0))}if(!e&&s&&ls(s))return{token:s.token};let c=!1;if(Pg())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=Sg(Rg(r,yield Cg()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),c=!0);let l=yield i.exchangeTokenPromise;return yield ml(r,l),i.token=l,{token:l.token}}catch(l){return l.code==="appCheck/throttled"||l.code==="appCheck/initial-throttle"?us.warn(l.message):t&&us.error(l),gl(l)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),c=!0),s=yield ot(r).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"||l.code==="appCheck/initial-throttle"?us.warn(l.message):t&&us.error(l),o=l}let u;return s?o?ls(s)?u={token:s.token,internalError:o}:u=gl(o):(u={token:s.token},i.token=s,yield ml(r,s)):u=gl(o),c&&RA(r,u),u})}function AA(n){return _(this,null,function*(){let e=n.app;bg(e);let{provider:t}=ot(e);if(Pg()){let r=yield Cg(),{token:i}=yield Sg(Rg(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function bA(n,e,t,r){let{app:i}=n,s=ot(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&ls(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),wg(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>wg(n))}function kg(n,e){let t=ot(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function wg(n){let{app:e}=n,t=ot(e),r=t.tokenRefresher;r||(r=SA(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function SA(n){let{app:e}=n;return new _l(()=>_(null,null,function*(){let t=ot(e),r;if(t.token?r=yield vl(n,!0):r=yield vl(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=ot(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Eg.RETRIAL_MIN_WAIT,Eg.RETRIAL_MAX_WAIT)}function RA(n,e){let t=ot(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function ls(n){return n.expireTimeMillis-Date.now()>0}function gl(n){return{token:TA(wA),error:n}}var Il=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=ot(this.app);for(let t of e)kg(this.app,t.next);return Promise.resolve()}};function PA(n,e){return new Il(n,e)}function CA(n){return{getToken:e=>vl(n,e),getLimitedUseToken:()=>AA(n),addTokenListener:e=>bA(n,"INTERNAL",e),removeTokenListener:e=>kg(n.app,e)}}var kA="@firebase/app-check",DA="0.10.1";var NA="app-check",Tg="app-check-internal";function OA(){st(new qe(NA,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return PA(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Tg).initialize()})),st(new qe(Tg,n=>{let e=n.getProvider("app-check").getImmediate();return CA(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),fe(kA,DA)}OA();var VA="app-check";var Fr=class{constructor(){return Jn(VA)}};var xA=["localhost","0.0.0.0","127.0.0.1"],ck=typeof window<"u"&&xA.includes(window.location.hostname);function Gg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Kg=Gg,Hg=new it("auth","Firebase",Gg());var ca=new mt("@firebase/auth");function LA(n,...e){ca.logLevel<=J.WARN&&ca.warn(`Auth (${cn}): ${n}`,...e)}function ia(n,...e){ca.logLevel<=J.ERROR&&ca.error(`Auth (${cn}): ${n}`,...e)}function tt(n,...e){throw jl(n,...e)}function at(n,...e){return jl(n,...e)}function $l(n,e,t){let r=Object.assign(Object.assign({},Kg()),{[e]:t});return new it("auth","Firebase",r).create(e,{appName:n.name})}function Ft(n){return $l(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function MA(n,e,t){let r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&tt(n,"argument-error"),$l(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function jl(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Hg.create(n,...e)}function G(n,e,...t){if(!n)throw jl(e,...t)}function Lt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw ia(e),new Error(e)}function Ut(n,e){n||Lt(e)}function Tl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function FA(){return Dg()==="http:"||Dg()==="https:"}function Dg(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function UA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(FA()||Xm()||"connection"in navigator)?navigator.onLine:!0}function BA(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Xn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ut(t>e,"Short delay should be less than long delay!"),this.isMobile=Qm()||Zm()}get(){return UA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function zl(n,e){Ut(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var ua=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Lt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Lt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Lt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var qA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var $A=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],jA=new Xn(3e4,6e4);function fn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Bt(s,o,c,u){return _(this,arguments,function*(n,e,t,r,i={}){return Qg(n,i,()=>_(null,null,function*(){let l={},f={};r&&(e==="GET"?f=r:l={body:JSON.stringify(r)});let p=Vr(Object.assign({key:n.config.apiKey},f)).slice(1),g=yield n._getAdditionalHeaders();g["Content-Type"]="application/json",n.languageCode&&(g["X-Firebase-Locale"]=n.languageCode);let E=Object.assign({method:e,headers:g},l);return Ym()||(E.referrerPolicy="no-referrer"),n.emulatorConfig&&Nt(n.emulatorConfig.host)&&(E.credentials="include"),ua.fetch()(yield Jg(n,n.config.apiHost,t,p),E)}))})}function Qg(n,e,t){return _(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},qA),e);try{let i=new Al(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw ra(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,l]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ra(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw ra(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw ra(n,"user-disabled",o);let f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw $l(n,f,l);tt(n,f)}}catch(i){if(i instanceof He)throw i;tt(n,"network-request-failed",{message:String(i)})}})}function ys(s,o,c,u){return _(this,arguments,function*(n,e,t,r,i={}){let l=yield Bt(n,e,t,r,i);return"mfaPendingCredential"in l&&tt(n,"multi-factor-auth-required",{_serverResponse:l}),l})}function Jg(n,e,t,r){return _(this,null,function*(){let i=`${e}${t}?${r}`,s=n,o=s.config.emulator?zl(n.config,i):`${n.config.apiScheme}://${i}`;return $A.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}function zA(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Al=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(at(this.auth,"network-request-failed")),jA.get())})}};function ra(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=at(n,e,r);return i.customData._tokenResponse=t,i}function Ng(n){return n!==void 0&&n.enterprise!==void 0}var bl=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return zA(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};function WA(n,e){return _(this,null,function*(){return Bt(n,"GET","/v2/recaptchaConfig",fn(n,e))})}function GA(n,e){return _(this,null,function*(){return Bt(n,"POST","/v1/accounts:delete",e)})}function la(n,e){return _(this,null,function*(){return Bt(n,"POST","/v1/accounts:lookup",e)})}function ds(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Wl(n,e=!1){return _(this,null,function*(){let t=re(n),r=yield t.getIdToken(e),i=Gl(r);G(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:ds(El(i.auth_time)),issuedAtTime:ds(El(i.iat)),expirationTime:ds(El(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function El(n){return Number(n)*1e3}function Gl(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ia("JWT malformed, contained fewer than 3 sections"),null;try{let i=Ko(t);return i?JSON.parse(i):(ia("Failed to decode base64 JWT payload"),null)}catch(i){return ia("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Og(n){let e=Gl(n);return G(e,"internal-error"),G(typeof e.exp<"u","internal-error"),G(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Br(n,e,t=!1){return _(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof He&&KA(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function KA({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Sl=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>_(this,null,function*(){yield this.iteration()}),t)}iteration(){return _(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var ps=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ds(this.lastLoginAt),this.creationTime=ds(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function ha(n){return _(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Br(n,la(t,{idToken:r}));G(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Yg(s.providerUserInfo):[],c=HA(n.providerData,o),u=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!c?.length,f=u?l:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new ps(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(n,p)})}function Kl(n){return _(this,null,function*(){let e=re(n);yield ha(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function HA(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Yg(n){return n.map(e=>{var{providerId:t}=e,r=jo(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function QA(n,e){return _(this,null,function*(){let t=yield Qg(n,{},()=>_(null,null,function*(){let r=Vr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=yield Jg(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:c,body:r};return n.emulatorConfig&&Nt(n.emulatorConfig.host)&&(u.credentials="include"),ua.fetch()(o,u)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function JA(n,e){return _(this,null,function*(){return Bt(n,"POST","/v2/accounts:revokeToken",fn(n,e))})}var fs=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){G(e.idToken,"internal-error"),G(typeof e.idToken<"u","internal-error"),G(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Og(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){G(e.length!==0,"internal-error");let t=Og(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return _(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(G(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return _(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield QA(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&(G(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(G(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(G(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Lt("not implemented")}};function hn(n,e){G(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var dn=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=jo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Sl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ps(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return _(this,null,function*(){let t=yield Br(this,this.stsTokenManager.getToken(this.auth,e));return G(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Wl(this,e)}reload(){return Kl(this)}_assign(e){this!==e&&(G(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){G(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return _(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield ha(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return _(this,null,function*(){if($e(this.auth.app))return Promise.reject(Ft(this.auth));let e=yield this.getIdToken();return yield Br(this,GA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,c,u,l,f;let p=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(i=t.email)!==null&&i!==void 0?i:void 0,E=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,k=(o=t.photoURL)!==null&&o!==void 0?o:void 0,N=(c=t.tenantId)!==null&&c!==void 0?c:void 0,O=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,U=(l=t.createdAt)!==null&&l!==void 0?l:void 0,$=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:q,emailVerified:H,isAnonymous:te,providerData:K,stsTokenManager:w}=t;G(q&&w,e,"internal-error");let y=fs.fromJSON(this.name,w);G(typeof q=="string",e,"internal-error"),hn(p,e.name),hn(g,e.name),G(typeof H=="boolean",e,"internal-error"),G(typeof te=="boolean",e,"internal-error"),hn(E,e.name),hn(k,e.name),hn(N,e.name),hn(O,e.name),hn(U,e.name),hn($,e.name);let I=new n({uid:q,auth:e,email:g,emailVerified:H,displayName:p,isAnonymous:te,photoURL:k,phoneNumber:E,tenantId:N,stsTokenManager:y,createdAt:U,lastLoginAt:$});return K&&Array.isArray(K)&&(I.providerData=K.map(T=>Object.assign({},T))),O&&(I._redirectEventId=O),I}static _fromIdTokenResponse(e,t,r=!1){return _(this,null,function*(){let i=new fs;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield ha(s),s})}static _fromGetAccountInfoResponse(e,t,r){return _(this,null,function*(){let i=t.users[0];G(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Yg(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,c=new fs;c.updateFromIdToken(r);let u=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new ps(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,l),u})}};var Vg=new Map;function Mt(n){Ut(n instanceof Function,"Expected a class definition");let e=Vg.get(n);return e?(Ut(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Vg.set(n,e),e)}var YA=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return _(this,null,function*(){return!0})}_set(t,r){return _(this,null,function*(){this.storage[t]=r})}_get(t){return _(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return _(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Rl=YA;function sa(n,e,t){return`firebase:${n}:${e}:${t}`}var da=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=sa(this.userKey,i.apiKey,s),this.fullPersistenceKey=sa("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return _(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield la(this.auth,{idToken:e}).catch(()=>{});return t?dn._fromGetAccountInfoResponse(this.auth,t,e):null}return dn._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return _(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return _(this,null,function*(){if(!t.length)return new n(Mt(Rl),e,r);let i=(yield Promise.all(t.map(l=>_(null,null,function*(){if(yield l._isAvailable())return l})))).filter(l=>l),s=i[0]||Mt(Rl),o=sa(r,e.config.apiKey,e.name),c=null;for(let l of t)try{let f=yield l._get(o);if(f){let p;if(typeof f=="string"){let g=yield la(e,{idToken:f}).catch(()=>{});if(!g)break;p=yield dn._fromGetAccountInfoResponse(e,g,f)}else p=dn._fromJSON(e,f);l!==s&&(c=p),s=l;break}}catch{}let u=i.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,e,r):(s=u[0],c&&(yield s._set(o,c.toJSON())),yield Promise.all(t.map(l=>_(null,null,function*(){if(l!==s)try{yield l._remove(o)}catch{}}))),new n(s,e,r))})}};function xg(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(t_(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Xg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(r_(e))return"Blackberry";if(i_(e))return"Webos";if(Zg(e))return"Safari";if((e.includes("chrome/")||e_(e))&&!e.includes("edge/"))return"Chrome";if(n_(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Xg(n=_e()){return/firefox\//i.test(n)}function Zg(n=_e()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function e_(n=_e()){return/crios\//i.test(n)}function t_(n=_e()){return/iemobile/i.test(n)}function n_(n=_e()){return/android/i.test(n)}function r_(n=_e()){return/blackberry/i.test(n)}function i_(n=_e()){return/webos/i.test(n)}function Hl(n=_e()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function XA(n=_e()){var e;return Hl(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function ZA(){return eg()&&document.documentMode===10}function s_(n=_e()){return Hl(n)||n_(n)||i_(n)||r_(n)||/windows phone/i.test(n)||t_(n)}function o_(n,e=[]){let t;switch(n){case"Browser":t=xg(_e());break;case"Worker":t=`${xg(_e())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${cn}/${r}`}var Pl=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return _(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function eb(t){return _(this,arguments,function*(n,e={}){return Bt(n,"GET","/v2/passwordPolicy",fn(n,e))})}var tb=6,Cl=class{constructor(e){var t,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:tb,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,c;let u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var kl=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fa(this),this.idTokenSubscription=new fa(this),this.beforeStateQueue=new Pl(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Hg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Mt(t)),this._initializationPromise=this.queue(()=>_(this,null,function*(){var r,i,s;if(!this._deleted&&(this.persistenceManager=yield da.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return _(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return _(this,null,function*(){try{let t=yield la(this,{idToken:e}),r=yield dn._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return _(this,null,function*(){var t;if($e(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===c)&&u?.user&&(i=u.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return G(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return _(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return _(this,null,function*(){try{yield ha(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=BA()}_delete(){return _(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return _(this,null,function*(){if($e(this.app))return Promise.reject(Ft(this));let t=e?re(e):null;return t&&G(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return _(this,null,function*(){if(!this._deleted)return e&&G(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>_(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return _(this,null,function*(){return $e(this.app)?Promise.reject(Ft(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return $e(this.app)?Promise.reject(Ft(this)):this.queue(()=>_(this,null,function*(){yield this.assertedPersistence.setPersistence(Mt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return _(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return _(this,null,function*(){let e=yield eb(this),t=new Cl(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new it("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return _(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield JA(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return _(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return _(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Mt(e)||this._popupRedirectResolver;G(t,this,"argument-error"),this.redirectPersistenceManager=yield da.create(this,[Mt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return _(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>_(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return _(this,null,function*(){if(e===this.currentUser)return this.queue(()=>_(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(G(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return _(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return G(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=o_(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return _(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return _(this,null,function*(){var e;if($e(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&LA(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function pn(n){return re(n)}var fa=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=rg(t=>this.observer=t)}get next(){return G(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var wa={loadJS(){return _(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nb(n){wa=n}function a_(n){return wa.loadJS(n)}function rb(){return wa.recaptchaEnterpriseScript}function ib(){return wa.gapiScript}function c_(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var Dl=class{constructor(){this.enterprise=new Nl}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Nl=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var sb="recaptcha-enterprise",u_="NO_RECAPTCHA",Ol=class{constructor(e){this.type=sb,this.auth=pn(e)}verify(e="verify",t=!1){return _(this,null,function*(){function r(s){return _(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,c)=>_(null,null,function*(){WA(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let l=new bl(u);return s.tenantId==null?s._agentRecaptchaConfig=l:s._tenantRecaptchaConfigs[s.tenantId]=l,o(l.siteKey)}}).catch(u=>{c(u)})}))})}function i(s,o,c){let u=window.grecaptcha;Ng(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(l=>{o(l)}).catch(()=>{o(u_)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Dl().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{r(this.auth).then(c=>{if(!t&&Ng(window.grecaptcha))i(c,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=rb();u.length!==0&&(u+=c),a_(u).then(()=>{i(c,s,o)}).catch(l=>{o(l)})}}).catch(c=>{o(c)})})})}};function hs(n,e,t,r=!1,i=!1){return _(this,null,function*(){let s=new Ol(n),o;if(i)o=u_;else try{o=yield s.verify(t)}catch{o=yield s.verify(t,!0)}let c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let u=c.phoneEnrollmentInfo.phoneNumber,l=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let u=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:o}):Object.assign(c,{captchaResponse:o}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c})}function Vl(n,e,t,r,i){return _(this,null,function*(){var s,o;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let c=yield hs(n,e,t,t==="getOobCode");return r(n,c)}else return r(n,e).catch(c=>_(null,null,function*(){if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let u=yield hs(n,e,t,t==="getOobCode");return r(n,u)}else return Promise.reject(c)}));else if(i==="PHONE_PROVIDER")if(!((o=n._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){let c=yield hs(n,e,t);return r(n,c).catch(u=>_(null,null,function*(){var l;if(((l=n._getRecaptchaConfig())===null||l===void 0?void 0:l.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(u.code==="auth/missing-recaptcha-token"||u.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let f=yield hs(n,e,t,!1,!0);return r(n,f)}return Promise.reject(u)}))}else{let c=yield hs(n,e,t,!1,!0);return r(n,c)}else return Promise.reject(i+" provider is not supported.")})}function Ql(n,e){let t=an(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(ze(s,e??{}))return i;tt(i,"already-initialized")}return t.initialize({options:e})}function ob(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Mt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Jl(n,e,t){let r=pn(n);G(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=l_(e),{host:o,port:c}=ab(e),u=c===null?"":`:${c}`,l={url:`${s}//${o}${u}/`},f=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){G(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),G(ze(l,r.config.emulator)&&ze(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=l,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Nt(o)?(ss(`${s}//${o}${u}`),Jo("Auth",!0)):i||cb()}function l_(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ab(n){let e=l_(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:Lg(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:Lg(o)}}}function Lg(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function cb(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var qr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Lt("not implemented")}_getIdTokenResponse(e){return Lt("not implemented")}_linkToIdToken(e,t){return Lt("not implemented")}_getReauthenticationResolver(e){return Lt("not implemented")}};function ub(n,e){return _(this,null,function*(){return Bt(n,"POST","/v1/accounts:signUp",e)})}function lb(n,e){return _(this,null,function*(){return ys(n,"POST","/v1/accounts:signInWithPassword",fn(n,e))})}function hb(n,e){return _(this,null,function*(){return ys(n,"POST","/v1/accounts:signInWithEmailLink",fn(n,e))})}function db(n,e){return _(this,null,function*(){return ys(n,"POST","/v1/accounts:signInWithEmailLink",fn(n,e))})}var ms=class n extends qr{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return _(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Vl(e,t,"signInWithPassword",lb,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return hb(e,{email:this._email,oobCode:this._password});default:tt(e,"internal-error")}})}_linkToIdToken(e,t){return _(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Vl(e,r,"signUpPassword",ub,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return db(e,{idToken:t,email:this._email,oobCode:this._password});default:tt(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function Ur(n,e){return _(this,null,function*(){return ys(n,"POST","/v1/accounts:signInWithIdp",fn(n,e))})}var fb="http://localhost",pa=class n extends qr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=jo(t,["providerId","signInMethod"]);if(!r||!i)return null;let o=new n(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return Ur(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,Ur(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Ur(e,t)}buildRequest(){let e={requestUri:fb,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Vr(t)}return e}};function pb(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function mb(n){let e=xr(Lr(n)).link,t=e?xr(Lr(e)).deep_link_id:null,r=xr(Lr(n)).deep_link_id;return(r?xr(Lr(r)).link:null)||r||t||e||n}var ma=class n{constructor(e){var t,r,i,s,o,c;let u=xr(Lr(e)),l=(t=u.apiKey)!==null&&t!==void 0?t:null,f=(r=u.oobCode)!==null&&r!==void 0?r:null,p=pb((i=u.mode)!==null&&i!==void 0?i:null);G(l&&f&&p,"argument-error"),this.apiKey=l,this.operation=p,this.code=f,this.continueUrl=(s=u.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=u.lang)!==null&&o!==void 0?o:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=mb(e);try{return new n(t)}catch{return null}}};var h_=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return ms._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=ma.parseLink(r);return G(i,"argument-error"),ms._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),gs=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var ga=class extends gs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var gb=(()=>{class n extends ga{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return pa._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();function _b(n,e){return _(this,null,function*(){return ys(n,"POST","/v1/accounts:signUp",fn(n,e))})}var $r=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return _(this,null,function*(){let s=yield dn._fromIdTokenResponse(e,r,i),o=Mg(r);return new n({user:s,providerId:o,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return _(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Mg(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Mg(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var xl=class n extends He{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function d_(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?xl._fromErrorAndOperation(n,s,e,r):s})}function yb(n,e,t=!1){return _(this,null,function*(){let r=yield Br(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return $r._forOperation(n,"link",r)})}function vb(n,e,t=!1){return _(this,null,function*(){let{auth:r}=n;if($e(r.app))return Promise.reject(Ft(r));let i="reauthenticate";try{let s=yield Br(n,d_(r,i,e,n),t);G(s.idToken,r,"internal-error");let o=Gl(s.idToken);G(o,r,"internal-error");let{sub:c}=o;return G(n.uid===c,r,"user-mismatch"),$r._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&tt(r,"user-mismatch"),s}})}function f_(n,e,t=!1){return _(this,null,function*(){if($e(n.app))return Promise.reject(Ft(n));let r="signIn",i=yield d_(n,r,e),s=yield $r._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function Yl(n,e){return _(this,null,function*(){return f_(pn(n),e)})}function p_(n){return _(this,null,function*(){let e=pn(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function Xl(n,e,t){return _(this,null,function*(){if($e(n.app))return Promise.reject(Ft(n));let r=pn(n),o=yield Vl(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_b,"EMAIL_PASSWORD_PROVIDER").catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&p_(n),u}),c=yield $r._fromIdTokenResponse(r,"signIn",o);return yield r._updateCurrentUser(c.user),c})}function Zl(n,e,t){return $e(n.app)?Promise.reject(Ft(n)):Yl(re(n),h_.credential(e,t)).catch(r=>_(null,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&p_(n),r}))}function Ib(n,e){return _(this,null,function*(){return Bt(n,"POST","/v1/accounts:update",e)})}function eh(r,i){return _(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=re(n),c={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},u=yield Br(s,Ib(s.auth,c));s.displayName=u.displayName||null,s.photoURL=u.photoUrl||null;let l=s.providerData.find(({providerId:f})=>f==="password");l&&(l.displayName=s.displayName,l.photoURL=s.photoURL),yield s._updateTokensIfNecessary(u)})}function vs(n,e,t,r){return re(n).onIdTokenChanged(e,t,r)}function th(n,e,t){return re(n).beforeAuthStateChanged(e,t)}function Ta(n,e,t,r){return re(n).onAuthStateChanged(e,t,r)}function nh(n){return re(n).signOut()}var _a="__sak";var ya=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_a,"1"),this.storage.removeItem(_a),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var Eb=1e3,wb=10,Tb=(()=>{class n extends ya{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=s_(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((c,u,l)=>{this.notifyListeners(c,l)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!r&&this.localCache[i]===c||this.notifyListeners(i,c)},o=this.storage.getItem(i);ZA()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,wb):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},Eb)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return _(this,null,function*(){yield dt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return _(this,null,function*(){let r=yield dt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return _(this,null,function*(){yield dt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),m_=Tb;var Ab=(()=>{class n extends ya{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),rh=Ab;function bb(n){return Promise.all(n.map(e=>_(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var Sb=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return _(this,null,function*(){let r=t,{eventId:i,eventType:s,data:o}=r.data,c=this.handlersMap[s];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let u=Array.from(c).map(f=>_(this,null,function*(){return f(r.origin,o)})),l=yield bb(u);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:l})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function ih(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var Ll=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return _(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let l=ih("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(p){let g=p;if(g.data.eventId===l)switch(g.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(g.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function _t(){return window}function Rb(n){_t().location.href=n}function g_(){return typeof _t().WorkerGlobalScope<"u"&&typeof _t().importScripts=="function"}function Pb(){return _(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function Cb(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function kb(){return g_()?self:null}var __="firebaseLocalStorageDb",Db=1,va="firebaseLocalStorage",y_="fbase_key",Zn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Aa(n,e){return n.transaction([va],e?"readwrite":"readonly").objectStore(va)}function Nb(){let n=indexedDB.deleteDatabase(__);return new Zn(n).toPromise()}function Ml(){let n=indexedDB.open(__,Db);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(va,{keyPath:y_})}catch(i){t(i)}}),n.addEventListener("success",()=>_(null,null,function*(){let r=n.result;r.objectStoreNames.contains(va)?e(r):(r.close(),yield Nb(),e(yield Ml()))}))})}function Fg(n,e,t){return _(this,null,function*(){let r=Aa(n,!0).put({[y_]:e,value:t});return new Zn(r).toPromise()})}function Ob(n,e){return _(this,null,function*(){let t=Aa(n,!1).get(e),r=yield new Zn(t).toPromise();return r===void 0?null:r.value})}function Ug(n,e){let t=Aa(n,!0).delete(e);return new Zn(t).toPromise()}var Vb=800,xb=3,Lb=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return _(this,null,function*(){return this.db?this.db:(this.db=yield Ml(),this.db)})}_withRetries(t){return _(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>xb)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return _(this,null,function*(){return g_()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return _(this,null,function*(){this.receiver=Sb._getInstance(kb()),this.receiver._subscribe("keyChanged",(t,r)=>_(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>_(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return _(this,null,function*(){var t,r;if(this.activeServiceWorker=yield Pb(),!this.activeServiceWorker)return;this.sender=new Ll(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return _(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||Cb()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return _(this,null,function*(){try{if(!indexedDB)return!1;let t=yield Ml();return yield Fg(t,_a,"1"),yield Ug(t,_a),!0}catch{}return!1})}_withPendingWrite(t){return _(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return _(this,null,function*(){return this._withPendingWrite(()=>_(this,null,function*(){return yield this._withRetries(i=>Fg(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return _(this,null,function*(){let r=yield this._withRetries(i=>Ob(i,t));return this.localCache[t]=r,r})}_remove(t){return _(this,null,function*(){return this._withPendingWrite(()=>_(this,null,function*(){return yield this._withRetries(r=>Ug(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return _(this,null,function*(){let t=yield this._withRetries(s=>{let o=Aa(s,!1).getAll();return new Zn(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>_(this,null,function*(){return this._poll()}),Vb)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),v_=Lb;var gk=c_("rcb"),_k=new Xn(3e4,6e4);function I_(n,e){return e?Mt(e):(G(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var _s=class extends qr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ur(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ur(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ur(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Mb(n){return f_(n.auth,new _s(n),n.bypassAuthState)}function Fb(n){let{auth:e,user:t}=n;return G(t,e,"internal-error"),vb(t,new _s(n),n.bypassAuthState)}function Ub(n){return _(this,null,function*(){let{auth:e,user:t}=n;return G(t,e,"internal-error"),yb(t,new _s(n),n.bypassAuthState)})}var Ia=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>_(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return _(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(u))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Mb;case"linkViaPopup":case"linkViaRedirect":return Ub;case"reauthViaPopup":case"reauthViaRedirect":return Fb;default:tt(this.auth,"internal-error")}}resolve(e){Ut(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ut(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var Bb=new Xn(2e3,1e4);function sh(n,e,t){return _(this,null,function*(){if($e(n.app))return Promise.reject(at(n,"operation-not-supported-in-this-environment"));let r=pn(n);MA(n,e,gs);let i=I_(r,t);return new qb(r,"signInViaPopup",e,i).executeNotNull()})}var qb=(()=>{class n extends Ia{constructor(t,r,i,s,o){super(t,r,s,o),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return _(this,null,function*(){let t=yield this.execute();return G(t,this.auth,"internal-error"),t})}onExecution(){return _(this,null,function*(){Ut(this.filter.length===1,"Popup operations only handle one event");let t=ih();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(at(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(at(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let t=()=>{var r,i;if(!((i=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(at(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Bb.get())};t()}}n.currentPopupAction=null;return n})(),$b="pendingRedirect",oa=new Map,Fl=class n extends Ia{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return _(this,null,function*(){let e=oa.get(this.auth._key());if(!e){try{let r=(yield jb(this.resolver,this.auth))?yield dt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}oa.set(this.auth._key(),e)}return this.bypassAuthState||oa.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return _(this,null,function*(){if(e.type==="signInViaRedirect")return dt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,dt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return _(this,null,function*(){})}cleanUp(){}};function jb(n,e){return _(this,null,function*(){let t=Gb(e),r=Wb(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function zb(n,e){oa.set(n._key(),e)}function Wb(n){return Mt(n._redirectPersistence)}function Gb(n){return sa($b,n.config.apiKey,n.name)}function Kb(n,e,t=!1){return _(this,null,function*(){if($e(n.app))return Promise.reject(Ft(n));let r=pn(n),i=I_(r,e),o=yield new Fl(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})}var Hb=10*60*1e3,Ul=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Qb(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!E_(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(at(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Hb&&this.cachedEventUids.clear(),this.cachedEventUids.has(Bg(e))}saveEventToCache(e){this.cachedEventUids.add(Bg(e)),this.lastProcessedEventTime=Date.now()}};function Bg(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function E_({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Qb(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return E_(n);default:return!1}}function Jb(t){return _(this,arguments,function*(n,e={}){return Bt(n,"GET","/v1/projects",e)})}var Yb=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xb=/^https?/;function Zb(n){return _(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield Jb(n);for(let t of e)try{if(e0(t))return}catch{}tt(n,"unauthorized-domain")})}function e0(n){let e=Tl(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!Xb.test(t))return!1;if(Yb.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var t0=new Xn(3e4,6e4);function qg(){let n=_t().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function n0(n){return new Promise((e,t)=>{var r,i,s;function o(){qg(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{qg(),t(at(n,"network-request-failed"))},timeout:t0.get()})}if(!((i=(r=_t().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=_t().gapi)===null||s===void 0)&&s.load)o();else{let c=c_("iframefcb");return _t()[c]=()=>{gapi.load?o():t(at(n,"network-request-failed"))},a_(`${ib()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw aa=null,e})}var aa=null;function r0(n){return aa=aa||n0(n),aa}var i0=new Xn(5e3,15e3),s0="__/auth/iframe",o0="emulator/auth/iframe",a0={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},c0=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function u0(n){let e=n.config;G(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?zl(e,o0):`https://${n.config.authDomain}/${s0}`,r={apiKey:e.apiKey,appName:n.name,v:cn},i=c0.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Vr(r).slice(1)}`}function l0(n){return _(this,null,function*(){let e=yield r0(n),t=_t().gapi;return G(t,n,"internal-error"),e.open({where:document.body,url:u0(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:a0,dontclear:!0},r=>new Promise((i,s)=>_(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let o=at(n,"network-request-failed"),c=_t().setTimeout(()=>{s(o)},i0.get());function u(){_t().clearTimeout(c),i(r)}r.ping(u).then(u,()=>{s(o)})})))})}var h0={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},d0=500,f0=600,p0="_blank",m0="http://localhost",Ea=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function g0(n,e,t,r=d0,i=f0){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",u=Object.assign(Object.assign({},h0),{width:r.toString(),height:i.toString(),top:s,left:o}),l=_e().toLowerCase();t&&(c=e_(l)?p0:t),Xg(l)&&(e=e||m0,u.scrollbars="yes");let f=Object.entries(u).reduce((g,[E,k])=>`${g}${E}=${k},`,"");if(XA(l)&&c!=="_self")return _0(e||"",c),new Ea(null);let p=window.open(e||"",c,f);G(p,n,"popup-blocked");try{p.focus()}catch{}return new Ea(p)}function _0(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var y0="__/auth/handler",v0="emulator/auth/handler",I0=encodeURIComponent("fac");function $g(n,e,t,r,i,s){return _(this,null,function*(){G(n.config.authDomain,n,"auth-domain-config-required"),G(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:cn,eventId:i};if(e instanceof gs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",ng(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,p]of Object.entries(s||{}))o[f]=p}if(e instanceof ga){let f=e.getScopes().filter(p=>p!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=yield n._getAppCheckToken(),l=u?`#${I0}=${encodeURIComponent(u)}`:"";return`${E0(n)}?${Vr(c).slice(1)}${l}`})}function E0({config:n}){return n.emulator?zl(n,v0):`https://${n.authDomain}/${y0}`}var wl="webStorageSupport",Bl=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rh,this._completeRedirectFn=Kb,this._overrideRedirectResult=zb}_openPopup(e,t,r,i){return _(this,null,function*(){var s;Ut((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield $g(e,t,r,Tl(),i);return g0(e,o,ih())})}_openRedirect(e,t,r,i){return _(this,null,function*(){yield this._originValidation(e);let s=yield $g(e,t,r,Tl(),i);return Rb(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Ut(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return _(this,null,function*(){let t=yield l0(e),r=new Ul(e);return t.register("authEvent",i=>(G(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(wl,{type:wl},i=>{var s;let o=(s=i?.[0])===null||s===void 0?void 0:s[wl];o!==void 0&&t(!!o),tt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Zb(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return s_()||Zg()||Hl()}},w_=Bl;var jg="@firebase/auth",zg="1.10.8";var ql=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return _(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){G(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function w0(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function T0(n){st(new qe("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=r.options;G(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let u={apiKey:o,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:o_(n)},l=new kl(r,i,s,u);return ob(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),st(new qe("auth-internal",e=>{let t=pn(e.getProvider("auth").getImmediate());return(r=>new ql(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),fe(jg,zg,w0(n)),fe(jg,zg,"esm2017")}var A0=5*60,b0=Ju("authIdTokenMaxAge")||A0,Wg=null,S0=n=>e=>_(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>b0)return;let i=t?.token;Wg!==i&&(Wg=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function oh(n=Hn()){let e=an(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Ql(n,{popupRedirectResolver:w_,persistence:[v_,m_,rh]}),r=Ju("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=S0(s.toString());th(t,o,()=>o(t.currentUser)),vs(t,c=>o(c))}}let i=Hu("auth");return i&&Jl(t,`http://${i}`),t}function R0(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}nb({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=at("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",R0().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});T0("Browser");function A_(n){return new ft(function(e){var t=Ta(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}function b_(n){return new ft(function(e){var t=vs(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var S_="auth",Is=class{constructor(e){return e}},Es=class{constructor(){return Jn(S_)}};var ah=new Dr("angularfire2.auth-instances");function dS(n,e){let t=cs(S_,n,e);return t&&new Is(t)}function fS(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Is(r)}}var pS={provide:Es,deps:[[new et,ah]]},mS={provide:Is,useFactory:dS,deps:[[new et,ah],xt]};function aD(n,...e){return fe("angularfire",Vt.full,"auth"),Nr([mS,pS,{provide:ah,useFactory:fS(n),multi:!0,deps:[pt,sn,un,Yn,[new et,Fr],...e]}])}var cD=x(A_,!0);var uD=x(b_,!0);var lD=x(Xl,!0,2);var hD=x(oh,!0);var dD=x(Zl,!0,2);var fD=x(sh,!0,2);var pD=x(nh,!0,2);var mD=x(eh,!0,2);var R_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},P_={};var qt,ch;(function(){var n;function e(w,y){function I(){}I.prototype=y.prototype,w.D=y.prototype,w.prototype=new I,w.prototype.constructor=w,w.C=function(T,A,R){for(var v=Array(arguments.length-2),Pt=2;Pt<arguments.length;Pt++)v[Pt-2]=arguments[Pt];return y.prototype[A].apply(T,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,y,I){I||(I=0);var T=Array(16);if(typeof y=="string")for(var A=0;16>A;++A)T[A]=y.charCodeAt(I++)|y.charCodeAt(I++)<<8|y.charCodeAt(I++)<<16|y.charCodeAt(I++)<<24;else for(A=0;16>A;++A)T[A]=y[I++]|y[I++]<<8|y[I++]<<16|y[I++]<<24;y=w.g[0],I=w.g[1],A=w.g[2];var R=w.g[3],v=y+(R^I&(A^R))+T[0]+3614090360&4294967295;y=I+(v<<7&4294967295|v>>>25),v=R+(A^y&(I^A))+T[1]+3905402710&4294967295,R=y+(v<<12&4294967295|v>>>20),v=A+(I^R&(y^I))+T[2]+606105819&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(y^A&(R^y))+T[3]+3250441966&4294967295,I=A+(v<<22&4294967295|v>>>10),v=y+(R^I&(A^R))+T[4]+4118548399&4294967295,y=I+(v<<7&4294967295|v>>>25),v=R+(A^y&(I^A))+T[5]+1200080426&4294967295,R=y+(v<<12&4294967295|v>>>20),v=A+(I^R&(y^I))+T[6]+2821735955&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(y^A&(R^y))+T[7]+4249261313&4294967295,I=A+(v<<22&4294967295|v>>>10),v=y+(R^I&(A^R))+T[8]+1770035416&4294967295,y=I+(v<<7&4294967295|v>>>25),v=R+(A^y&(I^A))+T[9]+2336552879&4294967295,R=y+(v<<12&4294967295|v>>>20),v=A+(I^R&(y^I))+T[10]+4294925233&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(y^A&(R^y))+T[11]+2304563134&4294967295,I=A+(v<<22&4294967295|v>>>10),v=y+(R^I&(A^R))+T[12]+1804603682&4294967295,y=I+(v<<7&4294967295|v>>>25),v=R+(A^y&(I^A))+T[13]+4254626195&4294967295,R=y+(v<<12&4294967295|v>>>20),v=A+(I^R&(y^I))+T[14]+2792965006&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(y^A&(R^y))+T[15]+1236535329&4294967295,I=A+(v<<22&4294967295|v>>>10),v=y+(A^R&(I^A))+T[1]+4129170786&4294967295,y=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(y^I))+T[6]+3225465664&4294967295,R=y+(v<<9&4294967295|v>>>23),v=A+(y^I&(R^y))+T[11]+643717713&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^y&(A^R))+T[0]+3921069994&4294967295,I=A+(v<<20&4294967295|v>>>12),v=y+(A^R&(I^A))+T[5]+3593408605&4294967295,y=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(y^I))+T[10]+38016083&4294967295,R=y+(v<<9&4294967295|v>>>23),v=A+(y^I&(R^y))+T[15]+3634488961&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^y&(A^R))+T[4]+3889429448&4294967295,I=A+(v<<20&4294967295|v>>>12),v=y+(A^R&(I^A))+T[9]+568446438&4294967295,y=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(y^I))+T[14]+3275163606&4294967295,R=y+(v<<9&4294967295|v>>>23),v=A+(y^I&(R^y))+T[3]+4107603335&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^y&(A^R))+T[8]+1163531501&4294967295,I=A+(v<<20&4294967295|v>>>12),v=y+(A^R&(I^A))+T[13]+2850285829&4294967295,y=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(y^I))+T[2]+4243563512&4294967295,R=y+(v<<9&4294967295|v>>>23),v=A+(y^I&(R^y))+T[7]+1735328473&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^y&(A^R))+T[12]+2368359562&4294967295,I=A+(v<<20&4294967295|v>>>12),v=y+(I^A^R)+T[5]+4294588738&4294967295,y=I+(v<<4&4294967295|v>>>28),v=R+(y^I^A)+T[8]+2272392833&4294967295,R=y+(v<<11&4294967295|v>>>21),v=A+(R^y^I)+T[11]+1839030562&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^y)+T[14]+4259657740&4294967295,I=A+(v<<23&4294967295|v>>>9),v=y+(I^A^R)+T[1]+2763975236&4294967295,y=I+(v<<4&4294967295|v>>>28),v=R+(y^I^A)+T[4]+1272893353&4294967295,R=y+(v<<11&4294967295|v>>>21),v=A+(R^y^I)+T[7]+4139469664&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^y)+T[10]+3200236656&4294967295,I=A+(v<<23&4294967295|v>>>9),v=y+(I^A^R)+T[13]+681279174&4294967295,y=I+(v<<4&4294967295|v>>>28),v=R+(y^I^A)+T[0]+3936430074&4294967295,R=y+(v<<11&4294967295|v>>>21),v=A+(R^y^I)+T[3]+3572445317&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^y)+T[6]+76029189&4294967295,I=A+(v<<23&4294967295|v>>>9),v=y+(I^A^R)+T[9]+3654602809&4294967295,y=I+(v<<4&4294967295|v>>>28),v=R+(y^I^A)+T[12]+3873151461&4294967295,R=y+(v<<11&4294967295|v>>>21),v=A+(R^y^I)+T[15]+530742520&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^y)+T[2]+3299628645&4294967295,I=A+(v<<23&4294967295|v>>>9),v=y+(A^(I|~R))+T[0]+4096336452&4294967295,y=I+(v<<6&4294967295|v>>>26),v=R+(I^(y|~A))+T[7]+1126891415&4294967295,R=y+(v<<10&4294967295|v>>>22),v=A+(y^(R|~I))+T[14]+2878612391&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~y))+T[5]+4237533241&4294967295,I=A+(v<<21&4294967295|v>>>11),v=y+(A^(I|~R))+T[12]+1700485571&4294967295,y=I+(v<<6&4294967295|v>>>26),v=R+(I^(y|~A))+T[3]+2399980690&4294967295,R=y+(v<<10&4294967295|v>>>22),v=A+(y^(R|~I))+T[10]+4293915773&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~y))+T[1]+2240044497&4294967295,I=A+(v<<21&4294967295|v>>>11),v=y+(A^(I|~R))+T[8]+1873313359&4294967295,y=I+(v<<6&4294967295|v>>>26),v=R+(I^(y|~A))+T[15]+4264355552&4294967295,R=y+(v<<10&4294967295|v>>>22),v=A+(y^(R|~I))+T[6]+2734768916&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~y))+T[13]+1309151649&4294967295,I=A+(v<<21&4294967295|v>>>11),v=y+(A^(I|~R))+T[4]+4149444226&4294967295,y=I+(v<<6&4294967295|v>>>26),v=R+(I^(y|~A))+T[11]+3174756917&4294967295,R=y+(v<<10&4294967295|v>>>22),v=A+(y^(R|~I))+T[2]+718787259&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~y))+T[9]+3951481745&4294967295,w.g[0]=w.g[0]+y&4294967295,w.g[1]=w.g[1]+(A+(v<<21&4294967295|v>>>11))&4294967295,w.g[2]=w.g[2]+A&4294967295,w.g[3]=w.g[3]+R&4294967295}r.prototype.u=function(w,y){y===void 0&&(y=w.length);for(var I=y-this.blockSize,T=this.B,A=this.h,R=0;R<y;){if(A==0)for(;R<=I;)i(this,w,R),R+=this.blockSize;if(typeof w=="string"){for(;R<y;)if(T[A++]=w.charCodeAt(R++),A==this.blockSize){i(this,T),A=0;break}}else for(;R<y;)if(T[A++]=w[R++],A==this.blockSize){i(this,T),A=0;break}}this.h=A,this.o+=y},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var y=1;y<w.length-8;++y)w[y]=0;var I=8*this.o;for(y=w.length-8;y<w.length;++y)w[y]=I&255,I/=256;for(this.u(w),w=Array(16),y=I=0;4>y;++y)for(var T=0;32>T;T+=8)w[I++]=this.g[y]>>>T&255;return w};function s(w,y){var I=c;return Object.prototype.hasOwnProperty.call(I,w)?I[w]:I[w]=y(w)}function o(w,y){this.h=y;for(var I=[],T=!0,A=w.length-1;0<=A;A--){var R=w[A]|0;T&&R==y||(I[A]=R,T=!1)}this.g=I}var c={};function u(w){return-128<=w&&128>w?s(w,function(y){return new o([y|0],0>y?-1:0)}):new o([w|0],0>w?-1:0)}function l(w){if(isNaN(w)||!isFinite(w))return p;if(0>w)return O(l(-w));for(var y=[],I=1,T=0;w>=I;T++)y[T]=w/I|0,I*=4294967296;return new o(y,0)}function f(w,y){if(w.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(w.charAt(0)=="-")return O(f(w.substring(1),y));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=l(Math.pow(y,8)),T=p,A=0;A<w.length;A+=8){var R=Math.min(8,w.length-A),v=parseInt(w.substring(A,A+R),y);8>R?(R=l(Math.pow(y,R)),T=T.j(R).add(l(v))):(T=T.j(I),T=T.add(l(v)))}return T}var p=u(0),g=u(1),E=u(16777216);n=o.prototype,n.m=function(){if(N(this))return-O(this).m();for(var w=0,y=1,I=0;I<this.g.length;I++){var T=this.i(I);w+=(0<=T?T:4294967296+T)*y,y*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(N(this))return"-"+O(this).toString(w);for(var y=l(Math.pow(w,6)),I=this,T="";;){var A=H(I,y).g;I=U(I,A.j(y));var R=((0<I.g.length?I.g[0]:I.h)>>>0).toString(w);if(I=A,k(I))return R+T;for(;6>R.length;)R="0"+R;T=R+T}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(var y=0;y<w.g.length;y++)if(w.g[y]!=0)return!1;return!0}function N(w){return w.h==-1}n.l=function(w){return w=U(this,w),N(w)?-1:k(w)?0:1};function O(w){for(var y=w.g.length,I=[],T=0;T<y;T++)I[T]=~w.g[T];return new o(I,~w.h).add(g)}n.abs=function(){return N(this)?O(this):this},n.add=function(w){for(var y=Math.max(this.g.length,w.g.length),I=[],T=0,A=0;A<=y;A++){var R=T+(this.i(A)&65535)+(w.i(A)&65535),v=(R>>>16)+(this.i(A)>>>16)+(w.i(A)>>>16);T=v>>>16,R&=65535,v&=65535,I[A]=v<<16|R}return new o(I,I[I.length-1]&-2147483648?-1:0)};function U(w,y){return w.add(O(y))}n.j=function(w){if(k(this)||k(w))return p;if(N(this))return N(w)?O(this).j(O(w)):O(O(this).j(w));if(N(w))return O(this.j(O(w)));if(0>this.l(E)&&0>w.l(E))return l(this.m()*w.m());for(var y=this.g.length+w.g.length,I=[],T=0;T<2*y;T++)I[T]=0;for(T=0;T<this.g.length;T++)for(var A=0;A<w.g.length;A++){var R=this.i(T)>>>16,v=this.i(T)&65535,Pt=w.i(A)>>>16,Mi=w.i(A)&65535;I[2*T+2*A]+=v*Mi,$(I,2*T+2*A),I[2*T+2*A+1]+=R*Mi,$(I,2*T+2*A+1),I[2*T+2*A+1]+=v*Pt,$(I,2*T+2*A+1),I[2*T+2*A+2]+=R*Pt,$(I,2*T+2*A+2)}for(T=0;T<y;T++)I[T]=I[2*T+1]<<16|I[2*T];for(T=y;T<2*y;T++)I[T]=0;return new o(I,0)};function $(w,y){for(;(w[y]&65535)!=w[y];)w[y+1]+=w[y]>>>16,w[y]&=65535,y++}function q(w,y){this.g=w,this.h=y}function H(w,y){if(k(y))throw Error("division by zero");if(k(w))return new q(p,p);if(N(w))return y=H(O(w),y),new q(O(y.g),O(y.h));if(N(y))return y=H(w,O(y)),new q(O(y.g),y.h);if(30<w.g.length){if(N(w)||N(y))throw Error("slowDivide_ only works with positive integers.");for(var I=g,T=y;0>=T.l(w);)I=te(I),T=te(T);var A=K(I,1),R=K(T,1);for(T=K(T,2),I=K(I,2);!k(T);){var v=R.add(T);0>=v.l(w)&&(A=A.add(I),R=v),T=K(T,1),I=K(I,1)}return y=U(w,A.j(y)),new q(A,y)}for(A=p;0<=w.l(y);){for(I=Math.max(1,Math.floor(w.m()/y.m())),T=Math.ceil(Math.log(I)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),R=l(I),v=R.j(y);N(v)||0<v.l(w);)I-=T,R=l(I),v=R.j(y);k(R)&&(R=g),A=A.add(R),w=U(w,v)}return new q(A,w)}n.A=function(w){return H(this,w).h},n.and=function(w){for(var y=Math.max(this.g.length,w.g.length),I=[],T=0;T<y;T++)I[T]=this.i(T)&w.i(T);return new o(I,this.h&w.h)},n.or=function(w){for(var y=Math.max(this.g.length,w.g.length),I=[],T=0;T<y;T++)I[T]=this.i(T)|w.i(T);return new o(I,this.h|w.h)},n.xor=function(w){for(var y=Math.max(this.g.length,w.g.length),I=[],T=0;T<y;T++)I[T]=this.i(T)^w.i(T);return new o(I,this.h^w.h)};function te(w){for(var y=w.g.length+1,I=[],T=0;T<y;T++)I[T]=w.i(T)<<1|w.i(T-1)>>>31;return new o(I,w.h)}function K(w,y){var I=y>>5;y%=32;for(var T=w.g.length-I,A=[],R=0;R<T;R++)A[R]=0<y?w.i(R+I)>>>y|w.i(R+I+1)<<32-y:w.i(R+I);return new o(A,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ch=P_.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=f,qt=P_.Integer=o}).apply(typeof R_<"u"?R_:typeof self<"u"?self:typeof window<"u"?window:{});var ba=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$t={};var uh,gS,jr,lh,ws,Sa,hh,dh,fh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,h,d){return a==Array.prototype||a==Object.prototype||(a[h]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof ba=="object"&&ba];for(var h=0;h<a.length;++h){var d=a[h];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function i(a,h){if(h)e:{var d=r;a=a.split(".");for(var m=0;m<a.length-1;m++){var b=a[m];if(!(b in d))break e;d=d[b]}a=a[a.length-1],m=d[a],h=h(m),h!=m&&h!=null&&e(d,a,{configurable:!0,writable:!0,value:h})}}function s(a,h){a instanceof String&&(a+="");var d=0,m=!1,b={next:function(){if(!m&&d<a.length){var C=d++;return{value:h(C,a[C]),done:!1}}return m=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}i("Array.prototype.values",function(a){return a||function(){return s(this,function(h,d){return d})}});var o=o||{},c=this||self;function u(a){var h=typeof a;return h=h!="object"?h:a?Array.isArray(a)?"array":h:"null",h=="array"||h=="object"&&typeof a.length=="number"}function l(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function f(a,h,d){return a.call.apply(a.bind,arguments)}function p(a,h,d){if(!a)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,m),a.apply(h,b)}}return function(){return a.apply(h,arguments)}}function g(a,h,d){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,g.apply(null,arguments)}function E(a,h){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function k(a,h){function d(){}d.prototype=h.prototype,a.aa=h.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(m,b,C){for(var M=Array(arguments.length-2),ae=2;ae<arguments.length;ae++)M[ae-2]=arguments[ae];return h.prototype[b].apply(m,M)}}function N(a){let h=a.length;if(0<h){let d=Array(h);for(let m=0;m<h;m++)d[m]=a[m];return d}return[]}function O(a,h){for(let d=1;d<arguments.length;d++){let m=arguments[d];if(u(m)){let b=a.length||0,C=m.length||0;a.length=b+C;for(let M=0;M<C;M++)a[b+M]=m[M]}else a.push(m)}}class U{constructor(h,d){this.i=h,this.j=d,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function $(a){return/^[\s\xa0]*$/.test(a)}function q(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function H(a){return H[" "](a),a}H[" "]=function(){};var te=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function K(a,h,d){for(let m in a)h.call(d,a[m],m,a)}function w(a,h){for(let d in a)h.call(void 0,a[d],d,a)}function y(a){let h={};for(let d in a)h[d]=a[d];return h}let I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(a,h){let d,m;for(let b=1;b<arguments.length;b++){m=arguments[b];for(d in m)a[d]=m[d];for(let C=0;C<I.length;C++)d=I[C],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function A(a){var h=1;a=a.split(":");let d=[];for(;0<h&&a.length;)d.push(a.shift()),h--;return a.length&&d.push(a.join(":")),d}function R(a){c.setTimeout(()=>{throw a},0)}function v(){var a=du;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class Pt{constructor(){this.h=this.g=null}add(h,d){let m=Mi.get();m.set(h,d),this.h?this.h.next=m:this.g=m,this.h=m}}var Mi=new U(()=>new aw,a=>a.reset());class aw{constructor(){this.next=this.g=this.h=null}set(h,d){this.h=h,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Fi,Ui=!1,du=new Pt,Sp=()=>{let a=c.Promise.resolve(void 0);Fi=()=>{a.then(cw)}};var cw=()=>{for(var a;a=v();){try{a.h.call(a.g)}catch(d){R(d)}var h=Mi;h.j(a),100>h.h&&(h.h++,a.next=h.g,h.g=a)}Ui=!1};function en(){this.s=this.s,this.C=this.C}en.prototype.s=!1,en.prototype.ma=function(){this.s||(this.s=!0,this.N())},en.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function De(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}De.prototype.h=function(){this.defaultPrevented=!0};var uw=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,h),c.removeEventListener("test",d,h)}catch{}return a}();function Bi(a,h){if(De.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget){if(te){e:{try{H(h.nodeName);var b=!0;break e}catch{}b=!1}b||(h=null)}}else d=="mouseover"?h=a.fromElement:d=="mouseout"&&(h=a.toElement);this.relatedTarget=h,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:lw[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Bi.aa.h.call(this)}}k(Bi,De);var lw={2:"touch",3:"pen",4:"mouse"};Bi.prototype.h=function(){Bi.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var qi="closure_listenable_"+(1e6*Math.random()|0),hw=0;function dw(a,h,d,m,b){this.listener=a,this.proxy=null,this.src=h,this.type=d,this.capture=!!m,this.ha=b,this.key=++hw,this.da=this.fa=!1}function So(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Ro(a){this.src=a,this.g={},this.h=0}Ro.prototype.add=function(a,h,d,m,b){var C=a.toString();a=this.g[C],a||(a=this.g[C]=[],this.h++);var M=pu(a,h,m,b);return-1<M?(h=a[M],d||(h.fa=!1)):(h=new dw(h,this.src,C,!!m,b),h.fa=d,a.push(h)),h};function fu(a,h){var d=h.type;if(d in a.g){var m=a.g[d],b=Array.prototype.indexOf.call(m,h,void 0),C;(C=0<=b)&&Array.prototype.splice.call(m,b,1),C&&(So(h),a.g[d].length==0&&(delete a.g[d],a.h--))}}function pu(a,h,d,m){for(var b=0;b<a.length;++b){var C=a[b];if(!C.da&&C.listener==h&&C.capture==!!d&&C.ha==m)return b}return-1}var mu="closure_lm_"+(1e6*Math.random()|0),gu={};function Rp(a,h,d,m,b){if(m&&m.once)return Cp(a,h,d,m,b);if(Array.isArray(h)){for(var C=0;C<h.length;C++)Rp(a,h[C],d,m,b);return null}return d=Iu(d),a&&a[qi]?a.K(h,d,l(m)?!!m.capture:!!m,b):Pp(a,h,d,!1,m,b)}function Pp(a,h,d,m,b,C){if(!h)throw Error("Invalid event type");var M=l(b)?!!b.capture:!!b,ae=yu(a);if(ae||(a[mu]=ae=new Ro(a)),d=ae.add(h,d,m,M,C),d.proxy)return d;if(m=fw(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)uw||(b=M),b===void 0&&(b=!1),a.addEventListener(h.toString(),m,b);else if(a.attachEvent)a.attachEvent(Dp(h.toString()),m);else if(a.addListener&&a.removeListener)a.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function fw(){function a(d){return h.call(a.src,a.listener,d)}let h=pw;return a}function Cp(a,h,d,m,b){if(Array.isArray(h)){for(var C=0;C<h.length;C++)Cp(a,h[C],d,m,b);return null}return d=Iu(d),a&&a[qi]?a.L(h,d,l(m)?!!m.capture:!!m,b):Pp(a,h,d,!0,m,b)}function kp(a,h,d,m,b){if(Array.isArray(h))for(var C=0;C<h.length;C++)kp(a,h[C],d,m,b);else m=l(m)?!!m.capture:!!m,d=Iu(d),a&&a[qi]?(a=a.i,h=String(h).toString(),h in a.g&&(C=a.g[h],d=pu(C,d,m,b),-1<d&&(So(C[d]),Array.prototype.splice.call(C,d,1),C.length==0&&(delete a.g[h],a.h--)))):a&&(a=yu(a))&&(h=a.g[h.toString()],a=-1,h&&(a=pu(h,d,m,b)),(d=-1<a?h[a]:null)&&_u(d))}function _u(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[qi])fu(h.i,a);else{var d=a.type,m=a.proxy;h.removeEventListener?h.removeEventListener(d,m,a.capture):h.detachEvent?h.detachEvent(Dp(d),m):h.addListener&&h.removeListener&&h.removeListener(m),(d=yu(h))?(fu(d,a),d.h==0&&(d.src=null,h[mu]=null)):So(a)}}}function Dp(a){return a in gu?gu[a]:gu[a]="on"+a}function pw(a,h){if(a.da)a=!0;else{h=new Bi(h,this);var d=a.listener,m=a.ha||a.src;a.fa&&_u(a),a=d.call(m,h)}return a}function yu(a){return a=a[mu],a instanceof Ro?a:null}var vu="__closure_events_fn_"+(1e9*Math.random()>>>0);function Iu(a){return typeof a=="function"?a:(a[vu]||(a[vu]=function(h){return a.handleEvent(h)}),a[vu])}function Ne(){en.call(this),this.i=new Ro(this),this.M=this,this.F=null}k(Ne,en),Ne.prototype[qi]=!0,Ne.prototype.removeEventListener=function(a,h,d,m){kp(this,a,h,d,m)};function Ue(a,h){var d,m=a.F;if(m)for(d=[];m;m=m.F)d.push(m);if(a=a.M,m=h.type||h,typeof h=="string")h=new De(h,a);else if(h instanceof De)h.target=h.target||a;else{var b=h;h=new De(m,a),T(h,b)}if(b=!0,d)for(var C=d.length-1;0<=C;C--){var M=h.g=d[C];b=Po(M,m,!0,h)&&b}if(M=h.g=a,b=Po(M,m,!0,h)&&b,b=Po(M,m,!1,h)&&b,d)for(C=0;C<d.length;C++)M=h.g=d[C],b=Po(M,m,!1,h)&&b}Ne.prototype.N=function(){if(Ne.aa.N.call(this),this.i){var a=this.i,h;for(h in a.g){for(var d=a.g[h],m=0;m<d.length;m++)So(d[m]);delete a.g[h],a.h--}}this.F=null},Ne.prototype.K=function(a,h,d,m){return this.i.add(String(a),h,!1,d,m)},Ne.prototype.L=function(a,h,d,m){return this.i.add(String(a),h,!0,d,m)};function Po(a,h,d,m){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();for(var b=!0,C=0;C<h.length;++C){var M=h[C];if(M&&!M.da&&M.capture==d){var ae=M.listener,ke=M.ha||M.src;M.fa&&fu(a.i,M),b=ae.call(ke,m)!==!1&&b}}return b&&!m.defaultPrevented}function Np(a,h,d){if(typeof a=="function")d&&(a=g(a,d));else if(a&&typeof a.handleEvent=="function")a=g(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:c.setTimeout(a,h||0)}function Op(a){a.g=Np(()=>{a.g=null,a.i&&(a.i=!1,Op(a))},a.l);let h=a.h;a.h=null,a.m.apply(null,h)}class mw extends en{constructor(h,d){super(),this.m=h,this.l=d,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Op(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $i(a){en.call(this),this.h=a,this.g={}}k($i,en);var Vp=[];function xp(a){K(a.g,function(h,d){this.g.hasOwnProperty(d)&&_u(h)},a),a.g={}}$i.prototype.N=function(){$i.aa.N.call(this),xp(this)},$i.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Eu=c.JSON.stringify,gw=c.JSON.parse,_w=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function wu(){}wu.prototype.h=null;function Lp(a){return a.h||(a.h=a.i())}function Mp(){}var ji={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Tu(){De.call(this,"d")}k(Tu,De);function Au(){De.call(this,"c")}k(Au,De);var qn={},Fp=null;function Co(){return Fp=Fp||new Ne}qn.La="serverreachability";function Up(a){De.call(this,qn.La,a)}k(Up,De);function zi(a){let h=Co();Ue(h,new Up(h))}qn.STAT_EVENT="statevent";function Bp(a,h){De.call(this,qn.STAT_EVENT,a),this.stat=h}k(Bp,De);function Be(a){let h=Co();Ue(h,new Bp(h,a))}qn.Ma="timingevent";function qp(a,h){De.call(this,qn.Ma,a),this.size=h}k(qp,De);function Wi(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},h)}function Gi(){this.g=!0}Gi.prototype.xa=function(){this.g=!1};function yw(a,h,d,m,b,C){a.info(function(){if(a.g)if(C)for(var M="",ae=C.split("&"),ke=0;ke<ae.length;ke++){var ne=ae[ke].split("=");if(1<ne.length){var Oe=ne[0];ne=ne[1];var Ve=Oe.split("_");M=2<=Ve.length&&Ve[1]=="type"?M+(Oe+"="+ne+"&"):M+(Oe+"=redacted&")}}else M=null;else M=C;return"XMLHTTP REQ ("+m+") [attempt "+b+"]: "+h+`
`+d+`
`+M})}function vw(a,h,d,m,b,C,M){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+b+"]: "+h+`
`+d+`
`+C+" "+M})}function Rr(a,h,d,m){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+Ew(a,d)+(m?" "+m:"")})}function Iw(a,h){a.info(function(){return"TIMEOUT: "+h})}Gi.prototype.info=function(){};function Ew(a,h){if(!a.g)return h;if(!h)return null;try{var d=JSON.parse(h);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var m=d[a];if(!(2>m.length)){var b=m[1];if(Array.isArray(b)&&!(1>b.length)){var C=b[0];if(C!="noop"&&C!="stop"&&C!="close")for(var M=1;M<b.length;M++)b[M]=""}}}}return Eu(d)}catch{return h}}var ko={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},$p={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},bu;function Do(){}k(Do,wu),Do.prototype.g=function(){return new XMLHttpRequest},Do.prototype.i=function(){return{}},bu=new Do;function tn(a,h,d,m){this.j=a,this.i=h,this.l=d,this.R=m||1,this.U=new $i(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new jp}function jp(){this.i=null,this.g="",this.h=!1}var zp={},Su={};function Ru(a,h,d){a.L=1,a.v=xo(Ct(h)),a.m=d,a.P=!0,Wp(a,null)}function Wp(a,h){a.F=Date.now(),No(a),a.A=Ct(a.v);var d=a.A,m=a.R;Array.isArray(m)||(m=[String(m)]),sm(d.i,"t",m),a.C=0,d=a.j.J,a.h=new jp,a.g=Tm(a.j,d?h:null,!a.m),0<a.O&&(a.M=new mw(g(a.Y,a,a.g),a.O)),h=a.U,d=a.g,m=a.ca;var b="readystatechange";Array.isArray(b)||(b&&(Vp[0]=b.toString()),b=Vp);for(var C=0;C<b.length;C++){var M=Rp(d,b[C],m||h.handleEvent,!1,h.h||h);if(!M)break;h.g[M.key]=M}h=a.H?y(a.H):{},a.m?(a.u||(a.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,h)):(a.u="GET",a.g.ea(a.A,a.u,null,h)),zi(),yw(a.i,a.u,a.A,a.l,a.R,a.m)}tn.prototype.ca=function(a){a=a.target;let h=this.M;h&&kt(a)==3?h.j():this.Y(a)},tn.prototype.Y=function(a){try{if(a==this.g)e:{let Ve=kt(this.g);var h=this.g.Ba();let kr=this.g.Z();if(!(3>Ve)&&(Ve!=3||this.g&&(this.h.h||this.g.oa()||dm(this.g)))){this.J||Ve!=4||h==7||(h==8||0>=kr?zi(3):zi(2)),Pu(this);var d=this.g.Z();this.X=d;t:if(Gp(this)){var m=dm(this.g);a="";var b=m.length,C=kt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$n(this),Ki(this);var M="";break t}this.h.i=new c.TextDecoder}for(h=0;h<b;h++)this.h.h=!0,a+=this.h.i.decode(m[h],{stream:!(C&&h==b-1)});m.length=0,this.h.g+=a,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=d==200,vw(this.i,this.u,this.A,this.l,this.R,Ve,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ae,ke=this.g;if((ae=ke.g?ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(ae)){var ne=ae;break t}}ne=null}if(d=ne)Rr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Cu(this,d);else{this.o=!1,this.s=3,Be(12),$n(this),Ki(this);break e}}if(this.P){d=!0;let rt;for(;!this.J&&this.C<M.length;)if(rt=ww(this,M),rt==Su){Ve==4&&(this.s=4,Be(14),d=!1),Rr(this.i,this.l,null,"[Incomplete Response]");break}else if(rt==zp){this.s=4,Be(15),Rr(this.i,this.l,M,"[Invalid Chunk]"),d=!1;break}else Rr(this.i,this.l,rt,null),Cu(this,rt);if(Gp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ve!=4||M.length!=0||this.h.h||(this.s=1,Be(16),d=!1),this.o=this.o&&d,!d)Rr(this.i,this.l,M,"[Invalid Chunked Response]"),$n(this),Ki(this);else if(0<M.length&&!this.W){this.W=!0;var Oe=this.j;Oe.g==this&&Oe.ba&&!Oe.M&&(Oe.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),xu(Oe),Oe.M=!0,Be(11))}}else Rr(this.i,this.l,M,null),Cu(this,M);Ve==4&&$n(this),this.o&&!this.J&&(Ve==4?vm(this.j,this):(this.o=!1,No(this)))}else Uw(this.g),d==400&&0<M.indexOf("Unknown SID")?(this.s=3,Be(12)):(this.s=0,Be(13)),$n(this),Ki(this)}}}catch{}finally{}};function Gp(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function ww(a,h){var d=a.C,m=h.indexOf(`
`,d);return m==-1?Su:(d=Number(h.substring(d,m)),isNaN(d)?zp:(m+=1,m+d>h.length?Su:(h=h.slice(m,m+d),a.C=m+d,h)))}tn.prototype.cancel=function(){this.J=!0,$n(this)};function No(a){a.S=Date.now()+a.I,Kp(a,a.I)}function Kp(a,h){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Wi(g(a.ba,a),h)}function Pu(a){a.B&&(c.clearTimeout(a.B),a.B=null)}tn.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(Iw(this.i,this.A),this.L!=2&&(zi(),Be(17)),$n(this),this.s=2,Ki(this)):Kp(this,this.S-a)};function Ki(a){a.j.G==0||a.J||vm(a.j,a)}function $n(a){Pu(a);var h=a.M;h&&typeof h.ma=="function"&&h.ma(),a.M=null,xp(a.U),a.g&&(h=a.g,a.g=null,h.abort(),h.ma())}function Cu(a,h){try{var d=a.j;if(d.G!=0&&(d.g==a||ku(d.h,a))){if(!a.K&&ku(d.h,a)&&d.G==3){try{var m=d.Da.g.parse(h)}catch{m=null}if(Array.isArray(m)&&m.length==3){var b=m;if(b[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Bo(d),Fo(d);else break e;Vu(d),Be(18)}}else d.za=b[1],0<d.za-d.T&&37500>b[2]&&d.F&&d.v==0&&!d.C&&(d.C=Wi(g(d.Za,d),6e3));if(1>=Jp(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else zn(d,11)}else if((a.K||d.g==a)&&Bo(d),!$(h))for(b=d.Da.g.parse(h),h=0;h<b.length;h++){let ne=b[h];if(d.T=ne[0],ne=ne[1],d.G==2)if(ne[0]=="c"){d.K=ne[1],d.ia=ne[2];let Oe=ne[3];Oe!=null&&(d.la=Oe,d.j.info("VER="+d.la));let Ve=ne[4];Ve!=null&&(d.Aa=Ve,d.j.info("SVER="+d.Aa));let kr=ne[5];kr!=null&&typeof kr=="number"&&0<kr&&(m=1.5*kr,d.L=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let rt=a.g;if(rt){let $o=rt.g?rt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($o){var C=m.h;C.g||$o.indexOf("spdy")==-1&&$o.indexOf("quic")==-1&&$o.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(Du(C,C.h),C.h=null))}if(m.D){let Lu=rt.g?rt.g.getResponseHeader("X-HTTP-Session-Id"):null;Lu&&(m.ya=Lu,ce(m.I,m.D,Lu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),m=d;var M=a;if(m.qa=wm(m,m.J?m.ia:null,m.W),M.K){Yp(m.h,M);var ae=M,ke=m.L;ke&&(ae.I=ke),ae.B&&(Pu(ae),No(ae)),m.g=M}else _m(m);0<d.i.length&&Uo(d)}else ne[0]!="stop"&&ne[0]!="close"||zn(d,7);else d.G==3&&(ne[0]=="stop"||ne[0]=="close"?ne[0]=="stop"?zn(d,7):Ou(d):ne[0]!="noop"&&d.l&&d.l.ta(ne),d.v=0)}}zi(4)}catch{}}var Tw=class{constructor(a,h){this.g=a,this.map=h}};function Hp(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qp(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Jp(a){return a.h?1:a.g?a.g.size:0}function ku(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function Du(a,h){a.g?a.g.add(h):a.h=h}function Yp(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Hp.prototype.cancel=function(){if(this.i=Xp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Xp(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let h=a.i;for(let d of a.g.values())h=h.concat(d.D);return h}return N(a.i)}function Aw(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var h=[],d=a.length,m=0;m<d;m++)h.push(a[m]);return h}h=[],d=0;for(m in a)h[d++]=a[m];return h}function bw(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var h=[];a=a.length;for(var d=0;d<a;d++)h.push(d);return h}h=[],d=0;for(let m in a)h[d++]=m;return h}}}function Zp(a,h){if(a.forEach&&typeof a.forEach=="function")a.forEach(h,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,h,void 0);else for(var d=bw(a),m=Aw(a),b=m.length,C=0;C<b;C++)h.call(void 0,m[C],d&&d[C],a)}var em=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Sw(a,h){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var m=a[d].indexOf("="),b=null;if(0<=m){var C=a[d].substring(0,m);b=a[d].substring(m+1)}else C=a[d];h(C,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function jn(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof jn){this.h=a.h,Oo(this,a.j),this.o=a.o,this.g=a.g,Vo(this,a.s),this.l=a.l;var h=a.i,d=new Ji;d.i=h.i,h.g&&(d.g=new Map(h.g),d.h=h.h),tm(this,d),this.m=a.m}else a&&(h=String(a).match(em))?(this.h=!1,Oo(this,h[1]||"",!0),this.o=Hi(h[2]||""),this.g=Hi(h[3]||"",!0),Vo(this,h[4]),this.l=Hi(h[5]||"",!0),tm(this,h[6]||"",!0),this.m=Hi(h[7]||"")):(this.h=!1,this.i=new Ji(null,this.h))}jn.prototype.toString=function(){var a=[],h=this.j;h&&a.push(Qi(h,nm,!0),":");var d=this.g;return(d||h=="file")&&(a.push("//"),(h=this.o)&&a.push(Qi(h,nm,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Qi(d,d.charAt(0)=="/"?Cw:Pw,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Qi(d,Dw)),a.join("")};function Ct(a){return new jn(a)}function Oo(a,h,d){a.j=d?Hi(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function Vo(a,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);a.s=h}else a.s=null}function tm(a,h,d){h instanceof Ji?(a.i=h,Nw(a.i,a.h)):(d||(h=Qi(h,kw)),a.i=new Ji(h,a.h))}function ce(a,h,d){a.i.set(h,d)}function xo(a){return ce(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Hi(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Qi(a,h,d){return typeof a=="string"?(a=encodeURI(a).replace(h,Rw),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Rw(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var nm=/[#\/\?@]/g,Pw=/[#\?:]/g,Cw=/[#\?]/g,kw=/[#\?@]/g,Dw=/#/g;function Ji(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function nn(a){a.g||(a.g=new Map,a.h=0,a.i&&Sw(a.i,function(h,d){a.add(decodeURIComponent(h.replace(/\+/g," ")),d)}))}n=Ji.prototype,n.add=function(a,h){nn(this),this.i=null,a=Pr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(h),this.h+=1,this};function rm(a,h){nn(a),h=Pr(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function im(a,h){return nn(a),h=Pr(a,h),a.g.has(h)}n.forEach=function(a,h){nn(this),this.g.forEach(function(d,m){d.forEach(function(b){a.call(h,b,m,this)},this)},this)},n.na=function(){nn(this);let a=Array.from(this.g.values()),h=Array.from(this.g.keys()),d=[];for(let m=0;m<h.length;m++){let b=a[m];for(let C=0;C<b.length;C++)d.push(h[m])}return d},n.V=function(a){nn(this);let h=[];if(typeof a=="string")im(this,a)&&(h=h.concat(this.g.get(Pr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)h=h.concat(a[d])}return h},n.set=function(a,h){return nn(this),this.i=null,a=Pr(this,a),im(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},n.get=function(a,h){return a?(a=this.V(a),0<a.length?String(a[0]):h):h};function sm(a,h,d){rm(a,h),0<d.length&&(a.i=null,a.g.set(Pr(a,h),N(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],h=Array.from(this.g.keys());for(var d=0;d<h.length;d++){var m=h[d];let C=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var b=C;M[m]!==""&&(b+="="+encodeURIComponent(String(M[m]))),a.push(b)}}return this.i=a.join("&")};function Pr(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function Nw(a,h){h&&!a.j&&(nn(a),a.i=null,a.g.forEach(function(d,m){var b=m.toLowerCase();m!=b&&(rm(this,m),sm(this,b,d))},a)),a.j=h}function Ow(a,h){let d=new Gi;if(c.Image){let m=new Image;m.onload=E(rn,d,"TestLoadImage: loaded",!0,h,m),m.onerror=E(rn,d,"TestLoadImage: error",!1,h,m),m.onabort=E(rn,d,"TestLoadImage: abort",!1,h,m),m.ontimeout=E(rn,d,"TestLoadImage: timeout",!1,h,m),c.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else h(!1)}function Vw(a,h){let d=new Gi,m=new AbortController,b=setTimeout(()=>{m.abort(),rn(d,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:m.signal}).then(C=>{clearTimeout(b),C.ok?rn(d,"TestPingServer: ok",!0,h):rn(d,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(b),rn(d,"TestPingServer: error",!1,h)})}function rn(a,h,d,m,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),m(d)}catch{}}function xw(){this.g=new _w}function Lw(a,h,d){let m=d||"";try{Zp(a,function(b,C){let M=b;l(b)&&(M=Eu(b)),h.push(m+C+"="+encodeURIComponent(M))})}catch(b){throw h.push(m+"type="+encodeURIComponent("_badmap")),b}}function Yi(a){this.l=a.Ub||null,this.j=a.eb||!1}k(Yi,wu),Yi.prototype.g=function(){return new Lo(this.l,this.j)},Yi.prototype.i=function(a){return function(){return a}}({});function Lo(a,h){Ne.call(this),this.D=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Lo,Ne),n=Lo.prototype,n.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=h,this.readyState=1,Zi(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(h.body=a),(this.D||c).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Xi(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Zi(this)),this.g&&(this.readyState=3,Zi(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;om(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function om(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?Xi(this):Zi(this),this.readyState==3&&om(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,Xi(this))},n.Qa=function(a){this.g&&(this.response=a,Xi(this))},n.ga=function(){this.g&&Xi(this)};function Xi(a){a.readyState=4,a.l=null,a.j=null,a.v=null,Zi(a)}n.setRequestHeader=function(a,h){this.u.append(a,h)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],h=this.h.entries();for(var d=h.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=h.next();return a.join(`\r
`)};function Zi(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Lo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function am(a){let h="";return K(a,function(d,m){h+=m,h+=":",h+=d,h+=`\r
`}),h}function Nu(a,h,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=am(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):ce(a,h,d))}function me(a){Ne.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(me,Ne);var Mw=/^https?$/i,Fw=["POST","PUT"];n=me.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,h,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():bu.g(),this.v=this.o?Lp(this.o):Lp(bu),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(C){cm(this,C);return}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var b in m)d.set(b,m[b]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let C of m.keys())d.set(C,m.get(C));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(C=>C.toLowerCase()=="content-type"),b=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Fw,h,void 0))||m||b||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[C,M]of d)this.g.setRequestHeader(C,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{hm(this),this.u=!0,this.g.send(a),this.u=!1}catch(C){cm(this,C)}};function cm(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.m=5,um(a),Mo(a)}function um(a){a.A||(a.A=!0,Ue(a,"complete"),Ue(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Ue(this,"complete"),Ue(this,"abort"),Mo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mo(this,!0)),me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?lm(this):this.bb())},n.bb=function(){lm(this)};function lm(a){if(a.h&&typeof o<"u"&&(!a.v[1]||kt(a)!=4||a.Z()!=2)){if(a.u&&kt(a)==4)Np(a.Ea,0,a);else if(Ue(a,"readystatechange"),kt(a)==4){a.h=!1;try{let M=a.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var d;if(!(d=h)){var m;if(m=M===0){var b=String(a.D).match(em)[1]||null;!b&&c.self&&c.self.location&&(b=c.self.location.protocol.slice(0,-1)),m=!Mw.test(b?b.toLowerCase():"")}d=m}if(d)Ue(a,"complete"),Ue(a,"success");else{a.m=6;try{var C=2<kt(a)?a.g.statusText:""}catch{C=""}a.l=C+" ["+a.Z()+"]",um(a)}}finally{Mo(a)}}}}function Mo(a,h){if(a.g){hm(a);let d=a.g,m=a.v[0]?()=>{}:null;a.g=null,a.v=null,h||Ue(a,"ready");try{d.onreadystatechange=m}catch{}}}function hm(a){a.I&&(c.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function kt(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<kt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),gw(h)}};function dm(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Uw(a){let h={};a=(a.g&&2<=kt(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<a.length;m++){if($(a[m]))continue;var d=A(a[m]);let b=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let C=h[b]||[];h[b]=C,C.push(d)}w(h,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function es(a,h,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||h}function fm(a){this.Aa=0,this.i=[],this.j=new Gi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=es("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=es("baseRetryDelayMs",5e3,a),this.cb=es("retryDelaySeedMs",1e4,a),this.Wa=es("forwardChannelMaxRetries",2,a),this.wa=es("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Hp(a&&a.concurrentRequestLimit),this.Da=new xw,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=fm.prototype,n.la=8,n.G=1,n.connect=function(a,h,d,m){Be(0),this.W=a,this.H=h||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=wm(this,null,this.W),Uo(this)};function Ou(a){if(pm(a),a.G==3){var h=a.U++,d=Ct(a.I);if(ce(d,"SID",a.K),ce(d,"RID",h),ce(d,"TYPE","terminate"),ts(a,d),h=new tn(a,a.j,h),h.L=2,h.v=xo(Ct(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(h.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=h.v,d=!0),d||(h.g=Tm(h.j,null),h.g.ea(h.v)),h.F=Date.now(),No(h)}Em(a)}function Fo(a){a.g&&(xu(a),a.g.cancel(),a.g=null)}function pm(a){Fo(a),a.u&&(c.clearTimeout(a.u),a.u=null),Bo(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function Uo(a){if(!Qp(a.h)&&!a.s){a.s=!0;var h=a.Ga;Fi||Sp(),Ui||(Fi(),Ui=!0),du.add(h,a),a.B=0}}function Bw(a,h){return Jp(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=h.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Wi(g(a.Ga,a,h),Im(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let b=new tn(this,this.j,a),C=this.o;if(this.S&&(C?(C=y(C),T(C,this.S)):C=this.S),this.m!==null||this.O||(b.H=C,C=null),this.P)e:{for(var h=0,d=0;d<this.i.length;d++){t:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(h+=m,4096<h){h=d;break e}if(h===4096||d===this.i.length-1){h=d+1;break e}}h=1e3}else h=1e3;h=gm(this,b,h),d=Ct(this.I),ce(d,"RID",a),ce(d,"CVER",22),this.D&&ce(d,"X-HTTP-Session-Id",this.D),ts(this,d),C&&(this.O?h="headers="+encodeURIComponent(String(am(C)))+"&"+h:this.m&&Nu(d,this.m,C)),Du(this.h,b),this.Ua&&ce(d,"TYPE","init"),this.P?(ce(d,"$req",h),ce(d,"SID","null"),b.T=!0,Ru(b,d,null)):Ru(b,d,h),this.G=2}}else this.G==3&&(a?mm(this,a):this.i.length==0||Qp(this.h)||mm(this))};function mm(a,h){var d;h?d=h.l:d=a.U++;let m=Ct(a.I);ce(m,"SID",a.K),ce(m,"RID",d),ce(m,"AID",a.T),ts(a,m),a.m&&a.o&&Nu(m,a.m,a.o),d=new tn(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),h&&(a.i=h.D.concat(a.i)),h=gm(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Du(a.h,d),Ru(d,m,h)}function ts(a,h){a.H&&K(a.H,function(d,m){ce(h,m,d)}),a.l&&Zp({},function(d,m){ce(h,m,d)})}function gm(a,h,d){d=Math.min(a.i.length,d);var m=a.l?g(a.l.Na,a.l,a):null;e:{var b=a.i;let C=-1;for(;;){let M=["count="+d];C==-1?0<d?(C=b[0].g,M.push("ofs="+C)):C=0:M.push("ofs="+C);let ae=!0;for(let ke=0;ke<d;ke++){let ne=b[ke].g,Oe=b[ke].map;if(ne-=C,0>ne)C=Math.max(0,b[ke].g-100),ae=!1;else try{Lw(Oe,M,"req"+ne+"_")}catch{m&&m(Oe)}}if(ae){m=M.join("&");break e}}}return a=a.i.splice(0,d),h.D=a,m}function _m(a){if(!a.g&&!a.u){a.Y=1;var h=a.Fa;Fi||Sp(),Ui||(Fi(),Ui=!0),du.add(h,a),a.v=0}}function Vu(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Wi(g(a.Fa,a),Im(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,ym(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Wi(g(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Be(10),Fo(this),ym(this))};function xu(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function ym(a){a.g=new tn(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var h=Ct(a.qa);ce(h,"RID","rpc"),ce(h,"SID",a.K),ce(h,"AID",a.T),ce(h,"CI",a.F?"0":"1"),!a.F&&a.ja&&ce(h,"TO",a.ja),ce(h,"TYPE","xmlhttp"),ts(a,h),a.m&&a.o&&Nu(h,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=xo(Ct(h)),d.m=null,d.P=!0,Wp(d,a)}n.Za=function(){this.C!=null&&(this.C=null,Fo(this),Vu(this),Be(19))};function Bo(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function vm(a,h){var d=null;if(a.g==h){Bo(a),xu(a),a.g=null;var m=2}else if(ku(a.h,h))d=h.D,Yp(a.h,h),m=1;else return;if(a.G!=0){if(h.o)if(m==1){d=h.m?h.m.length:0,h=Date.now()-h.F;var b=a.B;m=Co(),Ue(m,new qp(m,d)),Uo(a)}else _m(a);else if(b=h.s,b==3||b==0&&0<h.X||!(m==1&&Bw(a,h)||m==2&&Vu(a)))switch(d&&0<d.length&&(h=a.h,h.i=h.i.concat(d)),b){case 1:zn(a,5);break;case 4:zn(a,10);break;case 3:zn(a,6);break;default:zn(a,2)}}}function Im(a,h){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*h}function zn(a,h){if(a.j.info("Error code "+h),h==2){var d=g(a.fb,a),m=a.Xa;let b=!m;m=new jn(m||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Oo(m,"https"),xo(m),b?Ow(m.toString(),d):Vw(m.toString(),d)}else Be(2);a.G=0,a.l&&a.l.sa(h),Em(a),pm(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),Be(2)):(this.j.info("Failed to ping google.com"),Be(1))};function Em(a){if(a.G=0,a.ka=[],a.l){let h=Xp(a.h);(h.length!=0||a.i.length!=0)&&(O(a.ka,h),O(a.ka,a.i),a.h.i.length=0,N(a.i),a.i.length=0),a.l.ra()}}function wm(a,h,d){var m=d instanceof jn?Ct(d):new jn(d);if(m.g!="")h&&(m.g=h+"."+m.g),Vo(m,m.s);else{var b=c.location;m=b.protocol,h=h?h+"."+b.hostname:b.hostname,b=+b.port;var C=new jn(null);m&&Oo(C,m),h&&(C.g=h),b&&Vo(C,b),d&&(C.l=d),m=C}return d=a.D,h=a.ya,d&&h&&ce(m,d,h),ce(m,"VER",a.la),ts(a,m),m}function Tm(a,h,d){if(h&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Ca&&!a.pa?new me(new Yi({eb:d})):new me(a.pa),h.Ha(a.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Am(){}n=Am.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function qo(){}qo.prototype.g=function(a,h){return new Ke(a,h)};function Ke(a,h){Ne.call(this),this.g=new fm(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(a?a["X-WebChannel-Client-Profile"]=h.va:a={"X-WebChannel-Client-Profile":h.va}),this.g.S=a,(a=h&&h.Sb)&&!$(a)&&(this.g.m=a),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!$(h)&&(this.g.D=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new Cr(this)}k(Ke,Ne),Ke.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ke.prototype.close=function(){Ou(this.g)},Ke.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=Eu(a),a=d);h.i.push(new Tw(h.Ya++,a)),h.G==3&&Uo(h)},Ke.prototype.N=function(){this.g.l=null,delete this.j,Ou(this.g),delete this.g,Ke.aa.N.call(this)};function bm(a){Tu.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(let d in h){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}k(bm,Tu);function Sm(){Au.call(this),this.status=1}k(Sm,Au);function Cr(a){this.g=a}k(Cr,Am),Cr.prototype.ua=function(){Ue(this.g,"a")},Cr.prototype.ta=function(a){Ue(this.g,new bm(a))},Cr.prototype.sa=function(a){Ue(this.g,new Sm)},Cr.prototype.ra=function(){Ue(this.g,"b")},qo.prototype.createWebChannel=qo.prototype.g,Ke.prototype.send=Ke.prototype.o,Ke.prototype.open=Ke.prototype.m,Ke.prototype.close=Ke.prototype.close,fh=$t.createWebChannelTransport=function(){return new qo},dh=$t.getStatEventTarget=function(){return Co()},hh=$t.Event=qn,Sa=$t.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ko.NO_ERROR=0,ko.TIMEOUT=8,ko.HTTP_ERROR=6,ws=$t.ErrorCode=ko,$p.COMPLETE="complete",lh=$t.EventType=$p,Mp.EventType=ji,ji.OPEN="a",ji.CLOSE="b",ji.ERROR="c",ji.MESSAGE="d",Ne.prototype.listen=Ne.prototype.K,jr=$t.WebChannel=Mp,gS=$t.FetchXmlHttpFactory=Yi,me.prototype.listenOnce=me.prototype.L,me.prototype.getLastError=me.prototype.Ka,me.prototype.getLastErrorCode=me.prototype.Ba,me.prototype.getStatus=me.prototype.Z,me.prototype.getResponseJson=me.prototype.Oa,me.prototype.getResponseText=me.prototype.oa,me.prototype.send=me.prototype.ea,me.prototype.setWithCredentials=me.prototype.Ha,uh=$t.XhrIo=me}).apply(typeof ba<"u"?ba:typeof self<"u"?self:typeof window<"u"?window:{});var C_="@firebase/firestore",k_="4.8.0";var Te=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Te.UNAUTHENTICATED=new Te(null),Te.GOOGLE_CREDENTIALS=new Te("google-credentials-uid"),Te.FIRST_PARTY=new Te("first-party-uid"),Te.MOCK_USER=new Te("mock-user");var Ci="11.10.0";var An=new mt("@firebase/firestore");function Jr(){return An.logLevel}function Ky(n){An.setLogLevel(n)}function V(n,...e){if(An.logLevel<=J.DEBUG){let t=e.map(Df);An.debug(`Firestore (${Ci}): ${n}`,...t)}}function ye(n,...e){if(An.logLevel<=J.ERROR){let t=e.map(Df);An.error(`Firestore (${Ci}): ${n}`,...t)}}function je(n,...e){if(An.logLevel<=J.WARN){let t=e.map(Df);An.warn(`Firestore (${Ci}): ${n}`,...t)}}function Df(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function B(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Hy(n,r,t)}function Hy(n,e,t){let r=`FIRESTORE (${Ci}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ye(r),new Error(r)}function j(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Hy(e,i,r)}function PD(n,e){n||B(57014,e)}function L(n,e){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends He{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var be=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var qa=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Eh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Te.UNAUTHENTICATED))}shutdown(){}},wh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Th=class{constructor(e){this.t=e,this.currentUser=Te.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){j(this.o===void 0,42304);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new be;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new be,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>_(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new be)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(j(typeof r.accessToken=="string",31837,{l:r}),new qa(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return j(e===null||typeof e=="string",2055,{h:e}),new Te(e)}},Ah=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Te.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},bh=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Ah(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Te.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ms=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Sh=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,$e(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){j(this.o===void 0,3512);let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ms(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(j(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ms(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}},D_=class{getToken(){return Promise.resolve(new Ms(""))}invalidateToken(){}start(e,t){}shutdown(){}};function _S(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function Nf(){return new TextEncoder}var Fs=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=_S(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function W(n,e){return n<e?-1:n>e?1:0}function Rh(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return W(r,i);{let s=Nf(),o=yS(s.encode(N_(n,t)),s.encode(N_(e,t)));return o!==0?o:W(r,i)}}t+=r>65535?2:1}return W(n.length,e.length)}function N_(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function yS(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return W(n[t],e[t]);return W(n.length,e.length)}function si(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Qy(n){return n+"\0"}var Ph="__name__",$a=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&B(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return W(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Rh(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return qt.fromString(e.substring(4,e.length-2))}},X=class n extends $a{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new D(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},vS=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Se=class n extends $a{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return vS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ph}static keyField(){return new n([Ph])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new D(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new D(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new D(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(r+=c,i++):(s(),i++)}if(s(),o)throw new D(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var F=class n{constructor(e){this.path=e}static fromPath(e){return new n(X.fromString(e))}static fromName(e){return new n(X.fromString(e).popFirst(5))}static empty(){return new n(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new X(e.slice()))}};function Of(n,e,t){if(!t)throw new D(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function IS(n,e,t,r){if(e===!0&&r===!0)throw new D(S.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function O_(n){if(!F.isDocumentKey(n))throw new D(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function V_(n){if(F.isDocumentKey(n))throw new D(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Jy(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function jc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B(12329,{type:typeof n})}function Y(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=jc(n);throw new D(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Yy(n,e){if(e<=0)throw new D(S.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Ae(n,e){let t={typeString:n};return e&&(t.value=e),t}function Tr(n,e){if(!Jy(n))throw new D(S.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new D(S.INVALID_ARGUMENT,t);return!0}var x_=-62135596800,L_=1e6,de=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*L_);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<x_)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/L_}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Tr(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-x_;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};de._jsonSchemaVersion="firestore/timestamp/1.0",de._jsonSchema={type:Ae("string",de._jsonSchemaVersion),seconds:Ae("number"),nanoseconds:Ae("number")};var z=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new de(0,0))}static max(){return new n(new de(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var oi=-1,bn=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Ch(n){return n.fields.find(e=>e.kind===2)}function tr(n){return n.fields.filter(e=>e.kind!==2)}function ES(n,e){let t=W(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=wS(n.fields[r],e.fields[r]),t!==0)return t;return W(n.fields.length,e.fields.length)}bn.UNKNOWN_ID=-1;var zt=class{constructor(e,t){this.fieldPath=e,this.kind=t}};function wS(n,e){let t=Se.comparator(n.fieldPath,e.fieldPath);return t!==0?t:W(n.kind,e.kind)}var ai=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,nt.min())}};function Xy(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(r===1e9?new de(t+1,0):new de(t,r));return new nt(i,F.empty(),e)}function Zy(n){return new nt(n.readTime,n.key,oi)}var nt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(z.min(),F.empty(),oi)}static max(){return new n(z.max(),F.empty(),oi)}};function Vf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:W(n.largestBatchId,e.largestBatchId))}var ev="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ja=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function xn(n){return _(this,null,function*(){if(n.code!==S.FAILED_PRECONDITION||n.message!==ev)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let l=u;t(e[l]).next(f=>{o[l]=f,++c,c===s&&r(o)},f=>i(f))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Qe="SimpleDb",za=class n{static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new ur(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new be,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new ur(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{let i=xf(r.target.error);this.S.reject(new ur(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(V(Qe,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Dh(t)}},Sn=class n{static delete(e){return V(Qe,"Removing database:",e),rr(Ho().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Or())return!1;if(n.F())return!0;let e=_e(),t=n.M(e),r=0<t&&t<10,i=tv(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,n.M(_e())===12.2&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(e){return _(this,null,function*(){return this.db||(V(Qe,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new ur(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new D(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new D(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ur(e,o))},i.onupgradeneeded=s=>{V(Qe,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,i.transaction,s.oldVersion,this.version).next(()=>{V(Qe,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{let r=t.target;this.L=r.version},{passive:!0})),this.db.addEventListener("versionchange",t=>{var r;t.newVersion===null&&(je('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(r=this.databaseDeletedListener)===null||r===void 0||r.call(this))},{passive:!0}),this.db})}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}runTransaction(e,t,r,i){return _(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.k(e);let c=za.open(this.db,e,s?"readonly":"readwrite",r),u=i(c).next(l=>(c.v(),l)).catch(l=>(c.abort(l),P.reject(l))).toPromise();return u.catch(()=>{}),yield c.D,u}catch(c){let u=c,l=u.name!=="FirebaseError"&&o<3;if(V(Qe,"Transaction failed with error:",u.message,"Retrying:",l),this.close(),!l)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function tv(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var kh=class{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return rr(this.$.delete())}},ur=class extends D{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ln(n){return n.name==="IndexedDbTransactionError"}var Dh=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(V(Qe,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(V(Qe,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),rr(r)}add(e){return V(Qe,"ADD",this.store.name,e,e),rr(this.store.add(e))}get(e){return rr(this.store.get(e)).next(t=>(t===void 0&&(t=null),V(Qe,"GET",this.store.name,e,t),t))}delete(e){return V(Qe,"DELETE",this.store.name,e),rr(this.store.delete(e))}count(){return V(Qe,"COUNT",this.store.name),rr(this.store.count())}j(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new P((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.J(s,(c,u)=>{o.push(u)}).next(()=>o)}}H(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new P((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}Y(e,t){V(Qe,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Z=!1;let i=this.cursor(r);return this.J(i,(s,o,c)=>c.delete())}X(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.J(i,t)}ee(e){let t=this.cursor({});return new P((r,i)=>{t.onerror=s=>{let o=xf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():r()}):r()}})}J(e,t){let r=[];return new P((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new kh(c),l=t(c.primaryKey,c.value,u);if(l instanceof P){let f=l.catch(p=>(u.done(),P.reject(p)));r.push(f)}u.isDone?i():u.W===null?c.continue():c.continue(u.W)}}).next(()=>P.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Z?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function rr(n){return new P((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=xf(r.target.error);t(i)}})}var M_=!1;function xf(n){let e=Sn.M(_e());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return M_||(M_=!0,setTimeout(()=>{throw r},0)),r}}return n}var Cs="IndexBackfiller",Nh=class{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(e){V(Cs,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>_(this,null,function*(){this.task=null;try{let t=yield this.te.re();V(Cs,`Documents written: ${t}`)}catch(t){Ln(t)?V(Cs,"Ignoring IndexedDB error during index backfill: ",t):yield xn(t)}yield this.ne(6e4)}))}},Oh=class{constructor(e,t){this.localStore=e,this.persistence=t}re(e=50){return _(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))})}ie(e,t){let r=new Set,i=t,s=!0;return P.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return V(Cs,`Processing collection: ${o}`),this.se(e,o,i).next(c=>{i-=c,r.add(o)});s=!1})).next(()=>t-i)}se(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.oe(i,s)).next(c=>(V(Cs,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}oe(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=Zy(s);Vf(o,r)>0&&(r=o)}),new nt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Je=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),wn=-1;function _o(n){return n==null}function Us(n){return n===0&&1/n==-1/0}function nv(n){return typeof n=="number"&&Number.isInteger(n)&&!Us(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Wa="";function Me(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=F_(e)),e=TS(n.get(t),e);return F_(e)}function TS(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case Wa:t+="";break;default:t+=s}}return t}function F_(n){return n+Wa+""}function vt(n){let e=n.length;if(j(e>=2,64408,{path:n}),e===2)return j(n.charAt(0)===Wa&&n.charAt(1)==="",56145,{path:n}),X.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Wa,s);switch((o<0||o>t)&&B(50515,{path:n}),n.charAt(o+1)){case"":let c=n.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:B(61167,{path:n})}s=o+2}return new X(r)}var nr="remoteDocuments",yo="owner",zr="owner",Bs="mutationQueues",AS="userId",ct="mutations",U_="batchId",ar="userMutationsIndex",B_=["userId","batchId"];function Oa(n,e){return[n,Me(e)]}function rv(n,e,t){return[n,Me(e),t]}var bS={},ci="documentMutations",Ga="remoteDocumentsV14",SS=["prefixPath","collectionGroup","readTime","documentId"],Va="documentKeyIndex",RS=["prefixPath","collectionGroup","documentId"],iv="collectionGroupIndex",PS=["collectionGroup","readTime","prefixPath","documentId"],qs="remoteDocumentGlobal",Vh="remoteDocumentGlobalKey",ui="targets",sv="queryTargetsIndex",CS=["canonicalId","targetId"],li="targetDocuments",kS=["targetId","path"],Lf="documentTargetsIndex",DS=["path","targetId"],Ka="targetGlobalKey",lr="targetGlobal",$s="collectionParents",NS=["collectionId","parent"],hi="clientMetadata",OS="clientId",zc="bundles",VS="bundleId",Wc="namedQueries",xS="name",Mf="indexConfiguration",LS="indexId",xh="collectionGroupIndex",MS="collectionGroup",ks="indexState",FS=["indexId","uid"],ov="sequenceNumberIndex",US=["uid","sequenceNumber"],Ds="indexEntries",BS=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],av="documentKeyIndex",qS=["indexId","uid","orderedDocumentKey"],Gc="documentOverlays",$S=["userId","collectionPath","documentId"],Lh="collectionPathOverlayIndex",jS=["userId","collectionPath","largestBatchId"],cv="collectionGroupOverlayIndex",zS=["userId","collectionGroup","largestBatchId"],Ff="globals",WS="name",uv=[Bs,ct,ci,nr,ui,yo,lr,li,hi,qs,$s,zc,Wc],GS=[...uv,Gc],lv=[Bs,ct,ci,Ga,ui,yo,lr,li,hi,qs,$s,zc,Wc,Gc],hv=lv,Uf=[...hv,Mf,ks,Ds],KS=Uf,dv=[...Uf,Ff],HS=dv;var js=class extends ja{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}};function Pe(n,e){let t=L(n);return Sn.N(t.ce,e)}function q_(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Mn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function fv(n,e){let t=[];for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function pv(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var le=class n{constructor(e,t){this.comparator=e,this.root=t||wt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,wt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ei(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ei(this.root,e,this.comparator,!1)}getReverseIterator(){return new ei(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ei(this.root,e,this.comparator,!0)}},ei=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},wt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw B(43730,{key:this.key,value:this.value});if(this.right.isRed())throw B(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw B(27949);return e+(this.isRed()?0:1)}};wt.EMPTY=null,wt.RED=!0,wt.BLACK=!1;wt.EMPTY=new class{constructor(){this.size=0}get key(){throw B(57766)}get value(){throw B(16141)}get color(){throw B(16727)}get left(){throw B(29726)}get right(){throw B(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new wt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var oe=class n{constructor(e){this.comparator=e,this.data=new le(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ha(this.data.getIterator())}getIteratorFrom(e){return new Ha(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Ha=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Wr(n){return n.hasNext()?n.getNext():void 0}var Ye=class n{constructor(e){this.fields=e,e.sort(Se.comparator)}static empty(){return new n([])}unionWith(e){let t=new oe(Se.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return si(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Qa=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function kD(){return typeof atob<"u"}var Ie=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Qa("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ie.EMPTY_BYTE_STRING=new Ie("");var QS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Kt(n){if(j(!!n,39018),typeof n=="string"){let e=0,t=QS.exec(n);if(j(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:he(n.seconds),nanos:he(n.nanos)}}function he(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ht(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}var mv="server_timestamp",gv="__type__",_v="__previous_value__",yv="__local_write_time__";function Kc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[gv])===null||t===void 0?void 0:t.stringValue)===mv}function Hc(n){let e=n.mapValue.fields[_v];return Kc(e)?Hc(e):e}function zs(n){let e=Kt(n.mapValue.fields[yv].timestampValue);return new de(e.seconds,e.nanos)}var Mh=class{constructor(e,t,r,i,s,o,c,u,l,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=l,this.isUsingEmulator=f}},Ws="(default)",di=class n{constructor(e,t){this.projectId=e,this.database=t||Ws}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Ws}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Bf="__type__",vv="__max__",In={mapValue:{fields:{__type__:{stringValue:vv}}}},qf="__vector__",fi="value",xa={nullValue:"NULL_VALUE"};function Rn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Kc(n)?4:Iv(n)?9007199254740991:Qc(n)?10:11:B(28295,{value:n})}function bt(n,e){if(n===e)return!0;let t=Rn(n);if(t!==Rn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zs(n).isEqual(zs(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Kt(i.timestampValue),c=Kt(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Ht(i.bytesValue).isEqual(Ht(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return he(i.geoPointValue.latitude)===he(s.geoPointValue.latitude)&&he(i.geoPointValue.longitude)===he(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return he(i.integerValue)===he(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=he(i.doubleValue),c=he(s.doubleValue);return o===c?Us(o)===Us(c):isNaN(o)&&isNaN(c)}return!1}(n,e);case 9:return si(n.arrayValue.values||[],e.arrayValue.values||[],bt);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(q_(o)!==q_(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!bt(o[u],c[u])))return!1;return!0}(n,e);default:return B(52216,{left:n})}}function Gs(n,e){return(n.values||[]).find(t=>bt(t,e))!==void 0}function Pn(n,e){if(n===e)return 0;let t=Rn(n),r=Rn(e);if(t!==r)return W(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return function(s,o){let c=he(s.integerValue||s.doubleValue),u=he(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(n,e);case 3:return $_(n.timestampValue,e.timestampValue);case 4:return $_(zs(n),zs(e));case 5:return Rh(n.stringValue,e.stringValue);case 6:return function(s,o){let c=Ht(s),u=Ht(o);return c.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let c=s.split("/"),u=o.split("/");for(let l=0;l<c.length&&l<u.length;l++){let f=W(c[l],u[l]);if(f!==0)return f}return W(c.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let c=W(he(s.latitude),he(o.latitude));return c!==0?c:W(he(s.longitude),he(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return j_(n.arrayValue,e.arrayValue);case 10:return function(s,o){var c,u,l,f;let p=s.fields||{},g=o.fields||{},E=(c=p[fi])===null||c===void 0?void 0:c.arrayValue,k=(u=g[fi])===null||u===void 0?void 0:u.arrayValue,N=W(((l=E?.values)===null||l===void 0?void 0:l.length)||0,((f=k?.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:j_(E,k)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===In.mapValue&&o===In.mapValue)return 0;if(s===In.mapValue)return 1;if(o===In.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),l=o.fields||{},f=Object.keys(l);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){let g=Rh(u[p],f[p]);if(g!==0)return g;let E=Pn(c[u[p]],l[f[p]]);if(E!==0)return E}return W(u.length,f.length)}(n.mapValue,e.mapValue);default:throw B(23264,{le:t})}}function $_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return W(n,e);let t=Kt(n),r=Kt(e),i=W(t.seconds,r.seconds);return i!==0?i:W(t.nanos,r.nanos)}function j_(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Pn(t[i],r[i]);if(s)return s}return W(t.length,r.length)}function pi(n){return Fh(n)}function Fh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Kt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ht(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return F.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Fh(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Fh(t.fields[o])}`;return i+"}"}(n.mapValue):B(61005,{value:n})}function La(n){switch(Rn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Hc(n);return e?16+La(e):16;case 5:return 2*n.stringValue.length;case 6:return Ht(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+La(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return Mn(r.fields,(s,o)=>{i+=s.length+La(o)}),i}(n.mapValue);default:throw B(13486,{value:n})}}function hr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Uh(n){return!!n&&"integerValue"in n}function Ks(n){return!!n&&"arrayValue"in n}function z_(n){return!!n&&"nullValue"in n}function W_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ma(n){return!!n&&"mapValue"in n}function Qc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Bf])===null||t===void 0?void 0:t.stringValue)===qf}function Ns(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Mn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ns(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ns(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Iv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===vv}var Ev={mapValue:{fields:{[Bf]:{stringValue:qf},[fi]:{arrayValue:{}}}}};function JS(n){return"nullValue"in n?xa:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?hr(di.empty(),F.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Qc(n)?Ev:{mapValue:{}}:B(35942,{value:n})}function YS(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?hr(di.empty(),F.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Ev:"mapValue"in n?Qc(n)?{mapValue:{}}:In:B(61959,{value:n})}function G_(n,e){let t=Pn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function K_(n,e){let t=Pn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Le=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ma(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ns(t)}setAll(e){let t=Se.emptyPath(),r={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=c.popLast()}o?r[c.lastSegment()]=Ns(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Ma(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return bt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ma(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Mn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Ns(this.value))}};function wv(n){let e=[];return Mn(n.fields,(t,r)=>{let i=new Se([t]);if(Ma(r)){let s=wv(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Ye(e)}var Re=class n{constructor(e,t,r,i,s,o,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),Le.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,z.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),Le.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),Le.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Le.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Le.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var St=class{constructor(e,t){this.position=e,this.inclusive=t}};function H_(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=F.comparator(F.fromName(o.referenceValue),t.key):r=Pn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Q_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!bt(n.position[t],e.position[t]))return!1;return!0}var dr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function XS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ja=class{},Z=class n extends Ja{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new $h(e,t,r):t==="array-contains"?new Wh(e,r):t==="in"?new Ya(e,r):t==="not-in"?new Gh(e,r):t==="array-contains-any"?new Kh(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new jh(e,r):new zh(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Pn(t,this.value)):t!==null&&Rn(this.value)===Rn(t)&&this.matchesComparison(Pn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ie=class n extends Ja{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return mi(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function mi(n){return n.op==="and"}function Bh(n){return n.op==="or"}function $f(n){return Tv(n)&&mi(n)}function Tv(n){for(let e of n.filters)if(e instanceof ie)return!1;return!0}function qh(n){if(n instanceof Z)return n.field.canonicalString()+n.op.toString()+pi(n.value);if($f(n))return n.filters.map(e=>qh(e)).join(",");{let e=n.filters.map(t=>qh(t)).join(",");return`${n.op}(${e})`}}function Av(n,e){return n instanceof Z?function(r,i){return i instanceof Z&&r.op===i.op&&r.field.isEqual(i.field)&&bt(r.value,i.value)}(n,e):n instanceof ie?function(r,i){return i instanceof ie&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,c)=>s&&Av(o,i.filters[c]),!0):!1}(n,e):void B(19439)}function bv(n,e){let t=n.filters.concat(e);return ie.create(t,n.op)}function Sv(n){return n instanceof Z?function(t){return`${t.field.canonicalString()} ${t.op} ${pi(t.value)}`}(n):n instanceof ie?function(t){return t.op.toString()+" {"+t.getFilters().map(Sv).join(" ,")+"}"}(n):"Filter"}var $h=class extends Z{constructor(e,t,r){super(e,t,r),this.key=F.fromName(r.referenceValue)}matches(e){let t=F.comparator(e.key,this.key);return this.matchesComparison(t)}},jh=class extends Z{constructor(e,t){super(e,"in",t),this.keys=Rv("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},zh=class extends Z{constructor(e,t){super(e,"not-in",t),this.keys=Rv("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Rv(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>F.fromName(r.referenceValue))}var Wh=class extends Z{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ks(t)&&Gs(t.arrayValue,this.value)}},Ya=class extends Z{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Gs(this.value.arrayValue,t)}},Gh=class extends Z{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Gs(this.value.arrayValue,t)}},Kh=class extends Z{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Ks(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Gs(this.value.arrayValue,r))}};var Hh=class{constructor(e,t=null,r=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.Pe=null}};function Qh(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Hh(n,e,t,r,i,s,o)}function fr(n){let e=L(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>qh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),_o(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>pi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>pi(r)).join(",")),e.Pe=t}return e.Pe}function vo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!XS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Av(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Q_(n.startAt,e.startAt)&&Q_(n.endAt,e.endAt)}function Xa(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Za(n,e){return n.filters.filter(t=>t instanceof Z&&t.field.isEqual(e))}function J_(n,e,t){let r=xa,i=!0;for(let s of Za(n,e)){let o=xa,c=!0;switch(s.op){case"<":case"<=":o=JS(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=xa}G_({value:r,inclusive:i},{value:o,inclusive:c})<0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];G_({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function Y_(n,e,t){let r=In,i=!0;for(let s of Za(n,e)){let o=In,c=!0;switch(s.op){case">=":case">":o=YS(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=In}K_({value:r,inclusive:i},{value:o,inclusive:c})>0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];K_({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var ut=class{constructor(e,t=null,r=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function Pv(n,e,t,r,i,s,o,c){return new ut(n,e,t,r,i,s,o,c)}function ki(n){return new ut(n)}function X_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function jf(n){return n.collectionGroup!==null}function ti(n){let e=L(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new oe(Se.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(l=>{l.isInequality()&&(c=c.add(l.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new dr(s,r))}),t.has(Se.keyField().canonicalString())||e.Te.push(new dr(Se.keyField(),r))}return e.Te}function Fe(n){let e=L(n);return e.Ie||(e.Ie=kv(e,ti(n))),e.Ie}function Cv(n){let e=L(n);return e.de||(e.de=kv(e,n.explicitOrderBy)),e.de}function kv(n,e){if(n.limitType==="F")return Qh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new dr(i.field,s)});let t=n.endAt?new St(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new St(n.startAt.position,n.startAt.inclusive):null;return Qh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Jh(n,e){let t=n.filters.concat([e]);return new ut(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ec(n,e,t){return new ut(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Io(n,e){return vo(Fe(n),Fe(e))&&n.limitType===e.limitType}function Dv(n){return`${fr(Fe(n))}|lt:${n.limitType}`}function Yr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Sv(i)).join(", ")}]`),_o(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>pi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>pi(i)).join(",")),`Target(${r})`}(Fe(n))}; limitType=${n.limitType})`}function Eo(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):F.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of ti(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,c,u){let l=H_(o,c,u);return o.inclusive?l<=0:l<0}(r.startAt,ti(r),i)||r.endAt&&!function(o,c,u){let l=H_(o,c,u);return o.inclusive?l>=0:l>0}(r.endAt,ti(r),i))}(n,e)}function Nv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Ov(n){return(e,t)=>{let r=!1;for(let i of ti(n)){let s=ZS(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function ZS(n,e,t){let r=n.field.isKeyField()?F.comparator(e.key,t.key):function(s,o,c){let u=o.data.field(s),l=c.data.field(s);return u!==null&&l!==null?Pn(u,l):B(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B(19790,{direction:n.dir})}}var lt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Mn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return pv(this.inner)}size(){return this.innerSize}};var eR=new le(F.comparator);function Ge(){return eR}var Vv=new le(F.comparator);function Rs(...n){let e=Vv;for(let t of n)e=e.insert(t.key,t);return e}function xv(n){let e=Vv;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function It(){return Os()}function Lv(){return Os()}function Os(){return new lt(n=>n.toString(),(n,e)=>n.isEqual(e))}var tR=new le(F.comparator),nR=new oe(F.comparator);function Q(...n){let e=nR;for(let t of n)e=e.add(t);return e}var rR=new oe(W);function zf(){return rR}function Wf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Us(e)?"-0":e}}function Mv(n){return{integerValue:""+n}}function Fv(n,e){return nv(e)?Mv(e):Wf(n,e)}var gi=class{constructor(){this._=void 0}};function iR(n,e,t){return n instanceof Cn?function(i,s){let o={fields:{[gv]:{stringValue:mv},[yv]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Kc(s)&&(s=Hc(s)),s&&(o.fields[_v]=s),{mapValue:o}}(t,e):n instanceof Qt?Bv(n,e):n instanceof Jt?qv(n,e):function(i,s){let o=Uv(i,s),c=Z_(o)+Z_(i.Ee);return Uh(o)&&Uh(i.Ee)?Mv(c):Wf(i.serializer,c)}(n,e)}function sR(n,e,t){return n instanceof Qt?Bv(n,e):n instanceof Jt?qv(n,e):t}function Uv(n,e){return n instanceof kn?function(r){return Uh(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Cn=class extends gi{},Qt=class extends gi{constructor(e){super(),this.elements=e}};function Bv(n,e){let t=$v(e);for(let r of n.elements)t.some(i=>bt(i,r))||t.push(r);return{arrayValue:{values:t}}}var Jt=class extends gi{constructor(e){super(),this.elements=e}};function qv(n,e){let t=$v(e);for(let r of n.elements)t=t.filter(i=>!bt(i,r));return{arrayValue:{values:t}}}var kn=class extends gi{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function Z_(n){return he(n.integerValue||n.doubleValue)}function $v(n){return Ks(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var pr=class{constructor(e,t){this.field=e,this.transform=t}};function oR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Qt&&i instanceof Qt||r instanceof Jt&&i instanceof Jt?si(r.elements,i.elements,bt):r instanceof kn&&i instanceof kn?bt(r.Ee,i.Ee):r instanceof Cn&&i instanceof Cn}(n.transform,e.transform)}var Yh=class{constructor(e,t){this.version=e,this.transformResults=t}},ge=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Fa(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var _i=class{};function jv(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Nn(n.key,ge.none()):new Dn(n.key,n.data,ge.none());{let t=n.data,r=Le.empty(),i=new oe(Se.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new ht(n.key,r,new Ye(i.toArray()),ge.none())}}function aR(n,e,t){n instanceof Dn?function(i,s,o){let c=i.value.clone(),u=ty(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):n instanceof ht?function(i,s,o){if(!Fa(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=ty(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(zv(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Vs(n,e,t,r){return n instanceof Dn?function(s,o,c,u){if(!Fa(s.precondition,o))return c;let l=s.value.clone(),f=ny(s.fieldTransforms,u,o);return l.setAll(f),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof ht?function(s,o,c,u){if(!Fa(s.precondition,o))return c;let l=ny(s.fieldTransforms,u,o),f=o.data;return f.setAll(zv(s)),f.setAll(l),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,r):function(s,o,c){return Fa(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(n,e,t)}function cR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=Uv(r.transform,i||null);s!=null&&(t===null&&(t=Le.empty()),t.set(r.field,s))}return t||null}function ey(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&si(r,i,(s,o)=>oR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Dn=class extends _i{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ht=class extends _i{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function zv(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function ty(n,e,t){let r=new Map;j(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,sR(o,c,t[i]))}return r}function ny(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,iR(s,o,e))}return r}var Nn=class extends _i{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Hs=class extends _i{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Qs=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&aR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Vs(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Vs(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Lv();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=jv(o,c);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(z.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&si(this.mutations,e.mutations,(t,r)=>ey(t,r))&&si(this.baseMutations,e.baseMutations,(t,r)=>ey(t,r))}},Xh=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){j(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=function(){return tR}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Js=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var tc=class{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}};var Zh=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ee,ee;function Wv(n){switch(n){case S.OK:return B(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return B(15467,{code:n})}}function Gv(n){if(n===void 0)return ye("GRPC error has no .code"),S.UNKNOWN;switch(n){case Ee.OK:return S.OK;case Ee.CANCELLED:return S.CANCELLED;case Ee.UNKNOWN:return S.UNKNOWN;case Ee.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case Ee.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case Ee.INTERNAL:return S.INTERNAL;case Ee.UNAVAILABLE:return S.UNAVAILABLE;case Ee.UNAUTHENTICATED:return S.UNAUTHENTICATED;case Ee.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case Ee.NOT_FOUND:return S.NOT_FOUND;case Ee.ALREADY_EXISTS:return S.ALREADY_EXISTS;case Ee.PERMISSION_DENIED:return S.PERMISSION_DENIED;case Ee.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case Ee.ABORTED:return S.ABORTED;case Ee.OUT_OF_RANGE:return S.OUT_OF_RANGE;case Ee.UNIMPLEMENTED:return S.UNIMPLEMENTED;case Ee.DATA_LOSS:return S.DATA_LOSS;default:return B(39323,{code:n})}}(ee=Ee||(Ee={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";var nc=null;var uR=new qt([4294967295,4294967295],0);function ry(n){let e=Nf().encode(n),t=new ch;return t.update(e),new Uint8Array(t.digest())}function iy(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new qt([t,r],0),new qt([i,s],0)]}var ed=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new cr(`Invalid padding: ${t}`);if(r<0)throw new cr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new cr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new cr(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=qt.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(qt.fromNumber(r)));return i.compare(uR)===1&&(i=new qt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=ry(e),[r,i]=iy(t);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);if(!this.ye(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(c=>o.insert(c)),o}insert(e){if(this.fe===0)return;let t=ry(e),[r,i]=iy(t);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);this.we(o)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},cr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ys=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Xs.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(z.min(),i,new le(W),Ge(),Q())}},Xs=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Q(),Q(),Q())}};var ni=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},rc=class{constructor(e,t){this.targetId=e,this.De=t}},ic=class{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},sc=class{constructor(){this.ve=0,this.Ce=sy(),this.Fe=Ie.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Q(),t=Q(),r=Q();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:B(38017,{changeType:s})}}),new Xs(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=sy()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,j(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},td=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=Ge(),this.je=Ra(),this.Je=Ra(),this.He=new le(W)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:B(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(Xa(s))if(r===0){let o=new F(s.path);this.Xe(t,o,Re.newNoDocument(o,z.min()))}else j(r===1,20013,{expectedCount:r});else{let o=this.ot(t);if(o!==r){let c=this._t(e),u=c?this.ut(c,e,o):1;if(u!==0){this.rt(t);let l=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,l)}nc?.ct(function(f,p,g,E,k){var N,O,U,$,q,H;let te={localCacheCount:f,existenceFilterCount:p.count,databaseId:g.database,projectId:g.projectId},K=p.unchangedNames;return K&&(te.bloomFilter={applied:k===0,hashCount:(N=K?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:($=(U=(O=K?.bits)===null||O===void 0?void 0:O.bitmap)===null||U===void 0?void 0:U.length)!==null&&$!==void 0?$:0,padding:(H=(q=K?.bits)===null||q===void 0?void 0:q.padding)!==null&&H!==void 0?H:0,mightContain:w=>{var y;return(y=E?.mightContain(w))!==null&&y!==void 0&&y}}),te}(o,e.De,this.We.lt(),c,u))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,c;try{o=Ht(r).toUint8Array()}catch(u){if(u instanceof Qa)return je("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new ed(o,i,s)}catch(u){return je(u instanceof cr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.fe===0?null:c}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.We.lt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,o)=>{let c=this.st(o);if(c){if(s.current&&Xa(c.target)){let u=new F(c.target.path);this.Tt(u).has(o)||this.It(o,u)||this.Xe(o,u,Re.newNoDocument(u,e))}s.Ne&&(t.set(o,s.Le()),s.ke())}});let r=Q();this.Je.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let l=this.st(u);return!l||l.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ze.forEach((s,o)=>o.setReadTime(e));let i=new Ys(e,t,this.He,this.ze,r);return this.ze=Ge(),this.je=Ra(),this.Je=Ra(),this.He=new le(W),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new sc,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new oe(W),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new oe(W),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new sc),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function Ra(){return new le(F.comparator)}function sy(){return new le(F.comparator)}var lR={asc:"ASCENDING",desc:"DESCENDING"},hR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dR={and:"AND",or:"OR"},nd=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function rd(n,e){return n.useProto3Json||_o(e)?e:{value:e}}function yi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Kv(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function fR(n,e){return yi(n,e.toTimestamp())}function ve(n){return j(!!n,49232),z.fromTimestamp(function(t){let r=Kt(t);return new de(r.seconds,r.nanos)}(n))}function Gf(n,e){return id(n,e).canonicalString()}function id(n,e){let t=function(i){return new X(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Hv(n){let e=X.fromString(n);return j(rI(e),10190,{key:e.toString()}),e}function Zs(n,e){return Gf(n.databaseId,e.path)}function Tt(n,e){let t=Hv(e);if(t.get(1)!==n.databaseId.projectId)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(Yv(t))}function Qv(n,e){return Gf(n.databaseId,e)}function Jv(n){let e=Hv(n);return e.length===4?X.emptyPath():Yv(e)}function sd(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Yv(n){return j(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function oy(n,e,t){return{name:Zs(n,e),fields:t.value.mapValue.fields}}function Jc(n,e,t){let r=Tt(n,e.name),i=ve(e.updateTime),s=e.createTime?ve(e.createTime):z.min(),o=new Le({mapValue:{fields:e.fields}}),c=Re.newFoundDocument(r,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function pR(n,e){return"found"in e?function(r,i){j(!!i.found,43571),i.found.name,i.found.updateTime;let s=Tt(r,i.found.name),o=ve(i.found.updateTime),c=i.found.createTime?ve(i.found.createTime):z.min(),u=new Le({mapValue:{fields:i.found.fields}});return Re.newFoundDocument(s,o,c,u)}(n,e):"missing"in e?function(r,i){j(!!i.missing,3894),j(!!i.readTime,22933);let s=Tt(r,i.missing),o=ve(i.readTime);return Re.newNoDocument(s,o)}(n,e):B(7234,{result:e})}function mR(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:B(39313,{state:l})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,f){return l.useProto3Json?(j(f===void 0||typeof f=="string",58123),Ie.fromBase64String(f||"")):(j(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ie.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(l){let f=l.code===void 0?S.UNKNOWN:Gv(l.code);return new D(f,l.message||"")}(o);t=new ic(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Tt(n,r.document.name),s=ve(r.document.updateTime),o=r.document.createTime?ve(r.document.createTime):z.min(),c=new Le({mapValue:{fields:r.document.fields}}),u=Re.newFoundDocument(i,s,o,c),l=r.targetIds||[],f=r.removedTargetIds||[];t=new ni(l,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Tt(n,r.document),s=r.readTime?ve(r.readTime):z.min(),o=Re.newNoDocument(i,s),c=r.removedTargetIds||[];t=new ni([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Tt(n,r.document),s=r.removedTargetIds||[];t=new ni([],s,i,null)}else{if(!("filter"in e))return B(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Zh(i,s),c=r.targetId;t=new rc(c,o)}}return t}function eo(n,e){let t;if(e instanceof Dn)t={update:oy(n,e.key,e.value)};else if(e instanceof Nn)t={delete:Zs(n,e.key)};else if(e instanceof ht)t={update:oy(n,e.key,e.data),updateMask:ER(e.fieldMask)};else{if(!(e instanceof Hs))return B(16599,{Rt:e.type});t={verify:Zs(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let c=o.transform;if(c instanceof Cn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Qt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Jt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof kn)return{fieldPath:o.field.canonicalString(),increment:c.Ee};throw B(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:fR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:B(27497)}(n,e.precondition)),t}function od(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?ge.updateTime(ve(s.updateTime)):s.exists!==void 0?ge.exists(s.exists):ge.none()}(e.currentDocument):ge.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,c){let u=null;if("setToServerValue"in c)j(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new Cn;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new Qt(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new Jt(f)}else"increment"in c?u=new kn(o,c.increment):B(16584,{proto:c});let l=Se.fromServerFormat(c.fieldPath);return new pr(l,u)}(n,i)):[];if(e.update){e.update.name;let i=Tt(n,e.update.name),s=new Le({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let l=u.fieldPaths||[];return new Ye(l.map(f=>Se.fromServerFormat(f)))}(e.updateMask);return new ht(i,s,o,t,r)}return new Dn(i,s,t,r)}if(e.delete){let i=Tt(n,e.delete);return new Nn(i,t)}if(e.verify){let i=Tt(n,e.verify);return new Hs(i,t)}return B(1463,{proto:e})}function gR(n,e){return n&&n.length>0?(j(e!==void 0,14353),n.map(t=>function(i,s){let o=i.updateTime?ve(i.updateTime):ve(s);return o.isEqual(z.min())&&(o=ve(s)),new Yh(o,i.transformResults||[])}(t,e))):[]}function Xv(n,e){return{documents:[Qv(n,e.path)]}}function Yc(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Qv(n,i);let s=function(l){if(l.length!==0)return nI(ie.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(l){if(l.length!==0)return l.map(f=>function(g){return{field:yn(g.field),direction:yR(g.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=rd(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{Vt:t,parent:i}}function Zv(n,e,t,r){let{Vt:i,parent:s}=Yc(n,e),o={},c=[],u=0;return t.forEach(l=>{let f=r?l.alias:"aggregate_"+u++;o[f]=l.alias,l.aggregateType==="count"?c.push({alias:f,count:{}}):l.aggregateType==="avg"?c.push({alias:f,avg:{field:yn(l.fieldPath)}}):l.aggregateType==="sum"&&c.push({alias:f,sum:{field:yn(l.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:c,structuredQuery:i.structuredQuery},parent:i.parent},ft:o,parent:s}}function eI(n){let e=Jv(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){j(r===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(p){let g=tI(p);return g instanceof ie&&$f(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(g=>function(k){return new dr(Xr(k.field),function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(g))}(t.orderBy));let c=null;t.limit&&(c=function(p){let g;return g=typeof p=="object"?p.value:p,_o(g)?null:g}(t.limit));let u=null;t.startAt&&(u=function(p){let g=!!p.before,E=p.values||[];return new St(E,g)}(t.startAt));let l=null;return t.endAt&&(l=function(p){let g=!p.before,E=p.values||[];return new St(E,g)}(t.endAt)),Pv(e,i,o,s,c,"F",u,l)}function _R(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function tI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Xr(t.unaryFilter.field);return Z.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Xr(t.unaryFilter.field);return Z.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Xr(t.unaryFilter.field);return Z.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Xr(t.unaryFilter.field);return Z.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B(61313);default:return B(60726)}}(n):n.fieldFilter!==void 0?function(t){return Z.create(Xr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B(58110);default:return B(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ie.create(t.compositeFilter.filters.map(r=>tI(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B(1026)}}(t.compositeFilter.op))}(n):B(30097,{filter:n})}function yR(n){return lR[n]}function vR(n){return hR[n]}function IR(n){return dR[n]}function yn(n){return{fieldPath:n.canonicalString()}}function Xr(n){return Se.fromServerFormat(n.fieldPath)}function nI(n){return n instanceof Z?function(t){if(t.op==="=="){if(W_(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NAN"}};if(z_(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(W_(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NOT_NAN"}};if(z_(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yn(t.field),op:vR(t.op),value:t.value}}}(n):n instanceof ie?function(t){let r=t.getFilters().map(i=>nI(i));return r.length===1?r[0]:{compositeFilter:{op:IR(t.op),filters:r}}}(n):B(54877,{filter:n})}function ER(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function rI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var vi=class n{constructor(e,t,r,i,s=z.min(),o=z.min(),c=Ie.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var oc=class{constructor(e){this.gt=e}};function wR(n,e){let t;if(e.document)t=Jc(n.gt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=F.fromSegments(e.noDocument.path),i=gr(e.noDocument.readTime);t=Re.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B(56709);{let r=F.fromSegments(e.unknownDocument.path),i=gr(e.unknownDocument.version);t=Re.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new de(i[0],i[1]);return z.fromTimestamp(s)}(e.readTime)),t}function ay(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ac(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Zs(s,o.key),fields:o.data.value.mapValue.fields,updateTime:yi(s,o.version.toTimestamp()),createTime:yi(s,o.createTime.toTimestamp())}}(n.gt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:mr(e.version)};else{if(!e.isUnknownDocument())return B(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:mr(e.version)}}return r}function ac(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function mr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function gr(n){let e=new de(n.seconds,n.nanoseconds);return z.fromTimestamp(e)}function ir(n,e){let t=(e.baseMutations||[]).map(s=>od(n.gt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>od(n.gt,s)),i=de.fromMillis(e.localWriteTimeMs);return new Qs(e.batchId,i,t,r)}function Ps(n){let e=gr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?gr(n.lastLimboFreeSnapshotVersion):z.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){let o=s.documents.length;return j(o===1,1966,{count:o}),Fe(ki(Jv(s.documents[0])))}(n.query):function(s){return Fe(eI(s))}(n.query),new vi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ie.fromBase64String(n.resumeToken))}function iI(n,e){let t=mr(e.snapshotVersion),r=mr(e.lastLimboFreeSnapshotVersion),i;i=Xa(e.target)?Xv(n.gt,e.target):Yc(n.gt,e.target).Vt;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:fr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Xc(n){let e=eI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ec(e,e.limit,"L"):e}function ph(n,e){return new Js(e.largestBatchId,od(n.gt,e.overlayMutation))}function cy(n,e){let t=e.path.lastSegment();return[n,Me(e.path.popLast()),t]}function uy(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:mr(r.readTime),documentKey:Me(r.documentKey.path),largestBatchId:r.largestBatchId}}var ad=class{getBundleMetadata(e,t){return ly(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:gr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return ly(e).put(function(i){return{bundleId:i.id,createTime:mr(ve(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return hy(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Xc(s.bundledQuery),readTime:gr(s.readTime)}}(r)})}saveNamedQuery(e,t){return hy(e).put(function(i){return{name:i.name,readTime:mr(ve(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function ly(n){return Pe(n,zc)}function hy(n){return Pe(n,Wc)}var cc=class n{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Ts(e).get(cy(this.userId,t)).next(r=>r?ph(this.serializer,r):null)}getOverlays(e,t){let r=It();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let c=new Js(t,o);i.push(this.wt(e,c))}),P.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Me(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Ts(e).Y(Lh,c))}),P.waitFor(s)}getOverlaysForCollection(e,t,r){let i=It(),s=Me(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ts(e).j(Lh,o).next(c=>{for(let u of c){let l=ph(this.serializer,u);i.set(l.getKey(),l)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=It(),o,c=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ts(e).X({index:cv,range:c},(u,l,f)=>{let p=ph(this.serializer,l);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):f.done()}).next(()=>s)}wt(e,t){return Ts(e).put(function(i,s,o){let[c,u,l]=cy(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:l,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:eo(i.gt,o.mutation)}}(this.serializer,this.userId,t))}};function Ts(n){return Pe(n,Gc)}var cd=class{St(e){return Pe(e,Ff)}getSessionToken(e){return this.St(e).get("sessionToken").next(t=>{let r=t?.value;return r?Ie.fromUint8Array(r):Ie.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}};var jt=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(he(e.integerValue));else if("doubleValue"in e){let r=he(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Us(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=Kt(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Ht(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?Iv(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Qc(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):B(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let o=fi,c=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(he(c)),this.xt(o,t),this.Dt(s[o],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),F.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};jt.Ut=new jt;var Gr=255;function TR(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function dy(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=TR(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var ud=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Wt(r.value),r=t.next();this.Gt()}zt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.jt(r.value),r=t.next();this.Jt()}Ht(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Wt(r);else if(r<2048)this.Wt(960|r>>>6),this.Wt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Wt(480|r>>>12),this.Wt(128|63&r>>>6),this.Wt(128|63&r);else{let i=t.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.jt(r);else if(r<2048)this.jt(960|r>>>6),this.jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.jt(480|r>>>12),this.jt(128|63&r>>>6),this.jt(128|63&r);else{let i=t.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(e){let t=this.Xt(e),r=dy(t);this.en(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}tn(e){let t=this.Xt(e),r=dy(t);this.en(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}nn(){this.rn(Gr),this.rn(255)}sn(){this._n(Gr),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Wt(e){let t=255&e;t===0?(this.rn(0),this.rn(255)):t===Gr?(this.rn(Gr),this.rn(0)):this.rn(t)}jt(e){let t=255&e;t===0?(this._n(0),this._n(255)):t===Gr?(this._n(Gr),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},ld=class{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}},hd=class{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}},sr=class{constructor(){this.un=new ud,this.cn=new ld(this.un),this.ln=new hd(this.un)}seed(e){this.un.seed(e)}hn(e){return e===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var or=class n{constructor(e,t,r,i){this.Pn=e,this.Tn=t,this.In=r,this.dn=i}En(){let e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new n(this.Pn,this.Tn,this.In,r)}An(e,t,r){return{indexId:this.Pn,uid:e,arrayValue:Ua(this.In),directionalValue:Ua(this.dn),orderedDocumentKey:Ua(t),documentKey:r.path.toArray()}}Rn(e,t,r){let i=this.An(e,t,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function mn(n,e){let t=n.Pn-e.Pn;return t!==0?t:(t=fy(n.In,e.In),t!==0?t:(t=fy(n.dn,e.dn),t!==0?t:F.comparator(n.Tn,e.Tn)))}function fy(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Ua(n){return Xu()?function(t){let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r}(n):n}function py(n){return typeof n!="string"?n:function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(n)}var uc=class{constructor(e){this.Vn=new oe((t,r)=>Se.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Vn=this.Vn.add(r):this.fn.push(r)}}get gn(){return this.Vn.size>1}pn(e){if(j(e.collectionGroup===this.collectionId,49279),this.gn)return!1;let t=Ch(e);if(t!==void 0&&!this.yn(t))return!1;let r=tr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.yn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Vn.size>0){let c=this.Vn.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=r[s];if(!this.wn(c,u)||!this.Sn(this.mn[o++],u))return!1}++s}for(;s<r.length;++s){let c=r[s];if(o>=this.mn.length||!this.Sn(this.mn[o++],c))return!1}return!0}bn(){if(this.gn)return null;let e=new oe(Se.comparator),t=[];for(let r of this.fn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new zt(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new zt(r.field,0))}for(let r of this.mn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new zt(r.field,r.dir==="asc"?0:1)));return new bn(bn.UNKNOWN_ID,this.collectionId,t,ai.empty())}yn(e){for(let t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function sI(n){var e,t;if(j(n instanceof Z||n instanceof ie,20012),n instanceof Z){if(n instanceof Ya){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Z.create(n.field,"==",s)))||[];return ie.create(i,"or")}return n}let r=n.filters.map(i=>sI(i));return ie.create(r,n.op)}function AR(n){if(n.getFilters().length===0)return[];let e=pd(sI(n));return j(oI(e),7391),dd(e)||fd(e)?[e]:e.getFilters()}function dd(n){return n instanceof Z}function fd(n){return n instanceof ie&&$f(n)}function oI(n){return dd(n)||fd(n)||function(t){if(t instanceof ie&&Bh(t)){for(let r of t.getFilters())if(!dd(r)&&!fd(r))return!1;return!0}return!1}(n)}function pd(n){if(j(n instanceof Z||n instanceof ie,34018),n instanceof Z)return n;if(n.filters.length===1)return pd(n.filters[0]);let e=n.filters.map(r=>pd(r)),t=ie.create(e,n.op);return t=lc(t),oI(t)?t:(j(t instanceof ie,64498),j(mi(t),40251),j(t.filters.length>1,57927),t.filters.reduce((r,i)=>Kf(r,i)))}function Kf(n,e){let t;return j(n instanceof Z||n instanceof ie,38388),j(e instanceof Z||e instanceof ie,25473),t=n instanceof Z?e instanceof Z?function(i,s){return ie.create([i,s],"and")}(n,e):my(n,e):e instanceof Z?my(e,n):function(i,s){if(j(i.filters.length>0&&s.filters.length>0,48005),mi(i)&&mi(s))return bv(i,s.getFilters());let o=Bh(i)?i:s,c=Bh(i)?s:i,u=o.filters.map(l=>Kf(l,c));return ie.create(u,"or")}(n,e),lc(t)}function my(n,e){if(mi(e))return bv(e,n.getFilters());{let t=e.filters.map(r=>Kf(n,r));return ie.create(t,"or")}}function lc(n){if(j(n instanceof Z||n instanceof ie,11850),n instanceof Z)return n;let e=n.getFilters();if(e.length===1)return lc(e[0]);if(Tv(n))return n;let t=e.map(i=>lc(i)),r=[];return t.forEach(i=>{i instanceof Z?r.push(i):i instanceof ie&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ie.create(r,n.op)}var md=class{constructor(){this.Dn=new to}addToCollectionParentIndex(e,t){return this.Dn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(nt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(nt.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},to=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new oe(X.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new oe(X.comparator)).toArray()}};var gy="IndexedDbIndexManager",Pa=new Uint8Array(0),gd=class{constructor(e,t){this.databaseId=t,this.vn=new to,this.Cn=new lt(r=>fr(r),(r,i)=>vo(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let s={collectionId:r,parent:Me(i)};return _y(e).put(s)}return P.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[Qy(t),""],!1,!0);return _y(e).j(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(vt(o.parent))}return r})}addFieldIndex(e,t){let r=As(e),i=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Hr(e);return s.next(c=>{o.put(uy(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=As(e),i=Hr(e),s=Kr(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=As(e),r=Kr(e),i=Hr(e);return t.Y().next(()=>r.Y()).next(()=>i.Y())}createTargetIndexes(e,t){return P.forEach(this.Fn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new uc(r).bn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Kr(e),i=!0,s=new Map;return P.forEach(this.Fn(t),o=>this.Mn(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=Q(),c=[];return P.forEach(s,(u,l)=>{V(gy,`Using index ${function(q){return`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map(H=>`${H.fieldPath}:${H.kind}`).join(",")}`}(u)} to execute ${fr(t)}`);let f=function(q,H){let te=Ch(H);if(te===void 0)return null;for(let K of Za(q,te.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null}(l,u),p=function(q,H){let te=new Map;for(let K of tr(H))for(let w of Za(q,K.fieldPath))switch(w.op){case"==":case"in":te.set(K.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return te.set(K.fieldPath.canonicalString(),w.value),Array.from(te.values())}return null}(l,u),g=function(q,H){let te=[],K=!0;for(let w of tr(H)){let y=w.kind===0?J_(q,w.fieldPath,q.startAt):Y_(q,w.fieldPath,q.startAt);te.push(y.value),K&&(K=y.inclusive)}return new St(te,K)}(l,u),E=function(q,H){let te=[],K=!0;for(let w of tr(H)){let y=w.kind===0?Y_(q,w.fieldPath,q.endAt):J_(q,w.fieldPath,q.endAt);te.push(y.value),K&&(K=y.inclusive)}return new St(te,K)}(l,u),k=this.xn(u,l,g),N=this.xn(u,l,E),O=this.On(u,l,p),U=this.Nn(u.indexId,f,k,g.inclusive,N,E.inclusive,O);return P.forEach(U,$=>r.H($,t.limit).next(q=>{q.forEach(H=>{let te=F.fromSegments(H.documentKey);o.has(te)||(o=o.add(te),c.push(te))})}))}).next(()=>c)}return P.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=AR(ie.create(e.filters,"and")).map(r=>Qh(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,r,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),l=u/(t!=null?t.length:1),f=[];for(let p=0;p<u;++p){let g=t?this.Bn(t[p/l]):Pa,E=this.Ln(e,g,r[p%l],i),k=this.kn(e,g,s[p%l],o),N=c.map(O=>this.Ln(e,g,O,!0));f.push(...this.createRange(E,k,N))}return f}Ln(e,t,r,i){let s=new or(e,F.empty(),t,r);return i?s:s.En()}kn(e,t,r,i){let s=new or(e,F.empty(),t,r);return i?s.En():s}Mn(e,t){let r=new uc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)r.pn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let r=2,i=this.Fn(t);return P.forEach(i,s=>this.Mn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let l=new oe(Se.comparator),f=!1;for(let p of u.filters)for(let g of p.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?f=!0:l=l.add(g.field));for(let p of u.orderBy)p.field.isKeyField()||(l=l.add(p.field));return l.size+(f?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}qn(e,t){let r=new sr;for(let i of tr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.hn(i.kind);jt.Ut.bt(s,o)}return r.an()}Bn(e){let t=new sr;return jt.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){let r=new sr;return jt.Ut.bt(hr(this.databaseId,t),r.hn(function(s){let o=tr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.an()}On(e,t,r){if(r===null)return[];let i=[];i.push(new sr);let s=0;for(let o of tr(e)){let c=r[s++];for(let u of i)if(this.$n(t,o.fieldPath)&&Ks(c))i=this.Un(i,o,c);else{let l=u.hn(o.kind);jt.Ut.bt(c,l)}}return this.Kn(i)}xn(e,t,r){return this.On(e,t,r.position)}Kn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].an();return t}Un(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let c of i){let u=new sr;u.seed(c.an()),jt.Ut.bt(o,u.hn(t.kind)),s.push(u)}return s}$n(e,t){return!!e.filters.find(r=>r instanceof Z&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=As(e),i=Hr(e);return(t?r.j(xh,IDBKeyRange.bound(t,t)):r.j()).next(s=>{let o=[];return P.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push(function(f,p){let g=p?new ai(p.sequenceNumber,new nt(gr(p.readTime),new F(vt(p.documentKey)),p.largestBatchId)):ai.empty(),E=f.fields.map(([k,N])=>new zt(Se.fromServerFormat(k),N));return new bn(f.indexId,f.collectionGroup,E,g)}(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:W(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=As(e),s=Hr(e);return this.Wn(e).next(o=>i.j(xh,IDBKeyRange.bound(t,t)).next(c=>P.forEach(c,u=>s.put(uy(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return P.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?P.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(r.set(i.collectionGroup,c),P.forEach(c,u=>this.Gn(e,i,u).next(l=>{let f=this.zn(s,u);return l.isEqual(f)?P.resolve():this.jn(e,s,u,l,f)}))))})}Jn(e,t,r,i){return Kr(e).put(i.An(this.uid,this.Qn(r,t.key),t.key))}Hn(e,t,r,i){return Kr(e).delete(i.Rn(this.uid,this.Qn(r,t.key),t.key))}Gn(e,t,r){let i=Kr(e),s=new oe(mn);return i.X({index:av,range:IDBKeyRange.only([r.indexId,this.uid,Ua(this.Qn(r,t))])},(o,c)=>{s=s.add(new or(r.indexId,t,py(c.arrayValue),py(c.directionalValue)))}).next(()=>s)}zn(e,t){let r=new oe(mn),i=this.qn(t,e);if(i==null)return r;let s=Ch(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Ks(o))for(let c of o.arrayValue.values||[])r=r.add(new or(t.indexId,e.key,this.Bn(c),i))}else r=r.add(new or(t.indexId,e.key,Pa,i));return r}jn(e,t,r,i,s){V(gy,"Updating index entries for document '%s'",t.key);let o=[];return function(u,l,f,p,g){let E=u.getIterator(),k=l.getIterator(),N=Wr(E),O=Wr(k);for(;N||O;){let U=!1,$=!1;if(N&&O){let q=f(N,O);q<0?$=!0:q>0&&(U=!0)}else N!=null?$=!0:U=!0;U?(p(O),O=Wr(k)):$?(g(N),N=Wr(E)):(N=Wr(E),O=Wr(k))}}(i,s,mn,c=>{o.push(this.Jn(e,t,r,c))},c=>{o.push(this.Hn(e,t,r,c))}),P.waitFor(o)}Wn(e){let t=1;return Hr(e).X({index:ov,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,c)=>mn(o,c)).filter((o,c,u)=>!c||mn(o,u[c-1])!==0);let i=[];i.push(e);for(let o of r){let c=mn(o,e),u=mn(o,t);if(c===0)i[0]=e.En();else if(c>0&&u<0)i.push(o),i.push(o.En());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Yn(i[o],i[o+1]))return[];let c=i[o].Rn(this.uid,Pa,F.empty()),u=i[o+1].Rn(this.uid,Pa,F.empty());s.push(IDBKeyRange.bound(c,u))}return s}Yn(e,t){return mn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(yy)}getMinOffset(e,t){return P.mapArray(this.Fn(t),r=>this.Mn(e,r).next(i=>i||B(44426))).next(yy)}};function _y(n){return Pe(n,$s)}function Kr(n){return Pe(n,Ds)}function As(n){return Pe(n,Mf)}function Hr(n){return Pe(n,ks)}function yy(n){j(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Vf(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new nt(e.readTime,e.documentKey,t)}var vy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},aI=41943040,We=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};function cI(n,e,t){let r=n.store(ct),i=n.store(ci),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=r.X({range:o},(f,p,g)=>(c++,g.delete()));s.push(u.next(()=>{j(c===1,47070,{batchId:t.batchId})}));let l=[];for(let f of t.mutations){let p=rv(e,f.key.path,t.batchId);s.push(i.delete(p)),l.push(f.key)}return P.waitFor(s).next(()=>l)}function hc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw B(14731);e=n.noDocument}return JSON.stringify(e).length}We.DEFAULT_COLLECTION_PERCENTILE=10,We.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,We.DEFAULT=new We(aI,We.DEFAULT_COLLECTION_PERCENTILE,We.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),We.DISABLED=new We(-1,0,0);var dc=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Zn={}}static yt(e,t,r,i){j(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gn(e).X({index:ar,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Zr(e),o=gn(e);return o.add({}).next(c=>{j(typeof c=="number",49019);let u=new Qs(c,t,r,i),l=function(E,k,N){let O=N.baseMutations.map($=>eo(E.gt,$)),U=N.mutations.map($=>eo(E.gt,$));return{userId:k,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:O,mutations:U}}(this.serializer,this.userId,u),f=[],p=new oe((g,E)=>W(g.canonicalString(),E.canonicalString()));for(let g of i){let E=rv(this.userId,g.key.path,c);p=p.add(g.key.path.popLast()),f.push(o.put(l)),f.push(s.put(E,bS))}return p.forEach(g=>{f.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Zn[c]=u.keys()}),P.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return gn(e).get(t).next(r=>r?(j(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),ir(this.serializer,r)):null)}Xn(e,t){return this.Zn[t]?P.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Zn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return gn(e).X({index:ar,range:i},(o,c,u)=>{c.userId===this.userId&&(j(c.batchId>=r,47524,{er:r}),s=ir(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=wn;return gn(e).X({index:ar,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,wn],[this.userId,Number.POSITIVE_INFINITY]);return gn(e).j(ar,t).next(r=>r.map(i=>ir(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Oa(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Zr(e).X({range:i},(o,c,u)=>{let[l,f,p]=o,g=vt(f);if(l===this.userId&&t.path.isEqual(g))return gn(e).get(p).next(E=>{if(!E)throw B(61480,{tr:o,batchId:p});j(E.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:E.userId,batchId:p}),s.push(ir(this.serializer,E))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new oe(W),i=[];return t.forEach(s=>{let o=Oa(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=Zr(e).X({range:c},(l,f,p)=>{let[g,E,k]=l,N=vt(E);g===this.userId&&s.path.isEqual(N)?r=r.add(k):p.done()});i.push(u)}),P.waitFor(i).next(()=>this.nr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Oa(this.userId,r),o=IDBKeyRange.lowerBound(s),c=new oe(W);return Zr(e).X({range:o},(u,l,f)=>{let[p,g,E]=u,k=vt(g);p===this.userId&&r.isPrefixOf(k)?k.length===i&&(c=c.add(E)):f.done()}).next(()=>this.nr(e,c))}nr(e,t){let r=[],i=[];return t.forEach(s=>{i.push(gn(e).get(s).next(o=>{if(o===null)throw B(35274,{batchId:s});j(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),r.push(ir(this.serializer,o))}))}),P.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return cI(e.ce,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),P.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return P.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Zr(e).X({range:r},(s,o,c)=>{if(s[0]===this.userId){let u=vt(s[1]);i.push(u)}else c.done()}).next(()=>{j(i.length===0,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return uI(e,this.userId,t)}sr(e){return lI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:wn,lastStreamToken:""})}};function uI(n,e,t){let r=Oa(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Zr(n).X({range:s,Z:!0},(c,u,l)=>{let[f,p,g]=c;f===e&&p===i&&(o=!0),l.done()}).next(()=>o)}function gn(n){return Pe(n,ct)}function Zr(n){return Pe(n,ci)}function lI(n){return Pe(n,Bs)}var Ii=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var _d=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{let r=new Ii(t.highestTargetId);return t.highestTargetId=r.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(t=>z.fromTimestamp(new de(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.cr(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.lr(e,i)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(r=>(r.targetCount+=1,this.Pr(t,r),this.lr(e,r))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Qr(e).delete(t.targetId)).next(()=>this.cr(e)).next(r=>(j(r.targetCount>0,8065),r.targetCount-=1,this.lr(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Qr(e).X((o,c)=>{let u=Ps(c);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>P.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Qr(e).X((r,i)=>{let s=Ps(i);t(s)})}cr(e){return Iy(e).get(Ka).next(t=>(j(t!==null,2888),t))}lr(e,t){return Iy(e).put(Ka,t)}hr(e,t){return Qr(e).put(iI(this.serializer,t))}Pr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.cr(e).next(t=>t.targetCount)}getTargetData(e,t){let r=fr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Qr(e).X({range:i,index:sv},(o,c,u)=>{let l=Ps(c);vo(t,l.target)&&(s=l,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=vn(e);return t.forEach(o=>{let c=Me(o.path);i.push(s.put({targetId:r,path:c})),i.push(this.referenceDelegate.addReference(e,r,o))}),P.waitFor(i)}removeMatchingKeys(e,t,r){let i=vn(e);return P.forEach(t,s=>{let o=Me(s.path);return P.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=vn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=vn(e),s=Q();return i.X({range:r,Z:!0},(o,c,u)=>{let l=vt(o[1]),f=new F(l);s=s.add(f)}).next(()=>s)}containsKey(e,t){let r=Me(t.path),i=IDBKeyRange.bound([r],[Qy(r)],!1,!0),s=0;return vn(e).X({index:Lf,Z:!0,range:i},([o,c],u,l)=>{o!==0&&(s++,l.done())}).next(()=>s>0)}Et(e,t){return Qr(e).get(t).next(r=>r?Ps(r):null)}};function Qr(n){return Pe(n,ui)}function Iy(n){return Pe(n,lr)}function vn(n){return Pe(n,li)}var Ey="LruGarbageCollector",hI=1048576;function wy([n,e],[t,r]){let i=W(n,t);return i===0?W(e,r):i}var yd=class{constructor(e){this.Tr=e,this.buffer=new oe(wy),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();wy(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},fc=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){V(Ey,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>_(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ln(t)?V(Ey,"Ignoring IndexedDB error during garbage collection: ",t):yield xn(t)}yield this.Rr(3e5)}))}},vd=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Je.ue);let r=new yd(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(vy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vy):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,o,c,u,l,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,c=Date.now(),this.removeTargets(e,r,t))).next(p=>(s=p,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>(l=Date.now(),Jr()<=J.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${p} documents in `+(l-u)+`ms
Total Duration: ${l-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function dI(n,e){return new vd(n,e)}var Id=class{constructor(e,t){this.db=e,this.garbageCollector=dI(this,t)}mr(e){let t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(r,i)=>t(i))}addReference(e,t,r){return Ca(e,r)}removeReference(e,t,r){return Ca(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ca(e,t)}Sr(e,t){return function(i,s){let o=!1;return lI(i).ee(c=>uI(i,c,s).next(u=>(u&&(o=!0),P.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.wr(e,(o,c)=>{if(c<=t){let u=this.Sr(e,o).next(l=>{if(!l)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,z.min()),vn(e).delete(function(p){return[0,Me(p.path)]}(o))))});i.push(u)}}).next(()=>P.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ca(e,t)}wr(e,t){let r=vn(e),i,s=Je.ue;return r.X({index:Lf},([o,c],{path:u,sequenceNumber:l})=>{o===0?(s!==Je.ue&&t(new F(vt(i)),s),s=l,i=u):s=Je.ue}).next(()=>{s!==Je.ue&&t(new F(vt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Ca(n,e){return vn(n).put(function(r,i){return{targetId:0,path:Me(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var pc=class{constructor(){this.changes=new lt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ed=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return er(e).put(r)}removeEntry(e,t,r){return er(e).delete(function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],ac(o),c[c.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=Re.newInvalidDocument(t);return er(e).X({index:Va,range:IDBKeyRange.only(bs(t))},(i,s)=>{r=this.Dr(t,s)}).next(()=>r)}vr(e,t){let r={size:0,document:Re.newInvalidDocument(t)};return er(e).X({index:Va,range:IDBKeyRange.only(bs(t))},(i,s)=>{r={document:this.Dr(t,s),size:hc(s)}}).next(()=>r)}getEntries(e,t){let r=Ge();return this.Cr(e,t,(i,s)=>{let o=this.Dr(i,s);r=r.insert(i,o)}).next(()=>r)}Fr(e,t){let r=Ge(),i=new le(F.comparator);return this.Cr(e,t,(s,o)=>{let c=this.Dr(s,o);r=r.insert(s,c),i=i.insert(s,hc(o))}).next(()=>({documents:r,Mr:i}))}Cr(e,t,r){if(t.isEmpty())return P.resolve();let i=new oe(by);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(bs(i.first()),bs(i.last())),o=i.getIterator(),c=o.getNext();return er(e).X({index:Va,range:s},(u,l,f)=>{let p=F.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;c&&by(c,p)<0;)r(c,null),c=o.getNext();c&&c.isEqual(p)&&(r(c,l),c=o.hasNext()?o.getNext():null),c?f.G(bs(c)):f.done()}).next(()=>{for(;c;)r(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),ac(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return er(e).j(IDBKeyRange.bound(c,u,!0)).next(l=>{s?.incrementDocumentReadCount(l.length);let f=Ge();for(let p of l){let g=this.Dr(F.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);g.isFoundDocument()&&(Eo(t,g)||i.has(g.key))&&(f=f.insert(g.key,g))}return f})}getAllFromCollectionGroup(e,t,r,i){let s=Ge(),o=Ay(t,r),c=Ay(t,nt.max());return er(e).X({index:iv,range:IDBKeyRange.bound(o,c,!0)},(u,l,f)=>{let p=this.Dr(F.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new wd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Ty(e).get(Vh).next(t=>(j(!!t,20021),t))}br(e,t){return Ty(e).put(Vh,t)}Dr(e,t){if(t){let r=wR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(z.min())))return r}return Re.newInvalidDocument(e)}};function fI(n){return new Ed(n)}var wd=class extends pc{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new lt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new oe((s,o)=>W(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.Nr.get(s);if(t.push(this.Or.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=ay(this.Or.serializer,o);i=i.add(s.path.popLast());let l=hc(u);r+=l-c.size,t.push(this.Or.addEntry(e,s,u))}else if(r-=c.size,this.trackRemovals){let u=ay(this.Or.serializer,o.convertToNoDocument(z.min()));t.push(this.Or.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Or.updateMetadata(e,r)),P.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(r=>(this.Nr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:r,Mr:i})=>(i.forEach((s,o)=>{this.Nr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Ty(n){return Pe(n,qs)}function er(n){return Pe(n,Ga)}function bs(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ay(n,e){let t=e.documentKey.path.toArray();return[n,ac(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function by(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=W(t[s],r[s]),i)return i;return i=W(t.length,r.length),i||(i=W(t[t.length-2],r[r.length-2]),i||W(t[t.length-1],r[r.length-1]))}var Td=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var mc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Vs(r.mutation,i,Ye.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Q()){let i=It();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Rs();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=It();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Q()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,r,i){let s=Ge(),o=Os(),c=function(){return Os()}();return t.forEach((u,l)=>{let f=r.get(l.key);i.has(l.key)&&(f===void 0||f.mutation instanceof ht)?s=s.insert(l.key,l):f!==void 0?(o.set(l.key,f.mutation.getFieldMask()),Vs(f.mutation,l,f.mutation.getFieldMask(),de.now())):o.set(l.key,Ye.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((l,f)=>o.set(l,f)),t.forEach((l,f)=>{var p;return c.set(l,new Td(f,(p=o.get(l))!==null&&p!==void 0?p:null))}),c))}recalculateAndSaveOverlays(e,t){let r=Os(),i=new le((o,c)=>o-c),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let l=t.get(u);if(l===null)return;let f=r.get(u)||Ye.empty();f=c.applyToLocalView(l,f),r.set(u,f);let p=(i.get(c.batchId)||Q()).add(u);i=i.insert(c.batchId,p)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),l=u.key,f=u.value,p=Lv();f.forEach(g=>{if(!s.has(g)){let E=jv(t.get(g),r.get(g));E!==null&&p.set(g,E),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,p))}return P.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return F.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):jf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):P.resolve(It()),c=oi,u=s;return o.next(l=>P.forEach(l,(f,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),s.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,u,l,Q())).next(f=>({batchId:c,changes:xv(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next(r=>{let i=Rs();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Rs();return this.indexManager.getCollectionParents(e,s).next(c=>P.forEach(c,u=>{let l=function(p,g){return new ut(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(f=>{f.forEach((p,g)=>{o=o.insert(p,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,l)=>{let f=l.getKey();o.get(f)===null&&(o=o.insert(f,Re.newInvalidDocument(f)))});let c=Rs();return o.forEach((u,l)=>{let f=s.get(u);f!==void 0&&Vs(f.mutation,l,Ye.empty(),de.now()),Eo(t,l)&&(c=c.insert(u,l))}),c})}};var Ad=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return P.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ve(i.createTime)}}(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(i){return{name:i.name,query:Xc(i.bundledQuery),readTime:ve(i.readTime)}}(t)),P.resolve()}};var bd=class{constructor(){this.overlays=new le(F.comparator),this.kr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=It();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=It(),s=t.length+1,o=new F(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,l=u.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new le((l,f)=>l-f),o=this.overlays.getIterator();for(;o.hasNext();){let l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let f=s.get(l.largestBatchId);f===null&&(f=It(),s=s.insert(l.largestBatchId,f)),f.set(l.getKey(),l)}}let c=It(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((l,f)=>c.set(l,f)),!(c.size()>=i)););return P.resolve(c)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Js(t,r));let s=this.kr.get(t);s===void 0&&(s=Q(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};var Sd=class{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var no=class{constructor(){this.qr=new oe(we.Qr),this.$r=new oe(we.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new we(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new we(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new F(new X([])),r=new we(t,e),i=new we(t,e+1),s=[];return this.$r.forEachInRange([r,i],o=>{this.Wr(o),s.push(o.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new F(new X([])),r=new we(t,e),i=new we(t,e+1),s=Q();return this.$r.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new we(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},we=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return F.comparator(e.key,t.key)||W(e.Hr,t.Hr)}static Ur(e,t){return W(e.Hr,t.Hr)||F.comparator(e.key,t.key)}};var Rd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new oe(we.Qr)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Qs(s,t,r,i);this.mutationQueue.push(o);for(let c of i)this.Yr=this.Yr.add(new we(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?wn:this.er-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],o=>{let c=this.Zr(o.Hr);s.push(c)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new oe(W);return t.forEach(i=>{let s=new we(i,0),o=new we(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,o],c=>{r=r.add(c.Hr)})}),P.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;F.isDocumentKey(s)||(s=s.child(""));let o=new we(new F(s),0),c=new oe(W);return this.Yr.forEachWhile(u=>{let l=u.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(c=c.add(u.Hr)),!0)},o),P.resolve(this.ei(c))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){j(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return P.forEach(t.mutations,i=>{let s=new we(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new we(t,0),i=this.Yr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Pd=class{constructor(e){this.ni=e,this.docs=function(){return new le(F.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Re.newInvalidDocument(t))}getEntries(e,t){let r=Ge();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Re.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ge(),o=t.path,c=new F(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:l,value:{document:f}}=u.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||Vf(Zy(f),r)<=0||(i.has(f.key)||Eo(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return P.resolve(s)}getAllFromCollectionGroup(e,t,r,i){B(9500)}ri(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Cd(this)}getSize(e){return P.resolve(this.size)}},Cd=class extends pc{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var kd=class{constructor(e){this.persistence=e,this.ii=new lt(t=>fr(t),vo),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.si=0,this.oi=new no,this.targetCount=0,this._i=Ii.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),P.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Ii(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.hr(t),P.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((o,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ii.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.oi.containsKey(t))}};var ro=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new Je(0),this.ci=!1,this.ci=!0,this.li=new Sd,this.referenceDelegate=e(this),this.hi=new kd(this),this.indexManager=new md,this.remoteDocumentCache=function(i){return new Pd(i)}(r=>this.referenceDelegate.Pi(r)),this.serializer=new oc(t),this.Ti=new Ad(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new bd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new Rd(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new Dd(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return P.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},Dd=class extends ja{constructor(e){super(),this.currentSequenceNumber=e}},gc=class n{constructor(e){this.persistence=e,this.Ai=new no,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw B(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.mi,r=>{let i=F.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return P.or([()=>P.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},_c=class n{constructor(e,t){this.persistence=e,this.gi=new lt(r=>Me(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=dI(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return P.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?P.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,o=>this.Sr(e,o,t).next(c=>{c||(r++,s.removeEntry(o,z.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),P.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=La(e.data.value)),t}Sr(e,t,r){return P.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Nd=class{constructor(e){this.serializer=e}q(e,t,r,i){let s=new za("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore(yo)}(e),function(u){u.createObjectStore(Bs,{keyPath:AS}),u.createObjectStore(ct,{keyPath:U_,autoIncrement:!0}).createIndex(ar,B_,{unique:!0}),u.createObjectStore(ci)}(e),Sy(e),function(u){u.createObjectStore(nr)}(e));let o=P.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore(li),u.deleteObjectStore(ui),u.deleteObjectStore(lr)}(e),Sy(e)),o=o.next(()=>function(u){let l=u.store(lr),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return l.put(Ka,f)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,l){return l.store(ct).j().next(p=>{u.deleteObjectStore(ct),u.createObjectStore(ct,{keyPath:U_,autoIncrement:!0}).createIndex(ar,B_,{unique:!0});let g=l.store(ct),E=p.map(k=>g.put(k));return P.waitFor(E)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore(hi,{keyPath:OS})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.pi(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore(qs)}(e),this.yi(s)))),r<7&&i>=7&&(o=o.next(()=>this.wi(s))),r<8&&i>=8&&(o=o.next(()=>this.Si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.bi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore(zc,{keyPath:VS})})(e),function(u){u.createObjectStore(Wc,{keyPath:xS})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let l=u.createObjectStore(Gc,{keyPath:$S});l.createIndex(Lh,jS,{unique:!1}),l.createIndex(cv,zS,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let l=u.createObjectStore(Ga,{keyPath:SS});l.createIndex(Va,RS),l.createIndex(iv,PS)}(e)).next(()=>this.Di(e,s)).next(()=>e.deleteObjectStore(nr))),r<14&&i>=14&&(o=o.next(()=>this.Ci(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore(Mf,{keyPath:LS,autoIncrement:!0}).createIndex(xh,MS,{unique:!1}),u.createObjectStore(ks,{keyPath:FS}).createIndex(ov,US,{unique:!1}),u.createObjectStore(Ds,{keyPath:BS}).createIndex(av,qS,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(ks).clear()}).next(()=>{t.objectStore(Ds).clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore(Ff,{keyPath:WS})})(e)})),r<18&&i>=18&&Xu()&&(o=o.next(()=>{t.objectStore(ks).clear()}).next(()=>{t.objectStore(Ds).clear()})),o}yi(e){let t=0;return e.store(nr).X((r,i)=>{t+=hc(i)}).next(()=>{let r={byteSize:t};return e.store(qs).put(Vh,r)})}pi(e){let t=e.store(Bs),r=e.store(ct);return t.j().next(i=>P.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,wn],[s.userId,s.lastAcknowledgedBatchId]);return r.j(ar,o).next(c=>P.forEach(c,u=>{j(u.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});let l=ir(this.serializer,u);return cI(e,s.userId,l).next(()=>{})}))}))}wi(e){let t=e.store(li),r=e.store(nr);return e.store(lr).get(Ka).next(i=>{let s=[];return r.X((o,c)=>{let u=new X(o),l=function(p){return[0,Me(p)]}(u);s.push(t.get(l).next(f=>f?P.resolve():(p=>t.put({targetId:0,path:Me(p),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>P.waitFor(s))})}Si(e,t){e.createObjectStore($s,{keyPath:NS});let r=t.store($s),i=new to,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return r.put({collectionId:c,parent:Me(u)})}};return t.store(nr).X({Z:!0},(o,c)=>{let u=new X(o);return s(u.popLast())}).next(()=>t.store(ci).X({Z:!0},([o,c,u],l)=>{let f=vt(c);return s(f.popLast())}))}bi(e){let t=e.store(ui);return t.X((r,i)=>{let s=Ps(i),o=iI(this.serializer,s);return t.put(o)})}Di(e,t){let r=t.store(nr),i=[];return r.X((s,o)=>{let c=t.store(Ga),u=function(p){return p.document?new F(X.fromString(p.document.name).popFirst(5)):p.noDocument?F.fromSegments(p.noDocument.path):p.unknownDocument?F.fromSegments(p.unknownDocument.path):B(36783)}(o).path.toArray(),l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(l))}).next(()=>P.waitFor(i))}Ci(e,t){let r=t.store(ct),i=fI(this.serializer),s=new ro(gc.Vi,this.serializer.gt);return r.j().next(o=>{let c=new Map;return o.forEach(u=>{var l;let f=(l=c.get(u.userId))!==null&&l!==void 0?l:Q();ir(this.serializer,u).keys().forEach(p=>f=f.add(p)),c.set(u.userId,f)}),P.forEach(c,(u,l)=>{let f=new Te(l),p=cc.yt(this.serializer,f),g=s.getIndexManager(f),E=dc.yt(f,this.serializer,g,s.referenceDelegate);return new mc(i,E,p,g).recalculateAndSaveOverlaysForDocumentKeys(new js(t,Je.ue),u).next()})})}};function Sy(n){n.createObjectStore(li,{keyPath:kS}).createIndex(Lf,DS,{unique:!0}),n.createObjectStore(ui,{keyPath:"targetId"}).createIndex(sv,CS,{unique:!0}),n.createObjectStore(lr)}var _n="IndexedDbPersistence",mh=18e5,gh=5e3,_h="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",pI="main",Od=class n{constructor(e,t,r,i,s,o,c,u,l,f,p=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Fi=s,this.window=o,this.document=c,this.Mi=l,this.xi=f,this.Oi=p,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=g=>Promise.resolve(),!n.C())throw new D(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Id(this,i),this.Qi=t+pI,this.serializer=new oc(u),this.$i=new Sn(this.Qi,this.Oi,new Nd(this.serializer)),this.li=new cd,this.hi=new _d(this.referenceDelegate,this.serializer),this.remoteDocumentCache=fI(this.serializer),this.Ti=new ad,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&ye(_n,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(S.FAILED_PRECONDITION,_h);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new Je(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=t=>_(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(()=>_(this,null,function*(){this.started&&(yield this.Ki())})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ka(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(t=>{t||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(Ln(e))return V(_n,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V(_n,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return Ss(e).get(zr).next(t=>P.resolve(this.Xi(t)))}es(e){return ka(e).delete(this.clientId)}ts(){return _(this,null,function*(){if(this.isPrimary&&!this.ns(this.ki,mh)){this.ki=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Pe(t,hi);return r.j().next(i=>{let s=this.rs(i,mh),o=i.filter(c=>s.indexOf(c)===-1);return P.forEach(o,c=>r.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.ss(t.clientId))}})}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?P.resolve(!0):Ss(e).get(zr).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,gh)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new D(S.FAILED_PRECONDITION,_h);return!1}}return!(!this.networkEnabled||!this.inForeground)||ka(e).j().next(r=>this.rs(r,gh).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V(_n,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return _(this,null,function*(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),yield this.$i.runTransaction("shutdown","readwrite",[yo,hi],e=>{let t=new js(e,Je.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()})}rs(e,t){return e.filter(r=>this.ns(r.updateTimeMs,t)&&!this._s(r.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>ka(e).j().next(t=>this.rs(t,mh).map(r=>r.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return dc.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new gd(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return cc.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,r){V(_n,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===18?HS:u===17?dv:u===16?KS:u===15?Uf:u===14?hv:u===13?lv:u===12?GS:u===11?uv:void B(60245)}(this.Oi),o;return this.$i.runTransaction(e,i,s,c=>(o=new js(c,this.ui?this.ui.next():Je.ue),t==="readwrite-primary"?this.Ji(o).next(u=>!!u||this.Hi(o)).next(u=>{if(!u)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new D(S.FAILED_PRECONDITION,ev);return r(o)}).next(u=>this.Zi(o).next(()=>u)):this.Ts(o).next(()=>r(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}Ts(e){return Ss(e).get(zr).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,gh)&&!this._s(t.ownerId)&&!this.Xi(t)&&!(this.xi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(S.FAILED_PRECONDITION,_h)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ss(e).put(zr,t)}static C(){return Sn.C()}Yi(e){let t=Ss(e);return t.get(zr).next(r=>this.Xi(r)?(V(_n,"Releasing primary lease."),t.delete(zr)):P.resolve())}ns(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ye(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ni=()=>{this.us();let t=/(?:Version|Mobile)\/1[456]/;Yu()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{let r=((t=this.Ui)===null||t===void 0?void 0:t.getItem(this.ss(e)))!==null;return V(_n,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ye(_n,"Failed to get zombied client id.",r),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ss(n){return Pe(n,yo)}function ka(n){return Pe(n,hi)}function Hf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Vd=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=Q(),i=Q();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var xd=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var yc=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return Yu()?8:tv(_e())>0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new xd;return this.ws(e,t,o).next(c=>{if(s.result=c,this.Rs)return this.Ss(e,t,o,c.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Jr()<=J.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Yr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),P.resolve()):(Jr()<=J.DEBUG&&V("QueryEngine","Query:",Yr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Jr()<=J.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Yr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Fe(t))):P.resolve())}ps(e,t){if(X_(t))return P.resolve(null);let r=Fe(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ec(t,null,"F"),r=Fe(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Q(...s);return this.gs.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{let l=this.bs(t,c);return this.Ds(t,l,o,u.readTime)?this.ps(e,ec(t,null,"F")):this.vs(e,l,t,u)}))})))}ys(e,t,r,i){return X_(t)||i.isEqual(z.min())?P.resolve(null):this.gs.getDocuments(e,r).next(s=>{let o=this.bs(t,s);return this.Ds(t,o,r,i)?P.resolve(null):(Jr()<=J.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Yr(t)),this.vs(e,o,t,Xy(i,oi)).next(c=>c))})}bs(e,t){let r=new oe(Ov(e));return t.forEach((i,s)=>{Eo(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return Jr()<=J.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Yr(t)),this.gs.getDocumentsMatchingQuery(e,t,nt.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Qf="LocalStore",bR=3e8,Ld=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new le(W),this.Ms=new lt(s=>fr(s),vo),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mc(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function mI(n,e,t,r){return new Ld(n,e,t,r)}function gI(n,e){return _(this,null,function*(){let t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],c=[],u=Q();for(let l of i){o.push(l.batchId);for(let f of l.mutations)u=u.add(f.key)}for(let l of s){c.push(l.batchId);for(let f of l.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next(l=>({Bs:l,removedBatchIds:o,addedBatchIds:c}))})})})}function SR(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(c,u,l,f){let p=l.batch,g=p.keys(),E=P.resolve();return g.forEach(k=>{E=E.next(()=>f.getEntry(u,k)).next(N=>{let O=l.docVersions.get(k);j(O!==null,48541),N.version.compareTo(O)<0&&(p.applyToRemoteDocument(N,l),N.isValidDocument()&&(N.setReadTime(l.commitVersion),f.addEntry(N)))})}),E.next(()=>c.mutationQueue.removeMutationBatch(u,p))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let u=Q();for(let l=0;l<c.mutationResults.length;++l)c.mutationResults[l].transformResults.length>0&&(u=u.add(c.batch.mutations[l].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function _I(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function RR(n,e){let t=L(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let c=[];e.targetChanges.forEach((f,p)=>{let g=i.get(p);if(!g)return;c.push(t.hi.removeMatchingKeys(s,f.removedDocuments,p).next(()=>t.hi.addMatchingKeys(s,f.addedDocuments,p)));let E=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?E=E.withResumeToken(Ie.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(f.resumeToken,r)),i=i.insert(p,E),function(N,O,U){return N.resumeToken.approximateByteSize()===0||O.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=bR?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(g,E,f)&&c.push(t.hi.updateTargetData(s,E))});let u=Ge(),l=Q();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(yI(s,o,e.documentUpdates).next(f=>{u=f.Ls,l=f.ks})),!r.isEqual(z.min())){let f=t.hi.getLastRemoteSnapshotVersion(s).next(p=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(f)}return P.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,l)).next(()=>u)}).then(s=>(t.Fs=i,s))}function yI(n,e,t){let r=Q(),i=Q();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ge();return t.forEach((c,u)=>{let l=s.get(c);u.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(z.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!l.isValidDocument()||u.version.compareTo(l.version)>0||u.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):V(Qf,"Ignoring outdated watch update for ",c,". Current version:",l.version," Watch version:",u.version)}),{Ls:o,ks:i}})}function PR(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=wn),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ei(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,P.resolve(i)):t.hi.allocateTargetId(r).next(o=>(i=new vi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}function wi(n,e,t){return _(this,null,function*(){let r=L(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ln(o))throw o;V(Qf,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})}function vc(n,e,t){let r=L(n),i=z.min(),s=Q();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,l,f){let p=L(u),g=p.Ms.get(f);return g!==void 0?P.resolve(p.Fs.get(g)):p.hi.getTargetData(l,f)}(r,o,Fe(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>r.Cs.getDocumentsMatchingQuery(o,e,t?i:z.min(),t?s:Q())).next(c=>(EI(r,Nv(e),c),{documents:c,qs:s})))}function vI(n,e){let t=L(n),r=L(t.hi),i=t.Fs.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.Et(s,e).next(o=>o?o.target:null))}function II(n,e){let t=L(n),r=t.xs.get(e)||z.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Os.getAllFromCollectionGroup(i,e,Xy(r,oi),Number.MAX_SAFE_INTEGER)).then(i=>(EI(t,e,i),i))}function EI(n,e,t){let r=n.xs.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}function CR(n,e,t,r){return _(this,null,function*(){let i=L(n),s=Q(),o=Ge();for(let l of t){let f=e.Qs(l.metadata.name);l.document&&(s=s.add(f));let p=e.$s(l);p.setReadTime(e.Us(l.metadata.readTime)),o=o.insert(f,p)}let c=i.Os.newChangeBuffer({trackRemovals:!0}),u=yield Ei(i,function(f){return Fe(ki(X.fromString(`__bundle__/docs/${f}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",l=>yI(l,c,o).next(f=>(c.apply(l),f)).next(f=>i.hi.removeMatchingKeysForTargetId(l,u.targetId).next(()=>i.hi.addMatchingKeys(l,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(l,f.Ls,f.ks)).next(()=>f.Ls)))})}function kR(r,i){return _(this,arguments,function*(n,e,t=Q()){let s=yield Ei(n,Fe(Xc(e.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",c=>{let u=ve(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Ti.saveNamedQuery(c,e);let l=s.withResumeToken(Ie.EMPTY_BYTE_STRING,u);return o.Fs=o.Fs.insert(l.targetId,l),o.hi.updateTargetData(c,l).next(()=>o.hi.removeMatchingKeysForTargetId(c,s.targetId)).next(()=>o.hi.addMatchingKeys(c,t,s.targetId)).next(()=>o.Ti.saveNamedQuery(c,e))})})}var wI="firestore_clients";function Ry(n,e){return`${wI}_${n}_${e}`}var TI="firestore_mutations";function Py(n,e,t){let r=`${TI}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var AI="firestore_targets";function yh(n,e){return`${AI}_${n}_${e}`}var yt="SharedClientState",Ic=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ks(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new D(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(ye(yt,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},xs=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ks(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new D(r.error.code,r.error.message))),s?new n(e,r.state,i):(ye(yt,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ec=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=zf();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=nv(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(ye(yt,`Failed to parse client data for instance '${e}': ${t}`),null)}},Md=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(ye(yt,`Failed to parse online state: ${e}`),null)}},io=class{constructor(){this.activeTargetIds=zf()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ls=class{constructor(e,t,r,i,s){this.window=e,this.Fi=t,this.persistenceKey=r,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new le(W),this.started=!1,this.Zs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=Ry(this.persistenceKey,this.js),this.eo=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new io),this.no=new RegExp(`^${wI}_${o}_([^_]*)$`),this.ro=new RegExp(`^${TI}_${o}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${AI}_${o}_(\\d+)$`),this.so=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.oo=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}start(){return _(this,null,function*(){let e=yield this.syncEngine.Ps();for(let r of e){if(r===this.js)continue;let i=this.getItem(Ry(this.persistenceKey,r));if(i){let s=Ec.Ks(r,i);s&&(this.Ys=this.Ys.insert(s.clientId,s))}}this._o();let t=this.storage.getItem(this.so);if(t){let r=this.ao(t);r&&this.uo(r)}for(let r of this.Zs)this.Hs(r);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,r){this.lo(e,t,r),this.ho(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(yh(this.persistenceKey,e));if(i){let s=xs.Ks(e,i);s&&(r=s.state)}}return t&&this.Po.Gs(e),this._o(),r}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(yh(this.persistenceKey,e))}updateQueryState(e,t,r){this.To(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.ho(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V(yt,"READ",e,t),t}setItem(e,t){V(yt,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){V(yt,"REMOVE",e),this.storage.removeItem(e)}Hs(e){let t=e;if(t.storageArea===this.storage){if(V(yt,"EVENT",t.key,t.newValue),t.key===this.Xs)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(()=>_(this,null,function*(){if(this.started){if(t.key!==null){if(this.no.test(t.key)){if(t.newValue==null){let r=this.Ao(t.key);return this.Ro(r,null)}{let r=this.Vo(t.key,t.newValue);if(r)return this.Ro(r.clientId,r)}}else if(this.ro.test(t.key)){if(t.newValue!==null){let r=this.mo(t.key,t.newValue);if(r)return this.fo(r)}}else if(this.io.test(t.key)){if(t.newValue!==null){let r=this.po(t.key,t.newValue);if(r)return this.yo(r)}}else if(t.key===this.so){if(t.newValue!==null){let r=this.ao(t.newValue);if(r)return this.uo(r)}}else if(t.key===this.eo){let r=function(s){let o=Je.ue;if(s!=null)try{let c=JSON.parse(s);j(typeof c=="number",30636,{wo:s}),o=c}catch(c){ye(yt,"Failed to read sequence number from WebStorage",c)}return o}(t.newValue);r!==Je.ue&&this.sequenceNumberHandler(r)}else if(t.key===this.oo){let r=this.So(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.bo(i)))}}}else this.Zs.push(t)}))}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,r){let i=new Ic(this.currentUser,e,t,r),s=Py(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Ws())}ho(e){let t=Py(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){let t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,r){let i=yh(this.persistenceKey,e),s=new xs(e,t,r);this.setItem(i,s.Ws())}Eo(e){let t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){let t=this.no.exec(e);return t?t[1]:null}Vo(e,t){let r=this.Ao(e);return Ec.Ks(r,t)}mo(e,t){let r=this.ro.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Ic.Ks(new Te(s),i,t)}po(e,t){let r=this.io.exec(e),i=Number(r[1]);return xs.Ks(i,t)}ao(e){return Md.Ks(e)}So(e){return JSON.parse(e)}fo(e){return _(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);V(yt,`Ignoring mutation for non-active user ${e.user.uid}`)})}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Ys.insert(e,t):this.Ys.remove(e),i=this.co(this.Ys),s=this.co(r),o=[],c=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||c.push(u)}),this.syncEngine.Co(o,c).then(()=>{this.Ys=r})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=zf();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},wc=class{constructor(){this.Fo=new io,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new io,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Fd=class{xo(e){}shutdown(){}};var Cy="ConnectivityMonitor",Tc=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){V(Cy,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){V(Cy,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Da=null;function Ud(){return Da===null?Da=function(){return 268435456+Math.round(2147483648*Math.random())}():Da++,"0x"+Da.toString(16)}var vh="RestConnection",DR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Bd=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===Ws?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let o=Ud(),c=this.Go(e,t.toUriEncodedString());V(vh,`Sending RPC '${e}' ${o}:`,c,r);let u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(u,i,s);let{host:l}=new URL(c),f=Nt(l);return this.jo(e,c,u,r,f).then(p=>(V(vh,`Received RPC '${e}' ${o}: `,p),p),p=>{throw je(vh,`RPC '${e}' ${o} failed with error: `,p,"url: ",c,"request:",r),p})}Jo(e,t,r,i,s,o){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ci}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=DR[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var qd=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var xe="WebChannelConnection",$d=class extends Bd{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let o=Ud();return new Promise((c,u)=>{let l=new uh;l.setWithCredentials(!0),l.listenOnce(lh.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case ws.NO_ERROR:let p=l.getResponseJson();V(xe,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),c(p);break;case ws.TIMEOUT:V(xe,`RPC '${e}' ${o} timed out`),u(new D(S.DEADLINE_EXCEEDED,"Request time out"));break;case ws.HTTP_ERROR:let g=l.getStatus();if(V(xe,`RPC '${e}' ${o} failed with status:`,g,"response text:",l.getResponseText()),g>0){let E=l.getResponseJson();Array.isArray(E)&&(E=E[0]);let k=E?.error;if(k&&k.status&&k.message){let N=function(U){let $=U.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf($)>=0?$:S.UNKNOWN}(k.status);u(new D(N,k.message))}else u(new D(S.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new D(S.UNAVAILABLE,"Connection failed."));break;default:B(9055,{c_:e,streamId:o,l_:l.getLastErrorCode(),h_:l.getLastError()})}}finally{V(xe,`RPC '${e}' ${o} completed.`)}});let f=JSON.stringify(i);V(xe,`RPC '${e}' ${o} sending request:`,i),l.send(t,"POST",f,r,15)})}P_(e,t,r){let i=Ud(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=fh(),c=dh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.useFetchStreams=!0),this.zo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let f=s.join("");V(xe,`Creating RPC '${e}' stream ${i}: ${f}`,u);let p=o.createWebChannel(f,u);this.T_(p);let g=!1,E=!1,k=new qd({Ho:O=>{E?V(xe,`Not sending because RPC '${e}' stream ${i} is closed:`,O):(g||(V(xe,`Opening RPC '${e}' stream ${i} transport.`),p.open(),g=!0),V(xe,`RPC '${e}' stream ${i} sending:`,O),p.send(O))},Yo:()=>p.close()}),N=(O,U,$)=>{O.listen(U,q=>{try{$(q)}catch(H){setTimeout(()=>{throw H},0)}})};return N(p,jr.EventType.OPEN,()=>{E||(V(xe,`RPC '${e}' stream ${i} transport opened.`),k.s_())}),N(p,jr.EventType.CLOSE,()=>{E||(E=!0,V(xe,`RPC '${e}' stream ${i} transport closed`),k.__(),this.I_(p))}),N(p,jr.EventType.ERROR,O=>{E||(E=!0,je(xe,`RPC '${e}' stream ${i} transport errored. Name:`,O.name,"Message:",O.message),k.__(new D(S.UNAVAILABLE,"The operation could not be completed")))}),N(p,jr.EventType.MESSAGE,O=>{var U;if(!E){let $=O.data[0];j(!!$,16349);let q=$,H=q?.error||((U=q[0])===null||U===void 0?void 0:U.error);if(H){V(xe,`RPC '${e}' stream ${i} received error:`,H);let te=H.status,K=function(I){let T=Ee[I];if(T!==void 0)return Gv(T)}(te),w=H.message;K===void 0&&(K=S.INTERNAL,w="Unknown error status: "+te+" with message "+H.message),E=!0,k.__(new D(K,w)),p.close()}else V(xe,`RPC '${e}' stream ${i} received:`,$),k.a_($)}}),N(c,hh.STAT_EVENT,O=>{O.stat===Sa.PROXY?V(xe,`RPC '${e}' stream ${i} detected buffering proxy`):O.stat===Sa.NOPROXY&&V(xe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.o_()},0),k}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function bI(){return typeof window<"u"?window:null}function Ba(){return typeof document<"u"?document:null}function Ar(n){return new nd(n,!0)}var so=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var ky="PersistentStream",Ac=class{constructor(e,t,r,i,s,o,c,u){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new so(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return _(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return _(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return _(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new D(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>_(this,null,function*(){this.state=0,this.start()}))}G_(e){return V(ky,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(V(ky,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},jd=class extends Ac{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=mR(this.serializer,e),r=function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?ve(o.readTime):z.min()}(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=sd(this.serializer),t.addTarget=function(s,o){let c,u=o.target;if(c=Xa(u)?{documents:Xv(s,u)}:{query:Yc(s,u).Vt},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Kv(s,o.resumeToken);let l=rd(s,o.expectedCount);l!==null&&(c.expectedCount=l)}else if(o.snapshotVersion.compareTo(z.min())>0){c.readTime=yi(s,o.snapshotVersion.toTimestamp());let l=rd(s,o.expectedCount);l!==null&&(c.expectedCount=l)}return c}(this.serializer,e);let r=_R(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=sd(this.serializer),t.removeTarget=e,this.k_(t)}},zd=class extends Ac{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return j(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,j(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){j(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=gR(e.writeResults,e.commitTime),r=ve(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=sd(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>eo(this.serializer,r))};this.k_(t)}};var Wd=class{},Gd=class extends Wd{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,id(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(S.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Jo(e,id(t,r),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(S.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Kd=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ye(t),this._a=!1):V("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var _r="RemoteStore",Hd=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(o=>{r.enqueueAndForget(()=>_(this,null,function*(){Fn(this)&&(V(_r,"Restarting streams for network reachability change."),yield function(u){return _(this,null,function*(){let l=L(u);l.Ia.add(4),yield Di(l),l.Aa.set("Unknown"),l.Ia.delete(4),yield wo(l)})}(this))}))}),this.Aa=new Kd(r,i)}};function wo(n){return _(this,null,function*(){if(Fn(n))for(let e of n.da)yield e(!0)})}function Di(n){return _(this,null,function*(){for(let e of n.da)yield e(!1)})}function Zc(n,e){let t=L(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),Xf(t)?Yf(t):Oi(t).x_()&&Jf(t,e))}function Ti(n,e){let t=L(n),r=Oi(t);t.Ta.delete(e),r.x_()&&SI(t,e),t.Ta.size===0&&(r.x_()?r.B_():Fn(t)&&t.Aa.set("Unknown"))}function Jf(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Oi(n).H_(e)}function SI(n,e){n.Ra.$e(e),Oi(n).Y_(e)}function Yf(n){n.Ra=new td({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),Oi(n).start(),n.Aa.aa()}function Xf(n){return Fn(n)&&!Oi(n).M_()&&n.Ta.size>0}function Fn(n){return L(n).Ia.size===0}function RI(n){n.Ra=void 0}function NR(n){return _(this,null,function*(){n.Aa.set("Online")})}function OR(n){return _(this,null,function*(){n.Ta.forEach((e,t)=>{Jf(n,e)})})}function VR(n,e){return _(this,null,function*(){RI(n),Xf(n)?(n.Aa.la(e),Yf(n)):n.Aa.set("Unknown")})}function xR(n,e,t){return _(this,null,function*(){if(n.Aa.set("Online"),e instanceof ic&&e.state===2&&e.cause)try{yield function(i,s){return _(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i.Ta.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i.Ta.delete(c),i.Ra.removeTarget(c))})}(n,e)}catch(r){V(_r,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield bc(n,r)}else if(e instanceof ni?n.Ra.Ye(e):e instanceof rc?n.Ra.it(e):n.Ra.et(e),!t.isEqual(z.min()))try{let r=yield _I(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let c=s.Ra.Pt(o);return c.targetChanges.forEach((u,l)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.Ta.get(l);f&&s.Ta.set(l,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,l)=>{let f=s.Ta.get(u);if(!f)return;s.Ta.set(u,f.withResumeToken(Ie.EMPTY_BYTE_STRING,f.snapshotVersion)),SI(s,u);let p=new vi(f.target,u,l,f.sequenceNumber);Jf(s,p)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){V(_r,"Failed to raise snapshot:",r),yield bc(n,r)}})}function bc(n,e,t){return _(this,null,function*(){if(!Ln(e))throw e;n.Ia.add(1),yield Di(n),n.Aa.set("Offline"),t||(t=()=>_I(n.localStore)),n.asyncQueue.enqueueRetryable(()=>_(null,null,function*(){V(_r,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield wo(n)}))})}function PI(n,e){return e().catch(t=>bc(n,t,e))}function Ni(n){return _(this,null,function*(){let e=L(n),t=On(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:wn;for(;LR(e);)try{let i=yield PR(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,MR(e,i)}catch(i){yield bc(e,i)}CI(e)&&kI(e)})}function LR(n){return Fn(n)&&n.Pa.length<10}function MR(n,e){n.Pa.push(e);let t=On(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function CI(n){return Fn(n)&&!On(n).M_()&&n.Pa.length>0}function kI(n){On(n).start()}function FR(n){return _(this,null,function*(){On(n).na()})}function UR(n){return _(this,null,function*(){let e=On(n);for(let t of n.Pa)e.X_(t.mutations)})}function BR(n,e,t){return _(this,null,function*(){let r=n.Pa.shift(),i=Xh.from(r,e,t);yield PI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ni(n)})}function qR(n,e){return _(this,null,function*(){e&&On(n).Z_&&(yield function(r,i){return _(this,null,function*(){if(function(o){return Wv(o)&&o!==S.ABORTED}(i.code)){let s=r.Pa.shift();On(r).N_(),yield PI(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Ni(r)}})}(n,e)),CI(n)&&kI(n)})}function Dy(n,e){return _(this,null,function*(){let t=L(n);t.asyncQueue.verifyOperationInProgress(),V(_r,"RemoteStore received new credentials");let r=Fn(t);t.Ia.add(3),yield Di(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield wo(t)})}function Qd(n,e){return _(this,null,function*(){let t=L(n);e?(t.Ia.delete(2),yield wo(t)):e||(t.Ia.add(2),yield Di(t),t.Aa.set("Unknown"))})}function Oi(n){return n.Va||(n.Va=function(t,r,i){let s=L(t);return s.ia(),new jd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:NR.bind(null,n),e_:OR.bind(null,n),n_:VR.bind(null,n),J_:xR.bind(null,n)}),n.da.push(e=>_(null,null,function*(){e?(n.Va.N_(),Xf(n)?Yf(n):n.Aa.set("Unknown")):(yield n.Va.stop(),RI(n))}))),n.Va}function On(n){return n.ma||(n.ma=function(t,r,i){let s=L(t);return s.ia(),new zd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:FR.bind(null,n),n_:qR.bind(null,n),ea:UR.bind(null,n),ta:BR.bind(null,n)}),n.da.push(e=>_(null,null,function*(){e?(n.ma.N_(),yield Ni(n)):(yield n.ma.stop(),n.Pa.length>0&&(V(_r,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var Jd=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new be,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,c=new n(e,t,o,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Vi(n,e){if(ye("AsyncQueue",`${e}: ${n}`),Ln(n))return new D(S.UNAVAILABLE,`${e}: ${n}`);throw n}var oo=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||F.comparator(t.key,r.key):(t,r)=>F.comparator(t.key,r.key),this.keyedMap=Rs(),this.sortedSet=new le(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Sc=class{constructor(){this.fa=new le(F.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):B(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},yr=class n{constructor(e,t,r,i,s,o,c,u,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new n(e,t,oo.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Io(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Yd=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},Xd=class{constructor(){this.queries=Ny(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=L(t),s=i.queries;i.queries=Ny(),s.forEach((o,c)=>{for(let u of c.wa)u.onError(r)})})(this,new D(S.ABORTED,"Firestore shutting down"))}};function Ny(){return new lt(n=>Dv(n),Io)}function Zf(n,e){return _(this,null,function*(){let t=L(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new Yd,r=e.ba()?0:1);try{switch(r){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=Vi(o,`Initialization of query '${Yr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&tp(t)})}function ep(n,e){return _(this,null,function*(){let t=L(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.wa.indexOf(e);o>=0&&(s.wa.splice(o,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function $R(n,e){let t=L(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.wa)c.Ca(i)&&(r=!0);o.ya=i}}r&&tp(t)}function jR(n,e,t){let r=L(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function tp(n){n.Da.forEach(e=>{e.next()})}var Zd,Oy;(Oy=Zd||(Zd={})).Fa="default",Oy.Cache="cache";var ao=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new yr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=yr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Zd.Cache}};var Rc=class{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}};var Pc=class{constructor(e){this.serializer=e}Qs(e){return Tt(this.serializer,e)}$s(e){return e.metadata.exists?Jc(this.serializer,e.document,!1):Re.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return ve(e)}},co=class{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=DI(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=X.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){let t=new Map,r=new Pc(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Qs(i.metadata.name);for(let o of i.metadata.queries){let c=(t.get(o)||Q()).add(s);t.set(o,c)}}return t}za(e){return _(this,null,function*(){let t=yield CR(e,new Pc(this.serializer),this.Ka,this.$a.id),r=this.Ga(this.documents);for(let i of this.Ua)yield kR(e,i,r.get(i.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:t}})}};function DI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Cc=class{constructor(e){this.key=e}},kc=class{constructor(e){this.key=e}},Dc=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Q(),this.mutatedKeys=Q(),this.Xa=Ov(e),this.eu=new oo(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new Sc,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{let g=i.get(f),E=Eo(this.query,p)?p:null,k=!!g&&this.mutatedKeys.has(g.key),N=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations),O=!1;g&&E?g.data.isEqual(E.data)?k!==N&&(r.track({type:3,doc:E}),O=!0):this.iu(g,E)||(r.track({type:2,doc:E}),O=!0,(u&&this.Xa(E,u)>0||l&&this.Xa(E,l)<0)&&(c=!0)):!g&&E?(r.track({type:0,doc:E}),O=!0):g&&!E&&(r.track({type:1,doc:g}),O=!0,(u||l)&&(c=!0)),O&&(E?(o=o.add(E),s=N?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{eu:o,ru:r,Ds:c,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let o=e.ru.pa();o.sort((f,p)=>function(E,k){let N=O=>{switch(O){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B(20277,{At:O})}};return N(E)-N(k)}(f.type,p.type)||this.Xa(f.doc,p.doc)),this.su(r),i=i!=null&&i;let c=t&&!i?this.ou():[],u=this.Za.size===0&&this.current&&!i?1:0,l=u!==this.Ya;return this.Ya=u,o.length!==0||l?{snapshot:new yr(this.query,e.eu,s,o,e.mutatedKeys,u===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:c}:{_u:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Sc,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=Q(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new kc(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new Cc(r))}),t}uu(e){this.Ha=e.qs,this.Za=Q();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return yr.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Un="SyncEngine",ef=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},tf=class{constructor(e){this.key=e,this.lu=!1}},nf=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new lt(c=>Dv(c),Io),this.Tu=new Map,this.Iu=new Set,this.du=new le(F.comparator),this.Eu=new Map,this.Au=new no,this.Ru={},this.Vu=new Map,this.mu=Ii.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function zR(n,e,t=!0){return _(this,null,function*(){let r=eu(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield NI(r,e,t,!0),i})}function WR(n,e){return _(this,null,function*(){let t=eu(n);yield NI(t,e,!0,!1)})}function NI(n,e,t,r){return _(this,null,function*(){let i=yield Ei(n.localStore,Fe(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=yield np(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Zc(n.remoteStore,i),c})}function np(n,e,t,r,i){return _(this,null,function*(){n.gu=(p,g,E)=>function(N,O,U,$){return _(this,null,function*(){let q=O.view.nu(U);q.Ds&&(q=yield vc(N.localStore,O.query,!1).then(({documents:w})=>O.view.nu(w,q)));let H=$&&$.targetChanges.get(O.targetId),te=$&&$.targetMismatches.get(O.targetId)!=null,K=O.view.applyChanges(q,N.isPrimaryClient,H,te);return rf(N,O.targetId,K._u),K.snapshot})}(n,p,g,E);let s=yield vc(n.localStore,e,!0),o=new Dc(e,s.qs),c=o.nu(s.documents),u=Xs.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),l=o.applyChanges(c,n.isPrimaryClient,u);rf(n,t,l._u);let f=new ef(e,t,o);return n.Pu.set(e,f),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),l.snapshot})}function GR(n,e,t){return _(this,null,function*(){let r=L(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(o=>!Io(o,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield wi(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ti(r.remoteStore,i.targetId),Ai(r,i.targetId)}).catch(xn))):(Ai(r,i.targetId),yield wi(r.localStore,i.targetId,!0))})}function KR(n,e){return _(this,null,function*(){let t=L(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ti(t.remoteStore,r.targetId))})}function HR(n,e,t){return _(this,null,function*(){let r=op(n);try{let i=yield function(o,c){let u=L(o),l=de.now(),f=c.reduce((E,k)=>E.add(k.key),Q()),p,g;return u.persistence.runTransaction("Locally write mutations","readwrite",E=>{let k=Ge(),N=Q();return u.Os.getEntries(E,f).next(O=>{k=O,k.forEach((U,$)=>{$.isValidDocument()||(N=N.add(U))})}).next(()=>u.localDocuments.getOverlayedDocuments(E,k)).next(O=>{p=O;let U=[];for(let $ of c){let q=cR($,p.get($.key).overlayedDocument);q!=null&&U.push(new ht($.key,q,wv(q.value.mapValue),ge.exists(!0)))}return u.mutationQueue.addMutationBatch(E,l,U,c)}).next(O=>{g=O;let U=O.applyToLocalDocumentSet(p,N);return u.documentOverlayCache.saveOverlays(E,O.batchId,U)})}).then(()=>({batchId:g.batchId,changes:xv(p)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,c,u){let l=o.Ru[o.currentUser.toKey()];l||(l=new le(W)),l=l.insert(c,u),o.Ru[o.currentUser.toKey()]=l}(r,i.batchId,t),yield Zt(r,i.changes),yield Ni(r.remoteStore)}catch(i){let s=Vi(i,"Failed to persist write");t.reject(s)}})}function OI(n,e){return _(this,null,function*(){let t=L(n);try{let r=yield RR(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Eu.get(s);o&&(j(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.lu=!0:i.modifiedDocuments.size>0?j(o.lu,14607):i.removedDocuments.size>0&&(j(o.lu,42227),o.lu=!1))}),yield Zt(t,r,e)}catch(r){yield xn(r)}})}function Vy(n,e,t){let r=L(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,o)=>{let c=o.view.va(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){let u=L(o);u.onlineState=c;let l=!1;u.queries.forEach((f,p)=>{for(let g of p.wa)g.va(c)&&(l=!0)}),l&&tp(u)}(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function QR(n,e,t){return _(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let o=new le(F.comparator);o=o.insert(s,Re.newNoDocument(s,z.min()));let c=Q().add(s),u=new Ys(z.min(),new Map,new le(W),o,c);yield OI(r,u),r.du=r.du.remove(s),r.Eu.delete(e),sp(r)}else yield wi(r.localStore,e,!1).then(()=>Ai(r,e,t)).catch(xn)})}function JR(n,e){return _(this,null,function*(){let t=L(n),r=e.batch.batchId;try{let i=yield SR(t.localStore,e);ip(t,r,null),rp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Zt(t,i)}catch(i){yield xn(i)}})}function YR(n,e,t){return _(this,null,function*(){let r=L(n);try{let i=yield function(o,c){let u=L(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let f;return u.mutationQueue.lookupMutationBatch(l,c).next(p=>(j(p!==null,37113),f=p.keys(),u.mutationQueue.removeMutationBatch(l,p))).next(()=>u.mutationQueue.performConsistencyCheck(l)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(l,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,f)).next(()=>u.localDocuments.getDocuments(l,f))})}(r.localStore,e);ip(r,e,t),rp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Zt(r,i)}catch(i){yield xn(i)}})}function XR(n,e){return _(this,null,function*(){let t=L(n);Fn(t.remoteStore)||V(Un,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let c=L(o);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>c.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===wn)return void e.resolve();let i=t.Vu.get(r)||[];i.push(e),t.Vu.set(r,i)}catch(r){let i=Vi(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function rp(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function ip(n,e,t){let r=L(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function Ai(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||VI(n,r)})}function VI(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Ti(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),sp(n))}function rf(n,e,t){for(let r of t)r instanceof Cc?(n.Au.addReference(r.key,e),ZR(n,r)):r instanceof kc?(V(Un,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||VI(n,r.key)):B(19791,{yu:r})}function ZR(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(V(Un,"New document in limbo: "+t),n.Iu.add(r),sp(n))}function sp(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new F(X.fromString(e)),r=n.mu.next();n.Eu.set(r,new tf(t)),n.du=n.du.insert(t,r),Zc(n.remoteStore,new vi(Fe(ki(t.path)),r,"TargetPurposeLimboResolution",Je.ue))}}function Zt(n,e,t){return _(this,null,function*(){let r=L(n),i=[],s=[],o=[];r.Pu.isEmpty()||(r.Pu.forEach((c,u)=>{o.push(r.gu(u,e,t).then(l=>{var f;if((l||t)&&r.isPrimaryClient){let p=l?!l.fromCache:(f=t?.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(l){i.push(l);let p=Vd.Es(u.targetId,l);s.push(p)}}))}),yield Promise.all(o),r.hu.J_(i),yield function(u,l){return _(this,null,function*(){let f=L(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>P.forEach(l,g=>P.forEach(g.Is,E=>f.persistence.referenceDelegate.addReference(p,g.targetId,E)).next(()=>P.forEach(g.ds,E=>f.persistence.referenceDelegate.removeReference(p,g.targetId,E)))))}catch(p){if(!Ln(p))throw p;V(Qf,"Failed to update sequence numbers: "+p)}for(let p of l){let g=p.targetId;if(!p.fromCache){let E=f.Fs.get(g),k=E.snapshotVersion,N=E.withLastLimboFreeSnapshotVersion(k);f.Fs=f.Fs.insert(g,N)}}})}(r.localStore,s))})}function eP(n,e){return _(this,null,function*(){let t=L(n);if(!t.currentUser.isEqual(e)){V(Un,"User change. New user:",e.toKey());let r=yield gI(t.localStore,e);t.currentUser=e,function(s,o){s.Vu.forEach(c=>{c.forEach(u=>{u.reject(new D(S.CANCELLED,o))})}),s.Vu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Zt(t,r.Bs)}})}function tP(n,e){let t=L(n),r=t.Eu.get(e);if(r&&r.lu)return Q().add(r.key);{let i=Q(),s=t.Tu.get(e);if(!s)return i;for(let o of s){let c=t.Pu.get(o);i=i.unionWith(c.view.tu)}return i}}function nP(n,e){return _(this,null,function*(){let t=L(n),r=yield vc(t.localStore,e.query,!0),i=e.view.uu(r);return t.isPrimaryClient&&rf(t,e.targetId,i._u),i})}function rP(n,e){return _(this,null,function*(){let t=L(n);return II(t.localStore,e).then(r=>Zt(t,r))})}function iP(n,e,t,r){return _(this,null,function*(){let i=L(n),s=yield function(c,u){let l=L(c),f=L(l.mutationQueue);return l.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.Xn(p,u).next(g=>g?l.localDocuments.getDocuments(p,g):P.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Ni(i.remoteStore):t==="acknowledged"||t==="rejected"?(ip(i,e,r||null),rp(i,e),function(c,u){L(L(c).mutationQueue).rr(u)}(i.localStore,e)):B(6720,"Unknown batchState",{wu:t}),yield Zt(i,s)):V(Un,"Cannot apply mutation batch with id: "+e)})}function sP(n,e){return _(this,null,function*(){let t=L(n);if(eu(t),op(t),e===!0&&t.fu!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield xy(t,r.toArray());t.fu=!0,yield Qd(t.remoteStore,!0);for(let s of i)Zc(t.remoteStore,s)}else if(e===!1&&t.fu!==!1){let r=[],i=Promise.resolve();t.Tu.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Ai(t,o),wi(t.localStore,o,!0))),Ti(t.remoteStore,o)}),yield i,yield xy(t,r),function(o){let c=L(o);c.Eu.forEach((u,l)=>{Ti(c.remoteStore,l)}),c.Au.jr(),c.Eu=new Map,c.du=new le(F.comparator)}(t),t.fu=!1,yield Qd(t.remoteStore,!1)}})}function xy(n,e,t){return _(this,null,function*(){let r=L(n),i=[],s=[];for(let o of e){let c,u=r.Tu.get(o);if(u&&u.length!==0){c=yield Ei(r.localStore,Fe(u[0]));for(let l of u){let f=r.Pu.get(l),p=yield nP(r,f);p.snapshot&&s.push(p.snapshot)}}else{let l=yield vI(r.localStore,o);c=yield Ei(r.localStore,l),yield np(r,xI(l),o,!1,c.resumeToken)}i.push(c)}return r.hu.J_(s),i})}function xI(n){return Pv(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function oP(n){return function(t){return L(L(t).persistence).Ps()}(L(n).localStore)}function aP(n,e,t,r){return _(this,null,function*(){let i=L(n);if(i.fu)return void V(Un,"Ignoring unexpected query state notification.");let s=i.Tu.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield II(i.localStore,Nv(s[0])),c=Ys.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ie.EMPTY_BYTE_STRING);yield Zt(i,o,c);break}case"rejected":yield wi(i.localStore,e,!0),Ai(i,e,r);break;default:B(64155,t)}})}function cP(n,e,t){return _(this,null,function*(){let r=eu(n);if(r.fu){for(let i of e){if(r.Tu.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){V(Un,"Adding an already active target "+i);continue}let s=yield vI(r.localStore,i),o=yield Ei(r.localStore,s);yield np(r,xI(s),o.targetId,!1,o.resumeToken),Zc(r.remoteStore,o)}for(let i of t)r.Tu.has(i)&&(yield wi(r.localStore,i,!1).then(()=>{Ti(r.remoteStore,i),Ai(r,i)}).catch(xn))}})}function eu(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=OI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=QR.bind(null,e),e.hu.J_=$R.bind(null,e.eventManager),e.hu.pu=jR.bind(null,e.eventManager),e}function op(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=JR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=YR.bind(null,e),e}function uP(n,e,t){let r=L(n);(function(s,o,c){return _(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(E,k){let N=L(E),O=ve(k.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",U=>N.Ti.getBundleMetadata(U,k.id)).then(U=>!!U&&U.createTime.compareTo(O)>=0)}(s.localStore,u))return yield o.close(),c._completeWith(function(E){return{taskState:"Success",documentsLoaded:E.totalDocuments,bytesLoaded:E.totalBytes,totalDocuments:E.totalDocuments,totalBytes:E.totalBytes}}(u)),Promise.resolve(new Set);c._updateProgress(DI(u));let l=new co(u,o.serializer),f=yield o.Su();for(;f;){let g=yield l.Wa(f);g&&c._updateProgress(g),f=yield o.Su()}let p=yield l.za(s.localStore);return yield Zt(s,p.Ja,void 0),yield function(E,k){let N=L(E);return N.persistence.runTransaction("Save bundle","readwrite",O=>N.Ti.saveBundleMetadata(O,k))}(s.localStore,u),c._completeWith(p.progress),Promise.resolve(p.ja)}catch(u){return je(Un,`Loading bundle failed with ${u}`),c._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var tu=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return _(this,null,function*(){this.serializer=Ar(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,r){return null}Fu(t,r){return null}vu(t){return mI(this.persistence,new yc,t.initialUser,this.serializer)}Du(t){return new ro(gc.Vi,this.serializer)}bu(t){return new wc}terminate(){return _(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),uo=class extends tu{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){j(this.persistence.referenceDelegate instanceof _c,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new fc(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?We.withCacheSize(this.cacheSizeBytes):We.DEFAULT;return new ro(r=>_c.Vi(r,t),this.serializer)}},lo=class n extends tu{constructor(e,t,r){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return _(this,null,function*(){yield dt(n.prototype,this,"initialize").call(this,e),yield this.Mu.initialize(this,e),yield op(this.Mu.syncEngine),yield Ni(this.Mu.remoteStore),yield this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(e){return mI(this.persistence,new yc,e.initialUser,this.serializer)}Cu(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new fc(r,e.asyncQueue,t)}Fu(e,t){let r=new Oh(t,this.persistence);return new Nh(e.asyncQueue,r)}Du(e){let t=Hf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?We.withCacheSize(this.cacheSizeBytes):We.DEFAULT;return new Od(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,bI(),Ba(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new wc}},Nc=class n extends lo{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return _(this,null,function*(){yield dt(n.prototype,this,"initialize").call(this,e);let t=this.Mu.syncEngine;this.sharedClientState instanceof Ls&&(this.sharedClientState.syncEngine={Do:iP.bind(null,t),vo:aP.bind(null,t),Co:cP.bind(null,t),Ps:oP.bind(null,t),bo:rP.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.ji(r=>_(this,null,function*(){yield sP(this.Mu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}bu(e){let t=bI();if(!Ls.C(t))throw new D(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Hf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ls(t,e.asyncQueue,r,e.clientId,e.initialUser)}},xi=(()=>{class n{initialize(t,r){return _(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Vy(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=eP.bind(null,this.syncEngine),yield Qd(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Xd}()}createDatastore(t){let r=Ar(t.databaseInfo.databaseId),i=function(o){return new $d(o)}(t.databaseInfo);return function(o,c,u,l){return new Gd(o,c,u,l)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,o,c,u){return new Hd(i,s,o,c,u)}(this.localStore,this.datastore,t.asyncQueue,r=>Vy(this.syncEngine,r,0),function(){return Tc.C()?new Tc:new Fd}())}createSyncEngine(t,r){return function(s,o,c,u,l,f,p){let g=new nf(s,o,c,u,l,f);return p&&(g.fu=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return _(this,null,function*(){var t,r;yield function(s){return _(this,null,function*(){let o=L(s);V(_r,"RemoteStore shutting down."),o.Ia.add(5),yield Di(o),o.Ea.shutdown(),o.Aa.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();function Ly(n,e=10240){let t=0;return{read(){return _(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return _(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var bi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var sf=class{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new be,this.buffer=new Uint8Array,this.Bu=function(){return new TextDecoder("utf-8")}(),this.Lu().then(r=>{r&&r.Qa()?this.metadata.resolve(r.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.qa)}`))},r=>this.metadata.reject(r))}close(){return this.Nu.cancel()}getMetadata(){return _(this,null,function*(){return this.metadata.promise})}Su(){return _(this,null,function*(){return yield this.getMetadata(),this.Lu()})}Lu(){return _(this,null,function*(){let e=yield this.ku();if(e===null)return null;let t=this.Bu.decode(e),r=Number(t);isNaN(r)&&this.qu(`length string (${t}) is not valid number`);let i=yield this.Qu(r);return new Rc(JSON.parse(i),e.length+r)})}$u(){return this.buffer.findIndex(e=>e===123)}ku(){return _(this,null,function*(){for(;this.$u()<0&&!(yield this.Uu()););if(this.buffer.length===0)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Qu(e){return _(this,null,function*(){for(;this.buffer.length<e;)(yield this.Uu())&&this.qu("Reached the end of bundle when more is expected.");let t=this.Bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}qu(e){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${e}`)}Uu(){return _(this,null,function*(){let e=yield this.Nu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var of=class{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Qa())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do r=this.Su(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Ku(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.ku(),t=this.Qu(e);return new Rc(JSON.parse(t),e)}Qu(e){if(this.cursor+e>this.bundleData.length)throw new D(S.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}};var af=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return _(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return _(this,null,function*(){let o=L(i),c={documents:s.map(p=>Zs(o.serializer,p))},u=yield o.Jo("BatchGetDocuments",o.serializer.databaseId,X.emptyPath(),c,s.length),l=new Map;u.forEach(p=>{let g=pR(o.serializer,p);l.set(g.key.toString(),g)});let f=[];return s.forEach(p=>{let g=l.get(p.toString());j(!!g,55234,{key:p}),f.push(g)}),f})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Nn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return _(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=F.fromPath(r);this.mutations.push(new Hs(i,this.precondition(i)))}),yield function(r,i){return _(this,null,function*(){let s=L(r),o={writes:i.map(c=>eo(s.serializer,c))};yield s.Wo("Commit",s.serializer.databaseId,X.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B(50498,{Wu:e.constructor.name});t=z.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new D(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(z.min())?ge.exists(!1):ge.updateTime(t):ge.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new D(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ge.updateTime(t)}return ge.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var cf=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Gu=r.maxAttempts,this.F_=new so(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(()=>_(this,null,function*(){let e=new af(this.datastore),t=this.Ju(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Hu(i)}))}).catch(r=>{this.Hu(r)})}))}Ju(e){try{let t=this.updateFunction(e);return!_o(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Wv(t)}return!1}};var Vn="FirestoreClient",uf=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Te.UNAUTHENTICATED,this.clientId=Fs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>_(this,null,function*(){V(Vn,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(V(Vn,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new be;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>_(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Vi(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ih(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V(Vn,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>_(null,null,function*(){r.isEqual(i)||(yield gI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>{je("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{V("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{je("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e})}function My(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield ap(n);V(Vn,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Dy(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Dy(e.remoteStore,i)),n._onlineComponents=e})}function ap(n){return _(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(Vn,"Using user provided OfflineComponentProvider");try{yield Ih(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===S.FAILED_PRECONDITION||i.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;je("Error using user provided cache. Falling back to memory cache: "+t),yield Ih(n,new tu)}}else V(Vn,"Using default OfflineComponentProvider"),yield Ih(n,new uo(void 0));return n._offlineComponents})}function nu(n){return _(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(Vn,"Using user provided OnlineComponentProvider"),yield My(n,n._uninitializedComponentsProvider._online)):(V(Vn,"Using default OnlineComponentProvider"),yield My(n,new xi))),n._onlineComponents})}function LI(n){return ap(n).then(e=>e.persistence)}function Li(n){return ap(n).then(e=>e.localStore)}function MI(n){return nu(n).then(e=>e.remoteStore)}function cp(n){return nu(n).then(e=>e.syncEngine)}function FI(n){return nu(n).then(e=>e.datastore)}function Si(n){return _(this,null,function*(){let e=yield nu(n),t=e.eventManager;return t.onListen=zR.bind(null,e.syncEngine),t.onUnlisten=GR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=WR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=KR.bind(null,e.syncEngine),t})}function lP(n){return n.asyncQueue.enqueue(()=>_(null,null,function*(){let e=yield LI(n),t=yield MI(n);return e.setNetworkEnabled(!0),function(i){let s=L(i);return s.Ia.delete(0),wo(s)}(t)}))}function hP(n){return n.asyncQueue.enqueue(()=>_(null,null,function*(){let e=yield LI(n),t=yield MI(n);return e.setNetworkEnabled(!1),function(i){return _(this,null,function*(){let s=L(i);s.Ia.add(0),yield Di(s),s.Aa.set("Offline")})}(t)}))}function dP(n,e){let t=new be;return n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return function(i,s,o){return _(this,null,function*(){try{let c=yield function(l,f){let p=L(l);return p.persistence.runTransaction("read document","readonly",g=>p.localDocuments.getDocument(g,f))}(i,s);c.isFoundDocument()?o.resolve(c):c.isNoDocument()?o.resolve(null):o.reject(new D(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){let u=Vi(c,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield Li(n),e,t)})),t.promise}function UI(n,e,t={}){let r=new be;return n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return function(s,o,c,u,l){let f=new bi({next:g=>{f.Ou(),o.enqueueAndForget(()=>ep(s,p));let E=g.docs.has(c);!E&&g.fromCache?l.reject(new D(S.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&g.fromCache&&u&&u.source==="server"?l.reject(new D(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(g)},error:g=>l.reject(g)}),p=new ao(ki(c.path),f,{includeMetadataChanges:!0,ka:!0});return Zf(s,p)}(yield Si(n),n.asyncQueue,e,t,r)})),r.promise}function fP(n,e){let t=new be;return n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return function(i,s,o){return _(this,null,function*(){try{let c=yield vc(i,s,!0),u=new Dc(s,c.qs),l=u.nu(c.documents),f=u.applyChanges(l,!1);o.resolve(f.snapshot)}catch(c){let u=Vi(c,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield Li(n),e,t)})),t.promise}function BI(n,e,t={}){let r=new be;return n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return function(s,o,c,u,l){let f=new bi({next:g=>{f.Ou(),o.enqueueAndForget(()=>ep(s,p)),g.fromCache&&u.source==="server"?l.reject(new D(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(g)},error:g=>l.reject(g)}),p=new ao(c,f,{includeMetadataChanges:!0,ka:!0});return Zf(s,p)}(yield Si(n),n.asyncQueue,e,t,r)})),r.promise}function pP(n,e,t){let r=new be;return n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){try{let i=yield FI(n);r.resolve(function(o,c,u){return _(this,null,function*(){var l;let f=L(o),{request:p,ft:g,parent:E}=Zv(f.serializer,Cv(c),u);f.connection.Qo||delete p.parent;let k=(yield f.Jo("RunAggregationQuery",f.serializer.databaseId,E,p,1)).filter(O=>!!O.result);j(k.length===1,64727);let N=(l=k[0].result)===null||l===void 0?void 0:l.aggregateFields;return Object.keys(N).reduce((O,U)=>(O[g[U]]=N[U],O),{})})}(i,e,t))}catch(i){r.reject(i)}})),r.promise}function mP(n,e){let t=new bi(e);return n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return function(i,s){L(i).Da.add(s),s.next()}(yield Si(n),t)})),()=>{t.Ou(),n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return function(i,s){L(i).Da.delete(s)}(yield Si(n),t)}))}}function gP(n,e,t,r){let i=function(o,c){let u;return u=typeof o=="string"?Nf().encode(o):o,function(f,p){return new sf(f,p)}(function(f,p){if(f instanceof Uint8Array)return Ly(f,p);if(f instanceof ArrayBuffer)return Ly(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),c)}(t,Ar(e));n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){uP(yield cp(n),i,r)}))}function _P(n,e){return n.asyncQueue.enqueue(()=>_(null,null,function*(){return function(r,i){let s=L(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Ti.getNamedQuery(o,i))}(yield Li(n),e)}))}function qI(n,e){return function(r,i){return new of(r,i)}(n,e)}function yP(n,e){return n.asyncQueue.enqueue(()=>_(null,null,function*(){return function(r,i){return _(this,null,function*(){let s=L(r),o=s.indexManager,c=[];return s.persistence.runTransaction("Configure indexes","readwrite",u=>o.getFieldIndexes(u).next(l=>function(p,g,E,k,N){p=[...p],g=[...g],p.sort(E),g.sort(E);let O=p.length,U=g.length,$=0,q=0;for(;$<U&&q<O;){let H=E(p[q],g[$]);H<0?N(p[q++]):H>0?k(g[$++]):($++,q++)}for(;$<U;)k(g[$++]);for(;q<O;)N(p[q++])}(l,i,ES,f=>{c.push(o.addFieldIndex(u,f))},f=>{c.push(o.deleteFieldIndex(u,f))})).next(()=>P.waitFor(c)))})}(yield Li(n),e)}))}function vP(n,e){return n.asyncQueue.enqueue(()=>_(null,null,function*(){return function(r,i){L(r).Cs.Rs=i}(yield Li(n),e)}))}function IP(n){return n.asyncQueue.enqueue(()=>_(null,null,function*(){return function(t){let r=L(t),i=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",s=>i.deleteAllFieldIndexes(s))}(yield Li(n))}))}function $I(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Fy=new Map;var jI="firestore.googleapis.com",Uy=!0,Oc=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new D(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=jI,this.ssl=Uy}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Uy;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=aI;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<hI)throw new D(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}IS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$I((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},vr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Oc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Oc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Eh;switch(r.type){case"firstParty":return new bh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return _(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Fy.get(t);r&&(V("ComponentProvider","Removing Datastore"),Fy.delete(t),r.terminate())}(this),Promise.resolve()}};function up(n,e,t,r={}){var i;n=Y(n,vr);let s=Nt(e),o=n._getSettings(),c=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;s&&(ss(`https://${u}`),Jo("Firestore",!0)),o.host!==jI&&o.host!==u&&je("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l=Object.assign(Object.assign({},o),{host:u,ssl:s,emulatorOptions:r});if(!ze(l,c)&&(n._setSettings(l),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Te.MOCK_USER;else{f=Hm(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new D(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Te(g)}n._authCredentials=new wh(new qa(f,p))}}var Ce=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ue=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new At(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Tr(t,n._jsonSchema))return new n(e,r||null,new F(X.fromString(t.referencePath)))}};ue._jsonSchemaVersion="firestore/documentReference/1.0",ue._jsonSchema={type:Ae("string",ue._jsonSchemaVersion),referencePath:Ae("string")};var At=class n extends Ce{constructor(e,t,r){super(e,t,ki(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ue(this.firestore,null,new F(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function zI(n,e,...t){if(n=re(n),Of("collection","path",e),n instanceof vr){let r=X.fromString(e,...t);return V_(r),new At(n,null,r)}{if(!(n instanceof ue||n instanceof At))throw new D(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(X.fromString(e,...t));return V_(r),new At(n.firestore,null,r)}}function WI(n,e){if(n=Y(n,vr),Of("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(S.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ce(n,null,function(r){return new ut(X.emptyPath(),r)}(e))}function lp(n,e,...t){if(n=re(n),arguments.length===1&&(e=Fs.newId()),Of("doc","path",e),n instanceof vr){let r=X.fromString(e,...t);return O_(r),new ue(n,null,new F(r))}{if(!(n instanceof ue||n instanceof At))throw new D(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(X.fromString(e,...t));return O_(r),new ue(n.firestore,n instanceof At?n.converter:null,new F(r))}}function Bn(n,e){return n=re(n),e=re(e),(n instanceof ue||n instanceof At)&&(e instanceof ue||e instanceof At)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function ru(n,e){return n=re(n),e=re(e),n instanceof Ce&&e instanceof Ce&&n.firestore===e.firestore&&Io(n._query,e._query)&&n.converter===e.converter}var By="AsyncQueue",Vc=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new so(this,"async_queue_retry"),this.oc=()=>{let r=Ba();r&&V(By,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=Ba();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=Ba();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new be;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return _(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Ln(e))throw e;V(By,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,ye("INTERNAL UNHANDLED ERROR: ",qy(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=Jd.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&B(47125,{hc:qy(this.tc)})}verifyOperationInProgress(){}Pc(){return _(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function qy(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function ri(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var lf=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new be,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var DD=-1,se=class extends vr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Vc,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return _(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Vc(e),this._firestoreClient=void 0,yield e}})}};function GI(n,e,t){t||(t=Ws);let r=an(n,"firestore");if(r.isInitialized(t)){let i=r.getImmediate({identifier:t}),s=r.getOptions(t);if(ze(s,e))return i;throw new D(S.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new D(S.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<hI)throw new D(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Nt(e.host)&&ss(e.host),r.initialize({options:e,instanceIdentifier:t})}function KI(n,e){let t=typeof n=="object"?n:Hn(),r=typeof n=="string"?n:e||Ws,i=an(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Km("firestore");s&&up(i,...s)}return i}function pe(n){if(n._terminated)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||HI(n),n._firestoreClient}function HI(n){var e,t,r;let i=n._freezeSettings(),s=function(c,u,l,f){return new Mh(c,u,l,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,$I(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new uf(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(c){let u=c?._online.build();return{_offline:c?._offline.build(u),_online:u}}(n._componentsProvider))}function QI(n,e){je("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return YI(n,xi.provider,{build:r=>new lo(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function JI(n){return _(this,null,function*(){je("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();YI(n,xi.provider,{build:t=>new Nc(t,e.cacheSizeBytes)})})}function YI(n,e,t){if((n=Y(n,se))._firestoreClient||n._terminated)throw new D(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new D(S.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},HI(n)}function XI(n){if(n._initialized&&!n._terminated)throw new D(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new be;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>_(null,null,function*(){try{yield function(r){return _(this,null,function*(){if(!Sn.C())return Promise.resolve();let i=r+pI;yield Sn.delete(i)})}(Hf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function ZI(n){return function(t){let r=new be;return t.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return XR(yield cp(t),r)})),r.promise}(pe(n=Y(n,se)))}function eE(n){return lP(pe(n=Y(n,se)))}function tE(n){return hP(pe(n=Y(n,se)))}function nE(n){return gg(n.app,"firestore",n._databaseId.database),n._delete()}function xc(n,e){let t=pe(n=Y(n,se)),r=new lf;return gP(t,n._databaseId,e,r),r}function hp(n,e){return _P(pe(n=Y(n,se)),e).then(t=>t?new Ce(n,null,t.query):null)}var Ir=class{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}},hf=class{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}};var Wt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ie.fromBase64String(e))}catch(t){throw new D(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Tr(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Wt._jsonSchemaVersion="firestore/bytes/1.0",Wt._jsonSchema={type:Ae("string",Wt._jsonSchemaVersion),bytes:Ae("string")};var Yt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};function rE(){return new Yt(Ph)}var Xt=class{constructor(e){this._methodName=e}};var Tn=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Tr(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};Tn._jsonSchemaVersion="firestore/geoPoint/1.0",Tn._jsonSchema={type:Ae("string",Tn._jsonSchemaVersion),latitude:Ae("number"),longitude:Ae("number")};var Gt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Tr(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new D(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Gt._jsonSchemaVersion="firestore/vectorValue/1.0",Gt._jsonSchema={type:Ae("string",Gt._jsonSchemaVersion),vectorValues:Ae("object")};var EP=/^__.*__$/,df=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ht(e,this.data,this.fieldMask,t,this.fieldTransforms):new Dn(e,this.data,t,this.fieldTransforms)}},Lc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ht(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function iE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B(40011,{Ec:n})}}var Mc=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Fc(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(iE(this.Ec)&&EP.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},ff=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ar(e)}Dc(e,t,r,i=!1){return new Mc({Ec:e,methodName:t,bc:r,path:Se.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function br(n){let e=n._freezeSettings(),t=Ar(n._databaseId);return new ff(n._databaseId,!!e.ignoreUndefinedProperties,t)}function iu(n,e,t,r,i,s={}){let o=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);pp("Data must be an object, but it was:",o,r);let c=aE(r,o),u,l;if(s.merge)u=new Ye(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let p of s.mergeFields){let g=fo(e,p,t);if(!o.contains(g))throw new D(S.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);uE(f,g)||f.push(g)}u=new Ye(f),l=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,l=o.fieldTransforms;return new df(new Le(c),u,l)}var ho=class n extends Xt{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function sE(n,e,t){return new Mc({Ec:3,bc:e.settings.bc,methodName:n._methodName,mc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var pf=class n extends Xt{_toFieldTransform(e){return new pr(e.path,new Cn)}isEqual(e){return e instanceof n}},mf=class n extends Xt{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=sE(this,e,!0),r=this.vc.map(s=>Sr(s,t)),i=new Qt(r);return new pr(e.path,i)}isEqual(e){return e instanceof n&&ze(this.vc,e.vc)}},gf=class n extends Xt{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=sE(this,e,!0),r=this.vc.map(s=>Sr(s,t)),i=new Jt(r);return new pr(e.path,i)}isEqual(e){return e instanceof n&&ze(this.vc,e.vc)}},_f=class n extends Xt{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){let t=new kn(e.serializer,Fv(e.serializer,this.Cc));return new pr(e.path,t)}isEqual(e){return e instanceof n&&this.Cc===e.Cc}};function dp(n,e,t,r){let i=n.Dc(1,e,t);pp("Data must be an object, but it was:",i,r);let s=[],o=Le.empty();Mn(r,(u,l)=>{let f=su(e,u,t);l=re(l);let p=i.gc(f);if(l instanceof ho)s.push(f);else{let g=Sr(l,p);g!=null&&(s.push(f),o.set(f,g))}});let c=new Ye(s);return new Lc(o,c,i.fieldTransforms)}function fp(n,e,t,r,i,s){let o=n.Dc(1,e,t),c=[fo(e,r,t)],u=[i];if(s.length%2!=0)throw new D(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)c.push(fo(e,s[g])),u.push(s[g+1]);let l=[],f=Le.empty();for(let g=c.length-1;g>=0;--g)if(!uE(l,c[g])){let E=c[g],k=u[g];k=re(k);let N=o.gc(E);if(k instanceof ho)l.push(E);else{let O=Sr(k,N);O!=null&&(l.push(E),f.set(E,O))}}let p=new Ye(l);return new Lc(f,p,o.fieldTransforms)}function oE(n,e,t,r=!1){return Sr(t,n.Dc(r?4:3,e))}function Sr(n,e){if(cE(n=re(n)))return pp("Unsupported field value:",e,n),aE(n,e);if(n instanceof Xt)return function(r,i){if(!iE(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let c of r){let u=Sr(c,i.yc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=re(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Fv(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=de.fromDate(r);return{timestampValue:yi(i.serializer,s)}}if(r instanceof de){let s=new de(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:yi(i.serializer,s)}}if(r instanceof Tn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Wt)return{bytesValue:Kv(i.serializer,r._byteString)};if(r instanceof ue){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Gf(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gt)return function(o,c){return{mapValue:{fields:{[Bf]:{stringValue:qf},[fi]:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw c.wc("VectorValues must only contain numeric values.");return Wf(c.serializer,l)})}}}}}}(r,i);throw i.wc(`Unsupported field value: ${jc(r)}`)}(n,e)}function aE(n,e){let t={};return pv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mn(n,(r,i)=>{let s=Sr(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function cE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof de||n instanceof Tn||n instanceof Wt||n instanceof ue||n instanceof Xt||n instanceof Gt)}function pp(n,e,t){if(!cE(t)||!Jy(t)){let r=jc(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function fo(n,e,t){if((e=re(e))instanceof Yt)return e._internalPath;if(typeof e=="string")return su(n,e);throw Fc("Field path arguments must be of type string or ",n,!1,void 0,t)}var wP=new RegExp("[~\\*/\\[\\]]");function su(n,e,t){if(e.search(wP)>=0)throw Fc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Yt(...e.split("."))._internalPath}catch{throw Fc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Fc(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new D(S.INVALID_ARGUMENT,c+n+u)}function uE(n,e){return n.some(t=>t.isEqual(e))}var Er=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new yf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ou("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},yf=class extends Er{data(){return super.data()}};function ou(n,e){return typeof e=="string"?su(n,e):e instanceof Yt?e._internalPath:e._delegate._internalPath}function lE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var po=class{},wr=class extends po{};function hE(n,e,...t){let r=[];e instanceof po&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof Ri).length,c=s.filter(u=>u instanceof mo).length;if(o>1||o>0&&c>0)throw new D(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var mo=class n extends wr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return TE(e._query,t),new Ce(e.firestore,e.converter,Jh(e._query,t))}_parse(e){let t=br(e.firestore);return function(s,o,c,u,l,f,p){let g;if(l.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new D(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){jy(p,f);let k=[];for(let N of p)k.push($y(u,s,N));g={arrayValue:{values:k}}}else g=$y(u,s,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||jy(p,f),g=oE(c,o,p,f==="in"||f==="not-in");return Z.create(l,f,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function dE(n,e,t){let r=e,i=ou("where",n);return mo._create(i,r,t)}var Ri=class n extends po{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ie.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)TE(o,u),o=Jh(o,u)}(e._query,t),new Ce(e.firestore,e.converter,Jh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function fE(...n){return n.forEach(e=>AE("or",e)),Ri._create("or",n)}function pE(...n){return n.forEach(e=>AE("and",e)),Ri._create("and",n)}var vf=class n extends wr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new D(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new D(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new dr(s,o)}(e._query,this._field,this._direction);return new Ce(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new ut(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function mE(n,e="asc"){let t=e,r=ou("orderBy",n);return vf._create(r,t)}var Uc=class n extends wr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Ce(e.firestore,e.converter,ec(e._query,this._limit,this._limitType))}};function gE(n){return Yy("limit",n),Uc._create("limit",n,"F")}function _E(n){return Yy("limitToLast",n),Uc._create("limitToLast",n,"L")}var Bc=class n extends wr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=wE(e,this.type,this._docOrFields,this._inclusive);return new Ce(e.firestore,e.converter,function(i,s){return new ut(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function yE(...n){return Bc._create("startAt",n,!0)}function vE(...n){return Bc._create("startAfter",n,!1)}var qc=class n extends wr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=wE(e,this.type,this._docOrFields,this._inclusive);return new Ce(e.firestore,e.converter,function(i,s){return new ut(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function IE(...n){return qc._create("endBefore",n,!1)}function EE(...n){return qc._create("endAt",n,!0)}function wE(n,e,t,r){if(t[0]=re(t[0]),t[0]instanceof Er)return function(s,o,c,u,l){if(!u)throw new D(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let p of ti(s))if(p.field.isKeyField())f.push(hr(o,u.key));else{let g=u.data.field(p.field);if(Kc(g))throw new D(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let E=p.field.canonicalString();throw new D(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${E}' (used as the orderBy) does not exist.`)}f.push(g)}return new St(f,l)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=br(n.firestore);return function(o,c,u,l,f,p){let g=o.explicitOrderBy;if(f.length>g.length)throw new D(S.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let E=[];for(let k=0;k<f.length;k++){let N=f[k];if(g[k].field.isKeyField()){if(typeof N!="string")throw new D(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof N}`);if(!jf(o)&&N.indexOf("/")!==-1)throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${l}() must be a plain document ID, but '${N}' contains a slash.`);let O=o.path.child(X.fromString(N));if(!F.isDocumentKey(O))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${l}() must result in a valid document path, but '${O}' is not because it contains an odd number of segments.`);let U=new F(O);E.push(hr(c,U))}else{let O=oE(u,l,N);E.push(O)}}return new St(E,p)}(n._query,n.firestore._databaseId,i,e,t,r)}}function $y(n,e,t){if(typeof(t=re(t))=="string"){if(t==="")throw new D(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!jf(e)&&t.indexOf("/")!==-1)throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(X.fromString(t));if(!F.isDocumentKey(r))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return hr(n,new F(r))}if(t instanceof ue)return hr(n,t._key);throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jc(t)}.`)}function jy(n,e){if(!Array.isArray(n)||n.length===0)throw new D(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function TE(n,e){let t=function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function AE(n,e){if(!(e instanceof mo||e instanceof Ri))throw new D(S.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}var $c=class{convertValue(e,t="none"){switch(Rn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return he(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ht(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Mn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[fi].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>he(o.doubleValue));return new Gt(s)}convertGeoPoint(e){return new Tn(he(e.latitude),he(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Hc(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zs(e));default:return null}}convertTimestamp(e){let t=Kt(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=X.fromString(e);j(rI(r),9688,{name:e});let i=new di(r.get(1),r.get(3)),s=new F(r.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function au(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var go=class extends $c{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}};function bE(n){return new Ir("sum",fo("sum",n))}function ND(n){return new Ir("avg",fo("average",n))}function TP(){return new Ir("count")}function SE(n,e){var t,r;return n instanceof Ir&&e instanceof Ir&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function RE(n,e){return ru(n.query,e.query)&&ze(n.data(),e.data())}var PE="NOT SUPPORTED",Et=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Xe=class n extends Er{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ii(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(ou("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};function OD(n,e,t){if(Tr(e,Xe._jsonSchema)){if(e.bundle===PE)throw new D(S.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let r=Ar(n._databaseId),i=qI(e.bundle,r),s=i.Ku(),o=new co(i.getMetadata(),r);for(let f of s)o.Wa(f);let c=o.documents;if(c.length!==1)throw new D(S.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${c.length} documents.`);let u=Jc(r,c[0].document),l=new F(X.fromString(e.bundleName));return new Xe(n,new go(n),l,u,new Et(!1,!1),t||null)}}Xe._jsonSchemaVersion="firestore/documentSnapshot/1.0",Xe._jsonSchema={type:Ae("string",Xe._jsonSchemaVersion),bundleSource:Ae("string","DocumentSnapshot"),bundleName:Ae("string"),bundle:Ae("string")};var ii=class extends Xe{data(e={}){return super.data(e)}},Ze=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Et(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ii(this._firestore,this._userDataWriter,r.key,r,new Et(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new ii(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Et(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new ii(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Et(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),l=-1,f=-1;return c.type!==0&&(l=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:AP(c.type),doc:u,oldIndex:l,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Fs.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function VD(n,e,t){if(Tr(e,Ze._jsonSchema)){if(e.bundle===PE)throw new D(S.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let r=Ar(n._databaseId),i=qI(e.bundle,r),s=i.Ku(),o=new co(i.getMetadata(),r);for(let g of s)o.Wa(g);if(o.queries.length!==1)throw new D(S.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let c=Xc(o.queries[0].bundledQuery),u=o.documents,l=new oo;u.map(g=>{let E=Jc(r,g.document);l=l.add(E)});let f=yr.fromInitialDocuments(c,l,Q(),!1,!1),p=new Ce(n,t||null,c);return new Ze(n,new go(n),p,f)}}function AP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B(61501,{type:n})}}function CE(n,e){return n instanceof Xe&&e instanceof Xe?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ze&&e instanceof Ze&&n._firestore===e._firestore&&ru(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function kE(n){n=Y(n,ue);let e=Y(n.firestore,se);return UI(pe(e),n._key).then(t=>mp(e,n,t))}Ze._jsonSchemaVersion="firestore/querySnapshot/1.0",Ze._jsonSchema={type:Ae("string",Ze._jsonSchemaVersion),bundleSource:Ae("string","QuerySnapshot"),bundleName:Ae("string"),bundle:Ae("string")};var Rt=class extends $c{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}};function DE(n){n=Y(n,ue);let e=Y(n.firestore,se),t=pe(e),r=new Rt(e);return dP(t,n._key).then(i=>new Xe(e,r,n._key,i,new Et(i!==null&&i.hasLocalMutations,!0),n.converter))}function NE(n){n=Y(n,ue);let e=Y(n.firestore,se);return UI(pe(e),n._key,{source:"server"}).then(t=>mp(e,n,t))}function OE(n){n=Y(n,Ce);let e=Y(n.firestore,se),t=pe(e),r=new Rt(e);return lE(n._query),BI(t,n._query).then(i=>new Ze(e,r,n,i))}function VE(n){n=Y(n,Ce);let e=Y(n.firestore,se),t=pe(e),r=new Rt(e);return fP(t,n._query).then(i=>new Ze(e,r,n,i))}function xE(n){n=Y(n,Ce);let e=Y(n.firestore,se),t=pe(e),r=new Rt(e);return BI(t,n._query,{source:"server"}).then(i=>new Ze(e,r,n,i))}function LE(n,e,t){n=Y(n,ue);let r=Y(n.firestore,se),i=au(n.converter,e,t);return To(r,[iu(br(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,ge.none())])}function ME(n,e,t,...r){n=Y(n,ue);let i=Y(n.firestore,se),s=br(i),o;return o=typeof(e=re(e))=="string"||e instanceof Yt?fp(s,"updateDoc",n._key,e,t,r):dp(s,"updateDoc",n._key,e),To(i,[o.toMutation(n._key,ge.exists(!0))])}function FE(n){return To(Y(n.firestore,se),[new Nn(n._key,ge.none())])}function UE(n,e){let t=Y(n.firestore,se),r=lp(n),i=au(n.converter,e);return To(t,[iu(br(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,ge.exists(!1))]).then(()=>r)}function Pi(n,...e){var t,r,i;n=re(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||ri(e[o])||(s=e[o++]);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(ri(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),e[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let u,l,f;if(n instanceof ue)l=Y(n.firestore,se),f=ki(n._key.path),u={next:p=>{e[o]&&e[o](mp(l,n,p))},error:e[o+1],complete:e[o+2]};else{let p=Y(n,Ce);l=Y(p.firestore,se),f=p._query;let g=new Rt(l);u={next:E=>{e[o]&&e[o](new Ze(l,g,p,E))},error:e[o+1],complete:e[o+2]},lE(n._query)}return function(g,E,k,N){let O=new bi(N),U=new ao(E,O,k);return g.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return Zf(yield Si(g),U)})),()=>{O.Ou(),g.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return ep(yield Si(g),U)}))}}(pe(l),f,c,u)}function xD(n,e,...t){let r=re(n),i=function(u){let l={bundle:"",bundleName:"",bundleSource:""},f=["bundle","bundleName","bundleSource"];for(let p of f){if(!(p in u)){l.error=`snapshotJson missing required field: ${p}`;break}let g=u[p];if(typeof g!="string"){l.error=`snapshotJson field '${p}' must be a string.`;break}if(g.length===0){l.error=`snapshotJson field '${p}' cannot be an empty string.`;break}p==="bundle"?l.bundle=g:p==="bundleName"?l.bundleName=g:p==="bundleSource"&&(l.bundleSource=g)}return l}(e);if(i.error)throw new D(S.INVALID_ARGUMENT,i.error);let s,o=0;if(typeof t[o]!="object"||ri(t[o])||(s=t[o++]),i.bundleSource==="QuerySnapshot"){let c=null;if(typeof t[o]=="object"&&ri(t[o])){let u=t[o++];c={next:u.next,error:u.error,complete:u.complete}}else c={next:t[o++],error:t[o++],complete:t[o++]};return function(l,f,p,g,E){let k,N=!1;return xc(l,f.bundle).then(()=>hp(l,f.bundleName)).then(U=>{U&&!N&&(E&&U.withConverter(E),k=Pi(U,p||{},g))}).catch(U=>(g.error&&g.error(U),()=>{})),()=>{N||(N=!0,k&&k())}}(r,i,s,c,t[o])}if(i.bundleSource==="DocumentSnapshot"){let c=null;if(typeof t[o]=="object"&&ri(t[o])){let u=t[o++];c={next:u.next,error:u.error,complete:u.complete}}else c={next:t[o++],error:t[o++],complete:t[o++]};return function(l,f,p,g,E){let k,N=!1;return xc(l,f.bundle).then(()=>{if(!N){let U=new ue(l,E||null,F.fromPath(f.bundleName));k=Pi(U,p||{},g)}}).catch(U=>(g.error&&g.error(U),()=>{})),()=>{N||(N=!0,k&&k())}}(r,i,s,c,t[o])}throw new D(S.INVALID_ARGUMENT,`unsupported bundle source: ${i.bundleSource}`)}function BE(n,e){return mP(pe(n=Y(n,se)),ri(e)?e:{next:e})}function To(n,e){return function(r,i){let s=new be;return r.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return HR(yield cp(r),i,s)})),s.promise}(pe(n),e)}function mp(n,e,t){let r=t.docs.get(e._key),i=new Rt(n);return new Xe(n,i,e._key,r,new Et(t.hasPendingWrites,t.fromCache),e.converter)}function cu(n){return gp(n,{count:TP()})}function gp(n,e){let t=Y(n.firestore,se),r=pe(t),i=fv(e,(s,o)=>new tc(o,s.aggregateType,s._internalFieldPath));return pP(r,n._query,i).then(s=>function(c,u,l){let f=new Rt(c);return new hf(u,f,l)}(t,n,s))}var If=class{constructor(e){this.kind="memory",this._onlineComponentProvider=xi.provider,e?.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new uo(void 0)}}toJSON(){return{kind:this.kind}}},Ef=class{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=bP(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}},wf=class{constructor(){this.kind="memoryEager",this._offlineComponentProvider=tu.provider}toJSON(){return{kind:this.kind}}},Tf=class{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new uo(e)}}toJSON(){return{kind:this.kind}}};function LD(){return new wf}function MD(n){return new Tf(n?.cacheSizeBytes)}function FD(n){return new If(n)}function UD(n){return new Ef(n)}var Af=class{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=xi.provider,this._offlineComponentProvider={build:t=>new lo(t,e?.cacheSizeBytes,this.forceOwnership)}}},bf=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=xi.provider,this._offlineComponentProvider={build:t=>new Nc(t,e?.cacheSizeBytes)}}};function bP(n){return new Af(n?.forceOwnership)}function BD(){return new bf}var SP={maxAttempts:5};var Sf=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=br(e)}set(e,t,r){this._verifyNotCommitted();let i=En(e,this._firestore),s=au(i.converter,t,r),o=iu(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,ge.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=En(e,this._firestore),o;return o=typeof(t=re(t))=="string"||t instanceof Yt?fp(this._dataReader,"WriteBatch.update",s._key,t,r,i):dp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ge.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=En(e,this._firestore);return this._mutations=this._mutations.concat(new Nn(t._key,ge.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function En(n,e){if((n=re(n)).firestore!==e)throw new D(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Rf=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=br(e)}get(e){let t=En(e,this._firestore),r=new go(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return B(24041);let s=i[0];if(s.isFoundDocument())return new Er(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Er(this._firestore,r,t._key,null,t.converter);throw B(18433,{doc:s})})}set(e,t,r){let i=En(e,this._firestore),s=au(i.converter,t,r),o=iu(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=En(e,this._firestore),o;return o=typeof(t=re(t))=="string"||t instanceof Yt?fp(this._dataReader,"Transaction.update",s._key,t,r,i):dp(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=En(e,this._firestore);return this._transaction.delete(t._key),this}};var Pf=class extends Rf{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=En(e,this._firestore),r=new Rt(this._firestore);return super.get(e).then(i=>new Xe(this._firestore,r,t._key,i._document,new Et(!1,!1),t.converter))}};function qE(n,e,t){n=Y(n,se);let r=Object.assign(Object.assign({},SP),t);return function(s){if(s.maxAttempts<1)throw new D(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,c){let u=new be;return s.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){let l=yield FI(s);new cf(s.asyncQueue,l,c,o,u).zu()})),u.promise}(pe(n),i=>e(new Pf(n,i)),r)}function $E(){return new ho("deleteField")}function qD(){return new pf("serverTimestamp")}function $D(...n){return new mf("arrayUnion",n)}function jD(...n){return new gf("arrayRemove",n)}function jE(n){return new _f("increment",n)}function zE(n){return new Gt(n)}function WE(n){return pe(n=Y(n,se)),new Sf(n,e=>To(n,e))}function GE(n,e){let t=pe(n=Y(n,se));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return je("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(s){let o=typeof s=="string"?function(l){try{return JSON.parse(l)}catch(f){throw new D(S.INVALID_ARGUMENT,"Failed to parse JSON: "+f?.message)}}(s):s,c=[];if(Array.isArray(o.indexes))for(let u of o.indexes){let l=zy(u,"collectionGroup"),f=[];if(Array.isArray(u.fields))for(let p of u.fields){let g=su("setIndexConfiguration",zy(p,"fieldPath"));p.arrayConfig==="CONTAINS"?f.push(new zt(g,2)):p.order==="ASCENDING"?f.push(new zt(g,0)):p.order==="DESCENDING"&&f.push(new zt(g,1))}c.push(new bn(bn.UNKNOWN_ID,l,f,ai.empty()))}return c}(e);return yP(t,r)}function zy(n,e){if(typeof n[e]!="string")throw new D(S.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}var Cf=class{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}};function KE(n){var e;n=Y(n,se);let t=Wy.get(n);if(t)return t;if(((e=pe(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;let r=new Cf(n);return Wy.set(n,r),r}function HE(n){YE(n,!0)}function QE(n){YE(n,!1)}function JE(n){IP(pe(n._firestore)).then(e=>V("deleting all persistent cache indexes succeeded")).catch(e=>je("deleting all persistent cache indexes failed",e))}function YE(n,e){vP(pe(n._firestore),e).then(t=>V(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>je(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}var Wy=new WeakMap;function zD(n){var e;let t=(e=pe(Y(n.firestore,se))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Yc(t,Fe(n._query)).Vt}function WD(n,e){var t;let r=fv(e,(s,o)=>new tc(o,s.aggregateType,s._internalFieldPath)),i=(t=pe(Y(n.firestore,se))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return i===void 0?null:Zv(i,Cv(n._query),r,!0).request}var Gy=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return kf.instance.onExistenceFilterMismatch(e)}},kf=class n{constructor(){this.Fc=new Map}static get instance(){return Na||(Na=new n,function(t){if(nc)throw new Error("a TestingHooksSpi instance is already set");nc=t}(Na)),Na}ct(e){this.Fc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.Fc;return r.set(t,e),()=>r.delete(t)}},Na=null;(function(e,t=!0){(function(i){Ci=i})(cn),st(new qe("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),c=new se(new Th(r.getProvider("auth-internal")),new Sh(o,r.getProvider("app-check-internal")),function(l,f){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new D(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new di(l.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),fe(C_,k_,e),fe(C_,k_,"esm2017")})();var uu=function(){return uu=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},uu.apply(this,arguments)};function vp(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var RP={includeMetadataChanges:!1};function Ao(n,e){return e===void 0&&(e=RP),new ft(function(t){var r=Pi(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function Ip(n){return Ao(n,{includeMetadataChanges:!0})}function XE(n,e){return e===void 0&&(e={}),Ip(n).pipe(Wn(function(t){return lu(t,e)}))}function lu(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:uu(uu({},r),(t={},t[e.idField]=n.id,t))}var ZE=["added","modified","removed"],PP=function(n){return $u(function(e){for(var t=!1,r=0;r<e.length;r++){var i=e[r];if(n&&n.indexOf(i.type)>=0){t=!0;break}}return t})};function _p(n,e,t){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var s=n.slice();return s.splice.apply(s,vp([e,t],r,!1)),s}function CP(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&Bn(n[e.newIndex].doc.ref,e.doc.ref)))return _p(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||Bn(n[e.oldIndex].doc.ref,e.doc.ref))if(e.oldIndex!==e.newIndex){var t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return _p(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&Bn(n[e.oldIndex].doc.ref,e.doc.ref))return _p(n,e.oldIndex,1);break}return n}function kP(n,e,t){return t===void 0&&(t=ZE),e.forEach(function(r){t.indexOf(r.type)>-1&&(n=CP(n,r))}),n}var ew=function(){return Uu(Vm(void 0),Om())},yp=function(n,e){return JSON.stringify(n.metadata)===JSON.stringify(e.metadata)},DP=function(){return Uu(ew(),$u(function(n){var e=n[0],t=n[1];return t.length>0||e===void 0}),Wn(function(n){var e=n[1];return e}))};function hu(n,e){return e===void 0&&(e={}),Ao(n,{includeMetadataChanges:!0}).pipe(ew(),Wn(function(t){var r=t[0],i=t[1],s=i.docChanges();return r&&!yp(r,i)&&i.docs.forEach(function(o,c){var u=s.find(function(f){return Bn(f.doc.ref,o.ref)});if(u){if(yp(u.doc,o))return}else{var l=r?.docs.find(function(f){return Bn(f.ref,o.ref)});if(l&&yp(l,o))return}s.push({oldIndex:c,newIndex:c,type:"modified",doc:o})}),s}),PP(e.events||ZE),DP())}function Ep(n){return Ao(n,{includeMetadataChanges:!0}).pipe(Wn(function(e){return e.docs}))}function tw(n,e){return e===void 0&&(e={}),hu(n,e).pipe(ju(function(t,r){return kP(t,r,e.events)},[]),Nm())}function nw(n,e){return e===void 0&&(e={}),hu(n,e).pipe(ju(function(t,r){return vp(vp([],t,!0),r,!0)},[]))}function rw(n,e){return e===void 0&&(e={}),Ep(n).pipe(Wn(function(t){return t.map(function(r){return lu(r,e)})}))}function wp(n){return ns(cu(n))}function iw(n){return wp(n).pipe(Wn(function(e){return e.data().count}))}var bo=class{constructor(e){return e}},Ap="firestore",Tp=class{constructor(){return Jn(Ap)}},h1=Cm(0,300).pipe(km(()=>ns(Jn(Ap))),Dm()),bp=new Dr("angularfire2.firestore-instances");function NP(n,e){let t=cs(Ap,n,e);return t&&new bo(t)}function OP(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new bo(r)}}var sw={provide:Tp,deps:[[new et,bp]]},ow={provide:bo,useFactory:NP,deps:[[new et,bp],xt]},d1=(()=>{class n{constructor(){fe("angularfire",Vt.full,"fst")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Bm({type:n});static \u0275inj=Lm({providers:[ow,sw]})}return n})();function f1(n,...e){return fe("angularfire",Vt.full,"fst"),Nr([ow,sw,{provide:bp,useFactory:OP(n),multi:!0,deps:[pt,sn,un,Yn,[new et,Es],[new et,Fr],...e]}])}var p1=x(nw,!0),m1=x(Ep,!0),g1=x(hu,!0),_1=x(iw,!0),y1=x(wp,!0),v1=x(rw,!0),I1=x(Ip,!0),E1=x(XE,!0),w1=x(Ao,!0),T1=x(lu,!0),A1=x(tw,!0),b1=x(UE,!0,2),S1=x(SE,!0,2),R1=x(RE,!0,2),P1=x(pE,!0,2),C1=x(XI,!0),k1=x(zI,!0,2),D1=x(WI,!0,2),N1=x(up,!0),O1=x(JE,!0),V1=x(FE,!0,2),x1=x($E,!0,2),L1=x(tE,!0),M1=x(QE,!0),F1=x(lp,!0,2),U1=x(rE,!0,2),B1=x(QI,!0),q1=x(JI,!0),$1=x(eE,!0),j1=x(HE,!0),z1=x(EE,!0,2),W1=x(IE,!0,2),G1=x(gp,!0),K1=x(cu,!0),H1=x(kE,!0),Q1=x(DE,!0),J1=x(NE,!0),Y1=x(OE,!0),X1=x(VE,!0),Z1=x(xE,!0),eN=x(KI,!0),tN=x(KE,!0),nN=x(jE,!0,2),rN=x(GI,!0),iN=x(gE,!0,2),sN=x(_E,!0,2),oN=x(xc,!0),aN=x(hp,!0,2),cN=x(Pi,!0),uN=x(BE,!0),lN=x(fE,!0,2),hN=x(mE,!0,2),dN=x(hE,!0,2),fN=x(ru,!0,2),pN=x(Bn,!0,2),mN=x(qE,!0),gN=x(LE,!0,2),_N=x(GE,!0),yN=x(Ky,!0),vN=x(CE,!0,2),IN=x(vE,!0,2),EN=x(yE,!0,2),wN=x(bE,!0,2),TN=x(nE,!0),AN=x(ME,!0,2),bN=x(zE,!0,2),SN=x(ZI,!0),RN=x(dE,!0,2),PN=x(WE,!0,2);export{Km as a,Nt as b,ss as c,Hm as d,Jo as e,He as f,re as g,qe as h,st as i,an as j,$e as k,cn as l,Hn as m,fe as n,Vt as o,cs as p,Jn as q,un as r,x as s,xt as t,Yn as u,UC as v,BC as w,Fr as x,gb as y,Is as z,Es as A,aD as B,cD as C,uD as D,lD as E,hD as F,dD as G,fD as H,pD as I,mD as J,je as K,PD as L,D as M,Eh as N,D_ as O,Fs as P,Se as Q,F as R,IS as S,Y as T,de as U,kD as V,Ie as W,di as X,Ce as Y,ue as Z,At as _,lf as $,DD as aa,pe as ba,Ir as ca,hf as da,Wt as ea,Yt as fa,Xt as ga,Tn as ha,Gt as ia,wr as ja,mo as ka,Ri as la,vf as ma,Uc as na,Bc as oa,qc as pa,$c as qa,ND as ra,TP as sa,Et as ta,Xe as ua,OD as va,ii as wa,Ze as xa,VD as ya,xD as za,To as Aa,LD as Ba,MD as Ca,FD as Da,UD as Ea,bP as Fa,BD as Ga,Sf as Ha,Pf as Ia,qD as Ja,$D as Ka,jD as La,Cf as Ma,zD as Na,WD as Oa,Gy as Pa,bo as Qa,Tp as Ra,h1 as Sa,d1 as Ta,f1 as Ua,p1 as Va,m1 as Wa,g1 as Xa,_1 as Ya,y1 as Za,v1 as _a,I1 as $a,E1 as ab,w1 as bb,T1 as cb,A1 as db,b1 as eb,S1 as fb,R1 as gb,P1 as hb,C1 as ib,k1 as jb,D1 as kb,N1 as lb,O1 as mb,V1 as nb,x1 as ob,L1 as pb,M1 as qb,F1 as rb,U1 as sb,B1 as tb,q1 as ub,$1 as vb,j1 as wb,z1 as xb,W1 as yb,G1 as zb,K1 as Ab,H1 as Bb,Q1 as Cb,J1 as Db,Y1 as Eb,X1 as Fb,Z1 as Gb,eN as Hb,tN as Ib,nN as Jb,rN as Kb,iN as Lb,sN as Mb,oN as Nb,aN as Ob,cN as Pb,uN as Qb,lN as Rb,hN as Sb,dN as Tb,fN as Ub,pN as Vb,mN as Wb,gN as Xb,_N as Yb,yN as Zb,vN as _b,IN as $b,EN as ac,wN as bc,TN as cc,AN as dc,bN as ec,SN as fc,RN as gc,PN as hc};
