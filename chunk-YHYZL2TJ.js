import{$ as Vo,Ba as mv,E as sv,F as jp,H as ov,K as av,Kb as _v,L as cv,Lb as yv,Ob as zp,Q as uv,R as $p,S as lv,Xa as gv,Y as hv,Z as dv,a as je,b as rr,c as Fp,ca as sr,d as Yt,da as Xt,e as w,ea as xo,g as Up,ga as fv,h as ir,ha as dh,ia as pv,m as rv,n as iv,oa as ui,p as hh,q as Bp,r as qp,ra as fh,s as Fc,ta as kn,x as ms}from"./chunk-DGP2RV7H.js";var Iv=()=>{};var vv=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Rk=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],a=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},ph={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,a=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,d=s>>2,m=(s&3)<<4|a>>4,v=(a&15)<<2|h>>6,C=h&63;u||(C=64,o||(v=64)),r.push(t[d],t[m],t[v],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(vv(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Rk(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;let h=i<n.length?t[n.charAt(i)]:64;++i;let m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||h==null||m==null)throw new Wp;let v=s<<2|a>>4;if(r.push(v),h!==64){let C=a<<4&240|h>>2;if(r.push(C),m!==64){let k=h<<6&192|m;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Wp=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Pk=function(n){let e=vv(n);return ph.encodeByteArray(e,!0)},Bc=function(n){return Pk(n).replace(/\./g,"")},mh=function(n){try{return ph.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function gh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Ck=()=>gh().__FIREBASE_DEFAULTS__,kk=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Nk=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&mh(n[1]);return e&&JSON.parse(e)},_h=()=>{try{return Iv()||Ck()||kk()||Nk()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Hp=n=>{var e,t;return(t=(e=_h())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Tv=n=>{let e=Hp(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Qp=()=>{var n;return(n=_h())===null||n===void 0?void 0:n.config},Jp=n=>{var e;return(e=_h())===null||e===void 0?void 0:e[`_${n}`]};var gs=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function or(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function qc(n){return w(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Av(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Bc(JSON.stringify(t)),Bc(JSON.stringify(o)),""].join(".")}var Uc={};function Dk(){let n={prod:[],emulator:[]};for(let e of Object.keys(Uc))Uc[e]?n.emulator.push(e):n.prod.push(e);return n}function Ok(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Ev=!1;function yh(n,e){if(typeof window>"u"||typeof document>"u"||!or(window.location.host)||Uc[n]===e||Uc[n]||Ev)return;Uc[n]=e;function t(v){return`__firebase__banner__${v}`}let r="__firebase__banner",s=Dk().prod.length>0;function o(){let v=document.getElementById(r);v&&v.remove()}function a(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function u(v,C){v.setAttribute("width","24"),v.setAttribute("id",C),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function h(){let v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Ev=!0,o()},v}function d(v,C){v.setAttribute("id",C),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function m(){let v=Ok(r),C=t("text"),k=document.getElementById(C)||document.createElement("span"),V=t("learnmore"),N=document.getElementById(V)||document.createElement("a"),q=t("preprendIcon"),G=document.getElementById(q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){let $=v.element;a($),d(N,V);let te=h();u(G,q),$.append(G,k,N,te),document.body.appendChild($)}s?(k.innerText="Preview backend disconnected.",G.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(G.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Ge(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function bv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ge())}function Sv(){var n;let e=(n=_h())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Rv(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Pv(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Cv(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function kv(){let n=Ge();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Yp(){return!Sv()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Xp(){return!Sv()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Lo(){try{return typeof indexedDB=="object"}catch{return!1}}function Nv(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var Vk="FirebaseError",jt=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Vk,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hn.prototype.create)}},hn=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?xk(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new jt(i,a,r)}};function xk(n,e){return n.replace(Lk,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Lk=/\{\$([^}]+)}/g;function Dv(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function xt(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],o=e[i];if(wv(s)&&wv(o)){if(!xt(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function wv(n){return n!==null&&typeof n=="object"}function Mo(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Fo(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Uo(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Ov(n,e){let t=new Kp(n,e);return t.subscribe.bind(t)}var Kp=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Mk(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Gp),i.error===void 0&&(i.error=Gp),i.complete===void 0&&(i.complete=Gp);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Mk(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Gp(){}var cU=4*60*60*1e3;function be(n){return n&&n._delegate?n._delegate:n}var Pt=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var _s="[DEFAULT]";var Zp=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new gs;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Uk(e))try{this.getOrInitializeService({instanceIdentifier:_s})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=_s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return w(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=_s){return this.instances.has(e)}getOptions(e=_s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Fk(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=_s){return this.component?this.component.multipleInstances?e:_s:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Fk(n){return n===_s?void 0:n}function Uk(n){return n.instantiationMode==="EAGER"}var Ih=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Zp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Bk=[],de=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(de||{}),qk={debug:de.DEBUG,verbose:de.VERBOSE,info:de.INFO,warn:de.WARN,error:de.ERROR,silent:de.SILENT},jk=de.INFO,$k={[de.DEBUG]:"log",[de.VERBOSE]:"log",[de.INFO]:"info",[de.WARN]:"warn",[de.ERROR]:"error"},zk=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=$k[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Nn=class{constructor(e){this.name=e,this._logLevel=jk,this._logHandler=zk,this._userLogHandler=null,Bk.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in de))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?qk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,de.DEBUG,...e),this._logHandler(this,de.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,de.VERBOSE,...e),this._logHandler(this,de.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,de.INFO,...e),this._logHandler(this,de.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,de.WARN,...e),this._logHandler(this,de.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,de.ERROR,...e),this._logHandler(this,de.ERROR,...e)}};var Gk=(n,e)=>e.some(t=>n instanceof t),Vv,xv;function Wk(){return Vv||(Vv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kk(){return xv||(xv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Lv=new WeakMap,tm=new WeakMap,Mv=new WeakMap,em=new WeakMap,rm=new WeakMap;function Hk(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(Dn(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Lv.set(t,n)}).catch(()=>{}),rm.set(e,n),e}function Qk(n){if(tm.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});tm.set(n,e)}var nm={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return tm.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Mv.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Dn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Fv(n){nm=n(nm)}function Jk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(Eh(this),e,...t);return Mv.set(r,e.sort?e.sort():[e]),Dn(r)}:Kk().includes(n)?function(...e){return n.apply(Eh(this),e),Dn(Lv.get(this))}:function(...e){return Dn(n.apply(Eh(this),e))}}function Yk(n){return typeof n=="function"?Jk(n):(n instanceof IDBTransaction&&Qk(n),Gk(n,Wk())?new Proxy(n,nm):n)}function Dn(n){if(n instanceof IDBRequest)return Hk(n);if(em.has(n))return em.get(n);let e=Yk(n);return e!==n&&(em.set(n,e),rm.set(e,n)),e}var Eh=n=>rm.get(n);function wh(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,e),a=Dn(o);return r&&o.addEventListener("upgradeneeded",u=>{r(Dn(o.result),u.oldVersion,u.newVersion,Dn(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),a.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),a}var Xk=["get","getKey","getAll","getAllKeys","count"],Zk=["put","add","delete","clear"],im=new Map;function Uv(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(im.get(e))return im.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Zk.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Xk.includes(t)))return;let s=function(o,...a){return w(this,null,function*(){let u=this.transaction(o,i?"readwrite":"readonly"),h=u.store;return r&&(h=h.index(a.shift())),(yield Promise.all([h[t](...a),i&&u.done]))[0]})};return im.set(e,s),s}Fv(n=>rr(je({},n),{get:(e,t,r)=>Uv(e,t)||n.get(e,t,r),has:(e,t)=>!!Uv(e,t)||n.has(e,t)}));var om=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(eN(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function eN(n){let e=n.getComponent();return e?.type==="VERSION"}var am="@firebase/app",Bv="0.13.2";var ar=new Nn("@firebase/app"),tN="@firebase/app-compat",nN="@firebase/analytics-compat",rN="@firebase/analytics",iN="@firebase/app-check-compat",sN="@firebase/app-check",oN="@firebase/auth",aN="@firebase/auth-compat",cN="@firebase/database",uN="@firebase/data-connect",lN="@firebase/database-compat",hN="@firebase/functions",dN="@firebase/functions-compat",fN="@firebase/installations",pN="@firebase/installations-compat",mN="@firebase/messaging",gN="@firebase/messaging-compat",_N="@firebase/performance",yN="@firebase/performance-compat",IN="@firebase/remote-config",EN="@firebase/remote-config-compat",wN="@firebase/storage",vN="@firebase/storage-compat",TN="@firebase/firestore",AN="@firebase/ai",bN="@firebase/firestore-compat",SN="firebase",RN="11.10.0";var vh="[DEFAULT]",PN={[am]:"fire-core",[tN]:"fire-core-compat",[rN]:"fire-analytics",[nN]:"fire-analytics-compat",[sN]:"fire-app-check",[iN]:"fire-app-check-compat",[oN]:"fire-auth",[aN]:"fire-auth-compat",[cN]:"fire-rtdb",[uN]:"fire-data-connect",[lN]:"fire-rtdb-compat",[hN]:"fire-fn",[dN]:"fire-fn-compat",[fN]:"fire-iid",[pN]:"fire-iid-compat",[mN]:"fire-fcm",[gN]:"fire-fcm-compat",[_N]:"fire-perf",[yN]:"fire-perf-compat",[IN]:"fire-rc",[EN]:"fire-rc-compat",[wN]:"fire-gcs",[vN]:"fire-gcs-compat",[TN]:"fire-fst",[bN]:"fire-fst-compat",[AN]:"fire-vertex","fire-js":"fire-js",[SN]:"fire-js-all"};var jc=new Map,CN=new Map,cm=new Map;function qv(n,e){try{n.container.addComponent(e)}catch(t){ar.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function dn(n){let e=n.name;if(cm.has(e))return ar.debug(`There were multiple attempts to register component ${e}.`),!1;cm.set(e,n);for(let t of jc.values())qv(t,n);for(let t of CN.values())qv(t,n);return!0}function hi(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Gv(n,e,t=vh){hi(n,e).clearInstance(t)}function Ct(n){return n==null?!1:n.settings!==void 0}var kN={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},li=new hn("app","Firebase",kN);var um=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Pt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw li.create("app-deleted",{appName:this._name})}};var di=RN;function dm(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:vh,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw li.create("bad-app-name",{appName:String(i)});if(t||(t=Qp()),!t)throw li.create("no-options");let s=jc.get(i);if(s){if(xt(t,s.options)&&xt(r,s.config))return s;throw li.create("duplicate-app",{appName:i})}let o=new Ih(i);for(let u of cm.values())o.addComponent(u);let a=new um(t,r,o);return jc.set(i,a),a}function ys(n=vh){let e=jc.get(n);if(!e&&n===vh&&Qp())return dm();if(!e)throw li.create("no-app",{appName:n});return e}function Th(){return Array.from(jc.values())}function Be(n,e,t){var r;let i=(r=PN[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ar.warn(a.join(" "));return}dn(new Pt(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var NN="firebase-heartbeat-database",DN=1,$c="firebase-heartbeat-store",sm=null;function Wv(){return sm||(sm=wh(NN,DN,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore($c)}catch(t){console.warn(t)}}}}).catch(n=>{throw li.create("idb-open",{originalErrorMessage:n.message})})),sm}function ON(n){return w(this,null,function*(){try{let t=(yield Wv()).transaction($c),r=yield t.objectStore($c).get(Kv(n));return yield t.done,r}catch(e){if(e instanceof jt)ar.warn(e.message);else{let t=li.create("idb-get",{originalErrorMessage:e?.message});ar.warn(t.message)}}})}function jv(n,e){return w(this,null,function*(){try{let r=(yield Wv()).transaction($c,"readwrite");yield r.objectStore($c).put(e,Kv(n)),yield r.done}catch(t){if(t instanceof jt)ar.warn(t.message);else{let r=li.create("idb-set",{originalErrorMessage:t?.message});ar.warn(r.message)}}})}function Kv(n){return`${n.name}!${n.options.appId}`}var VN=1024,xN=30,lm=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new hm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return w(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=$v();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>xN){let o=MN(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ar.warn(r)}})}getHeartbeatsHeader(){return w(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=$v(),{heartbeatsToSend:r,unsentEntries:i}=LN(this._heartbeatsCache.heartbeats),s=Bc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return ar.warn(t),""}})}};function $v(){return new Date().toISOString().substring(0,10)}function LN(n,e=VN){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),zv(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),zv(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var hm=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return w(this,null,function*(){return Lo()?Nv().then(()=>!0).catch(()=>!1):!1})}read(){return w(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield ON(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return w(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return jv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return w(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return jv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function zv(n){return Bc(JSON.stringify({version:2,heartbeats:n})).length}function MN(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function FN(n){dn(new Pt("platform-logger",e=>new om(e),"PRIVATE")),dn(new Pt("heartbeat",e=>new lm(e),"PRIVATE")),Be(am,Bv,n),Be(am,Bv,"esm2017"),Be("fire-js","")}FN("");var UN="firebase",BN="11.10.0";Be(UN,BN,"app");function fm(n){n===void 0&&(pv(fm),n=sr(ui));let e=n.get(fh);return t=>new ir(r=>{let i=e.add(),s=!1;function o(){s||(i(),s=!0)}let a=t.subscribe({next:u=>{r.next(u),o()},complete:()=>{r.complete(),o()},error:u=>{r.error(u),o()}});return a.add(()=>{r.unsubscribe(),o()}),a})}var cr=new _v("ANGULARFIRE2_VERSION");function zc(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Es=(n,e)=>{let t=e?[e]:Th(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Bo=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(Bo||{}),Hv=zp()&&typeof Zone<"u"?Bo.WARN:Bo.SILENT;var Ah=class{zone;delegate;constructor(e,t=iv){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i?i.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,r)}},fi=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=sr(kn);this.outsideAngular=t.runOutsideAngular(()=>new Ah(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new Ah(typeof Zone>"u"?void 0:Zone.current,rv))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=hv({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Qv=!1;function jN(n,e){!Qv&&(Hv>Bo.SILENT||zp())&&(Qv=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Hv>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function $N(n){let e=sr(kn,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Is(n){let e=sr(kn,{optional:!0});return e?e.run(()=>n()):n()}var zN=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),dh(t,()=>Is(()=>n.apply(void 0,r)))),H=(n,e,t)=>(t||=e?Bo.WARN:Bo.VERBOSE,function(){let r,i=arguments,s,o,a;try{s=sr(fi),o=sr(fh),a=sr(fv)}catch{return jN(n,t),n.apply(this,i)}for(let h=0;h<arguments.length;h++)typeof i[h]=="function"&&(e&&(r||=Is(()=>o.add())),i[h]=zN(i[h],r,a));let u=$N(()=>n.apply(this,i));return e?u instanceof ir?u.pipe(qp(s.outsideAngular),Bp(s.insideAngular),fm(a)):u instanceof Promise?Is(()=>new Promise((h,d)=>{o.run(()=>u).then(m=>dh(a,()=>Is(()=>h(m))),m=>dh(a,()=>Is(()=>d(m))))})):typeof u=="function"&&r?function(){return setTimeout(r,0),u.apply(this,arguments)}:Is(()=>u):u instanceof ir?u.pipe(qp(s.outsideAngular),Bp(s.insideAngular)):Is(()=>u)});var ur=class{constructor(e){return e}},ws=class{constructor(){return Th()}};function GN(n){return n&&n.length===1?n[0]:new ur(ys())}var pm=new Vo("angularfire2._apps"),WN={provide:ur,useFactory:GN,deps:[[new Xt,pm]]},KN={provide:ws,deps:[[new Xt,pm]]};function HN(n){return(e,t)=>{let r=t.get(mv);Be("angularfire",cr.full,"core"),Be("angularfire",cr.full,"app"),Be("angular",yv.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new ur(i)}}function h4(n,...e){return xo([WN,KN,{provide:pm,useFactory:HN(n),multi:!0,deps:[kn,ui,fi,...e]}])}var d4=H(dm,!0);var QN=new Map,JN={activated:!1,tokenObservers:[]},YN={initialized:!1,enabled:!1};function fn(n){return QN.get(n)||Object.assign({},JN)}function Zv(){return YN}var XN="https://content-firebaseappcheck.googleapis.com/v1";var ZN="exchangeDebugToken",Jv={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},w4=24*60*60*1e3;var _m=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return w(this,null,function*(){this.stop();try{this.pending=new gs,this.pending.promise.catch(t=>{}),yield eD(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new gs,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function eD(n){return new Promise(e=>{setTimeout(e,n)})}var tD={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},pi=new hn("appCheck","AppCheck",tD);function eT(n){if(!fn(n).activated)throw pi.create("use-before-activation",{appName:n.name})}function tT(r,i){return w(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let C=yield o.getHeartbeatsHeader();C&&(s["X-Firebase-Client"]=C)}let a={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,a)}catch(C){throw pi.create("fetch-network-error",{originalErrorMessage:C?.message})}if(u.status!==200)throw pi.create("fetch-status-error",{httpStatus:u.status});let h;try{h=yield u.json()}catch(C){throw pi.create("fetch-parse-error",{originalErrorMessage:C?.message})}let d=h.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw pi.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let m=Number(d[1])*1e3,v=Date.now();return{token:h.token,expireTimeMillis:v+m,issuedAtTimeMillis:v}})}function nT(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${XN}/projects/${t}/apps/${r}:${ZN}?key=${i}`,body:{debug_token:e}}}var nD="firebase-app-check-database",rD=1,ym="firebase-app-check-store";var bh=null;function iD(){return bh||(bh=new Promise((n,e)=>{try{let t=indexedDB.open(nD,rD);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(pi.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(ym,{keyPath:"compositeKey"})}}}catch(t){e(pi.create("storage-open",{originalErrorMessage:t?.message}))}}),bh)}function sD(n,e){return oD(aD(n),e)}function oD(n,e){return w(this,null,function*(){let r=(yield iD()).transaction(ym,"readwrite"),s=r.objectStore(ym).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var h;a(pi.create("storage-set",{originalErrorMessage:(h=u.target.error)===null||h===void 0?void 0:h.message}))}})})}function aD(n){return`${n.options.appId}-${n.name}`}var Gc=new Nn("@firebase/app-check");function mm(n,e){return Lo()?sD(n,e).catch(t=>{Gc.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function rT(){return Zv().enabled}function iT(){return w(this,null,function*(){let n=Zv();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var cD={error:"UNKNOWN_ERROR"};function uD(n){return ph.encodeString(JSON.stringify(n),!1)}function Im(n,e=!1,t=!1){return w(this,null,function*(){let r=n.app;eT(r);let i=fn(r),s=i.token,o;if(s&&!Wc(s)&&(i.token=void 0,s=void 0),!s){let h=yield i.cachedTokenPromise;h&&(Wc(h)?s=h:yield mm(r,void 0))}if(!e&&s&&Wc(s))return{token:s.token};let a=!1;if(rT())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=tT(nT(r,yield iT()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),a=!0);let h=yield i.exchangeTokenPromise;return yield mm(r,h),i.token=h,{token:h.token}}catch(h){return h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?Gc.warn(h.message):t&&Gc.error(h),gm(h)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),a=!0),s=yield fn(r).exchangeTokenPromise}catch(h){h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?Gc.warn(h.message):t&&Gc.error(h),o=h}let u;return s?o?Wc(s)?u={token:s.token,internalError:o}:u=gm(o):(u={token:s.token},i.token=s,yield mm(r,s)):u=gm(o),a&&fD(r,u),u})}function lD(n){return w(this,null,function*(){let e=n.app;eT(e);let{provider:t}=fn(e);if(rT()){let r=yield iT(),{token:i}=yield tT(nT(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function hD(n,e,t,r){let{app:i}=n,s=fn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Wc(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Yv(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Yv(n))}function sT(n,e){let t=fn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Yv(n){let{app:e}=n,t=fn(e),r=t.tokenRefresher;r||(r=dD(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function dD(n){let{app:e}=n;return new _m(()=>w(this,null,function*(){let t=fn(e),r;if(t.token?r=yield Im(n,!0):r=yield Im(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=fn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Jv.RETRIAL_MIN_WAIT,Jv.RETRIAL_MAX_WAIT)}function fD(n,e){let t=fn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Wc(n){return n.expireTimeMillis-Date.now()>0}function gm(n){return{token:uD(cD),error:n}}var Em=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=fn(this.app);for(let t of e)sT(this.app,t.next);return Promise.resolve()}};function pD(n,e){return new Em(n,e)}function mD(n){return{getToken:e=>Im(n,e),getLimitedUseToken:()=>lD(n),addTokenListener:e=>hD(n,"INTERNAL",e),removeTokenListener:e=>sT(n.app,e)}}var gD="@firebase/app-check",_D="0.10.1";var yD="app-check",Xv="app-check-internal";function ID(){dn(new Pt(yD,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return pD(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Xv).initialize()})),dn(new Pt(Xv,n=>{let e=n.getProvider("app-check").getImmediate();return mD(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Be(gD,_D)}ID();var ED="app-check";var qo=class{constructor(){return Es(ED)}};var wD=["localhost","0.0.0.0","127.0.0.1"],V4=typeof window<"u"&&wD.includes(window.location.hostname);var oT=()=>{};var aT=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},vD=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],a=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},cT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,a=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,d=s>>2,m=(s&3)<<4|a>>4,v=(a&15)<<2|h>>6,C=h&63;u||(C=64,o||(v=64)),r.push(t[d],t[m],t[v],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(aT(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):vD(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;let h=i<n.length?t[n.charAt(i)]:64;++i;let m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||h==null||m==null)throw new vm;let v=s<<2|a>>4;if(r.push(v),h!==64){let C=a<<4&240|h>>2;if(r.push(C),m!==64){let k=h<<6&192|m;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},vm=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},TD=function(n){let e=aT(n);return cT.encodeByteArray(e,!0)},Am=function(n){return TD(n).replace(/\./g,"")},Sh=function(n){try{return cT.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function uT(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var AD=()=>uT().__FIREBASE_DEFAULTS__,bD=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},SD=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Sh(n[1]);return e&&JSON.parse(e)},lT=()=>{try{return oT()||AD()||bD()||SD()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}};var hT=n=>lT()?.[`_${n}`];function Kc(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function $t(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function dT(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($t())}function RD(){let n=lT()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function fT(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function pT(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function mT(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function gT(){return!RD()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function bm(){try{return typeof indexedDB=="object"}catch{return!1}}function _T(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var PD="FirebaseError",Zt=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=PD,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lr.prototype.create)}},lr=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?CD(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Zt(i,a,r)}};function CD(n,e){return n.replace(kD,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var kD=/\{\$([^}]+)}/g;function Sm(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function yT(n,e){let t=new Tm(n,e);return t.subscribe.bind(t)}var Tm=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");ND(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=wm),i.error===void 0&&(i.error=wm),i.complete===void 0&&(i.complete=wm);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function ND(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function wm(){}var U4=4*60*60*1e3;function On(n){return n&&n._delegate?n._delegate:n}var pn=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var DD=[],fe=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(fe||{}),OD={debug:fe.DEBUG,verbose:fe.VERBOSE,info:fe.INFO,warn:fe.WARN,error:fe.ERROR,silent:fe.SILENT},VD=fe.INFO,xD={[fe.DEBUG]:"log",[fe.VERBOSE]:"log",[fe.INFO]:"info",[fe.WARN]:"warn",[fe.ERROR]:"error"},LD=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=xD[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},mi=class{constructor(e){this.name=e,this._logLevel=VD,this._logHandler=LD,this._userLogHandler=null,DD.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in fe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?OD[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,fe.DEBUG,...e),this._logHandler(this,fe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,fe.VERBOSE,...e),this._logHandler(this,fe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,fe.INFO,...e),this._logHandler(this,fe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,fe.WARN,...e),this._logHandler(this,fe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,fe.ERROR,...e),this._logHandler(this,fe.ERROR,...e)}};var Pm=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(MD(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function MD(n){return n.getComponent()?.type==="VERSION"}var Cm="@firebase/app",IT="0.14.4";var dr=new mi("@firebase/app"),FD="@firebase/app-compat",UD="@firebase/analytics-compat",BD="@firebase/analytics",qD="@firebase/app-check-compat",jD="@firebase/app-check",$D="@firebase/auth",zD="@firebase/auth-compat",GD="@firebase/database",WD="@firebase/data-connect",KD="@firebase/database-compat",HD="@firebase/functions",QD="@firebase/functions-compat",JD="@firebase/installations",YD="@firebase/installations-compat",XD="@firebase/messaging",ZD="@firebase/messaging-compat",e1="@firebase/performance",t1="@firebase/performance-compat",n1="@firebase/remote-config",r1="@firebase/remote-config-compat",i1="@firebase/storage",s1="@firebase/storage-compat",o1="@firebase/firestore",a1="@firebase/ai",c1="@firebase/firestore-compat",u1="firebase",l1="12.4.0";var h1={[Cm]:"fire-core",[FD]:"fire-core-compat",[BD]:"fire-analytics",[UD]:"fire-analytics-compat",[jD]:"fire-app-check",[qD]:"fire-app-check-compat",[$D]:"fire-auth",[zD]:"fire-auth-compat",[GD]:"fire-rtdb",[WD]:"fire-data-connect",[KD]:"fire-rtdb-compat",[HD]:"fire-fn",[QD]:"fire-fn-compat",[JD]:"fire-iid",[YD]:"fire-iid-compat",[XD]:"fire-fcm",[ZD]:"fire-fcm-compat",[e1]:"fire-perf",[t1]:"fire-perf-compat",[n1]:"fire-rc",[r1]:"fire-rc-compat",[i1]:"fire-gcs",[s1]:"fire-gcs-compat",[o1]:"fire-fst",[c1]:"fire-fst-compat",[a1]:"fire-vertex","fire-js":"fire-js",[u1]:"fire-js-all"};var d1=new Map,f1=new Map,ET=new Map;function wT(n,e){try{n.container.addComponent(e)}catch(t){dr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function gi(n){let e=n.name;if(ET.has(e))return dr.debug(`There were multiple attempts to register component ${e}.`),!1;ET.set(e,n);for(let t of d1.values())wT(t,n);for(let t of f1.values())wT(t,n);return!0}function fr(n){return n==null?!1:n.settings!==void 0}var p1={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Dm=new lr("app","Firebase",p1);var jo=l1;function hr(n,e,t){let r=h1[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){let o=[`Unable to register library "${r}" with version "${e}":`];i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),dr.warn(o.join(" "));return}gi(new pn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var m1="firebase-heartbeat-database",g1=1,Hc="firebase-heartbeat-store",Rm=null;function ST(){return Rm||(Rm=wh(m1,g1,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Hc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Dm.create("idb-open",{originalErrorMessage:n.message})})),Rm}function _1(n){return w(this,null,function*(){try{let t=(yield ST()).transaction(Hc),r=yield t.objectStore(Hc).get(RT(n));return yield t.done,r}catch(e){if(e instanceof Zt)dr.warn(e.message);else{let t=Dm.create("idb-get",{originalErrorMessage:e?.message});dr.warn(t.message)}}})}function vT(n,e){return w(this,null,function*(){try{let r=(yield ST()).transaction(Hc,"readwrite");yield r.objectStore(Hc).put(e,RT(n)),yield r.done}catch(t){if(t instanceof Zt)dr.warn(t.message);else{let r=Dm.create("idb-set",{originalErrorMessage:t?.message});dr.warn(r.message)}}})}function RT(n){return`${n.name}!${n.options.appId}`}var y1=1024,I1=30,km=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Nm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return w(this,null,function*(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=TT();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>I1){let i=w1(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){dr.warn(e)}})}getHeartbeatsHeader(){return w(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=TT(),{heartbeatsToSend:t,unsentEntries:r}=E1(this._heartbeatsCache.heartbeats),i=Am(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return dr.warn(e),""}})}};function TT(){return new Date().toISOString().substring(0,10)}function E1(n,e=y1){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),AT(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),AT(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Nm=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return w(this,null,function*(){return bm()?_T().then(()=>!0).catch(()=>!1):!1})}read(){return w(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield _1(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return w(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return vT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return w(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return vT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function AT(n){return Am(JSON.stringify({version:2,heartbeats:n})).length}function w1(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function v1(n){gi(new pn("platform-logger",e=>new Pm(e),"PRIVATE")),gi(new pn("heartbeat",e=>new km(e),"PRIVATE")),hr(Cm,IT,n),hr(Cm,IT,"esm2020"),hr("fire-js","")}v1("");function xT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var LT=xT,MT=new lr("auth","Firebase",xT());var kh=new mi("@firebase/auth");function R1(n,...e){kh.logLevel<=fe.WARN&&kh.warn(`Auth (${jo}): ${n}`,...e)}function Ph(n,...e){kh.logLevel<=fe.ERROR&&kh.error(`Auth (${jo}): ${n}`,...e)}function PT(n,...e){throw zm(n,...e)}function $m(n,...e){return zm(n,...e)}function FT(n,e,t){let r=rr(je({},LT()),{[e]:t});return new lr("auth","Firebase",r).create(e,{appName:n.name})}function Ch(n){return FT(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function zm(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return MT.create(n,...e)}function Se(n,e,...t){if(!n)throw zm(e,...t)}function Qc(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ph(e),new Error(e)}function Nh(n,e){n||Qc(e)}function P1(){return CT()==="http:"||CT()==="https:"}function CT(){return typeof self<"u"&&self.location?.protocol||null}function C1(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(P1()||pT()||"connection"in navigator)?navigator.onLine:!0}function k1(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var As=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Nh(t>e,"Short delay should be less than long delay!"),this.isMobile=dT()||mT()}get(){return C1()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function N1(n,e){Nh(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Dh=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Qc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Qc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Qc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var D1={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var O1=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],V1=new As(3e4,6e4);function UT(n,e){return n.tenantId&&!e.tenantId?rr(je({},e),{tenantId:n.tenantId}):e}function Mh(s,o,a,u){return w(this,arguments,function*(n,e,t,r,i={}){return BT(n,i,()=>w(this,null,function*(){let h={},d={};r&&(e==="GET"?d=r:h={body:JSON.stringify(r)});let m=Sm(je({key:n.config.apiKey},d)).slice(1),v=yield n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);let C=je({method:e,headers:v},h);return fT()||(C.referrerPolicy="no-referrer"),n.emulatorConfig&&Kc(n.emulatorConfig.host)&&(C.credentials="include"),Dh.fetch()(yield qT(n,n.config.apiHost,t,m),C)}))})}function BT(n,e,t){return w(this,null,function*(){n._canInitEmulator=!1;let r=je(je({},D1),e);try{let i=new xm(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw Rh(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[u,h]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Rh(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw Rh(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw Rh(n,"user-disabled",o);let d=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw FT(n,d,h);PT(n,d)}}catch(i){if(i instanceof Zt)throw i;PT(n,"network-request-failed",{message:String(i)})}})}function qT(n,e,t,r){return w(this,null,function*(){let i=`${e}${t}?${r}`,s=n,o=s.config.emulator?N1(n.config,i):`${n.config.apiScheme}://${i}`;return O1.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}var xm=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r($m(this.auth,"network-request-failed")),V1.get())})}};function Rh(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=$m(n,e,r);return i.customData._tokenResponse=t,i}function x1(n,e){return w(this,null,function*(){return Mh(n,"POST","/v1/accounts:delete",e)})}function Oh(n,e){return w(this,null,function*(){return Mh(n,"POST","/v1/accounts:lookup",e)})}function Jc(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function jT(n,e=!1){return w(this,null,function*(){let t=On(n),r=yield t.getIdToken(e),i=$T(r);Se(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:Jc(Om(i.auth_time)),issuedAtTime:Jc(Om(i.iat)),expirationTime:Jc(Om(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Om(n){return Number(n)*1e3}function $T(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ph("JWT malformed, contained fewer than 3 sections"),null;try{let i=Sh(t);return i?JSON.parse(i):(Ph("Failed to decode base64 JWT payload"),null)}catch(i){return Ph("Caught error parsing JWT payload as JSON",i?.toString()),null}}function kT(n){let e=$T(n);return Se(e,"internal-error"),Se(typeof e.exp<"u","internal-error"),Se(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Lm(n,e,t=!1){return w(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Zt&&L1(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function L1({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Mm=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>w(this,null,function*(){yield this.iteration()}),t)}iteration(){return w(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Xc=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Jc(this.lastLoginAt),this.creationTime=Jc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Vh(n){return w(this,null,function*(){let e=n.auth,t=yield n.getIdToken(),r=yield Lm(n,Oh(e,{idToken:t}));Se(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let s=i.providerUserInfo?.length?GT(i.providerUserInfo):[],o=M1(n.providerData,s),a=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!o?.length,h=a?u:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Xc(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,d)})}function zT(n){return w(this,null,function*(){let e=On(n);yield Vh(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function M1(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function GT(n){return n.map(r=>{var i=r,{providerId:e}=i,t=Fp(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}function F1(n,e){return w(this,null,function*(){let t=yield BT(n,{},()=>w(this,null,function*(){let r=Sm({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=yield qT(n,i,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:a,body:r};return n.emulatorConfig&&Kc(n.emulatorConfig.host)&&(u.credentials="include"),Dh.fetch()(o,u)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function U1(n,e){return w(this,null,function*(){return Mh(n,"POST","/v2/accounts:revokeToken",UT(n,e))})}var Yc=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Se(e.idToken,"internal-error"),Se(typeof e.idToken<"u","internal-error"),Se(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):kT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Se(e.length!==0,"internal-error");let t=kT(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return w(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Se(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return w(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield F1(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&(Se(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(Se(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(Se(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Qc("not implemented")}};function _i(n,e){Se(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var vs=class n{constructor(s){var o=s,{uid:e,auth:t,stsTokenManager:r}=o,i=Fp(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Mm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Xc(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return w(this,null,function*(){let t=yield Lm(this,this.stsTokenManager.getToken(this.auth,e));return Se(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return jT(this,e)}reload(){return zT(this)}_assign(e){this!==e&&(Se(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>je({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(rr(je({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Se(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return w(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Vh(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return w(this,null,function*(){if(fr(this.auth.app))return Promise.reject(Ch(this.auth));let e=yield this.getIdToken();return yield Lm(this,x1(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return rr(je({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>je({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,u=t._redirectEventId??void 0,h=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:m,emailVerified:v,isAnonymous:C,providerData:k,stsTokenManager:V}=t;Se(m&&V,e,"internal-error");let N=Yc.fromJSON(this.name,V);Se(typeof m=="string",e,"internal-error"),_i(r,e.name),_i(i,e.name),Se(typeof v=="boolean",e,"internal-error"),Se(typeof C=="boolean",e,"internal-error"),_i(s,e.name),_i(o,e.name),_i(a,e.name),_i(u,e.name),_i(h,e.name),_i(d,e.name);let q=new n({uid:m,auth:e,email:i,emailVerified:v,displayName:r,isAnonymous:C,photoURL:o,phoneNumber:s,tenantId:a,stsTokenManager:N,createdAt:h,lastLoginAt:d});return k&&Array.isArray(k)&&(q.providerData=k.map(G=>je({},G))),u&&(q._redirectEventId=u),q}static _fromIdTokenResponse(e,t,r=!1){return w(this,null,function*(){let i=new Yc;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Vh(s),s})}static _fromGetAccountInfoResponse(e,t,r){return w(this,null,function*(){let i=t.users[0];Se(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?GT(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,a=new Yc;a.updateFromIdToken(r);let u=new n({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Xc(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u})}};var NT=new Map;function Ts(n){Nh(n instanceof Function,"Expected a class definition");let e=NT.get(n);return e?(Nh(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,NT.set(n,e),e)}var B1=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return w(this,null,function*(){return!0})}_set(t,r){return w(this,null,function*(){this.storage[t]=r})}_get(t){return w(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return w(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Fm=B1;function Vm(n,e,t){return`firebase:${n}:${e}:${t}`}var xh=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=Vm(this.userKey,i.apiKey,s),this.fullPersistenceKey=Vm("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return w(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Oh(this.auth,{idToken:e}).catch(()=>{});return t?vs._fromGetAccountInfoResponse(this.auth,t,e):null}return vs._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return w(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return w(this,null,function*(){if(!t.length)return new n(Ts(Fm),e,r);let i=(yield Promise.all(t.map(h=>w(this,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||Ts(Fm),o=Vm(r,e.config.apiKey,e.name),a=null;for(let h of t)try{let d=yield h._get(o);if(d){let m;if(typeof d=="string"){let v=yield Oh(e,{idToken:d}).catch(()=>{});if(!v)break;m=yield vs._fromGetAccountInfoResponse(e,v,d)}else m=vs._fromJSON(e,d);h!==s&&(a=m),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,e,r):(s=u[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(h=>w(this,null,function*(){if(h!==s)try{yield h._remove(o)}catch{}}))),new n(s,e,r))})}};function DT(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(z1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(q1(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(W1(e))return"Blackberry";if(K1(e))return"Webos";if(j1(e))return"Safari";if((e.includes("chrome/")||$1(e))&&!e.includes("edge/"))return"Chrome";if(G1(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function q1(n=$t()){return/firefox\//i.test(n)}function j1(n=$t()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function $1(n=$t()){return/crios\//i.test(n)}function z1(n=$t()){return/iemobile/i.test(n)}function G1(n=$t()){return/android/i.test(n)}function W1(n=$t()){return/blackberry/i.test(n)}function K1(n=$t()){return/webos/i.test(n)}function WT(n,e=[]){let t;switch(n){case"Browser":t=DT($t());break;case"Worker":t=`${DT($t())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${jo}/${r}`}var Um=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,a)=>{try{let u=e(s);o(u)}catch(u){a(u)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return w(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function H1(t){return w(this,arguments,function*(n,e={}){return Mh(n,"GET","/v2/passwordPolicy",UT(n,e))})}var Q1=6,Bm=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Q1,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var qm=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Lh(this),this.idTokenSubscription=new Lh(this),this.beforeStateQueue=new Um(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=MT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ts(t)),this._initializationPromise=this.queue(()=>w(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield xh.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return w(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return w(this,null,function*(){try{let t=yield Oh(this,{idToken:e}),r=yield vs._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return w(this,null,function*(){if(fr(this.app)){let s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}let t=yield this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let s=this.redirectUser?._redirectEventId,o=r?._redirectEventId,a=yield this.tryRedirectSignIn(e);(!s||s===o)&&a?.user&&(r=a.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(r)}catch(s){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Se(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return w(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return w(this,null,function*(){try{yield Vh(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=k1()}_delete(){return w(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return w(this,null,function*(){if(fr(this.app))return Promise.reject(Ch(this));let t=e?On(e):null;return t&&Se(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return w(this,null,function*(){if(!this._deleted)return e&&Se(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>w(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return w(this,null,function*(){return fr(this.app)?Promise.reject(Ch(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return fr(this.app)?Promise.reject(Ch(this)):this.queue(()=>w(this,null,function*(){yield this.assertedPersistence.setPersistence(Ts(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return w(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return w(this,null,function*(){let e=yield H1(this),t=new Bm(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new lr("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return w(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield U1(this,r)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(e,t){return w(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return w(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Ts(e)||this._popupRedirectResolver;Se(t,this,"argument-error"),this.redirectPersistenceManager=yield xh.create(this,[Ts(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return w(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>w(this,null,function*(){}))),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null})}_persistUserIfCurrent(e){return w(this,null,function*(){if(e===this.currentUser)return this.queue(()=>w(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Se(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return w(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Se(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=WT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return w(this,null,function*(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=yield this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e})}_getAppCheckToken(){return w(this,null,function*(){if(fr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&R1(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function J1(n){return On(n)}var Lh=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=yT(t=>this.observer=t)}get next(){return Se(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Y1={loadJS(){return w(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function X1(n){Y1=n}function Z1(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function eO(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Ts);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Gm(n,e,t,r){return On(n).onAuthStateChanged(e,t,r)}var m6=Z1("rcb"),g6=new As(3e4,6e4);var _6=new As(2e3,1e4);var y6=10*60*1e3;var I6=new As(3e4,6e4);var E6=new As(5e3,15e3);var w6=encodeURIComponent("fac");var OT="@firebase/auth",VT="1.11.0";var jm=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(e){return w(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Se(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function tO(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function nO(n){gi(new pn("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Se(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let u={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:WT(n)},h=new qm(r,i,s,u);return eO(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),gi(new pn("auth-internal",e=>{let t=J1(e.getProvider("auth").getImmediate());return(r=>new jm(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),hr(OT,VT,tO(n)),hr(OT,VT,"esm2020")}var rO=5*60,v6=hT("authIdTokenMaxAge")||rO;function iO(){return document.getElementsByTagName("head")?.[0]??document}X1({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=$m("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",iO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});nO("Browser");function KT(n){return new ir(function(e){var t=Gm(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}function uA(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var lA=uA,hA=new hn("auth","Firebase",uA());var $h=new Nn("@firebase/auth");function aO(n,...e){$h.logLevel<=de.WARN&&$h.warn(`Auth (${di}): ${n}`,...e)}function Uh(n,...e){$h.logLevel<=de.ERROR&&$h.error(`Auth (${di}): ${n}`,...e)}function en(n,...e){throw pg(n,...e)}function mn(n,...e){return pg(n,...e)}function fg(n,e,t){let r=Object.assign(Object.assign({},lA()),{[e]:t});return new hn("auth","Firebase",r).create(e,{appName:n.name})}function gr(n){return fg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cO(n,e,t){let r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&en(n,"argument-error"),fg(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function pg(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return hA.create(n,...e)}function se(n,e,...t){if(!n)throw pg(e,...t)}function pr(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Uh(e),new Error(e)}function _r(n,e){n||pr(e)}function Hm(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function uO(){return HT()==="http:"||HT()==="https:"}function HT(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function lO(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(uO()||Pv()||"connection"in navigator)?navigator.onLine:!0}function hO(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var bs=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,_r(t>e,"Short delay should be less than long delay!"),this.isMobile=bv()||Cv()}get(){return lO()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function mg(n,e){_r(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var zh=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;pr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;pr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;pr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var dO={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var fO=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],pO=new bs(3e4,6e4);function Ei(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function yr(s,o,a,u){return w(this,arguments,function*(n,e,t,r,i={}){return dA(n,i,()=>w(this,null,function*(){let h={},d={};r&&(e==="GET"?d=r:h={body:JSON.stringify(r)});let m=Mo(Object.assign({key:n.config.apiKey},d)).slice(1),v=yield n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);let C=Object.assign({method:e,headers:v},h);return Rv()||(C.referrerPolicy="no-referrer"),n.emulatorConfig&&or(n.emulatorConfig.host)&&(C.credentials="include"),zh.fetch()(yield fA(n,n.config.apiHost,t,m),C)}))})}function dA(n,e,t){return w(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},dO),e);try{let i=new Qm(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw Fh(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[u,h]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Fh(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw Fh(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw Fh(n,"user-disabled",o);let d=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw fg(n,d,h);en(n,d)}}catch(i){if(i instanceof jt)throw i;en(n,"network-request-failed",{message:String(i)})}})}function ou(s,o,a,u){return w(this,arguments,function*(n,e,t,r,i={}){let h=yield yr(n,e,t,r,i);return"mfaPendingCredential"in h&&en(n,"multi-factor-auth-required",{_serverResponse:h}),h})}function fA(n,e,t,r){return w(this,null,function*(){let i=`${e}${t}?${r}`,s=n,o=s.config.emulator?mg(n.config,i):`${n.config.apiScheme}://${i}`;return fO.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}function mO(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Qm=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(mn(this.auth,"network-request-failed")),pO.get())})}};function Fh(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=mn(n,e,r);return i.customData._tokenResponse=t,i}function QT(n){return n!==void 0&&n.enterprise!==void 0}var Jm=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return mO(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};function gO(n,e){return w(this,null,function*(){return yr(n,"GET","/v2/recaptchaConfig",Ei(n,e))})}function _O(n,e){return w(this,null,function*(){return yr(n,"POST","/v1/accounts:delete",e)})}function Gh(n,e){return w(this,null,function*(){return yr(n,"POST","/v1/accounts:lookup",e)})}function eu(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function gg(n,e=!1){return w(this,null,function*(){let t=be(n),r=yield t.getIdToken(e),i=_g(r);se(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:eu(Wm(i.auth_time)),issuedAtTime:eu(Wm(i.iat)),expirationTime:eu(Wm(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Wm(n){return Number(n)*1e3}function _g(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Uh("JWT malformed, contained fewer than 3 sections"),null;try{let i=mh(t);return i?JSON.parse(i):(Uh("Failed to decode base64 JWT payload"),null)}catch(i){return Uh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function JT(n){let e=_g(n);return se(e,"internal-error"),se(typeof e.exp<"u","internal-error"),se(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function zo(n,e,t=!1){return w(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof jt&&yO(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function yO({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Ym=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>w(this,null,function*(){yield this.iteration()}),t)}iteration(){return w(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var nu=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=eu(this.lastLoginAt),this.creationTime=eu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Wh(n){return w(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield zo(n,Gh(t,{idToken:r}));se(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?pA(s.providerUserInfo):[],a=IO(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,d=u?h:!1,m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new nu(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,m)})}function yg(n){return w(this,null,function*(){let e=be(n);yield Wh(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function IO(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function pA(n){return n.map(e=>{var{providerId:t}=e,r=hh(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function EO(n,e){return w(this,null,function*(){let t=yield dA(n,{},()=>w(this,null,function*(){let r=Mo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=yield fA(n,i,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:a,body:r};return n.emulatorConfig&&or(n.emulatorConfig.host)&&(u.credentials="include"),zh.fetch()(o,u)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function wO(n,e){return w(this,null,function*(){return yr(n,"POST","/v2/accounts:revokeToken",Ei(n,e))})}var tu=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){se(e.idToken,"internal-error"),se(typeof e.idToken<"u","internal-error"),se(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):JT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){se(e.length!==0,"internal-error");let t=JT(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return w(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(se(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return w(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield EO(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&(se(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(se(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(se(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return pr("not implemented")}};function yi(n,e){se(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Ii=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=hh(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ym(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new nu(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return w(this,null,function*(){let t=yield zo(this,this.stsTokenManager.getToken(this.auth,e));return se(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return gg(this,e)}reload(){return yg(this)}_assign(e){this!==e&&(se(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){se(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return w(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Wh(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return w(this,null,function*(){if(Ct(this.auth.app))return Promise.reject(gr(this.auth));let e=yield this.getIdToken();return yield zo(this,_O(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,a,u,h,d;let m=(r=t.displayName)!==null&&r!==void 0?r:void 0,v=(i=t.email)!==null&&i!==void 0?i:void 0,C=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,k=(o=t.photoURL)!==null&&o!==void 0?o:void 0,V=(a=t.tenantId)!==null&&a!==void 0?a:void 0,N=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,q=(h=t.createdAt)!==null&&h!==void 0?h:void 0,G=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:$,emailVerified:te,isAnonymous:oe,providerData:Z,stsTokenManager:T}=t;se($&&T,e,"internal-error");let y=tu.fromJSON(this.name,T);se(typeof $=="string",e,"internal-error"),yi(m,e.name),yi(v,e.name),se(typeof te=="boolean",e,"internal-error"),se(typeof oe=="boolean",e,"internal-error"),yi(C,e.name),yi(k,e.name),yi(V,e.name),yi(N,e.name),yi(q,e.name),yi(G,e.name);let E=new n({uid:$,auth:e,email:v,emailVerified:te,displayName:m,isAnonymous:oe,photoURL:k,phoneNumber:C,tenantId:V,stsTokenManager:y,createdAt:q,lastLoginAt:G});return Z&&Array.isArray(Z)&&(E.providerData=Z.map(b=>Object.assign({},b))),N&&(E._redirectEventId=N),E}static _fromIdTokenResponse(e,t,r=!1){return w(this,null,function*(){let i=new tu;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Wh(s),s})}static _fromGetAccountInfoResponse(e,t,r){return w(this,null,function*(){let i=t.users[0];se(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?pA(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,a=new tu;a.updateFromIdToken(r);let u=new n({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new nu(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u})}};var YT=new Map;function mr(n){_r(n instanceof Function,"Expected a class definition");let e=YT.get(n);return e?(_r(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,YT.set(n,e),e)}var vO=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return w(this,null,function*(){return!0})}_set(t,r){return w(this,null,function*(){this.storage[t]=r})}_get(t){return w(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return w(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Xm=vO;function Bh(n,e,t){return`firebase:${n}:${e}:${t}`}var Kh=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=Bh(this.userKey,i.apiKey,s),this.fullPersistenceKey=Bh("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return w(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Gh(this.auth,{idToken:e}).catch(()=>{});return t?Ii._fromGetAccountInfoResponse(this.auth,t,e):null}return Ii._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return w(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return w(this,null,function*(){if(!t.length)return new n(mr(Xm),e,r);let i=(yield Promise.all(t.map(h=>w(this,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||mr(Xm),o=Bh(r,e.config.apiKey,e.name),a=null;for(let h of t)try{let d=yield h._get(o);if(d){let m;if(typeof d=="string"){let v=yield Gh(e,{idToken:d}).catch(()=>{});if(!v)break;m=yield Ii._fromGetAccountInfoResponse(e,v,d)}else m=Ii._fromJSON(e,d);h!==s&&(a=m),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,e,r):(s=u[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(h=>w(this,null,function*(){if(h!==s)try{yield h._remove(o)}catch{}}))),new n(s,e,r))})}};function XT(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yA(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(mA(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(EA(e))return"Blackberry";if(wA(e))return"Webos";if(gA(e))return"Safari";if((e.includes("chrome/")||_A(e))&&!e.includes("edge/"))return"Chrome";if(IA(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function mA(n=Ge()){return/firefox\//i.test(n)}function gA(n=Ge()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _A(n=Ge()){return/crios\//i.test(n)}function yA(n=Ge()){return/iemobile/i.test(n)}function IA(n=Ge()){return/android/i.test(n)}function EA(n=Ge()){return/blackberry/i.test(n)}function wA(n=Ge()){return/webos/i.test(n)}function Ig(n=Ge()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function TO(n=Ge()){var e;return Ig(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function AO(){return kv()&&document.documentMode===10}function vA(n=Ge()){return Ig(n)||IA(n)||wA(n)||EA(n)||/windows phone/i.test(n)||yA(n)}function TA(n,e=[]){let t;switch(n){case"Browser":t=XT(Ge());break;case"Worker":t=`${XT(Ge())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${di}/${r}`}var Zm=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,a)=>{try{let u=e(s);o(u)}catch(u){a(u)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return w(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function bO(t){return w(this,arguments,function*(n,e={}){return yr(n,"GET","/v2/passwordPolicy",Ei(n,e))})}var SO=6,eg=class{constructor(e){var t,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:SO,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,a;let u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),u}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var tg=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Hh(this),this.idTokenSubscription=new Hh(this),this.beforeStateQueue=new Zm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=hA,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=mr(t)),this._initializationPromise=this.queue(()=>w(this,null,function*(){var r,i,s;if(!this._deleted&&(this.persistenceManager=yield Kh.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return w(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return w(this,null,function*(){try{let t=yield Gh(this,{idToken:e}),r=yield Ii._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return w(this,null,function*(){var t;if(Ct(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=i?._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(i=u.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return se(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return w(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return w(this,null,function*(){try{yield Wh(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=hO()}_delete(){return w(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return w(this,null,function*(){if(Ct(this.app))return Promise.reject(gr(this));let t=e?be(e):null;return t&&se(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return w(this,null,function*(){if(!this._deleted)return e&&se(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>w(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return w(this,null,function*(){return Ct(this.app)?Promise.reject(gr(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Ct(this.app)?Promise.reject(gr(this)):this.queue(()=>w(this,null,function*(){yield this.assertedPersistence.setPersistence(mr(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return w(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return w(this,null,function*(){let e=yield bO(this),t=new eg(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new hn("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return w(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield wO(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return w(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return w(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&mr(e)||this._popupRedirectResolver;se(t,this,"argument-error"),this.redirectPersistenceManager=yield Kh.create(this,[mr(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return w(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>w(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return w(this,null,function*(){if(e===this.currentUser)return this.queue(()=>w(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(se(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return w(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return se(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=TA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return w(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return w(this,null,function*(){var e;if(Ct(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&aO(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function wi(n){return be(n)}var Hh=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ov(t=>this.observer=t)}get next(){return se(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var rd={loadJS(){return w(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function RO(n){rd=n}function AA(n){return rd.loadJS(n)}function PO(){return rd.recaptchaEnterpriseScript}function CO(){return rd.gapiScript}function bA(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var ng=class{constructor(){this.enterprise=new rg}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},rg=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var kO="recaptcha-enterprise",SA="NO_RECAPTCHA",ig=class{constructor(e){this.type=kO,this.auth=wi(e)}verify(e="verify",t=!1){return w(this,null,function*(){function r(s){return w(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,a)=>w(this,null,function*(){gO(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{let h=new Jm(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{a(u)})}))})}function i(s,o,a){let u=window.grecaptcha;QT(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(SA)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ng().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{r(this.auth).then(a=>{if(!t&&QT(window.grecaptcha))i(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=PO();u.length!==0&&(u+=a),AA(u).then(()=>{i(a,s,o)}).catch(h=>{o(h)})}}).catch(a=>{o(a)})})})}};function Zc(n,e,t,r=!1,i=!1){return w(this,null,function*(){let s=new ig(n),o;if(i)o=SA;else try{o=yield s.verify(t)}catch{o=yield s.verify(t,!0)}let a=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){let u=a.phoneEnrollmentInfo.phoneNumber,h=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let u=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a})}function sg(n,e,t,r,i){return w(this,null,function*(){var s,o;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let a=yield Zc(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(a=>w(this,null,function*(){if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let u=yield Zc(n,e,t,t==="getOobCode");return r(n,u)}else return Promise.reject(a)}));else if(i==="PHONE_PROVIDER")if(!((o=n._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){let a=yield Zc(n,e,t);return r(n,a).catch(u=>w(this,null,function*(){var h;if(((h=n._getRecaptchaConfig())===null||h===void 0?void 0:h.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(u.code==="auth/missing-recaptcha-token"||u.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let d=yield Zc(n,e,t,!1,!0);return r(n,d)}return Promise.reject(u)}))}else{let a=yield Zc(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(i+" provider is not supported.")})}function Eg(n,e){let t=hi(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(xt(s,e??{}))return i;en(i,"already-initialized")}return t.initialize({options:e})}function NO(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(mr);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function wg(n,e,t){let r=wi(n);se(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=RA(e),{host:o,port:a}=DO(e),u=a===null?"":`:${a}`,h={url:`${s}//${o}${u}/`},d=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){se(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),se(xt(h,r.config.emulator)&&xt(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,or(o)?(qc(`${s}//${o}${u}`),yh("Auth",!0)):i||OO()}function RA(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function DO(n){let e=RA(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:ZT(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:ZT(o)}}}function ZT(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function OO(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Go=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return pr("not implemented")}_getIdTokenResponse(e){return pr("not implemented")}_linkToIdToken(e,t){return pr("not implemented")}_getReauthenticationResolver(e){return pr("not implemented")}};function VO(n,e){return w(this,null,function*(){return yr(n,"POST","/v1/accounts:signUp",e)})}function xO(n,e){return w(this,null,function*(){return ou(n,"POST","/v1/accounts:signInWithPassword",Ei(n,e))})}function LO(n,e){return w(this,null,function*(){return ou(n,"POST","/v1/accounts:signInWithEmailLink",Ei(n,e))})}function MO(n,e){return w(this,null,function*(){return ou(n,"POST","/v1/accounts:signInWithEmailLink",Ei(n,e))})}var ru=class n extends Go{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return w(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return sg(e,t,"signInWithPassword",xO,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return LO(e,{email:this._email,oobCode:this._password});default:en(e,"internal-error")}})}_linkToIdToken(e,t){return w(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return sg(e,r,"signUpPassword",VO,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return MO(e,{idToken:t,email:this._email,oobCode:this._password});default:en(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function $o(n,e){return w(this,null,function*(){return ou(n,"POST","/v1/accounts:signInWithIdp",Ei(n,e))})}var FO="http://localhost",Qh=class n extends Go{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):en("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=hh(t,["providerId","signInMethod"]);if(!r||!i)return null;let o=new n(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return $o(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,$o(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,$o(e,t)}buildRequest(){let e={requestUri:FO,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Mo(t)}return e}};function UO(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function BO(n){let e=Fo(Uo(n)).link,t=e?Fo(Uo(e)).deep_link_id:null,r=Fo(Uo(n)).deep_link_id;return(r?Fo(Uo(r)).link:null)||r||t||e||n}var Jh=class n{constructor(e){var t,r,i,s,o,a;let u=Fo(Uo(e)),h=(t=u.apiKey)!==null&&t!==void 0?t:null,d=(r=u.oobCode)!==null&&r!==void 0?r:null,m=UO((i=u.mode)!==null&&i!==void 0?i:null);se(h&&d&&m,"argument-error"),this.apiKey=h,this.operation=m,this.code=d,this.continueUrl=(s=u.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=u.lang)!==null&&o!==void 0?o:null,this.tenantId=(a=u.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){let t=BO(e);try{return new n(t)}catch{return null}}};var PA=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return ru._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=Jh.parseLink(r);return se(i,"argument-error"),ru._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),iu=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Yh=class extends iu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var qO=(()=>{class n extends Yh{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return Qh._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();function jO(n,e){return w(this,null,function*(){return ou(n,"POST","/v1/accounts:signUp",Ei(n,e))})}var Wo=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return w(this,null,function*(){let s=yield Ii._fromIdTokenResponse(e,r,i),o=eA(r);return new n({user:s,providerId:o,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return w(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=eA(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function eA(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var og=class n extends jt{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function CA(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?og._fromErrorAndOperation(n,s,e,r):s})}function $O(n,e,t=!1){return w(this,null,function*(){let r=yield zo(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return Wo._forOperation(n,"link",r)})}function zO(n,e,t=!1){return w(this,null,function*(){let{auth:r}=n;if(Ct(r.app))return Promise.reject(gr(r));let i="reauthenticate";try{let s=yield zo(n,CA(r,i,e,n),t);se(s.idToken,r,"internal-error");let o=_g(s.idToken);se(o,r,"internal-error");let{sub:a}=o;return se(n.uid===a,r,"user-mismatch"),Wo._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&en(r,"user-mismatch"),s}})}function kA(n,e,t=!1){return w(this,null,function*(){if(Ct(n.app))return Promise.reject(gr(n));let r="signIn",i=yield CA(n,r,e),s=yield Wo._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function vg(n,e){return w(this,null,function*(){return kA(wi(n),e)})}function NA(n){return w(this,null,function*(){let e=wi(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function Tg(n,e,t){return w(this,null,function*(){if(Ct(n.app))return Promise.reject(gr(n));let r=wi(n),o=yield sg(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",jO,"EMAIL_PASSWORD_PROVIDER").catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&NA(n),u}),a=yield Wo._fromIdTokenResponse(r,"signIn",o);return yield r._updateCurrentUser(a.user),a})}function Ag(n,e,t){return Ct(n.app)?Promise.reject(gr(n)):vg(be(n),PA.credential(e,t)).catch(r=>w(this,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&NA(n),r}))}function GO(n,e){return w(this,null,function*(){return yr(n,"POST","/v1/accounts:update",e)})}function bg(r,i){return w(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=be(n),a={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},u=yield zo(s,GO(s.auth,a));s.displayName=u.displayName||null,s.photoURL=u.photoUrl||null;let h=s.providerData.find(({providerId:d})=>d==="password");h&&(h.displayName=s.displayName,h.photoURL=s.photoURL),yield s._updateTokensIfNecessary(u)})}function Sg(n,e,t,r){return be(n).onIdTokenChanged(e,t,r)}function Rg(n,e,t){return be(n).beforeAuthStateChanged(e,t)}function Pg(n){return be(n).signOut()}var Xh="__sak";var Zh=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Xh,"1"),this.storage.removeItem(Xh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var WO=1e3,KO=10,HO=(()=>{class n extends Zh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=vA(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((a,u,h)=>{this.notifyListeners(a,h)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let a=this.storage.getItem(i);!r&&this.localCache[i]===a||this.notifyListeners(i,a)},o=this.storage.getItem(i);AO()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,KO):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},WO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return w(this,null,function*(){yield Yt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return w(this,null,function*(){let r=yield Yt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return w(this,null,function*(){yield Yt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),DA=HO;var QO=(()=>{class n extends Zh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),Cg=QO;function JO(n){return Promise.all(n.map(e=>w(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var YO=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return w(this,null,function*(){let r=t,{eventId:i,eventType:s,data:o}=r.data,a=this.handlersMap[s];if(!a?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let u=Array.from(a).map(d=>w(this,null,function*(){return d(r.origin,o)})),h=yield JO(u);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function kg(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var ag=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return w(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,u)=>{let h=kg("",20);i.port1.start();let d=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(m){let v=m;if(v.data.eventId===h)switch(v.data.status){case"ack":clearTimeout(d),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(v.data.response);break;default:clearTimeout(d),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function Vn(){return window}function XO(n){Vn().location.href=n}function OA(){return typeof Vn().WorkerGlobalScope<"u"&&typeof Vn().importScripts=="function"}function ZO(){return w(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function eV(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function tV(){return OA()?self:null}var VA="firebaseLocalStorageDb",nV=1,ed="firebaseLocalStorage",xA="fbase_key",Ss=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function id(n,e){return n.transaction([ed],e?"readwrite":"readonly").objectStore(ed)}function rV(){let n=indexedDB.deleteDatabase(VA);return new Ss(n).toPromise()}function cg(){let n=indexedDB.open(VA,nV);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(ed,{keyPath:xA})}catch(i){t(i)}}),n.addEventListener("success",()=>w(this,null,function*(){let r=n.result;r.objectStoreNames.contains(ed)?e(r):(r.close(),yield rV(),e(yield cg()))}))})}function tA(n,e,t){return w(this,null,function*(){let r=id(n,!0).put({[xA]:e,value:t});return new Ss(r).toPromise()})}function iV(n,e){return w(this,null,function*(){let t=id(n,!1).get(e),r=yield new Ss(t).toPromise();return r===void 0?null:r.value})}function nA(n,e){let t=id(n,!0).delete(e);return new Ss(t).toPromise()}var sV=800,oV=3,aV=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return w(this,null,function*(){return this.db?this.db:(this.db=yield cg(),this.db)})}_withRetries(t){return w(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>oV)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return w(this,null,function*(){return OA()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return w(this,null,function*(){this.receiver=YO._getInstance(tV()),this.receiver._subscribe("keyChanged",(t,r)=>w(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>w(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return w(this,null,function*(){var t,r;if(this.activeServiceWorker=yield ZO(),!this.activeServiceWorker)return;this.sender=new ag(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return w(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||eV()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return w(this,null,function*(){try{if(!indexedDB)return!1;let t=yield cg();return yield tA(t,Xh,"1"),yield nA(t,Xh),!0}catch{}return!1})}_withPendingWrite(t){return w(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return w(this,null,function*(){return this._withPendingWrite(()=>w(this,null,function*(){return yield this._withRetries(i=>tA(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return w(this,null,function*(){let r=yield this._withRetries(i=>iV(i,t));return this.localCache[t]=r,r})}_remove(t){return w(this,null,function*(){return this._withPendingWrite(()=>w(this,null,function*(){return yield this._withRetries(r=>nA(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return w(this,null,function*(){let t=yield this._withRetries(s=>{let o=id(s,!1).getAll();return new Ss(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>w(this,null,function*(){return this._poll()}),sV)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),LA=aV;var dq=bA("rcb"),fq=new bs(3e4,6e4);function MA(n,e){return e?mr(e):(se(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var su=class extends Go{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return $o(e,this._buildIdpRequest())}_linkToIdToken(e,t){return $o(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return $o(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function cV(n){return kA(n.auth,new su(n),n.bypassAuthState)}function uV(n){let{auth:e,user:t}=n;return se(t,e,"internal-error"),zO(t,new su(n),n.bypassAuthState)}function lV(n){return w(this,null,function*(){let{auth:e,user:t}=n;return se(t,e,"internal-error"),$O(t,new su(n),n.bypassAuthState)})}var td=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>w(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return w(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(u))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cV;case"linkViaPopup":case"linkViaRedirect":return lV;case"reauthViaPopup":case"reauthViaRedirect":return uV;default:en(this.auth,"internal-error")}}resolve(e){_r(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_r(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var hV=new bs(2e3,1e4);function Ng(n,e,t){return w(this,null,function*(){if(Ct(n.app))return Promise.reject(mn(n,"operation-not-supported-in-this-environment"));let r=wi(n);cO(n,e,iu);let i=MA(r,t);return new dV(r,"signInViaPopup",e,i).executeNotNull()})}var dV=(()=>{class n extends td{constructor(t,r,i,s,o){super(t,r,s,o),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return w(this,null,function*(){let t=yield this.execute();return se(t,this.auth,"internal-error"),t})}onExecution(){return w(this,null,function*(){_r(this.filter.length===1,"Popup operations only handle one event");let t=kg();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(mn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(mn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let t=()=>{var r,i;if(!((i=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(mn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,hV.get())};t()}}n.currentPopupAction=null;return n})(),fV="pendingRedirect",qh=new Map,ug=class n extends td{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return w(this,null,function*(){let e=qh.get(this.auth._key());if(!e){try{let r=(yield pV(this.resolver,this.auth))?yield Yt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}qh.set(this.auth._key(),e)}return this.bypassAuthState||qh.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return w(this,null,function*(){if(e.type==="signInViaRedirect")return Yt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Yt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return w(this,null,function*(){})}cleanUp(){}};function pV(n,e){return w(this,null,function*(){let t=_V(e),r=gV(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function mV(n,e){qh.set(n._key(),e)}function gV(n){return mr(n._redirectPersistence)}function _V(n){return Bh(fV,n.config.apiKey,n.name)}function yV(n,e,t=!1){return w(this,null,function*(){if(Ct(n.app))return Promise.reject(gr(n));let r=wi(n),i=MA(r,e),o=yield new ug(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})}var IV=10*60*1e3,lg=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!EV(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!FA(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(mn(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=IV&&this.cachedEventUids.clear(),this.cachedEventUids.has(rA(e))}saveEventToCache(e){this.cachedEventUids.add(rA(e)),this.lastProcessedEventTime=Date.now()}};function rA(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function FA({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function EV(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return FA(n);default:return!1}}function wV(t){return w(this,arguments,function*(n,e={}){return yr(n,"GET","/v1/projects",e)})}var vV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,TV=/^https?/;function AV(n){return w(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield wV(n);for(let t of e)try{if(bV(t))return}catch{}en(n,"unauthorized-domain")})}function bV(n){let e=Hm(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!TV.test(t))return!1;if(vV.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var SV=new bs(3e4,6e4);function iA(){let n=Vn().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function RV(n){return new Promise((e,t)=>{var r,i,s;function o(){iA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{iA(),t(mn(n,"network-request-failed"))},timeout:SV.get()})}if(!((i=(r=Vn().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Vn().gapi)===null||s===void 0)&&s.load)o();else{let a=bA("iframefcb");return Vn()[a]=()=>{gapi.load?o():t(mn(n,"network-request-failed"))},AA(`${CO()}?onload=${a}`).catch(u=>t(u))}}).catch(e=>{throw jh=null,e})}var jh=null;function PV(n){return jh=jh||RV(n),jh}var CV=new bs(5e3,15e3),kV="__/auth/iframe",NV="emulator/auth/iframe",DV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},OV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function VV(n){let e=n.config;se(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?mg(e,NV):`https://${n.config.authDomain}/${kV}`,r={apiKey:e.apiKey,appName:n.name,v:di},i=OV.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Mo(r).slice(1)}`}function xV(n){return w(this,null,function*(){let e=yield PV(n),t=Vn().gapi;return se(t,n,"internal-error"),e.open({where:document.body,url:VV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:DV,dontclear:!0},r=>new Promise((i,s)=>w(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let o=mn(n,"network-request-failed"),a=Vn().setTimeout(()=>{s(o)},CV.get());function u(){Vn().clearTimeout(a),i(r)}r.ping(u).then(u,()=>{s(o)})})))})}var LV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},MV=500,FV=600,UV="_blank",BV="http://localhost",nd=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function qV(n,e,t,r=MV,i=FV){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),a="",u=Object.assign(Object.assign({},LV),{width:r.toString(),height:i.toString(),top:s,left:o}),h=Ge().toLowerCase();t&&(a=_A(h)?UV:t),mA(h)&&(e=e||BV,u.scrollbars="yes");let d=Object.entries(u).reduce((v,[C,k])=>`${v}${C}=${k},`,"");if(TO(h)&&a!=="_self")return jV(e||"",a),new nd(null);let m=window.open(e||"",a,d);se(m,n,"popup-blocked");try{m.focus()}catch{}return new nd(m)}function jV(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var $V="__/auth/handler",zV="emulator/auth/handler",GV=encodeURIComponent("fac");function sA(n,e,t,r,i,s){return w(this,null,function*(){se(n.config.authDomain,n,"auth-domain-config-required"),se(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:di,eventId:i};if(e instanceof iu){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Dv(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[d,m]of Object.entries(s||{}))o[d]=m}if(e instanceof Yh){let d=e.getScopes().filter(m=>m!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let d of Object.keys(a))a[d]===void 0&&delete a[d];let u=yield n._getAppCheckToken(),h=u?`#${GV}=${encodeURIComponent(u)}`:"";return`${WV(n)}?${Mo(a).slice(1)}${h}`})}function WV({config:n}){return n.emulator?mg(n,zV):`https://${n.authDomain}/${$V}`}var Km="webStorageSupport",hg=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Cg,this._completeRedirectFn=yV,this._overrideRedirectResult=mV}_openPopup(e,t,r,i){return w(this,null,function*(){var s;_r((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield sA(e,t,r,Hm(),i);return qV(e,o,kg())})}_openRedirect(e,t,r,i){return w(this,null,function*(){yield this._originValidation(e);let s=yield sA(e,t,r,Hm(),i);return XO(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(_r(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return w(this,null,function*(){let t=yield xV(e),r=new lg(e);return t.register("authEvent",i=>(se(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Km,{type:Km},i=>{var s;let o=(s=i?.[0])===null||s===void 0?void 0:s[Km];o!==void 0&&t(!!o),en(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=AV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return vA()||gA()||Ig()}},UA=hg;var oA="@firebase/auth",aA="1.10.8";var dg=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return w(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){se(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function KV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function HV(n){dn(new Pt("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;se(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let u={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:TA(n)},h=new tg(r,i,s,u);return NO(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),dn(new Pt("auth-internal",e=>{let t=wi(e.getProvider("auth").getImmediate());return(r=>new dg(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Be(oA,aA,KV(n)),Be(oA,aA,"esm2017")}var QV=5*60,JV=Jp("authIdTokenMaxAge")||QV,cA=null,YV=n=>e=>w(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>JV)return;let i=t?.token;cA!==i&&(cA=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function Dg(n=ys()){let e=hi(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Eg(n,{popupRedirectResolver:UA,persistence:[LA,DA,Cg]}),r=Jp("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=YV(s.toString());Rg(t,o,()=>o(t.currentUser)),Sg(t,a=>o(a))}}let i=Hp("auth");return i&&wg(t,`http://${i}`),t}function XV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}RO({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=mn("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",XV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});HV("Browser");var BA="auth",au=class{constructor(e){return e}},cu=class{constructor(){return Es(BA)}};var Og=new Vo("angularfire2.auth-instances");function Ux(n,e){let t=zc(BA,n,e);return t&&new au(t)}function Bx(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new au(r)}}var qx={provide:cu,deps:[[new Xt,Og]]},jx={provide:au,useFactory:Ux,deps:[[new Xt,Og],ur]};function e9(n,...e){return Be("angularfire",cr.full,"auth"),xo([jx,qx,{provide:Og,useFactory:Bx(n),multi:!0,deps:[kn,ui,fi,ws,[new Xt,qo],...e]}])}var t9=H(KT,!0);var n9=H(Tg,!0,2);var r9=H(Dg,!0);var i9=H(Ag,!0,2);var s9=H(Ng,!0,2);var o9=H(Pg,!0,2);var a9=H(bg,!0,2);var qA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jA={};var Ir,Vg;(function(){var n;function e(T,y){function E(){}E.prototype=y.prototype,T.F=y.prototype,T.prototype=new E,T.prototype.constructor=T,T.D=function(b,A,P){for(var I=Array(arguments.length-2),xe=2;xe<arguments.length;xe++)I[xe-2]=arguments[xe];return y.prototype[A].apply(b,I)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,y,E){E||(E=0);let b=Array(16);if(typeof y=="string")for(var A=0;A<16;++A)b[A]=y.charCodeAt(E++)|y.charCodeAt(E++)<<8|y.charCodeAt(E++)<<16|y.charCodeAt(E++)<<24;else for(A=0;A<16;++A)b[A]=y[E++]|y[E++]<<8|y[E++]<<16|y[E++]<<24;y=T.g[0],E=T.g[1],A=T.g[2];let P=T.g[3],I;I=y+(P^E&(A^P))+b[0]+3614090360&4294967295,y=E+(I<<7&4294967295|I>>>25),I=P+(A^y&(E^A))+b[1]+3905402710&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(E^P&(y^E))+b[2]+606105819&4294967295,A=P+(I<<17&4294967295|I>>>15),I=E+(y^A&(P^y))+b[3]+3250441966&4294967295,E=A+(I<<22&4294967295|I>>>10),I=y+(P^E&(A^P))+b[4]+4118548399&4294967295,y=E+(I<<7&4294967295|I>>>25),I=P+(A^y&(E^A))+b[5]+1200080426&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(E^P&(y^E))+b[6]+2821735955&4294967295,A=P+(I<<17&4294967295|I>>>15),I=E+(y^A&(P^y))+b[7]+4249261313&4294967295,E=A+(I<<22&4294967295|I>>>10),I=y+(P^E&(A^P))+b[8]+1770035416&4294967295,y=E+(I<<7&4294967295|I>>>25),I=P+(A^y&(E^A))+b[9]+2336552879&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(E^P&(y^E))+b[10]+4294925233&4294967295,A=P+(I<<17&4294967295|I>>>15),I=E+(y^A&(P^y))+b[11]+2304563134&4294967295,E=A+(I<<22&4294967295|I>>>10),I=y+(P^E&(A^P))+b[12]+1804603682&4294967295,y=E+(I<<7&4294967295|I>>>25),I=P+(A^y&(E^A))+b[13]+4254626195&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(E^P&(y^E))+b[14]+2792965006&4294967295,A=P+(I<<17&4294967295|I>>>15),I=E+(y^A&(P^y))+b[15]+1236535329&4294967295,E=A+(I<<22&4294967295|I>>>10),I=y+(A^P&(E^A))+b[1]+4129170786&4294967295,y=E+(I<<5&4294967295|I>>>27),I=P+(E^A&(y^E))+b[6]+3225465664&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^E&(P^y))+b[11]+643717713&4294967295,A=P+(I<<14&4294967295|I>>>18),I=E+(P^y&(A^P))+b[0]+3921069994&4294967295,E=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(E^A))+b[5]+3593408605&4294967295,y=E+(I<<5&4294967295|I>>>27),I=P+(E^A&(y^E))+b[10]+38016083&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^E&(P^y))+b[15]+3634488961&4294967295,A=P+(I<<14&4294967295|I>>>18),I=E+(P^y&(A^P))+b[4]+3889429448&4294967295,E=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(E^A))+b[9]+568446438&4294967295,y=E+(I<<5&4294967295|I>>>27),I=P+(E^A&(y^E))+b[14]+3275163606&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^E&(P^y))+b[3]+4107603335&4294967295,A=P+(I<<14&4294967295|I>>>18),I=E+(P^y&(A^P))+b[8]+1163531501&4294967295,E=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(E^A))+b[13]+2850285829&4294967295,y=E+(I<<5&4294967295|I>>>27),I=P+(E^A&(y^E))+b[2]+4243563512&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^E&(P^y))+b[7]+1735328473&4294967295,A=P+(I<<14&4294967295|I>>>18),I=E+(P^y&(A^P))+b[12]+2368359562&4294967295,E=A+(I<<20&4294967295|I>>>12),I=y+(E^A^P)+b[5]+4294588738&4294967295,y=E+(I<<4&4294967295|I>>>28),I=P+(y^E^A)+b[8]+2272392833&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^E)+b[11]+1839030562&4294967295,A=P+(I<<16&4294967295|I>>>16),I=E+(A^P^y)+b[14]+4259657740&4294967295,E=A+(I<<23&4294967295|I>>>9),I=y+(E^A^P)+b[1]+2763975236&4294967295,y=E+(I<<4&4294967295|I>>>28),I=P+(y^E^A)+b[4]+1272893353&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^E)+b[7]+4139469664&4294967295,A=P+(I<<16&4294967295|I>>>16),I=E+(A^P^y)+b[10]+3200236656&4294967295,E=A+(I<<23&4294967295|I>>>9),I=y+(E^A^P)+b[13]+681279174&4294967295,y=E+(I<<4&4294967295|I>>>28),I=P+(y^E^A)+b[0]+3936430074&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^E)+b[3]+3572445317&4294967295,A=P+(I<<16&4294967295|I>>>16),I=E+(A^P^y)+b[6]+76029189&4294967295,E=A+(I<<23&4294967295|I>>>9),I=y+(E^A^P)+b[9]+3654602809&4294967295,y=E+(I<<4&4294967295|I>>>28),I=P+(y^E^A)+b[12]+3873151461&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^E)+b[15]+530742520&4294967295,A=P+(I<<16&4294967295|I>>>16),I=E+(A^P^y)+b[2]+3299628645&4294967295,E=A+(I<<23&4294967295|I>>>9),I=y+(A^(E|~P))+b[0]+4096336452&4294967295,y=E+(I<<6&4294967295|I>>>26),I=P+(E^(y|~A))+b[7]+1126891415&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~E))+b[14]+2878612391&4294967295,A=P+(I<<15&4294967295|I>>>17),I=E+(P^(A|~y))+b[5]+4237533241&4294967295,E=A+(I<<21&4294967295|I>>>11),I=y+(A^(E|~P))+b[12]+1700485571&4294967295,y=E+(I<<6&4294967295|I>>>26),I=P+(E^(y|~A))+b[3]+2399980690&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~E))+b[10]+4293915773&4294967295,A=P+(I<<15&4294967295|I>>>17),I=E+(P^(A|~y))+b[1]+2240044497&4294967295,E=A+(I<<21&4294967295|I>>>11),I=y+(A^(E|~P))+b[8]+1873313359&4294967295,y=E+(I<<6&4294967295|I>>>26),I=P+(E^(y|~A))+b[15]+4264355552&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~E))+b[6]+2734768916&4294967295,A=P+(I<<15&4294967295|I>>>17),I=E+(P^(A|~y))+b[13]+1309151649&4294967295,E=A+(I<<21&4294967295|I>>>11),I=y+(A^(E|~P))+b[4]+4149444226&4294967295,y=E+(I<<6&4294967295|I>>>26),I=P+(E^(y|~A))+b[11]+3174756917&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~E))+b[2]+718787259&4294967295,A=P+(I<<15&4294967295|I>>>17),I=E+(P^(A|~y))+b[9]+3951481745&4294967295,T.g[0]=T.g[0]+y&4294967295,T.g[1]=T.g[1]+(A+(I<<21&4294967295|I>>>11))&4294967295,T.g[2]=T.g[2]+A&4294967295,T.g[3]=T.g[3]+P&4294967295}r.prototype.v=function(T,y){y===void 0&&(y=T.length);let E=y-this.blockSize,b=this.C,A=this.h,P=0;for(;P<y;){if(A==0)for(;P<=E;)i(this,T,P),P+=this.blockSize;if(typeof T=="string"){for(;P<y;)if(b[A++]=T.charCodeAt(P++),A==this.blockSize){i(this,b),A=0;break}}else for(;P<y;)if(b[A++]=T[P++],A==this.blockSize){i(this,b),A=0;break}}this.h=A,this.o+=y},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var y=1;y<T.length-8;++y)T[y]=0;y=this.o*8;for(var E=T.length-8;E<T.length;++E)T[E]=y&255,y/=256;for(this.v(T),T=Array(16),y=0,E=0;E<4;++E)for(let b=0;b<32;b+=8)T[y++]=this.g[E]>>>b&255;return T};function s(T,y){var E=a;return Object.prototype.hasOwnProperty.call(E,T)?E[T]:E[T]=y(T)}function o(T,y){this.h=y;let E=[],b=!0;for(let A=T.length-1;A>=0;A--){let P=T[A]|0;b&&P==y||(E[A]=P,b=!1)}this.g=E}var a={};function u(T){return-128<=T&&T<128?s(T,function(y){return new o([y|0],y<0?-1:0)}):new o([T|0],T<0?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return m;if(T<0)return N(h(-T));let y=[],E=1;for(let b=0;T>=E;b++)y[b]=T/E|0,E*=4294967296;return new o(y,0)}function d(T,y){if(T.length==0)throw Error("number format error: empty string");if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(T.charAt(0)=="-")return N(d(T.substring(1),y));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');let E=h(Math.pow(y,8)),b=m;for(let P=0;P<T.length;P+=8){var A=Math.min(8,T.length-P);let I=parseInt(T.substring(P,P+A),y);A<8?(A=h(Math.pow(y,A)),b=b.j(A).add(h(I))):(b=b.j(E),b=b.add(h(I)))}return b}var m=u(0),v=u(1),C=u(16777216);n=o.prototype,n.m=function(){if(V(this))return-N(this).m();let T=0,y=1;for(let E=0;E<this.g.length;E++){let b=this.i(E);T+=(b>=0?b:4294967296+b)*y,y*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(k(this))return"0";if(V(this))return"-"+N(this).toString(T);let y=h(Math.pow(T,6));var E=this;let b="";for(;;){let A=te(E,y).g;E=q(E,A.j(y));let P=((E.g.length>0?E.g[0]:E.h)>>>0).toString(T);if(E=A,k(E))return P+b;for(;P.length<6;)P="0"+P;b=P+b}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function k(T){if(T.h!=0)return!1;for(let y=0;y<T.g.length;y++)if(T.g[y]!=0)return!1;return!0}function V(T){return T.h==-1}n.l=function(T){return T=q(this,T),V(T)?-1:k(T)?0:1};function N(T){let y=T.g.length,E=[];for(let b=0;b<y;b++)E[b]=~T.g[b];return new o(E,~T.h).add(v)}n.abs=function(){return V(this)?N(this):this},n.add=function(T){let y=Math.max(this.g.length,T.g.length),E=[],b=0;for(let A=0;A<=y;A++){let P=b+(this.i(A)&65535)+(T.i(A)&65535),I=(P>>>16)+(this.i(A)>>>16)+(T.i(A)>>>16);b=I>>>16,P&=65535,I&=65535,E[A]=I<<16|P}return new o(E,E[E.length-1]&-2147483648?-1:0)};function q(T,y){return T.add(N(y))}n.j=function(T){if(k(this)||k(T))return m;if(V(this))return V(T)?N(this).j(N(T)):N(N(this).j(T));if(V(T))return N(this.j(N(T)));if(this.l(C)<0&&T.l(C)<0)return h(this.m()*T.m());let y=this.g.length+T.g.length,E=[];for(var b=0;b<2*y;b++)E[b]=0;for(b=0;b<this.g.length;b++)for(let A=0;A<T.g.length;A++){let P=this.i(b)>>>16,I=this.i(b)&65535,xe=T.i(A)>>>16,Dt=T.i(A)&65535;E[2*b+2*A]+=I*Dt,G(E,2*b+2*A),E[2*b+2*A+1]+=P*Dt,G(E,2*b+2*A+1),E[2*b+2*A+1]+=I*xe,G(E,2*b+2*A+1),E[2*b+2*A+2]+=P*xe,G(E,2*b+2*A+2)}for(T=0;T<y;T++)E[T]=E[2*T+1]<<16|E[2*T];for(T=y;T<2*y;T++)E[T]=0;return new o(E,0)};function G(T,y){for(;(T[y]&65535)!=T[y];)T[y+1]+=T[y]>>>16,T[y]&=65535,y++}function $(T,y){this.g=T,this.h=y}function te(T,y){if(k(y))throw Error("division by zero");if(k(T))return new $(m,m);if(V(T))return y=te(N(T),y),new $(N(y.g),N(y.h));if(V(y))return y=te(T,N(y)),new $(N(y.g),y.h);if(T.g.length>30){if(V(T)||V(y))throw Error("slowDivide_ only works with positive integers.");for(var E=v,b=y;b.l(T)<=0;)E=oe(E),b=oe(b);var A=Z(E,1),P=Z(b,1);for(b=Z(b,2),E=Z(E,2);!k(b);){var I=P.add(b);I.l(T)<=0&&(A=A.add(E),P=I),b=Z(b,1),E=Z(E,1)}return y=q(T,A.j(y)),new $(A,y)}for(A=m;T.l(y)>=0;){for(E=Math.max(1,Math.floor(T.m()/y.m())),b=Math.ceil(Math.log(E)/Math.LN2),b=b<=48?1:Math.pow(2,b-48),P=h(E),I=P.j(y);V(I)||I.l(T)>0;)E-=b,P=h(E),I=P.j(y);k(P)&&(P=v),A=A.add(P),T=q(T,I)}return new $(A,T)}n.B=function(T){return te(this,T).h},n.and=function(T){let y=Math.max(this.g.length,T.g.length),E=[];for(let b=0;b<y;b++)E[b]=this.i(b)&T.i(b);return new o(E,this.h&T.h)},n.or=function(T){let y=Math.max(this.g.length,T.g.length),E=[];for(let b=0;b<y;b++)E[b]=this.i(b)|T.i(b);return new o(E,this.h|T.h)},n.xor=function(T){let y=Math.max(this.g.length,T.g.length),E=[];for(let b=0;b<y;b++)E[b]=this.i(b)^T.i(b);return new o(E,this.h^T.h)};function oe(T){let y=T.g.length+1,E=[];for(let b=0;b<y;b++)E[b]=T.i(b)<<1|T.i(b-1)>>>31;return new o(E,T.h)}function Z(T,y){let E=y>>5;y%=32;let b=T.g.length-E,A=[];for(let P=0;P<b;P++)A[P]=y>0?T.i(P+E)>>>y|T.i(P+E+1)<<32-y:T.i(P+E);return new o(A,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Vg=jA.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,Ir=jA.Integer=o}).apply(typeof qA<"u"?qA:typeof self<"u"?self:typeof window<"u"?window:{});var sd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Er={};var xg,$x,Ko,Lg,uu,od,Mg,Fg,Ug;(function(){var n,e=Object.defineProperty;function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof sd=="object"&&sd];for(var p=0;p<l.length;++p){var _=l[p];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var r=t(this);function i(l,p){if(p)e:{var _=r;l=l.split(".");for(var R=0;R<l.length-1;R++){var D=l[R];if(!(D in _))break e;_=_[D]}l=l[l.length-1],R=_[l],p=p(R),p!=R&&p!=null&&e(_,l,{configurable:!0,writable:!0,value:p})}}i("Symbol.dispose",function(l){return l||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(l){return l||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(l){return l||function(p){var _=[],R;for(R in p)Object.prototype.hasOwnProperty.call(p,R)&&_.push([R,p[R]]);return _}});var s=s||{},o=this||self;function a(l){var p=typeof l;return p=="object"&&l!=null||p=="function"}function u(l,p,_){return l.call.apply(l.bind,arguments)}function h(l,p,_){return h=u,h.apply(null,arguments)}function d(l,p){var _=Array.prototype.slice.call(arguments,1);return function(){var R=_.slice();return R.push.apply(R,arguments),l.apply(this,R)}}function m(l,p){function _(){}_.prototype=p.prototype,l.Z=p.prototype,l.prototype=new _,l.prototype.constructor=l,l.Ob=function(R,D,M){for(var W=Array(arguments.length-2),ae=2;ae<arguments.length;ae++)W[ae-2]=arguments[ae];return p.prototype[D].apply(R,W)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?l=>l&&AsyncContext.Snapshot.wrap(l):l=>l;function C(l){let p=l.length;if(p>0){let _=Array(p);for(let R=0;R<p;R++)_[R]=l[R];return _}return[]}function k(l,p){for(let R=1;R<arguments.length;R++){let D=arguments[R];var _=typeof D;if(_=_!="object"?_:D?Array.isArray(D)?"array":_:"null",_=="array"||_=="object"&&typeof D.length=="number"){_=l.length||0;let M=D.length||0;l.length=_+M;for(let W=0;W<M;W++)l[_+W]=D[W]}else l.push(D)}}class V{constructor(p,_){this.i=p,this.j=_,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function N(l){o.setTimeout(()=>{throw l},0)}function q(){var l=T;let p=null;return l.g&&(p=l.g,l.g=l.g.next,l.g||(l.h=null),p.next=null),p}class G{constructor(){this.h=this.g=null}add(p,_){let R=$.get();R.set(p,_),this.h?this.h.next=R:this.g=R,this.h=R}}var $=new V(()=>new te,l=>l.reset());class te{constructor(){this.next=this.g=this.h=null}set(p,_){this.h=p,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let oe,Z=!1,T=new G,y=()=>{let l=Promise.resolve(void 0);oe=()=>{l.then(E)}};function E(){for(var l;l=q();){try{l.h.call(l.g)}catch(_){N(_)}var p=$;p.j(l),p.h<100&&(p.h++,l.next=p.g,p.g=l)}Z=!1}function b(){this.u=this.u,this.C=this.C}b.prototype.u=!1,b.prototype.dispose=function(){this.u||(this.u=!0,this.N())},b.prototype[Symbol.dispose]=function(){this.dispose()},b.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function A(l,p){this.type=l,this.g=this.target=p,this.defaultPrevented=!1}A.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var l=!1,p=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let _=()=>{};o.addEventListener("test",_,p),o.removeEventListener("test",_,p)}catch{}return l}();function I(l){return/^[\s\xa0]*$/.test(l)}function xe(l,p){A.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l&&this.init(l,p)}m(xe,A),xe.prototype.init=function(l,p){let _=this.type=l.type,R=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;this.target=l.target||l.srcElement,this.g=p,p=l.relatedTarget,p||(_=="mouseover"?p=l.fromElement:_=="mouseout"&&(p=l.toElement)),this.relatedTarget=p,R?(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=l.pointerType,this.state=l.state,this.i=l,l.defaultPrevented&&xe.Z.h.call(this)},xe.prototype.h=function(){xe.Z.h.call(this);let l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Dt="closure_listenable_"+(Math.random()*1e6|0),Vp=0;function Yi(l,p,_,R,D){this.listener=l,this.proxy=null,this.src=p,this.type=_,this.capture=!!R,this.ha=D,this.key=++Vp,this.da=this.fa=!1}function Tn(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Br(l,p,_){for(let R in l)p.call(_,l[R],R,l)}function Fl(l,p){for(let _ in l)p.call(void 0,l[_],_,l)}function Ul(l){let p={};for(let _ in l)p[_]=l[_];return p}let rn="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ot(l,p){let _,R;for(let D=1;D<arguments.length;D++){R=arguments[D];for(_ in R)l[_]=R[_];for(let M=0;M<rn.length;M++)_=rn[M],Object.prototype.hasOwnProperty.call(R,_)&&(l[_]=R[_])}}function ao(l){this.src=l,this.g={},this.h=0}ao.prototype.add=function(l,p,_,R,D){let M=l.toString();l=this.g[M],l||(l=this.g[M]=[],this.h++);let W=mc(l,p,R,D);return W>-1?(p=l[W],_||(p.fa=!1)):(p=new Yi(p,this.src,M,!!R,D),p.fa=_,l.push(p)),p};function Qn(l,p){let _=p.type;if(_ in l.g){var R=l.g[_],D=Array.prototype.indexOf.call(R,p,void 0),M;(M=D>=0)&&Array.prototype.splice.call(R,D,1),M&&(Tn(p),l.g[_].length==0&&(delete l.g[_],l.h--))}}function mc(l,p,_,R){for(let D=0;D<l.length;++D){let M=l[D];if(!M.da&&M.listener==p&&M.capture==!!_&&M.ha==R)return D}return-1}var Jn="closure_lm_"+(Math.random()*1e6|0),gc={};function Bl(l,p,_,R,D){if(R&&R.once)return uo(l,p,_,R,D);if(Array.isArray(p)){for(let M=0;M<p.length;M++)Bl(l,p[M],_,R,D);return null}return _=po(_),l&&l[Dt]?l.J(p,_,a(R)?!!R.capture:!!R,D):Xi(l,p,_,!1,R,D)}function Xi(l,p,_,R,D,M){if(!p)throw Error("Invalid event type");let W=a(D)?!!D.capture:!!D,ae=fo(l);if(ae||(l[Jn]=ae=new ao(l)),_=ae.add(p,_,R,W,M),_.proxy)return _;if(R=co(),_.proxy=R,R.src=l,R.listener=_,l.addEventListener)P||(D=W),D===void 0&&(D=!1),l.addEventListener(p.toString(),R,D);else if(l.attachEvent)l.attachEvent(ho(p.toString()),R);else if(l.addListener&&l.removeListener)l.addListener(R);else throw Error("addEventListener and attachEvent are unavailable.");return _}function co(){function l(_){return p.call(l.src,l.listener,_)}let p=ql;return l}function uo(l,p,_,R,D){if(Array.isArray(p)){for(let M=0;M<p.length;M++)uo(l,p[M],_,R,D);return null}return _=po(_),l&&l[Dt]?l.K(p,_,a(R)?!!R.capture:!!R,D):Xi(l,p,_,!0,R,D)}function lo(l,p,_,R,D){if(Array.isArray(p))for(var M=0;M<p.length;M++)lo(l,p[M],_,R,D);else R=a(R)?!!R.capture:!!R,_=po(_),l&&l[Dt]?(l=l.i,M=String(p).toString(),M in l.g&&(p=l.g[M],_=mc(p,_,R,D),_>-1&&(Tn(p[_]),Array.prototype.splice.call(p,_,1),p.length==0&&(delete l.g[M],l.h--)))):l&&(l=fo(l))&&(p=l.g[p.toString()],l=-1,p&&(l=mc(p,_,R,D)),(_=l>-1?p[l]:null)&&Zi(_))}function Zi(l){if(typeof l!="number"&&l&&!l.da){var p=l.src;if(p&&p[Dt])Qn(p.i,l);else{var _=l.type,R=l.proxy;p.removeEventListener?p.removeEventListener(_,R,l.capture):p.detachEvent?p.detachEvent(ho(_),R):p.addListener&&p.removeListener&&p.removeListener(R),(_=fo(p))?(Qn(_,l),_.h==0&&(_.src=null,p[Jn]=null)):Tn(l)}}}function ho(l){return l in gc?gc[l]:gc[l]="on"+l}function ql(l,p){if(l.da)l=!0;else{p=new xe(p,this);let _=l.listener,R=l.ha||l.src;l.fa&&Zi(l),l=_.call(R,p)}return l}function fo(l){return l=l[Jn],l instanceof ao?l:null}var _c="__closure_events_fn_"+(Math.random()*1e9>>>0);function po(l){return typeof l=="function"?l:(l[_c]||(l[_c]=function(p){return l.handleEvent(p)}),l[_c])}function at(){b.call(this),this.i=new ao(this),this.M=this,this.G=null}m(at,b),at.prototype[Dt]=!0,at.prototype.removeEventListener=function(l,p,_,R){lo(this,l,p,_,R)};function ct(l,p){var _,R=l.G;if(R)for(_=[];R;R=R.G)_.push(R);if(l=l.M,R=p.type||p,typeof p=="string")p=new A(p,l);else if(p instanceof A)p.target=p.target||l;else{var D=p;p=new A(R,l),ot(p,D)}D=!0;let M,W;if(_)for(W=_.length-1;W>=0;W--)M=p.g=_[W],D=es(M,R,!0,p)&&D;if(M=p.g=l,D=es(M,R,!0,p)&&D,D=es(M,R,!1,p)&&D,_)for(W=0;W<_.length;W++)M=p.g=_[W],D=es(M,R,!1,p)&&D}at.prototype.N=function(){if(at.Z.N.call(this),this.i){var l=this.i;for(let p in l.g){let _=l.g[p];for(let R=0;R<_.length;R++)Tn(_[R]);delete l.g[p],l.h--}}this.G=null},at.prototype.J=function(l,p,_,R){return this.i.add(String(l),p,!1,_,R)},at.prototype.K=function(l,p,_,R){return this.i.add(String(l),p,!0,_,R)};function es(l,p,_,R){if(p=l.i.g[String(p)],!p)return!0;p=p.concat();let D=!0;for(let M=0;M<p.length;++M){let W=p[M];if(W&&!W.da&&W.capture==_){let ae=W.listener,c=W.ha||W.src;W.fa&&Qn(l.i,W),D=ae.call(c,R)!==!1&&D}}return D&&!R.defaultPrevented}function xp(l,p){if(typeof l!="function")if(l&&typeof l.handleEvent=="function")l=h(l.handleEvent,l);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:o.setTimeout(l,p||0)}function mo(l){l.g=xp(()=>{l.g=null,l.i&&(l.i=!1,mo(l))},l.l);let p=l.h;l.h=null,l.m.apply(null,p)}class yc extends b{constructor(p,_){super(),this.m=p,this.l=_,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:mo(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yn(l){b.call(this),this.h=l,this.g={}}m(Yn,b);var ut=[];function pt(l){Br(l.g,function(p,_){this.g.hasOwnProperty(_)&&Zi(p)},l),l.g={}}Yn.prototype.N=function(){Yn.Z.N.call(this),pt(this)},Yn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var qr=o.JSON.stringify,jl=o.JSON.parse,$l=class{stringify(l){return o.JSON.stringify(l,void 0)}parse(l){return o.JSON.parse(l,void 0)}};function zl(){}function jr(){}var $r={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function go(){A.call(this,"d")}m(go,A);function ts(){A.call(this,"c")}m(ts,A);var Xn={},Gl=null;function zr(){return Gl=Gl||new at}Xn.Ia="serverreachability";function Ic(l){A.call(this,Xn.Ia,l)}m(Ic,A);function Gr(l){let p=zr();ct(p,new Ic(p))}Xn.STAT_EVENT="statevent";function Wr(l,p){A.call(this,Xn.STAT_EVENT,l),this.stat=p}m(Wr,A);function lt(l){let p=zr();ct(p,new Wr(p,l))}Xn.Ja="timingevent";function _o(l,p){A.call(this,Xn.Ja,l),this.size=p}m(_o,A);function Ft(l,p){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){l()},p)}function Kr(){this.g=!0}Kr.prototype.ua=function(){this.g=!1};function yo(l,p,_,R,D,M){l.info(function(){if(l.g)if(M){var W="",ae=M.split("&");for(let f=0;f<ae.length;f++){var c=ae[f].split("=");if(c.length>1){let g=c[0];c=c[1];let S=g.split("_");W=S.length>=2&&S[1]=="type"?W+(g+"="+c+"&"):W+(g+"=redacted&")}}}else W=null;else W=M;return"XMLHTTP REQ ("+R+") [attempt "+D+"]: "+p+`
`+_+`
`+W})}function Wl(l,p,_,R,D,M,W){l.info(function(){return"XMLHTTP RESP ("+R+") [ attempt "+D+"]: "+p+`
`+_+`
`+M+" "+W})}function Qt(l,p,_,R){l.info(function(){return"XMLHTTP TEXT ("+p+"): "+_t(l,_)+(R?" "+R:"")})}function Kl(l,p){l.info(function(){return"TIMEOUT: "+p})}Kr.prototype.info=function(){};function _t(l,p){if(!l.g)return p;if(!p)return null;try{let M=JSON.parse(p);if(M){for(l=0;l<M.length;l++)if(Array.isArray(M[l])){var _=M[l];if(!(_.length<2)){var R=_[1];if(Array.isArray(R)&&!(R.length<1)){var D=R[0];if(D!="noop"&&D!="stop"&&D!="close")for(let W=1;W<R.length;W++)R[W]=""}}}}return qr(M)}catch{return p}}var ns={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Hr={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Qr;function Ec(){}m(Ec,zl),Ec.prototype.g=function(){return new XMLHttpRequest},Qr=new Ec;function rs(l){return encodeURIComponent(String(l))}function Jr(l){var p=1;l=l.split(":");let _=[];for(;p>0&&l.length;)_.push(l.shift()),p--;return l.length&&_.push(l.join(":")),_}function An(l,p,_,R){this.j=l,this.i=p,this.l=_,this.S=R||1,this.V=new Yn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Hl}function Hl(){this.i=null,this.g="",this.h=!1}var is={},Io={};function ss(l,p,_){l.M=1,l.A=us(Ut(p)),l.u=_,l.R=!0,os(l,null)}function os(l,p){l.F=Date.now(),Yr(l),l.B=Ut(l.A);var _=l.B,R=l.S;Array.isArray(R)||(R=[String(R)]),eh(_.i,"t",R),l.C=0,_=l.j.L,l.h=new Hl,l.g=Do(l.j,_?p:null,!l.u),l.P>0&&(l.O=new yc(h(l.Y,l,l.g),l.P)),p=l.V,_=l.g,R=l.ba;var D="readystatechange";Array.isArray(D)||(D&&(ut[0]=D.toString()),D=ut);for(let M=0;M<D.length;M++){let W=Bl(_,D[M],R||p.handleEvent,!1,p.h||p);if(!W)break;p.g[W.key]=W}p=l.J?Ul(l.J):{},l.u?(l.v||(l.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.B,l.v,l.u,p)):(l.v="GET",l.g.ea(l.B,l.v,null,p)),Gr(),yo(l.i,l.v,l.B,l.l,l.S,l.u)}An.prototype.ba=function(l){l=l.target;let p=this.O;p&&Ae(l)==3?p.j():this.Y(l)},An.prototype.Y=function(l){try{if(l==this.g)e:{let ae=Ae(this.g),c=this.g.ya(),f=this.g.ca();if(!(ae<3)&&(ae!=3||this.g&&(this.h.h||this.g.la()||ah(this.g)))){this.K||ae!=4||c==7||(c==8||f<=0?Gr(3):Gr(2)),wo(this);var p=this.g.ca();this.X=p;var _=bn(this);if(this.o=p==200,Wl(this.i,this.v,this.B,this.l,this.S,ae,p),this.o){if(this.U&&!this.L){t:{if(this.g){var R,D=this.g;if((R=D.g?D.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(R)){var M=R;break t}}M=null}if(l=M)Qt(this.i,this.l,l,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Zr(this,l);else{this.o=!1,this.m=3,lt(12),Zn(this),Xr(this);break e}}if(this.R){l=!0;let g;for(;!this.K&&this.C<_.length;)if(g=Ql(this,_),g==Io){ae==4&&(this.m=4,lt(14),l=!1),Qt(this.i,this.l,null,"[Incomplete Response]");break}else if(g==is){this.m=4,lt(15),Qt(this.i,this.l,_,"[Invalid Chunk]"),l=!1;break}else Qt(this.i,this.l,g,null),Zr(this,g);if(wc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ae!=4||_.length!=0||this.h.h||(this.m=1,lt(16),l=!1),this.o=this.o&&l,!l)Qt(this.i,this.l,_,"[Invalid Chunked Response]"),Zn(this),Xr(this);else if(_.length>0&&!this.W){this.W=!0;var W=this.j;W.g==this&&W.aa&&!W.P&&(W.j.info("Great, no buffering proxy detected. Bytes received: "+_.length),Co(W),W.P=!0,lt(11))}}else Qt(this.i,this.l,_,null),Zr(this,_);ae==4&&Zn(this),this.o&&!this.K&&(ae==4?Vc(this.j,this):(this.o=!1,Yr(this)))}else Lp(this.g),p==400&&_.indexOf("Unknown SID")>0?(this.m=3,lt(12)):(this.m=0,lt(13)),Zn(this),Xr(this)}}}catch{}finally{}};function bn(l){if(!wc(l))return l.g.la();let p=ah(l.g);if(p==="")return"";let _="",R=p.length,D=Ae(l.g)==4;if(!l.h.i){if(typeof TextDecoder>"u")return Zn(l),Xr(l),"";l.h.i=new o.TextDecoder}for(let M=0;M<R;M++)l.h.h=!0,_+=l.h.i.decode(p[M],{stream:!(D&&M==R-1)});return p.length=0,l.h.g+=_,l.C=0,l.h.g}function wc(l){return l.g?l.v=="GET"&&l.M!=2&&l.j.Aa:!1}function Ql(l,p){var _=l.C,R=p.indexOf(`
`,_);return R==-1?Io:(_=Number(p.substring(_,R)),isNaN(_)?is:(R+=1,R+_>p.length?Io:(p=p.slice(R,R+_),l.C=R+_,p)))}An.prototype.cancel=function(){this.K=!0,Zn(this)};function Yr(l){l.T=Date.now()+l.H,Eo(l,l.H)}function Eo(l,p){if(l.D!=null)throw Error("WatchDog timer not null");l.D=Ft(h(l.aa,l),p)}function wo(l){l.D&&(o.clearTimeout(l.D),l.D=null)}An.prototype.aa=function(){this.D=null;let l=Date.now();l-this.T>=0?(Kl(this.i,this.B),this.M!=2&&(Gr(),lt(17)),Zn(this),this.m=2,Xr(this)):Eo(this,this.T-l)};function Xr(l){l.j.I==0||l.K||Vc(l.j,l)}function Zn(l){wo(l);var p=l.O;p&&typeof p.dispose=="function"&&p.dispose(),l.O=null,pt(l.V),l.g&&(p=l.g,l.g=null,p.abort(),p.dispose())}function Zr(l,p){try{var _=l.j;if(_.I!=0&&(_.g==l||as(_.h,l))){if(!l.L&&as(_.h,l)&&_.I==3){try{var R=_.Ba.g.parse(p)}catch{R=null}if(Array.isArray(R)&&R.length==3){var D=R;if(D[0]==0){e:if(!_.v){if(_.g)if(_.g.F+3e3<l.F)ko(_),er(_);else break e;ai(_),lt(18)}}else _.xa=D[1],0<_.xa-_.K&&D[2]<37500&&_.F&&_.A==0&&!_.C&&(_.C=Ft(h(_.Va,_),6e3));Sn(_.h)<=1&&_.ta&&(_.ta=void 0)}else Pn(_,11)}else if((l.L||_.g==l)&&ko(_),!I(p))for(D=_.Ba.g.parse(p),p=0;p<D.length;p++){let f=D[p],g=f[0];if(!(g<=_.K))if(_.K=g,f=f[1],_.I==2)if(f[0]=="c"){_.M=f[1],_.ba=f[2];let S=f[3];S!=null&&(_.ka=S,_.j.info("VER="+_.ka));let O=f[4];O!=null&&(_.za=O,_.j.info("SVER="+_.za));let F=f[5];F!=null&&typeof F=="number"&&F>0&&(R=1.5*F,_.O=R,_.j.info("backChannelRequestTimeoutMs_="+R)),R=_;let z=l.g;if(z){let ve=z.g?z.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ve){var M=R.h;M.g||ve.indexOf("spdy")==-1&&ve.indexOf("quic")==-1&&ve.indexOf("h2")==-1||(M.j=M.l,M.g=new Set,M.h&&(vc(M,M.h),M.h=null))}if(R.G){let ze=z.g?z.g.getResponseHeader("X-HTTP-Session-Id"):null;ze&&(R.wa=ze,Ce(R.J,R.G,ze))}}_.I=3,_.l&&_.l.ra(),_.aa&&(_.T=Date.now()-l.F,_.j.info("Handshake RTT: "+_.T+"ms")),R=_;var W=l;if(R.na=No(R,R.L?R.ba:null,R.W),W.L){Tc(R.h,W);var ae=W,c=R.O;c&&(ae.H=c),ae.D&&(wo(ae),Yr(ae)),R.g=W}else Po(R);_.i.length>0&&Vt(_)}else f[0]!="stop"&&f[0]!="close"||Pn(_,7);else _.I==3&&(f[0]=="stop"||f[0]=="close"?f[0]=="stop"?Pn(_,7):Ro(_):f[0]!="noop"&&_.l&&_.l.qa(f),_.A=0)}}Gr(4)}catch{}}var Jl=class{constructor(l,p){this.g=l,this.map=p}};function vo(l){this.l=l||10,o.PerformanceNavigationTiming?(l=o.performance.getEntriesByType("navigation"),l=l.length>0&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ei(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function Sn(l){return l.h?1:l.g?l.g.size:0}function as(l,p){return l.h?l.h==p:l.g?l.g.has(p):!1}function vc(l,p){l.g?l.g.add(p):l.h=p}function Tc(l,p){l.h&&l.h==p?l.h=null:l.g&&l.g.has(p)&&l.g.delete(p)}vo.prototype.cancel=function(){if(this.i=Ac(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function Ac(l){if(l.h!=null)return l.i.concat(l.h.G);if(l.g!=null&&l.g.size!==0){let p=l.i;for(let _ of l.g.values())p=p.concat(_.G);return p}return C(l.i)}var bc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Sc(l,p){if(l){l=l.split("&");for(let _=0;_<l.length;_++){let R=l[_].indexOf("="),D,M=null;R>=0?(D=l[_].substring(0,R),M=l[_].substring(R+1)):D=l[_],p(D,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function Jt(l){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;l instanceof Jt?(this.l=l.l,ti(this,l.j),this.o=l.o,this.g=l.g,cs(this,l.u),this.h=l.h,Rc(this,th(l.i)),this.m=l.m):l&&(p=String(l).match(bc))?(this.l=!1,ti(this,p[1]||"",!0),this.o=ls(p[2]||""),this.g=ls(p[3]||"",!0),cs(this,p[4]),this.h=ls(p[5]||"",!0),Rc(this,p[6]||"",!0),this.m=ls(p[7]||"")):(this.l=!1,this.i=new on(null,this.l))}Jt.prototype.toString=function(){let l=[];var p=this.j;p&&l.push(Bt(p,hs,!0),":");var _=this.g;return(_||p=="file")&&(l.push("//"),(p=this.o)&&l.push(Bt(p,hs,!0),"@"),l.push(rs(_).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.u,_!=null&&l.push(":",String(_))),(_=this.h)&&(this.g&&_.charAt(0)!="/"&&l.push("/"),l.push(Bt(_,_.charAt(0)=="/"?Yl:To,!0))),(_=this.i.toString())&&l.push("?",_),(_=this.m)&&l.push("#",Bt(_,Ao)),l.join("")},Jt.prototype.resolve=function(l){let p=Ut(this),_=!!l.j;_?ti(p,l.j):_=!!l.o,_?p.o=l.o:_=!!l.g,_?p.g=l.g:_=l.u!=null;var R=l.h;if(_)cs(p,l.u);else if(_=!!l.h){if(R.charAt(0)!="/")if(this.g&&!this.h)R="/"+R;else{var D=p.h.lastIndexOf("/");D!=-1&&(R=p.h.slice(0,D+1)+R)}if(D=R,D==".."||D==".")R="";else if(D.indexOf("./")!=-1||D.indexOf("/.")!=-1){R=D.lastIndexOf("/",0)==0,D=D.split("/");let M=[];for(let W=0;W<D.length;){let ae=D[W++];ae=="."?R&&W==D.length&&M.push(""):ae==".."?((M.length>1||M.length==1&&M[0]!="")&&M.pop(),R&&W==D.length&&M.push("")):(M.push(ae),R=!0)}R=M.join("/")}else R=D}return _?p.h=R:_=l.i.toString()!=="",_?Rc(p,th(l.i)):_=!!l.m,_&&(p.m=l.m),p};function Ut(l){return new Jt(l)}function ti(l,p,_){l.j=_?ls(p,!0):p,l.j&&(l.j=l.j.replace(/:$/,""))}function cs(l,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);l.u=p}else l.u=null}function Rc(l,p,_){p instanceof on?(l.i=p,ds(l.i,l.l)):(_||(p=Bt(p,De)),l.i=new on(p,l.l))}function Ce(l,p,_){l.i.set(p,_)}function us(l){return Ce(l,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),l}function ls(l,p){return l?p?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Bt(l,p,_){return typeof l=="string"?(l=encodeURI(l).replace(p,sn),_&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function sn(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var hs=/[#\/\?@]/g,To=/[#\?:]/g,Yl=/[#\?]/g,De=/[#\?@]/g,Ao=/#/g;function on(l,p){this.h=this.g=null,this.i=l||null,this.j=!!p}function qt(l){l.g||(l.g=new Map,l.h=0,l.i&&Sc(l.i,function(p,_){l.add(decodeURIComponent(p.replace(/\+/g," ")),_)}))}n=on.prototype,n.add=function(l,p){qt(this),this.i=null,l=ni(this,l);let _=this.g.get(l);return _||this.g.set(l,_=[]),_.push(p),this.h+=1,this};function Xl(l,p){qt(l),p=ni(l,p),l.g.has(p)&&(l.i=null,l.h-=l.g.get(p).length,l.g.delete(p))}function Pc(l,p){return qt(l),p=ni(l,p),l.g.has(p)}n.forEach=function(l,p){qt(this),this.g.forEach(function(_,R){_.forEach(function(D){l.call(p,D,R,this)},this)},this)};function Zl(l,p){qt(l);let _=[];if(typeof p=="string")Pc(l,p)&&(_=_.concat(l.g.get(ni(l,p))));else for(l=Array.from(l.g.values()),p=0;p<l.length;p++)_=_.concat(l[p]);return _}n.set=function(l,p){return qt(this),this.i=null,l=ni(this,l),Pc(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[p]),this.h+=1,this},n.get=function(l,p){return l?(l=Zl(this,l),l.length>0?String(l[0]):p):p};function eh(l,p,_){Xl(l,p),_.length>0&&(l.i=null,l.g.set(ni(l,p),C(_)),l.h+=_.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],p=Array.from(this.g.keys());for(let R=0;R<p.length;R++){var _=p[R];let D=rs(_);_=Zl(this,_);for(let M=0;M<_.length;M++){let W=D;_[M]!==""&&(W+="="+rs(_[M])),l.push(W)}}return this.i=l.join("&")};function th(l){let p=new on;return p.i=l.i,l.g&&(p.g=new Map(l.g),p.h=l.h),p}function ni(l,p){return p=String(p),l.j&&(p=p.toLowerCase()),p}function ds(l,p){p&&!l.j&&(qt(l),l.i=null,l.g.forEach(function(_,R){let D=R.toLowerCase();R!=D&&(Xl(this,R),eh(this,D,_))},l)),l.j=p}function Rn(l,p){let _=new Kr;if(o.Image){let R=new Image;R.onload=d(an,_,"TestLoadImage: loaded",!0,p,R),R.onerror=d(an,_,"TestLoadImage: error",!1,p,R),R.onabort=d(an,_,"TestLoadImage: abort",!1,p,R),R.ontimeout=d(an,_,"TestLoadImage: timeout",!1,p,R),o.setTimeout(function(){R.ontimeout&&R.ontimeout()},1e4),R.src=l}else p(!1)}function nh(l,p){let _=new Kr,R=new AbortController,D=setTimeout(()=>{R.abort(),an(_,"TestPingServer: timeout",!1,p)},1e4);fetch(l,{signal:R.signal}).then(M=>{clearTimeout(D),M.ok?an(_,"TestPingServer: ok",!0,p):an(_,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(D),an(_,"TestPingServer: error",!1,p)})}function an(l,p,_,R,D){try{D&&(D.onload=null,D.onerror=null,D.onabort=null,D.ontimeout=null),R(_)}catch{}}function rh(){this.g=new $l}function cn(l){this.i=l.Sb||null,this.h=l.ab||!1}m(cn,zl),cn.prototype.g=function(){return new bo(this.i,this.h)};function bo(l,p){at.call(this),this.H=l,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(bo,at),n=bo.prototype,n.open=function(l,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=l,this.D=p,this.readyState=1,Ot(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};l&&(p.body=l),(this.H||o).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,fs(this)),this.readyState=0},n.Pa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Ot(this)),this.g&&(this.readyState=3,Ot(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ih(this)}else l.text().then(this.Oa.bind(this),this.ga.bind(this))};function ih(l){l.j.read().then(l.Ma.bind(l)).catch(l.ga.bind(l))}n.Ma=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var p=l.value?l.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!l.done}))&&(this.response=this.responseText+=p)}l.done?fs(this):Ot(this),this.readyState==3&&ih(this)}},n.Oa=function(l){this.g&&(this.response=this.responseText=l,fs(this))},n.Na=function(l){this.g&&(this.response=l,fs(this))},n.ga=function(){this.g&&fs(this)};function fs(l){l.readyState=4,l.l=null,l.j=null,l.B=null,Ot(l)}n.setRequestHeader=function(l,p){this.A.append(l,p)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],p=this.h.entries();for(var _=p.next();!_.done;)_=_.value,l.push(_[0]+": "+_[1]),_=p.next();return l.join(`\r
`)};function Ot(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(bo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function sh(l){let p="";return Br(l,function(_,R){p+=R,p+=":",p+=_,p+=`\r
`}),p}function Cc(l,p,_){e:{for(R in _){var R=!1;break e}R=!0}R||(_=sh(_),typeof l=="string"?_!=null&&rs(_):Ce(l,p,_))}function ke(l){at.call(this),this.headers=new Map,this.L=l||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(ke,at);var So=/^https?$/i,oh=["POST","PUT"];n=ke.prototype,n.Fa=function(l){this.H=l},n.ea=function(l,p,_,R){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);p=p?p.toUpperCase():"GET",this.D=l,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Qr.g(),this.g.onreadystatechange=v(h(this.Ca,this));try{this.B=!0,this.g.open(p,String(l),!0),this.B=!1}catch(M){ri(this,M);return}if(l=_||"",_=new Map(this.headers),R)if(Object.getPrototypeOf(R)===Object.prototype)for(var D in R)_.set(D,R[D]);else if(typeof R.keys=="function"&&typeof R.get=="function")for(let M of R.keys())_.set(M,R.get(M));else throw Error("Unknown input type for opt_headers: "+String(R));R=Array.from(_.keys()).find(M=>M.toLowerCase()=="content-type"),D=o.FormData&&l instanceof o.FormData,!(Array.prototype.indexOf.call(oh,p,void 0)>=0)||R||D||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[M,W]of _)this.g.setRequestHeader(M,W);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(l),this.v=!1}catch(M){ri(this,M)}};function ri(l,p){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=p,l.o=5,ii(l),si(l)}function ii(l){l.A||(l.A=!0,ct(l,"complete"),ct(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=l||7,ct(this,"complete"),ct(this,"abort"),si(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),si(this,!0)),ke.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?kc(this):this.Xa())},n.Xa=function(){kc(this)};function kc(l){if(l.h&&typeof s<"u"){if(l.v&&Ae(l)==4)setTimeout(l.Ca.bind(l),0);else if(ct(l,"readystatechange"),Ae(l)==4){l.h=!1;try{let M=l.ca();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var _;if(!(_=p)){var R;if(R=M===0){let W=String(l.D).match(bc)[1]||null;!W&&o.self&&o.self.location&&(W=o.self.location.protocol.slice(0,-1)),R=!So.test(W?W.toLowerCase():"")}_=R}if(_)ct(l,"complete"),ct(l,"success");else{l.o=6;try{var D=Ae(l)>2?l.g.statusText:""}catch{D=""}l.l=D+" ["+l.ca()+"]",ii(l)}}finally{si(l)}}}}function si(l,p){if(l.g){l.m&&(clearTimeout(l.m),l.m=null);let _=l.g;l.g=null,p||ct(l,"ready");try{_.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ae(l){return l.g?l.g.readyState:0}n.ca=function(){try{return Ae(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(l){if(this.g){var p=this.g.responseText;return l&&p.indexOf(l)==0&&(p=p.substring(l.length)),jl(p)}};function ah(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.F){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function Lp(l){let p={};l=(l.g&&Ae(l)>=2&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let R=0;R<l.length;R++){if(I(l[R]))continue;var _=Jr(l[R]);let D=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();let M=p[D]||[];p[D]=M,M.push(_)}Fl(p,function(R){return R.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function oi(l,p,_){return _&&_.internalChannelParams&&_.internalChannelParams[l]||p}function Nc(l){this.za=0,this.i=[],this.j=new Kr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=oi("failFast",!1,l),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=oi("baseRetryDelayMs",5e3,l),this.Za=oi("retryDelaySeedMs",1e4,l),this.Ta=oi("forwardChannelMaxRetries",2,l),this.va=oi("forwardChannelRequestTimeoutMs",2e4,l),this.ma=l&&l.xmlHttpFactory||void 0,this.Ua=l&&l.Rb||void 0,this.Aa=l&&l.useFetchStreams||!1,this.O=void 0,this.L=l&&l.supportsCrossDomainXhr||!1,this.M="",this.h=new vo(l&&l.concurrentRequestLimit),this.Ba=new rh,this.S=l&&l.fastHandshake||!1,this.R=l&&l.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=l&&l.Pb||!1,l&&l.ua&&this.j.ua(),l&&l.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&l&&l.detectBufferingProxy||!1,this.ia=void 0,l&&l.longPollingTimeout&&l.longPollingTimeout>0&&(this.ia=l.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Nc.prototype,n.ka=8,n.I=1,n.connect=function(l,p,_,R){lt(0),this.W=l,this.H=p||{},_&&R!==void 0&&(this.H.OSID=_,this.H.OAID=R),this.F=this.X,this.J=No(this,null,this.W),Vt(this)};function Ro(l){if(Dc(l),l.I==3){var p=l.V++,_=Ut(l.J);if(Ce(_,"SID",l.M),Ce(_,"RID",p),Ce(_,"TYPE","terminate"),un(l,_),p=new An(l,l.j,p),p.M=2,p.A=us(Ut(_)),_=!1,o.navigator&&o.navigator.sendBeacon)try{_=o.navigator.sendBeacon(p.A.toString(),"")}catch{}!_&&o.Image&&(new Image().src=p.A,_=!0),_||(p.g=Do(p.j,null),p.g.ea(p.A)),p.F=Date.now(),Yr(p)}xc(l)}function er(l){l.g&&(Co(l),l.g.cancel(),l.g=null)}function Dc(l){er(l),l.v&&(o.clearTimeout(l.v),l.v=null),ko(l),l.h.cancel(),l.m&&(typeof l.m=="number"&&o.clearTimeout(l.m),l.m=null)}function Vt(l){if(!ei(l.h)&&!l.m){l.m=!0;var p=l.Ea;oe||y(),Z||(oe(),Z=!0),T.add(p,l),l.D=0}}function ch(l,p){return Sn(l.h)>=l.h.j-(l.m?1:0)?!1:l.m?(l.i=p.G.concat(l.i),!0):l.I==1||l.I==2||l.D>=(l.Sa?0:l.Ta)?!1:(l.m=Ft(h(l.Ea,l,p),ci(l,l.D)),l.D++,!0)}n.Ea=function(l){if(this.m)if(this.m=null,this.I==1){if(!l){this.V=Math.floor(Math.random()*1e5),l=this.V++;let D=new An(this,this.j,l),M=this.o;if(this.U&&(M?(M=Ul(M),ot(M,this.U)):M=this.U),this.u!==null||this.R||(D.J=M,M=null),this.S)e:{for(var p=0,_=0;_<this.i.length;_++){t:{var R=this.i[_];if("__data__"in R.map&&(R=R.map.__data__,typeof R=="string")){R=R.length;break t}R=void 0}if(R===void 0)break;if(p+=R,p>4096){p=_;break e}if(p===4096||_===this.i.length-1){p=_+1;break e}}p=1e3}else p=1e3;p=Oc(this,D,p),_=Ut(this.J),Ce(_,"RID",l),Ce(_,"CVER",22),this.G&&Ce(_,"X-HTTP-Session-Id",this.G),un(this,_),M&&(this.R?p="headers="+rs(sh(M))+"&"+p:this.u&&Cc(_,this.u,M)),vc(this.h,D),this.Ra&&Ce(_,"TYPE","init"),this.S?(Ce(_,"$req",p),Ce(_,"SID","null"),D.U=!0,ss(D,_,null)):ss(D,_,p),this.I=2}}else this.I==3&&(l?uh(this,l):this.i.length==0||ei(this.h)||uh(this))};function uh(l,p){var _;p?_=p.l:_=l.V++;let R=Ut(l.J);Ce(R,"SID",l.M),Ce(R,"RID",_),Ce(R,"AID",l.K),un(l,R),l.u&&l.o&&Cc(R,l.u,l.o),_=new An(l,l.j,_,l.D+1),l.u===null&&(_.J=l.o),p&&(l.i=p.G.concat(l.i)),p=Oc(l,_,1e3),_.H=Math.round(l.va*.5)+Math.round(l.va*.5*Math.random()),vc(l.h,_),ss(_,R,p)}function un(l,p){l.H&&Br(l.H,function(_,R){Ce(p,R,_)}),l.l&&Br({},function(_,R){Ce(p,R,_)})}function Oc(l,p,_){_=Math.min(l.i.length,_);let R=l.l?h(l.l.Ka,l.l,l):null;e:{var D=l.i;let ae=-1;for(;;){let c=["count="+_];ae==-1?_>0?(ae=D[0].g,c.push("ofs="+ae)):ae=0:c.push("ofs="+ae);let f=!0;for(let g=0;g<_;g++){var M=D[g].g;let S=D[g].map;if(M-=ae,M<0)ae=Math.max(0,D[g].g-100),f=!1;else try{M="req"+M+"_"||"";try{var W=S instanceof Map?S:Object.entries(S);for(let[O,F]of W){let z=F;a(F)&&(z=qr(F)),c.push(M+O+"="+encodeURIComponent(z))}}catch(O){throw c.push(M+"type="+encodeURIComponent("_badmap")),O}}catch{R&&R(S)}}if(f){W=c.join("&");break e}}W=void 0}return l=l.i.splice(0,_),p.G=l,W}function Po(l){if(!l.g&&!l.v){l.Y=1;var p=l.Da;oe||y(),Z||(oe(),Z=!0),T.add(p,l),l.A=0}}function ai(l){return l.g||l.v||l.A>=3?!1:(l.Y++,l.v=Ft(h(l.Da,l),ci(l,l.A)),l.A++,!0)}n.Da=function(){if(this.v=null,ps(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var l=4*this.T;this.j.info("BP detection timer enabled: "+l),this.B=Ft(h(this.Wa,this),l)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,lt(10),er(this),ps(this))};function Co(l){l.B!=null&&(o.clearTimeout(l.B),l.B=null)}function ps(l){l.g=new An(l,l.j,"rpc",l.Y),l.u===null&&(l.g.J=l.o),l.g.P=0;var p=Ut(l.na);Ce(p,"RID","rpc"),Ce(p,"SID",l.M),Ce(p,"AID",l.K),Ce(p,"CI",l.F?"0":"1"),!l.F&&l.ia&&Ce(p,"TO",l.ia),Ce(p,"TYPE","xmlhttp"),un(l,p),l.u&&l.o&&Cc(p,l.u,l.o),l.O&&(l.g.H=l.O);var _=l.g;l=l.ba,_.M=1,_.A=us(Ut(p)),_.u=null,_.R=!0,os(_,l)}n.Va=function(){this.C!=null&&(this.C=null,er(this),ai(this),lt(19))};function ko(l){l.C!=null&&(o.clearTimeout(l.C),l.C=null)}function Vc(l,p){var _=null;if(l.g==p){ko(l),Co(l),l.g=null;var R=2}else if(as(l.h,p))_=p.G,Tc(l.h,p),R=1;else return;if(l.I!=0){if(p.o)if(R==1){_=p.u?p.u.length:0,p=Date.now()-p.F;var D=l.D;R=zr(),ct(R,new _o(R,_)),Vt(l)}else Po(l);else if(D=p.m,D==3||D==0&&p.X>0||!(R==1&&ch(l,p)||R==2&&ai(l)))switch(_&&_.length>0&&(p=l.h,p.i=p.i.concat(_)),D){case 1:Pn(l,5);break;case 4:Pn(l,10);break;case 3:Pn(l,6);break;default:Pn(l,2)}}}function ci(l,p){let _=l.Qa+Math.floor(Math.random()*l.Za);return l.isActive()||(_*=2),_*p}function Pn(l,p){if(l.j.info("Error code "+p),p==2){var _=h(l.bb,l),R=l.Ua;let D=!R;R=new Jt(R||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||ti(R,"https"),us(R),D?Rn(R.toString(),_):nh(R.toString(),_)}else lt(2);l.I=0,l.l&&l.l.pa(p),xc(l),Dc(l)}n.bb=function(l){l?(this.j.info("Successfully pinged google.com"),lt(2)):(this.j.info("Failed to ping google.com"),lt(1))};function xc(l){if(l.I=0,l.ja=[],l.l){let p=Ac(l.h);(p.length!=0||l.i.length!=0)&&(k(l.ja,p),k(l.ja,l.i),l.h.i.length=0,C(l.i),l.i.length=0),l.l.oa()}}function No(l,p,_){var R=_ instanceof Jt?Ut(_):new Jt(_);if(R.g!="")p&&(R.g=p+"."+R.g),cs(R,R.u);else{var D=o.location;R=D.protocol,p=p?p+"."+D.hostname:D.hostname,D=+D.port;let M=new Jt(null);R&&ti(M,R),p&&(M.g=p),D&&cs(M,D),_&&(M.h=_),R=M}return _=l.G,p=l.wa,_&&p&&Ce(R,_,p),Ce(R,"VER",l.ka),un(l,R),R}function Do(l,p,_){if(p&&!l.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=l.Aa&&!l.ma?new ke(new cn({ab:_})):new ke(l.ma),p.Fa(l.L),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Lc(){}n=Lc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function tr(){}tr.prototype.g=function(l,p){return new yt(l,p)};function yt(l,p){at.call(this),this.g=new Nc(p),this.l=l,this.h=p&&p.messageUrlParams||null,l=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(l?l["X-WebChannel-Content-Type"]=p.messageContentType:l={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(l?l["X-WebChannel-Client-Profile"]=p.sa:l={"X-WebChannel-Client-Profile":p.sa}),this.g.U=l,(l=p&&p.Qb)&&!I(l)&&(this.g.u=l),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!I(p)&&(this.g.G=p,l=this.h,l!==null&&p in l&&(l=this.h,p in l&&delete l[p])),this.j=new nr(this)}m(yt,at),yt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},yt.prototype.close=function(){Ro(this.g)},yt.prototype.o=function(l){var p=this.g;if(typeof l=="string"){var _={};_.__data__=l,l=_}else this.v&&(_={},_.__data__=qr(l),l=_);p.i.push(new Jl(p.Ya++,l)),p.I==3&&Vt(p)},yt.prototype.N=function(){this.g.l=null,delete this.j,Ro(this.g),delete this.g,yt.Z.N.call(this)};function Mc(l){go.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var p=l.__sm__;if(p){e:{for(let _ in p){l=_;break e}l=void 0}(this.i=l)&&(l=this.i,p=p!==null&&l in p?p[l]:void 0),this.data=p}else this.data=l}m(Mc,go);function Cn(){ts.call(this),this.status=1}m(Cn,ts);function nr(l){this.g=l}m(nr,Lc),nr.prototype.ra=function(){ct(this.g,"a")},nr.prototype.qa=function(l){ct(this.g,new Mc(l))},nr.prototype.pa=function(l){ct(this.g,new Cn)},nr.prototype.oa=function(){ct(this.g,"b")},tr.prototype.createWebChannel=tr.prototype.g,yt.prototype.send=yt.prototype.o,yt.prototype.open=yt.prototype.m,yt.prototype.close=yt.prototype.close,Ug=Er.createWebChannelTransport=function(){return new tr},Fg=Er.getStatEventTarget=function(){return zr()},Mg=Er.Event=Xn,od=Er.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ns.NO_ERROR=0,ns.TIMEOUT=8,ns.HTTP_ERROR=6,uu=Er.ErrorCode=ns,Hr.COMPLETE="complete",Lg=Er.EventType=Hr,jr.EventType=$r,$r.OPEN="a",$r.CLOSE="b",$r.ERROR="c",$r.MESSAGE="d",at.prototype.listen=at.prototype.J,Ko=Er.WebChannel=jr,$x=Er.FetchXmlHttpFactory=cn,ke.prototype.listenOnce=ke.prototype.K,ke.prototype.getLastError=ke.prototype.Ha,ke.prototype.getLastErrorCode=ke.prototype.ya,ke.prototype.getStatus=ke.prototype.ca,ke.prototype.getResponseJson=ke.prototype.La,ke.prototype.getResponseText=ke.prototype.la,ke.prototype.send=ke.prototype.ea,ke.prototype.setWithCredentials=ke.prototype.Fa,xg=Er.XhrIo=ke}).apply(typeof sd<"u"?sd:typeof self<"u"?self:typeof window<"u"?window:{});var $A="@firebase/firestore",zA="4.9.2";var vt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};vt.UNAUTHENTICATED=new vt(null),vt.GOOGLE_CREDENTIALS=new vt("google-credentials-uid"),vt.FIRST_PARTY=new vt("first-party-uid"),vt.MOCK_USER=new vt("mock-user");var ya="12.3.0";var Ds=new mi("@firebase/firestore");function Ho(){return Ds.logLevel}function X(n,...e){if(Ds.logLevel<=fe.DEBUG){let t=e.map(by);Ds.debug(`Firestore (${ya}): ${n}`,...t)}}function Tr(n,...e){if(Ds.logLevel<=fe.ERROR){let t=e.map(by);Ds.error(`Firestore (${ya}): ${n}`,...t)}}function gu(n,...e){if(Ds.logLevel<=fe.WARN){let t=e.map(by);Ds.warn(`Firestore (${ya}): ${n}`,...t)}}function by(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function ue(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Db(n,r,t)}function Db(n,e,t){let r=`FIRESTORE (${ya}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Tr(r),new Error(r)}function Me(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Db(e,i,r)}function me(n,e){return n}var J={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},re=class extends Zt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var vr=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Wg=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Kg=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(vt.UNAUTHENTICATED))}shutdown(){}};var Hg=class{constructor(e){this.t=e,this.currentUser=vt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Me(this.o===void 0,42304);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new vr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new vr,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>w(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new vr)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Me(typeof r.accessToken=="string",31837,{l:r}),new Wg(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Me(e===null||typeof e=="string",2055,{h:e}),new vt(e)}},Qg=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=vt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Jg=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Qg(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(vt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},fd=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Yg=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,fr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Me(this.o===void 0,3512);let r=s=>{s.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,X("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new fd(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Me(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new fd(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function zx(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var pd=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=zx(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function ye(n,e){return n<e?-1:n>e?1:0}function Xg(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),s=e.charAt(r);if(i!==s)return Bg(i)===Bg(s)?ye(i,s):Bg(i)?1:-1}return ye(n.length,e.length)}var Gx=55296,Wx=57343;function Bg(n){let e=n.charCodeAt(0);return e>=Gx&&e<=Wx}function sa(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var GA="__name__",md=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&ue(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ue(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return ye(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Xg(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ir.fromString(e.substring(4,e.length-2))}},ht=class n extends md{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new re(J.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},Kx=/^[_a-zA-Z][_a-zA-Z0-9]*$/,gn=class n extends md{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return Kx.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===GA}static keyField(){return new n([GA])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new re(J.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new re(J.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new re(J.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new re(J.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var ce=class n{constructor(e){this.path=e}static fromPath(e){return new n(ht.fromString(e))}static fromName(e){return new n(ht.fromString(e).popFirst(5))}static empty(){return new n(ht.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ht.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ht.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ht(e.slice()))}};function Hx(n,e,t,r){if(e===!0&&r===!0)throw new re(J.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Qx(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Jx(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ue(12329,{type:typeof n})}function ld(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new re(J.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Jx(n);throw new re(J.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Xe(n,e){let t={typeString:n};return e&&(t.value=e),t}function Nu(n,e){if(!Qx(n))throw new re(J.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new re(J.INVALID_ARGUMENT,t);return!0}var WA=-62135596800,KA=1e6,kt=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*KA);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new re(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new re(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<WA)throw new re(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new re(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/KA}_compareTo(e){return this.seconds===e.seconds?ye(this.nanoseconds,e.nanoseconds):ye(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Nu(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-WA;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};kt._jsonSchemaVersion="firestore/timestamp/1.0",kt._jsonSchema={type:Xe("string",kt._jsonSchemaVersion),seconds:Xe("number"),nanoseconds:Xe("number")};var he=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new kt(0,0))}static max(){return new n(new kt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var _u=-1,Zg=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Zg.UNKNOWN_ID=-1;function Yx(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=he.fromTimestamp(r===1e9?new kt(t+1,0):new kt(t,r));return new Os(i,ce.empty(),e)}function Xx(n){return new Os(n.readTime,n.key,_u)}var Os=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(he.min(),ce.empty(),_u)}static max(){return new n(he.max(),ce.empty(),_u)}};function Zx(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ce.comparator(n.documentKey,e.documentKey),t!==0?t:ye(n.largestBatchId,e.largestBatchId))}var eL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",e_=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Bd(n){return w(this,null,function*(){if(n.code!==J.FAILED_PRECONDITION||n.message!==eL)throw n;X("LocalStore","Unexpectedly lost primary lease")})}var j=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ue(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(d=>{o[h]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function tL(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ia(n){return n.name==="IndexedDbTransactionError"}var Sy=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>r.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),nL=-1;function qd(n){return n==null}function gd(n){return n===0&&1/n==-1/0}var Ob="";function rL(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=HA(e)),e=iL(n.get(t),e);return HA(e)}function iL(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case Ob:t+="";break;default:t+=s}}return t}function HA(n){return n+Ob+""}var sL="remoteDocuments",Vb="owner";var xb="mutationQueues";var Lb="mutations";var Mb="documentMutations",oL="remoteDocumentsV14";var Fb="remoteDocumentGlobal";var Ub="targets";var Bb="targetDocuments";var qb="targetGlobal",jb="collectionParents";var $b="clientMetadata";var zb="bundles";var Gb="namedQueries";var aL="indexConfiguration";var cL="indexState";var uL="indexEntries";var Wb="documentOverlays";var lL="globals";var hL=[xb,Lb,Mb,sL,Ub,Vb,qb,Bb,$b,Fb,jb,zb,Gb],A9=[...hL,Wb],dL=[xb,Lb,Mb,oL,Ub,Vb,qb,Bb,$b,Fb,jb,zb,Gb,Wb],fL=dL,pL=[...fL,aL,cL,uL];var b9=[...pL,lL];function QA(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Du(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function mL(n,e){let t=[];for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function gL(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var We=class n{constructor(e,t){this.comparator=e,this.root=t||xn.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xn.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Yo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Yo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Yo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Yo(this.root,e,this.comparator,!0)}},Yo=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},xn=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ue(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ue(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw ue(27949);return e+(this.isRed()?0:1)}};xn.EMPTY=null,xn.RED=!0,xn.BLACK=!1;xn.EMPTY=new class{constructor(){this.size=0}get key(){throw ue(57766)}get value(){throw ue(16141)}get color(){throw ue(16727)}get left(){throw ue(29726)}get right(){throw ue(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new xn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var mt=class n{constructor(e){this.comparator=e,this.data=new We(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new _d(this.data.getIterator())}getIteratorFrom(e){return new _d(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},_d=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Rs=class n{constructor(e){this.fields=e,e.sort(gn.comparator)}static empty(){return new n([])}unionWith(e){let t=new mt(gn.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return sa(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var yd=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Tt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new yd("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ye(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Tt.EMPTY_BYTE_STRING=new Tt("");var _L=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ar(n){if(Me(!!n,39018),typeof n=="string"){let e=0,t=_L.exec(n);if(Me(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Le(n.seconds),nanos:Le(n.nanos)}}function Le(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function br(n){return typeof n=="string"?Tt.fromBase64String(n):Tt.fromUint8Array(n)}var Kb="server_timestamp",Hb="__type__",Qb="__previous_value__",Jb="__local_write_time__";function Ry(n){return(n?.mapValue?.fields||{})[Hb]?.stringValue===Kb}function jd(n){let e=n.mapValue.fields[Qb];return Ry(e)?jd(e):e}function yu(n){let e=Ar(n.mapValue.fields[Jb].timestampValue);return new kt(e.seconds,e.nanos)}var t_=class{constructor(e,t,r,i,s,o,a,u,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=d}},n_="(default)",Id=class n{constructor(e,t){this.projectId=e,this.database=t||n_}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===n_}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Yb="__type__",Xb="__max__",ad={mapValue:{fields:{__type__:{stringValue:Xb}}}},Zb="__vector__",Iu="value";function Ti(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ry(n)?4:tS(n)?9007199254740991:eS(n)?10:11:ue(28295,{value:n})}function Mn(n,e){if(n===e)return!0;let t=Ti(n);if(t!==Ti(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yu(n).isEqual(yu(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Ar(i.timestampValue),a=Ar(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return br(i.bytesValue).isEqual(br(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Le(i.geoPointValue.latitude)===Le(s.geoPointValue.latitude)&&Le(i.geoPointValue.longitude)===Le(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Le(i.integerValue)===Le(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Le(i.doubleValue),a=Le(s.doubleValue);return o===a?gd(o)===gd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return sa(n.arrayValue.values||[],e.arrayValue.values||[],Mn);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(QA(o)!==QA(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Mn(o[u],a[u])))return!1;return!0}(n,e);default:return ue(52216,{left:n})}}function Eu(n,e){return(n.values||[]).find(t=>Mn(t,e))!==void 0}function oa(n,e){if(n===e)return 0;let t=Ti(n),r=Ti(e);if(t!==r)return ye(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ye(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=Le(s.integerValue||s.doubleValue),u=Le(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return JA(n.timestampValue,e.timestampValue);case 4:return JA(yu(n),yu(e));case 5:return Xg(n.stringValue,e.stringValue);case 6:return function(s,o){let a=br(s),u=br(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let h=0;h<a.length&&h<u.length;h++){let d=ye(a[h],u[h]);if(d!==0)return d}return ye(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=ye(Le(s.latitude),Le(o.latitude));return a!==0?a:ye(Le(s.longitude),Le(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return YA(n.arrayValue,e.arrayValue);case 10:return function(s,o){let a=s.fields||{},u=o.fields||{},h=a[Iu]?.arrayValue,d=u[Iu]?.arrayValue,m=ye(h?.values?.length||0,d?.values?.length||0);return m!==0?m:YA(h,d)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===ad.mapValue&&o===ad.mapValue)return 0;if(s===ad.mapValue)return 1;if(o===ad.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),h=o.fields||{},d=Object.keys(h);u.sort(),d.sort();for(let m=0;m<u.length&&m<d.length;++m){let v=Xg(u[m],d[m]);if(v!==0)return v;let C=oa(a[u[m]],h[d[m]]);if(C!==0)return C}return ye(u.length,d.length)}(n.mapValue,e.mapValue);default:throw ue(23264,{he:t})}}function JA(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ye(n,e);let t=Ar(n),r=Ar(e),i=ye(t.seconds,r.seconds);return i!==0?i:ye(t.nanos,r.nanos)}function YA(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=oa(t[i],r[i]);if(s)return s}return ye(t.length,r.length)}function aa(n){return r_(n)}function r_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Ar(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return br(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ce.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=r_(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${r_(t.fields[o])}`;return i+"}"}(n.mapValue):ue(61005,{value:n})}function hd(n){switch(Ti(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=jd(n);return e?16+hd(e):16;case 5:return 2*n.stringValue.length;case 6:return br(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+hd(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return Du(r.fields,(s,o)=>{i+=s.length+hd(o)}),i}(n.mapValue);default:throw ue(13486,{value:n})}}function i_(n){return!!n&&"integerValue"in n}function Py(n){return!!n&&"arrayValue"in n}function XA(n){return!!n&&"nullValue"in n}function ZA(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qg(n){return!!n&&"mapValue"in n}function eS(n){return(n?.mapValue?.fields||{})[Yb]?.stringValue===Zb}function hu(n){if(n.geoPointValue)return{geoPointValue:je({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:je({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Du(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=hu(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=hu(n.arrayValue.values[t]);return e}return je({},n)}function tS(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Xb}var R9={mapValue:{fields:{[Yb]:{stringValue:Zb},[Iu]:{arrayValue:{}}}}};var wr=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!qg(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hu(t)}setAll(e){let t=gn.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=hu(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());qg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];qg(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Du(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(hu(this.value))}};var yn=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,he.min(),he.min(),he.min(),wr.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,he.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,he.min(),he.min(),wr.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,he.min(),he.min(),wr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(he.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=wr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=wr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=he.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ca=class{constructor(e,t){this.position=e,this.inclusive=t}};function eb(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=ce.comparator(ce.fromName(o.referenceValue),t.key):r=oa(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function tb(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Mn(n.position[t],e.position[t]))return!1;return!0}var ua=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function yL(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ed=class{},dt=class n extends Ed{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new o_(e,t,r):t==="array-contains"?new u_(e,r):t==="in"?new l_(e,r):t==="not-in"?new h_(e,r):t==="array-contains-any"?new d_(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new a_(e,r):new c_(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(oa(t,this.value)):t!==null&&Ti(this.value)===Ti(t)&&this.matchesComparison(oa(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ue(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Fn=class n extends Ed{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return nS(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function nS(n){return n.op==="and"}function rS(n){return IL(n)&&nS(n)}function IL(n){for(let e of n.filters)if(e instanceof Fn)return!1;return!0}function s_(n){if(n instanceof dt)return n.field.canonicalString()+n.op.toString()+aa(n.value);if(rS(n))return n.filters.map(e=>s_(e)).join(",");{let e=n.filters.map(t=>s_(t)).join(",");return`${n.op}(${e})`}}function iS(n,e){return n instanceof dt?function(r,i){return i instanceof dt&&r.op===i.op&&r.field.isEqual(i.field)&&Mn(r.value,i.value)}(n,e):n instanceof Fn?function(r,i){return i instanceof Fn&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&iS(o,i.filters[a]),!0):!1}(n,e):void ue(19439)}function sS(n){return n instanceof dt?function(t){return`${t.field.canonicalString()} ${t.op} ${aa(t.value)}`}(n):n instanceof Fn?function(t){return t.op.toString()+" {"+t.getFilters().map(sS).join(" ,")+"}"}(n):"Filter"}var o_=class extends dt{constructor(e,t,r){super(e,t,r),this.key=ce.fromName(r.referenceValue)}matches(e){let t=ce.comparator(e.key,this.key);return this.matchesComparison(t)}},a_=class extends dt{constructor(e,t){super(e,"in",t),this.keys=oS("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},c_=class extends dt{constructor(e,t){super(e,"not-in",t),this.keys=oS("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function oS(n,e){return(e.arrayValue?.values||[]).map(t=>ce.fromName(t.referenceValue))}var u_=class extends dt{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Py(t)&&Eu(t.arrayValue,this.value)}},l_=class extends dt{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Eu(this.value.arrayValue,t)}},h_=class extends dt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Eu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Eu(this.value.arrayValue,t)}},d_=class extends dt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Py(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Eu(this.value.arrayValue,r))}};var f_=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.Te=null}};function nb(n,e=null,t=[],r=[],i=null,s=null,o=null){return new f_(n,e,t,r,i,s,o)}function Cy(n){let e=me(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>s_(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),qd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>aa(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>aa(r)).join(",")),e.Te=t}return e.Te}function ky(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!yL(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!iS(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!tb(n.startAt,e.startAt)&&tb(n.endAt,e.endAt)}function p_(n){return ce.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var la=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function EL(n,e,t,r,i,s,o,a){return new la(n,e,t,r,i,s,o,a)}function Ny(n){return new la(n)}function rb(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function wL(n){return n.collectionGroup!==null}function du(n){let e=me(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new mt(gn.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(a=a.add(h.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new ua(s,r))}),t.has(gn.keyField().canonicalString())||e.Ie.push(new ua(gn.keyField(),r))}return e.Ie}function Ln(n){let e=me(n);return e.Ee||(e.Ee=aS(e,du(n))),e.Ee}function vL(n){let e=me(n);return e.de||(e.de=aS(e,n.explicitOrderBy)),e.de}function aS(n,e){if(n.limitType==="F")return nb(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new ua(i.field,s)});let t=n.endAt?new ca(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ca(n.startAt.position,n.startAt.inclusive):null;return nb(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function m_(n,e,t){return new la(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function $d(n,e){return ky(Ln(n),Ln(e))&&n.limitType===e.limitType}function cS(n){return`${Cy(Ln(n))}|lt:${n.limitType}`}function Qo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>sS(i)).join(", ")}]`),qd(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>aa(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>aa(i)).join(",")),`Target(${r})`}(Ln(n))}; limitType=${n.limitType})`}function zd(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):ce.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of du(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let h=eb(o,a,u);return o.inclusive?h<=0:h<0}(r.startAt,du(r),i)||r.endAt&&!function(o,a,u){let h=eb(o,a,u);return o.inclusive?h>=0:h>0}(r.endAt,du(r),i))}(n,e)}function TL(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function uS(n){return(e,t)=>{let r=!1;for(let i of du(n)){let s=AL(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function AL(n,e,t){let r=n.field.isKeyField()?ce.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),h=a.data.field(s);return u!==null&&h!==null?oa(u,h):ue(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ue(19790,{direction:n.dir})}}var Sr=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Du(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return gL(this.inner)}size(){return this.innerSize}};var bL=new We(ce.comparator);function Ai(){return bL}var lS=new We(ce.comparator);function lu(...n){let e=lS;for(let t of n)e=e.insert(t.key,t);return e}function SL(n){let e=lS;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ps(){return fu()}function hS(){return fu()}function fu(){return new Sr(n=>n.toString(),(n,e)=>n.isEqual(e))}var P9=new We(ce.comparator),RL=new mt(ce.comparator);function we(...n){let e=RL;for(let t of n)e=e.add(t);return e}var PL=new mt(ye);function CL(){return PL}function kL(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gd(e)?"-0":e}}function NL(n){return{integerValue:""+n}}var ha=class{constructor(){this._=void 0}};function DL(n,e,t){return n instanceof wu?function(i,s){let o={fields:{[Hb]:{stringValue:Kb},[Jb]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ry(s)&&(s=jd(s)),s&&(o.fields[Qb]=s),{mapValue:o}}(t,e):n instanceof da?dS(n,e):n instanceof fa?fS(n,e):function(i,s){let o=VL(i,s),a=ib(o)+ib(i.Ae);return i_(o)&&i_(i.Ae)?NL(a):kL(i.serializer,a)}(n,e)}function OL(n,e,t){return n instanceof da?dS(n,e):n instanceof fa?fS(n,e):t}function VL(n,e){return n instanceof vu?function(r){return i_(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var wu=class extends ha{},da=class extends ha{constructor(e){super(),this.elements=e}};function dS(n,e){let t=pS(e);for(let r of n.elements)t.some(i=>Mn(i,r))||t.push(r);return{arrayValue:{values:t}}}var fa=class extends ha{constructor(e){super(),this.elements=e}};function fS(n,e){let t=pS(e);for(let r of n.elements)t=t.filter(i=>!Mn(i,r));return{arrayValue:{values:t}}}var vu=class extends ha{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function ib(n){return Le(n.integerValue||n.doubleValue)}function pS(n){return Py(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function xL(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof da&&i instanceof da||r instanceof fa&&i instanceof fa?sa(r.elements,i.elements,Mn):r instanceof vu&&i instanceof vu?Mn(r.Ae,i.Ae):r instanceof wu&&i instanceof wu}(n.transform,e.transform)}var pu=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function dd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Tu=class{};function mS(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new g_(n.key,pu.none()):new Au(n.key,n.data,pu.none());{let t=n.data,r=wr.empty(),i=new mt(gn.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new pa(n.key,r,new Rs(i.toArray()),pu.none())}}function LL(n,e,t){n instanceof Au?function(i,s,o){let a=i.value.clone(),u=ob(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof pa?function(i,s,o){if(!dd(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=ob(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(gS(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function mu(n,e,t,r){return n instanceof Au?function(s,o,a,u){if(!dd(s.precondition,o))return a;let h=s.value.clone(),d=ab(s.fieldTransforms,u,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,e,t,r):n instanceof pa?function(s,o,a,u){if(!dd(s.precondition,o))return a;let h=ab(s.fieldTransforms,u,o),d=o.data;return d.setAll(gS(s)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(s,o,a){return dd(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function sb(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&sa(r,i,(s,o)=>xL(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Au=class extends Tu{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},pa=class extends Tu{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function gS(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function ob(n,e,t){let r=new Map;Me(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,OL(o,a,t[i]))}return r}function ab(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,DL(s,o,e))}return r}var g_=class extends Tu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};var __=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&LL(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=mu(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=mu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=hS();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=mS(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(he.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),we())}isEqual(e){return this.batchId===e.batchId&&sa(this.mutations,e.mutations,(t,r)=>sb(t,r))&&sa(this.baseMutations,e.baseMutations,(t,r)=>sb(t,r))}};var y_=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var I_=class{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}};var E_=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Je,Ie;function _S(n){if(n===void 0)return Tr("GRPC error has no .code"),J.UNKNOWN;switch(n){case Je.OK:return J.OK;case Je.CANCELLED:return J.CANCELLED;case Je.UNKNOWN:return J.UNKNOWN;case Je.DEADLINE_EXCEEDED:return J.DEADLINE_EXCEEDED;case Je.RESOURCE_EXHAUSTED:return J.RESOURCE_EXHAUSTED;case Je.INTERNAL:return J.INTERNAL;case Je.UNAVAILABLE:return J.UNAVAILABLE;case Je.UNAUTHENTICATED:return J.UNAUTHENTICATED;case Je.INVALID_ARGUMENT:return J.INVALID_ARGUMENT;case Je.NOT_FOUND:return J.NOT_FOUND;case Je.ALREADY_EXISTS:return J.ALREADY_EXISTS;case Je.PERMISSION_DENIED:return J.PERMISSION_DENIED;case Je.FAILED_PRECONDITION:return J.FAILED_PRECONDITION;case Je.ABORTED:return J.ABORTED;case Je.OUT_OF_RANGE:return J.OUT_OF_RANGE;case Je.UNIMPLEMENTED:return J.UNIMPLEMENTED;case Je.DATA_LOSS:return J.DATA_LOSS;default:return ue(39323,{code:n})}}(Ie=Je||(Je={}))[Ie.OK=0]="OK",Ie[Ie.CANCELLED=1]="CANCELLED",Ie[Ie.UNKNOWN=2]="UNKNOWN",Ie[Ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ie[Ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ie[Ie.NOT_FOUND=5]="NOT_FOUND",Ie[Ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ie[Ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ie[Ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ie[Ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ie[Ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ie[Ie.ABORTED=10]="ABORTED",Ie[Ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ie[Ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ie[Ie.INTERNAL=13]="INTERNAL",Ie[Ie.UNAVAILABLE=14]="UNAVAILABLE",Ie[Ie.DATA_LOSS=15]="DATA_LOSS";var ML=null;function FL(){return new TextEncoder}var UL=new Ir([4294967295,4294967295],0);function cb(n){let e=FL().encode(n),t=new Vg;return t.update(e),new Uint8Array(t.digest())}function ub(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ir([t,r],0),new Ir([i,s],0)]}var w_=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Cs(`Invalid padding: ${t}`);if(r<0)throw new Cs(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Cs(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Cs(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ir.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Ir.fromNumber(r)));return i.compare(UL)===1&&(i=new Ir([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=cb(e),[r,i]=ub(t);for(let s=0;s<this.hashCount;s++){let o=this.ye(r,i,s);if(!this.we(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;let t=cb(e),[r,i]=ub(t);for(let s=0;s<this.hashCount;s++){let o=this.ye(r,i,s);this.Se(o)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Cs=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var wd=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,bu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(he.min(),i,new We(ye),Ai(),we())}},bu=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,we(),we(),we())}};var Xo=class{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}},vd=class{constructor(e,t){this.targetId=e,this.Ce=t}},Td=class{constructor(e,t,r=Tt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Ad=class{constructor(){this.ve=0,this.Fe=lb(),this.Me=Tt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=we(),t=we(),r=we();return this.Fe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:ue(38017,{changeType:s})}}),new bu(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=lb()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Me(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},v_=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ai(),this.Je=cd(),this.He=cd(),this.Ye=new We(ye)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ue(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,i)=>{this.rt(i)&&t(i)})}st(e){let t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){let s=i.target;if(p_(s))if(r===0){let o=new ce(s.path);this.et(t,o,yn.newNoDocument(o,he.min()))}else Me(r===1,20013,{expectedCount:r});else{let o=this._t(t);if(o!==r){let a=this.ut(e),u=a?this.ct(a,e,o):1;if(u!==0){this.it(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}ML?.lt(function(d,m,v,C,k){let V={localCacheCount:d,existenceFilterCount:m.count,databaseId:v.database,projectId:v.projectId},N=m.unchangedNames;return N&&(V.bloomFilter={applied:k===0,hashCount:N?.hashCount??0,bitmapLength:N?.bits?.bitmap?.length??0,padding:N?.bits?.padding??0,mightContain:q=>C?.mightContain(q)??!1}),V}(o,e.Ce,this.Ge.ht(),a,u))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=br(r).toUint8Array()}catch(u){if(u instanceof yd)return gu("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new w_(o,i,s)}catch(u){return gu(u instanceof Cs?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.et(t,s,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((s,o)=>{let a=this.ot(o);if(a){if(s.current&&p_(a.target)){let u=new ce(a.target.path);this.It(u).has(o)||this.Et(o,u)||this.et(o,u,yn.newNoDocument(u,e))}s.Be&&(t.set(o,s.ke()),s.qe())}});let r=we();this.He.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.je.forEach((s,o)=>o.setReadTime(e));let i=new wd(e,t,this.Ye,this.je,r);return this.je=Ai(),this.Je=cd(),this.He=cd(),this.Ye=new We(ye),i}Xe(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Ad,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new mt(ye),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new mt(ye),this.Je=this.Je.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||X("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ad),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function cd(){return new We(ce.comparator)}function lb(){return new We(ce.comparator)}var BL={asc:"ASCENDING",desc:"DESCENDING"},qL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jL={and:"AND",or:"OR"},T_=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function A_(n,e){return n.useProto3Json||qd(e)?e:{value:e}}function $L(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function zL(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Zo(n){return Me(!!n,49232),he.fromTimestamp(function(t){let r=Ar(t);return new kt(r.seconds,r.nanos)}(n))}function GL(n,e){return b_(n,e).canonicalString()}function b_(n,e){let t=function(i){return new ht(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function yS(n){let e=ht.fromString(n);return Me(AS(e),10190,{key:e.toString()}),e}function jg(n,e){let t=yS(e);if(t.get(1)!==n.databaseId.projectId)throw new re(J.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new re(J.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ce(ES(t))}function IS(n,e){return GL(n.databaseId,e)}function WL(n){let e=yS(n);return e.length===4?ht.emptyPath():ES(e)}function hb(n){return new ht(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ES(n){return Me(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function KL(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:ue(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,d){return h.useProto3Json?(Me(d===void 0||typeof d=="string",58123),Tt.fromBase64String(d||"")):(Me(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Tt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(h){let d=h.code===void 0?J.UNKNOWN:_S(h.code);return new re(d,h.message||"")}(o);t=new Td(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=jg(n,r.document.name),s=Zo(r.document.updateTime),o=r.document.createTime?Zo(r.document.createTime):he.min(),a=new wr({mapValue:{fields:r.document.fields}}),u=yn.newFoundDocument(i,s,o,a),h=r.targetIds||[],d=r.removedTargetIds||[];t=new Xo(h,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=jg(n,r.document),s=r.readTime?Zo(r.readTime):he.min(),o=yn.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Xo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=jg(n,r.document),s=r.removedTargetIds||[];t=new Xo([],s,i,null)}else{if(!("filter"in e))return ue(11601,{Rt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new E_(i,s),a=r.targetId;t=new vd(a,o)}}return t}function HL(n,e){return{documents:[IS(n,e.path)]}}function wS(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=IS(n,i);let s=function(h){if(h.length!==0)return TS(Fn.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(d=>function(v){return{field:vi(v.field),direction:XL(v.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=A_(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{ft:t,parent:i}}function QL(n,e,t,r){let{ft:i,parent:s}=wS(n,e),o={},a=[],u=0;return t.forEach(h=>{let d=r?h.alias:"aggregate_"+u++;o[d]=h.alias,h.aggregateType==="count"?a.push({alias:d,count:{}}):h.aggregateType==="avg"?a.push({alias:d,avg:{field:vi(h.fieldPath)}}):h.aggregateType==="sum"&&a.push({alias:d,sum:{field:vi(h.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:i.structuredQuery},parent:i.parent},gt:o,parent:s}}function JL(n){let e=WL(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Me(r===1,65062);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(m){let v=vS(m);return v instanceof Fn&&rS(v)?v.getFilters():[v]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(v=>function(k){return new ua(Jo(k.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(v))}(t.orderBy));let a=null;t.limit&&(a=function(m){let v;return v=typeof m=="object"?m.value:m,qd(v)?null:v}(t.limit));let u=null;t.startAt&&(u=function(m){let v=!!m.before,C=m.values||[];return new ca(C,v)}(t.startAt));let h=null;return t.endAt&&(h=function(m){let v=!m.before,C=m.values||[];return new ca(C,v)}(t.endAt)),EL(e,i,o,s,a,"F",u,h)}function YL(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ue(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function vS(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Jo(t.unaryFilter.field);return dt.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Jo(t.unaryFilter.field);return dt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Jo(t.unaryFilter.field);return dt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Jo(t.unaryFilter.field);return dt.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ue(61313);default:return ue(60726)}}(n):n.fieldFilter!==void 0?function(t){return dt.create(Jo(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ue(58110);default:return ue(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Fn.create(t.compositeFilter.filters.map(r=>vS(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return ue(1026)}}(t.compositeFilter.op))}(n):ue(30097,{filter:n})}function XL(n){return BL[n]}function ZL(n){return qL[n]}function eM(n){return jL[n]}function vi(n){return{fieldPath:n.canonicalString()}}function Jo(n){return gn.fromServerFormat(n.fieldPath)}function TS(n){return n instanceof dt?function(t){if(t.op==="=="){if(ZA(t.value))return{unaryFilter:{field:vi(t.field),op:"IS_NAN"}};if(XA(t.value))return{unaryFilter:{field:vi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ZA(t.value))return{unaryFilter:{field:vi(t.field),op:"IS_NOT_NAN"}};if(XA(t.value))return{unaryFilter:{field:vi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vi(t.field),op:ZL(t.op),value:t.value}}}(n):n instanceof Fn?function(t){let r=t.getFilters().map(i=>TS(i));return r.length===1?r[0]:{compositeFilter:{op:eM(t.op),filters:r}}}(n):ue(54877,{filter:n})}function AS(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Su=class n{constructor(e,t,r,i,s=he.min(),o=he.min(),a=Tt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var S_=class{constructor(e){this.yt=e}};function tM(n){let e=JL({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?m_(e,e.limit,"L"):e}var bd=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Le(e.integerValue));else if("doubleValue"in e){let r=Le(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),gd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Ar(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(br(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?tS(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):eS(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ue(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=Iu,s=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Le(s)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),ce.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};bd.Kt=new bd;var R_=class{constructor(){this.Cn=new P_}addToCollectionParentIndex(e,t){return this.Cn.add(t),j.resolve()}getCollectionParents(e,t){return j.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return j.resolve()}deleteFieldIndex(e,t){return j.resolve()}deleteAllFieldIndexes(e){return j.resolve()}createTargetIndexes(e,t){return j.resolve()}getDocumentsMatchingTarget(e,t){return j.resolve(null)}getIndexType(e,t){return j.resolve(0)}getFieldIndexes(e,t){return j.resolve([])}getNextCollectionGroupToUpdate(e){return j.resolve(null)}getMinOffset(e,t){return j.resolve(Os.min())}getMinOffsetFromCollectionGroup(e,t){return j.resolve(Os.min())}updateCollectionGroup(e,t,r){return j.resolve()}updateIndexEntries(e,t){return j.resolve()}},P_=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new mt(ht.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new mt(ht.comparator)).toArray()}};var C9=new Uint8Array(0);var db={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bS=41943040,tn=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};tn.DEFAULT_COLLECTION_PERCENTILE=10,tn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tn.DEFAULT=new tn(bS,tn.DEFAULT_COLLECTION_PERCENTILE,tn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tn.DISABLED=new tn(-1,0,0);var Ru=class n{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var fb="LruGarbageCollector",nM=1048576;function pb([n,e],[t,r]){let i=ye(n,t);return i===0?ye(e,r):i}var C_=class{constructor(e){this.Ir=e,this.buffer=new mt(pb),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();pb(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},k_=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){X(fb,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>w(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ia(t)?X(fb,"Ignoring IndexedDB error during garbage collection: ",t):yield Bd(t)}yield this.Vr(3e5)}))}},N_=class{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return j.resolve(Sy.ce);let r=new C_(t);return this.mr.forEachTarget(e,i=>r.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>r.Ar(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(X("LruGarbageCollector","Garbage collection skipped; disabled"),j.resolve(db)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),db):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,s,o,a,u,h,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(h=Date.now(),Ho()<=fe.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-d}ms`),j.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function rM(n,e){return new N_(n,e)}var D_=class{constructor(){this.changes=new Sr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?j.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var O_=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var V_=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&mu(r.mutation,i,Rs.empty(),kt.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,we()).next(()=>r))}getLocalViewOfDocuments(e,t,r=we()){let i=Ps();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=lu();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Ps();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,we()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ai(),o=fu(),a=function(){return fu()}();return t.forEach((u,h)=>{let d=r.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof pa)?s=s.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),mu(d.mutation,h,d.mutation.getFieldMask(),kt.now())):o.set(h.key,Rs.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,d)=>o.set(h,d)),t.forEach((h,d)=>a.set(h,new O_(d,o.get(h)??null))),a))}recalculateAndSaveOverlays(e,t){let r=fu(),i=new We((o,a)=>o-a),s=we();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let d=r.get(u)||Rs.empty();d=a.applyToLocalView(h,d),r.set(u,d);let m=(i.get(a.batchId)||we()).add(u);i=i.insert(a.batchId,m)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),h=u.key,d=u.value,m=hS();d.forEach(v=>{if(!s.has(v)){let C=mS(t.get(v),r.get(v));C!==null&&m.set(v,C),s=s.add(v)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,m))}return j.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return ce.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):wL(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):j.resolve(Ps()),a=_u,u=s;return o.next(h=>j.forEach(h,(d,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(d)?j.resolve():this.remoteDocumentCache.getEntry(e,d).next(v=>{u=u.insert(d,v)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,we())).next(d=>({batchId:a,changes:SL(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ce(t)).next(r=>{let i=lu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=lu();return this.indexManager.getCollectionParents(e,s).next(a=>j.forEach(a,u=>{let h=function(m,v){return new la(v,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next(d=>{d.forEach((m,v)=>{o=o.insert(m,v)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,h)=>{let d=h.getKey();o.get(d)===null&&(o=o.insert(d,yn.newInvalidDocument(d)))});let a=lu();return o.forEach((u,h)=>{let d=s.get(u);d!==void 0&&mu(d.mutation,h,Rs.empty(),kt.now()),zd(t,h)&&(a=a.insert(u,h))}),a})}};var x_=class{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return j.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Zo(i.createTime)}}(t)),j.resolve()}getNamedQuery(e,t){return j.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(i){return{name:i.name,query:tM(i.bundledQuery),readTime:Zo(i.readTime)}}(t)),j.resolve()}};var L_=class{constructor(){this.overlays=new We(ce.comparator),this.qr=new Map}getOverlay(e,t){return j.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Ps();return j.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.St(e,t,s)}),j.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.qr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.qr.delete(r)),j.resolve()}getOverlaysForCollection(e,t,r){let i=Ps(),s=t.length+1,o=new ce(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return j.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new We((h,d)=>h-d),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=s.get(h.largestBatchId);d===null&&(d=Ps(),s=s.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}let a=Ps(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,d)=>a.set(h,d)),!(a.size()>=i)););return j.resolve(a)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new y_(t,r));let s=this.qr.get(t);s===void 0&&(s=we(),this.qr.set(t,s)),this.qr.set(t,s.add(r.key))}};var M_=class{constructor(){this.sessionToken=Tt.EMPTY_BYTE_STRING}getSessionToken(e){return j.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,j.resolve()}};var Pu=class{constructor(){this.Qr=new mt(Ye.$r),this.Ur=new mt(Ye.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new Ye(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Ye(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){let t=new ce(new ht([])),r=new Ye(t,e),i=new Ye(t,e+1),s=[];return this.Ur.forEachInRange([r,i],o=>{this.Gr(o),s.push(o.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new ce(new ht([])),r=new Ye(t,e),i=new Ye(t,e+1),s=we();return this.Ur.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Ye(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ye=class{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ce.comparator(e.key,t.key)||ye(e.Yr,t.Yr)}static Kr(e,t){return ye(e.Yr,t.Yr)||ce.comparator(e.key,t.key)}};var F_=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new mt(Ye.$r)}checkEmpty(e){return j.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new __(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.Zr=this.Zr.add(new Ye(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return j.resolve(o)}lookupMutationBatch(e,t){return j.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.ei(r),s=i<0?0:i;return j.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return j.resolve(this.mutationQueue.length===0?nL:this.tr-1)}getAllMutationBatches(e){return j.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ye(t,0),i=new Ye(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,i],o=>{let a=this.Xr(o.Yr);s.push(a)}),j.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new mt(ye);return t.forEach(i=>{let s=new Ye(i,0),o=new Ye(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,o],a=>{r=r.add(a.Yr)})}),j.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;ce.isDocumentKey(s)||(s=s.child(""));let o=new Ye(new ce(s),0),a=new mt(ye);return this.Zr.forEachWhile(u=>{let h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(a=a.add(u.Yr)),!0)},o),j.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(r=>{let i=this.Xr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Me(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return j.forEach(t.mutations,i=>{let s=new Ye(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new Ye(t,0),i=this.Zr.firstAfterOrEqual(r);return j.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,j.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var U_=class{constructor(e){this.ri=e,this.docs=function(){return new We(ce.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return j.resolve(r?r.document.mutableCopy():yn.newInvalidDocument(t))}getEntries(e,t){let r=Ai();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():yn.newInvalidDocument(i))}),j.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ai(),o=t.path,a=new ce(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:h,value:{document:d}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Zx(Xx(d),r)<=0||(i.has(d.key)||zd(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return j.resolve(s)}getAllFromCollectionGroup(e,t,r,i){ue(9500)}ii(e,t){return j.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new B_(this)}getSize(e){return j.resolve(this.size)}},B_=class extends D_{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)}),j.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}};var q_=class{constructor(e){this.persistence=e,this.si=new Sr(t=>Cy(t),ky),this.lastRemoteSnapshotVersion=he.min(),this.highestTargetId=0,this.oi=0,this._i=new Pu,this.targetCount=0,this.ai=Ru.ur()}forEachTarget(e,t){return this.si.forEach((r,i)=>t(i)),j.resolve()}getLastRemoteSnapshotVersion(e){return j.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),j.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),j.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new Ru(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,j.resolve()}updateTargetData(e,t){return this.Pr(t),j.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,j.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),j.waitFor(s).next(()=>i)}getTargetCount(e){return j.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return j.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),j.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),j.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),j.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return j.resolve(r)}containsKey(e,t){return j.resolve(this._i.containsKey(t))}};var Sd=class{constructor(e,t){this.ui={},this.overlays={},this.ci=new Sy(0),this.li=!1,this.li=!0,this.hi=new M_,this.referenceDelegate=e(this),this.Pi=new q_(this),this.indexManager=new R_,this.remoteDocumentCache=function(i){return new U_(i)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new S_(t),this.Ii=new x_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new L_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new F_(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){X("MemoryPersistence","Starting transaction:",e);let i=new j_(this.ci.next());return this.referenceDelegate.Ei(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ai(e,t){return j.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}},j_=class extends e_{constructor(e){super(),this.currentSequenceNumber=e}},$_=class n{constructor(e){this.persistence=e,this.Ri=new Pu,this.Vi=null}static mi(e){return new n(e)}get fi(){if(this.Vi)return this.Vi;throw ue(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),j.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),j.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),j.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.fi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j.forEach(this.fi,r=>{let i=ce.fromPath(r);return this.gi(e,i).next(s=>{s||t.removeEntry(i,he.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return j.or([()=>j.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}},Rd=class n{constructor(e,t){this.persistence=e,this.pi=new Sr(r=>rL(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=rM(this,t)}static mi(e,t){return new n(e,t)}Ei(){}di(e){return j.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return j.forEach(this.pi,(r,i)=>this.br(e,r,i).next(s=>s?j.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,s.removeEntry(o,he.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),j.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),j.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),j.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),j.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=hd(e.data.value)),t}br(e,t,r){return j.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.pi.get(t);return j.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var z_=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=we(),i=we();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var G_=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var W_=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return gT()?8:tL($t())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ys(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ws(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new G_;return this.Ss(e,t,o).next(a=>{if(s.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>s.result)}bs(e,t,r,i){return r.documentReadCount<this.fs?(Ho()<=fe.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",Qo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),j.resolve()):(Ho()<=fe.DEBUG&&X("QueryEngine","Query:",Qo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Ho()<=fe.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",Qo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ln(t))):j.resolve())}ys(e,t){if(rb(t))return j.resolve(null);let r=Ln(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=m_(t,null,"F"),r=Ln(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=we(...s);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let h=this.Ds(t,a);return this.Cs(t,h,o,u.readTime)?this.ys(e,m_(t,null,"F")):this.vs(e,h,t,u)}))})))}ws(e,t,r,i){return rb(t)||i.isEqual(he.min())?j.resolve(null):this.ps.getDocuments(e,r).next(s=>{let o=this.Ds(t,s);return this.Cs(t,o,r,i)?j.resolve(null):(Ho()<=fe.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Qo(t)),this.vs(e,o,t,Yx(i,_u)).next(a=>a))})}Ds(e,t){let r=new mt(uS(e));return t.forEach((i,s)=>{zd(e,s)&&(r=r.add(s))}),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,r){return Ho()<=fe.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",Qo(t)),this.ps.getDocumentsMatchingQuery(e,t,Os.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Dy="LocalStore",iM=3e8,K_=class{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new We(ye),this.xs=new Sr(s=>Cy(s),ky),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new V_(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}};function sM(n,e,t,r){return new K_(n,e,t,r)}function SS(n,e){return w(this,null,function*(){let t=me(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=we();for(let h of i){o.push(h.batchId);for(let d of h.mutations)u=u.add(d.key)}for(let h of s){a.push(h.batchId);for(let d of h.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next(h=>({Ls:h,removedBatchIds:o,addedBatchIds:a}))})})})}function RS(n){let e=me(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function oM(n,e){let t=me(n),r=e.snapshotVersion,i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;let a=[];e.targetChanges.forEach((d,m)=>{let v=i.get(m);if(!v)return;a.push(t.Pi.removeMatchingKeys(s,d.removedDocuments,m).next(()=>t.Pi.addMatchingKeys(s,d.addedDocuments,m)));let C=v.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?C=C.withResumeToken(Tt.EMPTY_BYTE_STRING,he.min()).withLastLimboFreeSnapshotVersion(he.min()):d.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(d.resumeToken,r)),i=i.insert(m,C),function(V,N,q){return V.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=iM?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(v,C,d)&&a.push(t.Pi.updateTargetData(s,C))});let u=Ai(),h=we();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(aM(s,o,e.documentUpdates).next(d=>{u=d.ks,h=d.qs})),!r.isEqual(he.min())){let d=t.Pi.getLastRemoteSnapshotVersion(s).next(m=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return j.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.Ms=i,s))}function aM(n,e,t){let r=we(),i=we();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ai();return t.forEach((a,u)=>{let h=s.get(a);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(he.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):X(Dy,"Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",u.version)}),{ks:o,qs:i}})}function cM(n,e){let t=me(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Pi.getTargetData(r,e).next(s=>s?(i=s,j.resolve(i)):t.Pi.allocateTargetId(r).next(o=>(i=new Su(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}function H_(n,e,t){return w(this,null,function*(){let r=me(n),i=r.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ia(o))throw o;X(Dy,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)})}function mb(n,e,t){let r=me(n),i=he.min(),s=we();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,d){let m=me(u),v=m.xs.get(d);return v!==void 0?j.resolve(m.Ms.get(v)):m.Pi.getTargetData(h,d)}(r,o,Ln(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?i:he.min(),t?s:we())).next(a=>(uM(r,TL(e),a),{documents:a,Qs:s})))}function uM(n,e,t){let r=n.Os.get(e)||he.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Os.set(e,r)}var Pd=class{constructor(){this.activeTargetIds=CL()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Q_=class{constructor(){this.Mo=new Pd,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Pd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var J_=class{Oo(e){}shutdown(){}};var gb="ConnectivityMonitor",Cd=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){X(gb,"Network connectivity changed: AVAILABLE");for(let e of this.qo)e(0)}ko(){X(gb,"Network connectivity changed: UNAVAILABLE");for(let e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ud=null;function Y_(){return ud===null?ud=function(){return 268435456+Math.round(2147483648*Math.random())}():ud++,"0x"+ud.toString(16)}var $g="RestConnection",lM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},X_=class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===n_?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,s){let o=Y_(),a=this.zo(e,t.toUriEncodedString());X($g,`Sending RPC '${e}' ${o}:`,a,r);let u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,i,s);let{host:h}=new URL(a),d=Kc(h);return this.Jo(e,a,u,r,d).then(m=>(X($g,`Received RPC '${e}' ${o}: `,m),m),m=>{throw gu($g,`RPC '${e}' ${o} failed with error: `,m,"url: ",a,"request:",r),m})}Ho(e,t,r,i,s,o){return this.Go(e,t,r,i,s)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ya}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}zo(e,t){let r=lM[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}};var Z_=class{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}};var wt="WebChannelConnection",ey=class extends X_{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,s){let o=Y_();return new Promise((a,u)=>{let h=new xg;h.setWithCredentials(!0),h.listenOnce(Lg.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case uu.NO_ERROR:let m=h.getResponseJson();X(wt,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),a(m);break;case uu.TIMEOUT:X(wt,`RPC '${e}' ${o} timed out`),u(new re(J.DEADLINE_EXCEEDED,"Request time out"));break;case uu.HTTP_ERROR:let v=h.getStatus();if(X(wt,`RPC '${e}' ${o} failed with status:`,v,"response text:",h.getResponseText()),v>0){let C=h.getResponseJson();Array.isArray(C)&&(C=C[0]);let k=C?.error;if(k&&k.status&&k.message){let V=function(q){let G=q.toLowerCase().replace(/_/g,"-");return Object.values(J).indexOf(G)>=0?G:J.UNKNOWN}(k.status);u(new re(V,k.message))}else u(new re(J.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new re(J.UNAVAILABLE,"Connection failed."));break;default:ue(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{X(wt,`RPC '${e}' ${o} completed.`)}});let d=JSON.stringify(i);X(wt,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",d,r,15)})}T_(e,t,r){let i=Y_(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ug(),a=Fg(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let d=s.join("");X(wt,`Creating RPC '${e}' stream ${i}: ${d}`,u);let m=o.createWebChannel(d,u);this.I_(m);let v=!1,C=!1,k=new Z_({Yo:N=>{C?X(wt,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(v||(X(wt,`Opening RPC '${e}' stream ${i} transport.`),m.open(),v=!0),X(wt,`RPC '${e}' stream ${i} sending:`,N),m.send(N))},Zo:()=>m.close()}),V=(N,q,G)=>{N.listen(q,$=>{try{G($)}catch(te){setTimeout(()=>{throw te},0)}})};return V(m,Ko.EventType.OPEN,()=>{C||(X(wt,`RPC '${e}' stream ${i} transport opened.`),k.o_())}),V(m,Ko.EventType.CLOSE,()=>{C||(C=!0,X(wt,`RPC '${e}' stream ${i} transport closed`),k.a_(),this.E_(m))}),V(m,Ko.EventType.ERROR,N=>{C||(C=!0,gu(wt,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),k.a_(new re(J.UNAVAILABLE,"The operation could not be completed")))}),V(m,Ko.EventType.MESSAGE,N=>{if(!C){let q=N.data[0];Me(!!q,16349);let G=q,$=G?.error||G[0]?.error;if($){X(wt,`RPC '${e}' stream ${i} received error:`,$);let te=$.status,oe=function(y){let E=Je[y];if(E!==void 0)return _S(E)}(te),Z=$.message;oe===void 0&&(oe=J.INTERNAL,Z="Unknown error status: "+te+" with message "+$.message),C=!0,k.a_(new re(oe,Z)),m.close()}else X(wt,`RPC '${e}' stream ${i} received:`,q),k.u_(q)}}),V(a,Mg.STAT_EVENT,N=>{N.stat===od.PROXY?X(wt,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===od.NOPROXY&&X(wt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.__()},0),k}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}};function zg(){return typeof document<"u"?document:null}function PS(n){return new T_(n,!0)}var kd=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&X("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var _b="PersistentStream",ty=class{constructor(e,t,r,i,s,o,a,u){this.Mi=e,this.S_=r,this.b_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new kd(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return w(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return w(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return w(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===J.RESOURCE_EXHAUSTED?(Tr(t.toString()),Tr("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===J.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===t&&this.G_(r,i)},r=>{e(()=>{let i=new re(J.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(()=>w(this,null,function*(){this.state=0,this.start()}))}z_(e){return X(_b,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(X(_b,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ny=class extends ty{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=KL(this.serializer,e),r=function(s){if(!("targetChange"in s))return he.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?he.min():o.readTime?Zo(o.readTime):he.min()}(e);return this.listener.H_(t,r)}Y_(e){let t={};t.database=hb(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=p_(u)?{documents:HL(s,u)}:{query:wS(s,u).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=zL(s,o.resumeToken);let h=A_(s,o.expectedCount);h!==null&&(a.expectedCount=h)}else if(o.snapshotVersion.compareTo(he.min())>0){a.readTime=$L(s,o.snapshotVersion.toTimestamp());let h=A_(s,o.expectedCount);h!==null&&(a.expectedCount=h)}return a}(this.serializer,e);let r=YL(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){let t={};t.database=hb(this.serializer),t.removeTarget=e,this.q_(t)}};var ry=class{},iy=class extends ry{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new re(J.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Go(e,b_(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===J.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new re(J.UNKNOWN,s.toString())})}Ho(e,t,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,b_(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===J.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new re(J.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},sy=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Tr(t),this.aa=!1):X("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var ma="RemoteStore",oy=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(o=>{r.enqueueAndForget(()=>w(this,null,function*(){Vu(this)&&(X(ma,"Restarting streams for network reachability change."),yield function(u){return w(this,null,function*(){let h=me(u);h.Ea.add(4),yield Ou(h),h.Ra.set("Unknown"),h.Ea.delete(4),yield Gd(h)})}(this))}))}),this.Ra=new sy(r,i)}};function Gd(n){return w(this,null,function*(){if(Vu(n))for(let e of n.da)yield e(!0)})}function Ou(n){return w(this,null,function*(){for(let e of n.da)yield e(!1)})}function CS(n,e){let t=me(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ly(t)?xy(t):Ea(t).O_()&&Vy(t,e))}function Oy(n,e){let t=me(n),r=Ea(t);t.Ia.delete(e),r.O_()&&kS(t,e),t.Ia.size===0&&(r.O_()?r.L_():Vu(t)&&t.Ra.set("Unknown"))}function Vy(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(he.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ea(n).Y_(e)}function kS(n,e){n.Va.Ue(e),Ea(n).Z_(e)}function xy(n){n.Va=new v_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Ea(n).start(),n.Ra.ua()}function Ly(n){return Vu(n)&&!Ea(n).x_()&&n.Ia.size>0}function Vu(n){return me(n).Ea.size===0}function NS(n){n.Va=void 0}function hM(n){return w(this,null,function*(){n.Ra.set("Online")})}function dM(n){return w(this,null,function*(){n.Ia.forEach((e,t)=>{Vy(n,e)})})}function fM(n,e){return w(this,null,function*(){NS(n),Ly(n)?(n.Ra.ha(e),xy(n)):n.Ra.set("Unknown")})}function pM(n,e,t){return w(this,null,function*(){if(n.Ra.set("Online"),e instanceof Td&&e.state===2&&e.cause)try{yield function(i,s){return w(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.Ia.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.Ia.delete(a),i.Va.removeTarget(a))})}(n,e)}catch(r){X(ma,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield yb(n,r)}else if(e instanceof Xo?n.Va.Ze(e):e instanceof vd?n.Va.st(e):n.Va.tt(e),!t.isEqual(he.min()))try{let r=yield RS(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.Va.Tt(o);return a.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let d=s.Ia.get(h);d&&s.Ia.set(h,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,h)=>{let d=s.Ia.get(u);if(!d)return;s.Ia.set(u,d.withResumeToken(Tt.EMPTY_BYTE_STRING,d.snapshotVersion)),kS(s,u);let m=new Su(d.target,u,h,d.sequenceNumber);Vy(s,m)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){X(ma,"Failed to raise snapshot:",r),yield yb(n,r)}})}function yb(n,e,t){return w(this,null,function*(){if(!Ia(e))throw e;n.Ea.add(1),yield Ou(n),n.Ra.set("Offline"),t||(t=()=>RS(n.localStore)),n.asyncQueue.enqueueRetryable(()=>w(this,null,function*(){X(ma,"Retrying IndexedDB access"),yield t(),n.Ea.delete(1),yield Gd(n)}))})}function Ib(n,e){return w(this,null,function*(){let t=me(n);t.asyncQueue.verifyOperationInProgress(),X(ma,"RemoteStore received new credentials");let r=Vu(t);t.Ea.add(3),yield Ou(t),r&&t.Ra.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield Gd(t)})}function mM(n,e){return w(this,null,function*(){let t=me(n);e?(t.Ea.delete(2),yield Gd(t)):e||(t.Ea.add(2),yield Ou(t),t.Ra.set("Unknown"))})}function Ea(n){return n.ma||(n.ma=function(t,r,i){let s=me(t);return s.sa(),new ny(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Xo:hM.bind(null,n),t_:dM.bind(null,n),r_:fM.bind(null,n),H_:pM.bind(null,n)}),n.da.push(e=>w(this,null,function*(){e?(n.ma.B_(),Ly(n)?xy(n):n.Ra.set("Unknown")):(yield n.ma.stop(),NS(n))}))),n.ma}var ay=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new vr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new re(J.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function DS(n,e){if(Tr("AsyncQueue",`${e}: ${n}`),Ia(n))return new re(J.UNAVAILABLE,`${e}: ${n}`);throw n}var Nd=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ce.comparator(t.key,r.key):(t,r)=>ce.comparator(t.key,r.key),this.keyedMap=lu(),this.sortedSet=new We(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Dd=class{constructor(){this.ga=new We(ce.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ue(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}},ga=class n{constructor(e,t,r,i,s,o,a,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Nd.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&$d(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var cy=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}},uy=class{constructor(){this.queries=Eb(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=me(t),s=i.queries;i.queries=Eb(),s.forEach((o,a)=>{for(let u of a.Sa)u.onError(r)})})(this,new re(J.ABORTED,"Firestore shutting down"))}};function Eb(){return new Sr(n=>cS(n),$d)}function gM(n,e){return w(this,null,function*(){let t=me(n),r=3,i=e.query,s=t.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new cy,r=e.Da()?0:1);try{switch(r){case 0:s.wa=yield t.onListen(i,!0);break;case 1:s.wa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=DS(o,`Initialization of query '${Qo(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&My(t)})}function _M(n,e){return w(this,null,function*(){let t=me(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.Sa.indexOf(e);o>=0&&(s.Sa.splice(o,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function yM(n,e){let t=me(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.Sa)a.Fa(i)&&(r=!0);o.wa=i}}r&&My(t)}function IM(n,e,t){let r=me(n),i=r.queries.get(e);if(i)for(let s of i.Sa)s.onError(t);r.queries.delete(e)}function My(n){n.Ca.forEach(e=>{e.next()})}var ly,wb;(wb=ly||(ly={})).Ma="default",wb.Cache="cache";var hy=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ga(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ga.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ly.Cache}};var Od=class{constructor(e){this.key=e}},Vd=class{constructor(e){this.key=e}},dy=class{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=we(),this.mutatedKeys=we(),this.eu=uS(e),this.tu=new Nd(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new Dd,i=t?t.tu:this.tu,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,m)=>{let v=i.get(d),C=zd(this.query,m)?m:null,k=!!v&&this.mutatedKeys.has(v.key),V=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations),N=!1;v&&C?v.data.isEqual(C.data)?k!==V&&(r.track({type:3,doc:C}),N=!0):this.su(v,C)||(r.track({type:2,doc:C}),N=!0,(u&&this.eu(C,u)>0||h&&this.eu(C,h)<0)&&(a=!0)):!v&&C?(r.track({type:0,doc:C}),N=!0):v&&!C&&(r.track({type:1,doc:v}),N=!0,(u||h)&&(a=!0)),N&&(C?(o=o.add(C),s=V?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{tu:o,iu:r,Cs:a,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let o=e.iu.ya();o.sort((d,m)=>function(C,k){let V=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ue(20277,{Rt:N})}};return V(C)-V(k)}(d.type,m.type)||this.eu(d.doc,m.doc)),this.ou(r),i=i??!1;let a=t&&!i?this._u():[],u=this.Xa.size===0&&this.current&&!i?1:0,h=u!==this.Za;return this.Za=u,o.length!==0||h?{snapshot:new ga(this.query,e.tu,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Dd,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=we(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});let t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new Vd(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new Od(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=we();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ga.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},Fy="SyncEngine",fy=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},py=class{constructor(e){this.key=e,this.hu=!1}},my=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Sr(a=>cS(a),$d),this.Iu=new Map,this.Eu=new Set,this.du=new We(ce.comparator),this.Au=new Map,this.Ru=new Pu,this.Vu={},this.mu=new Map,this.fu=Ru.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function EM(n,e,t=!0){return w(this,null,function*(){let r=MS(n),i,s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=yield OS(r,e,t,!0),i})}function wM(n,e){return w(this,null,function*(){let t=MS(n);yield OS(t,e,!0,!1)})}function OS(n,e,t,r){return w(this,null,function*(){let i=yield cM(n.localStore,Ln(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield vM(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&CS(n.remoteStore,i),a})}function vM(n,e,t,r,i){return w(this,null,function*(){n.pu=(m,v,C)=>function(V,N,q,G){return w(this,null,function*(){let $=N.view.ru(q);$.Cs&&($=yield mb(V.localStore,N.query,!1).then(({documents:T})=>N.view.ru(T,$)));let te=G&&G.targetChanges.get(N.targetId),oe=G&&G.targetMismatches.get(N.targetId)!=null,Z=N.view.applyChanges($,V.isPrimaryClient,te,oe);return Tb(V,N.targetId,Z.au),Z.snapshot})}(n,m,v,C);let s=yield mb(n.localStore,e,!0),o=new dy(e,s.Qs),a=o.ru(s.documents),u=bu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(a,n.isPrimaryClient,u);Tb(n,t,h.au);let d=new fy(e,t,o);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot})}function TM(n,e,t){return w(this,null,function*(){let r=me(n),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(o=>!$d(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield H_(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Oy(r.remoteStore,i.targetId),gy(r,i.targetId)}).catch(Bd))):(gy(r,i.targetId),yield H_(r.localStore,i.targetId,!0))})}function AM(n,e){return w(this,null,function*(){let t=me(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Oy(t.remoteStore,r.targetId))})}function VS(n,e){return w(this,null,function*(){let t=me(n);try{let r=yield oM(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Au.get(s);o&&(Me(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?Me(o.hu,14607):i.removedDocuments.size>0&&(Me(o.hu,42227),o.hu=!1))}),yield LS(t,r,e)}catch(r){yield Bd(r)}})}function vb(n,e,t){let r=me(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach((s,o)=>{let a=o.view.va(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=me(o);u.onlineState=a;let h=!1;u.queries.forEach((d,m)=>{for(let v of m.Sa)v.va(a)&&(h=!0)}),h&&My(u)}(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function bM(n,e,t){return w(this,null,function*(){let r=me(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Au.get(e),s=i&&i.key;if(s){let o=new We(ce.comparator);o=o.insert(s,yn.newNoDocument(s,he.min()));let a=we().add(s),u=new wd(he.min(),new Map,new We(ye),o,a);yield VS(r,u),r.du=r.du.remove(s),r.Au.delete(e),Uy(r)}else yield H_(r.localStore,e,!1).then(()=>gy(r,e,t)).catch(Bd)})}function gy(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||xS(n,r)})}function xS(n,e){n.Eu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Oy(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Uy(n))}function Tb(n,e,t){for(let r of t)r instanceof Od?(n.Ru.addReference(r.key,e),SM(n,r)):r instanceof Vd?(X(Fy,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||xS(n,r.key)):ue(19791,{wu:r})}function SM(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(X(Fy,"New document in limbo: "+t),n.Eu.add(r),Uy(n))}function Uy(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new ce(ht.fromString(e)),r=n.fu.next();n.Au.set(r,new py(t)),n.du=n.du.insert(t,r),CS(n.remoteStore,new Su(Ln(Ny(t.path)),r,"TargetPurposeLimboResolution",Sy.ce))}}function LS(n,e,t){return w(this,null,function*(){let r=me(n),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,u)=>{o.push(r.pu(u,e,t).then(h=>{if((h||t)&&r.isPrimaryClient){let d=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,d?"current":"not-current")}if(h){i.push(h);let d=z_.As(u.targetId,h);s.push(d)}}))}),yield Promise.all(o),r.Pu.H_(i),yield function(u,h){return w(this,null,function*(){let d=me(u);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>j.forEach(h,v=>j.forEach(v.Es,C=>d.persistence.referenceDelegate.addReference(m,v.targetId,C)).next(()=>j.forEach(v.ds,C=>d.persistence.referenceDelegate.removeReference(m,v.targetId,C)))))}catch(m){if(!Ia(m))throw m;X(Dy,"Failed to update sequence numbers: "+m)}for(let m of h){let v=m.targetId;if(!m.fromCache){let C=d.Ms.get(v),k=C.snapshotVersion,V=C.withLastLimboFreeSnapshotVersion(k);d.Ms=d.Ms.insert(v,V)}}})}(r.localStore,s))})}function RM(n,e){return w(this,null,function*(){let t=me(n);if(!t.currentUser.isEqual(e)){X(Fy,"User change. New user:",e.toKey());let r=yield SS(t.localStore,e);t.currentUser=e,function(s,o){s.mu.forEach(a=>{a.forEach(u=>{u.reject(new re(J.CANCELLED,o))})}),s.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield LS(t,r.Ls)}})}function PM(n,e){let t=me(n),r=t.Au.get(e);if(r&&r.hu)return we().add(r.key);{let i=we(),s=t.Iu.get(e);if(!s)return i;for(let o of s){let a=t.Tu.get(o);i=i.unionWith(a.view.nu)}return i}}function MS(n){let e=me(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=VS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=PM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bM.bind(null,e),e.Pu.H_=yM.bind(null,e.eventManager),e.Pu.yu=IM.bind(null,e.eventManager),e}var FS=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return w(this,null,function*(){this.serializer=PS(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)})}Fu(t,r){return null}Mu(t,r){return null}vu(t){return sM(this.persistence,new W_,t.initialUser,this.serializer)}Cu(t){return new Sd($_.mi,this.serializer)}Du(t){return new Q_}terminate(){return w(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),_y=class extends FS{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Me(this.persistence.referenceDelegate instanceof Rd,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new k_(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?tn.withCacheSize(this.cacheSizeBytes):tn.DEFAULT;return new Sd(r=>Rd.mi(r,t),this.serializer)}};var CM=(()=>{class n{initialize(t,r){return w(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>vb(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=RM.bind(null,this.syncEngine),yield mM(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new uy}()}createDatastore(t){let r=PS(t.databaseInfo.databaseId),i=function(o){return new ey(o)}(t.databaseInfo);return function(o,a,u,h){return new iy(o,a,u,h)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,o,a,u){return new oy(i,s,o,a,u)}(this.localStore,this.datastore,t.asyncQueue,r=>vb(this.syncEngine,r,0),function(){return Cd.v()?new Cd:new J_}())}createSyncEngine(t,r){return function(s,o,a,u,h,d,m){let v=new my(s,o,a,u,h,d);return m&&(v.gu=!0),v}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return w(this,null,function*(){yield function(r){return w(this,null,function*(){let i=me(r);X(ma,"RemoteStore shutting down."),i.Ea.add(5),yield Ou(i),i.Aa.shutdown(),i.Ra.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var yy=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Tr("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var bi="FirestoreClient",Iy=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=vt.UNAUTHENTICATED,this.clientId=pd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>w(this,null,function*(){X(bi,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(X(bi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new vr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>w(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=DS(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Gg(n,e){return w(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),X(bi,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>w(this,null,function*(){r.isEqual(i)||(yield SS(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Ab(n,e){return w(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield kM(n);X(bi,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Ib(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Ib(e.remoteStore,i)),n._onlineComponents=e})}function kM(n){return w(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){X(bi,"Using user provided OfflineComponentProvider");try{yield Gg(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===J.FAILED_PRECONDITION||i.code===J.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;gu("Error using user provided cache. Falling back to memory cache: "+t),yield Gg(n,new FS)}}else X(bi,"Using default OfflineComponentProvider"),yield Gg(n,new _y(void 0));return n._offlineComponents})}function US(n){return w(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(X(bi,"Using user provided OnlineComponentProvider"),yield Ab(n,n._uninitializedComponentsProvider._online)):(X(bi,"Using default OnlineComponentProvider"),yield Ab(n,new CM))),n._onlineComponents})}function NM(n){return US(n).then(e=>e.datastore)}function bb(n){return w(this,null,function*(){let e=yield US(n),t=e.eventManager;return t.onListen=EM.bind(null,e.syncEngine),t.onUnlisten=TM.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=wM.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=AM.bind(null,e.syncEngine),t})}function DM(n,e,t){let r=new vr;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){try{let i=yield NM(n);r.resolve(function(o,a,u){return w(this,null,function*(){let h=me(o),{request:d,gt:m,parent:v}=QL(h.serializer,vL(a),u);h.connection.$o||delete d.parent;let C=(yield h.Ho("RunAggregationQuery",h.serializer.databaseId,v,d,1)).filter(V=>!!V.result);Me(C.length===1,64727);let k=C[0].result?.aggregateFields;return Object.keys(k).reduce((V,N)=>(V[m[N]]=k[N],V),{})})}(i,e,t))}catch(i){r.reject(i)}})),r.promise}function BS(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Sb=new Map;var OM="firestore.googleapis.com",Rb=!0,xd=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new re(J.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=OM,this.ssl=Rb}else this.host=e.host,this.ssl=e.ssl??Rb;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=bS;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<nM)throw new re(J.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Hx("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=BS(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new re(J.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new re(J.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new re(J.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Ey=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xd({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new re(J.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new re(J.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xd(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Kg;switch(r.type){case"firstParty":return new Jg(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new re(J.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return w(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Sb.get(t);r&&(X("ComponentProvider","Removing Datastore"),Sb.delete(t),r.terminate())}(this),Promise.resolve()}};var Ld=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},_n=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Nu(t,n._jsonSchema))return new n(e,r||null,new ce(ht.fromString(t.referencePath)))}};_n._jsonSchemaVersion="firestore/documentReference/1.0",_n._jsonSchema={type:Xe("string",_n._jsonSchemaVersion),referencePath:Xe("string")};var Cu=class n extends Ld{constructor(e,t,r){super(e,t,Ny(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new _n(this.firestore,null,new ce(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function wa(n,e){return n=On(n),e=On(e),(n instanceof _n||n instanceof Cu)&&(e instanceof _n||e instanceof Cu)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}var Pb="AsyncQueue",Md=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new kd(this,"async_queue_retry"),this._c=()=>{let r=zg();r&&X(Pb,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=zg();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=zg();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new vr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return w(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ia(e))throw e;X(Pb,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Tr("INTERNAL UNHANDLED ERROR: ",Cb(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=ay.createAndSchedule(this,e,t,r,s=>this.hc(s));return this.tc.push(i),i}uc(){this.nc&&ue(47125,{Pc:Cb(this.nc)})}verifyOperationInProgress(){}Tc(){return w(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function Cb(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function kb(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var _a=class extends Ey{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Md,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return w(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Md(e),this._firestoreClient=void 0,yield e}})}};function qS(n){if(n._terminated)throw new re(J.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||VM(n),n._firestoreClient}function VM(n){let e=n._freezeSettings(),t=function(i,s,o,a){return new t_(i,s,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,BS(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)}(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Iy(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(i){let s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}}(n._componentsProvider))}var wy=class{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}},vy=class{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}};var ea=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Tt.fromBase64String(e))}catch(t){throw new re(J.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Nu(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};ea._jsonSchemaVersion="firestore/bytes/1.0",ea._jsonSchema={type:Xe("string",ea._jsonSchemaVersion),bytes:Xe("string")};var Fd=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new re(J.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var ta=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new re(J.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new re(J.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ye(this._lat,e._lat)||ye(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Nu(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};ta._jsonSchemaVersion="firestore/geoPoint/1.0",ta._jsonSchema={type:Xe("string",ta._jsonSchemaVersion),latitude:Xe("number"),longitude:Xe("number")};var na=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Nu(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new re(J.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};na._jsonSchemaVersion="firestore/vectorValue/1.0",na._jsonSchema={type:Xe("string",na._jsonSchemaVersion),vectorValues:Xe("object")};var xM=new RegExp("[~\\*/\\[\\]]");function LM(n,e,t){if(e.search(xM)>=0)throw Nb(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Fd(...e.split("."))._internalPath}catch{throw Nb(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Nb(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new re(J.INVALID_ARGUMENT,a+n+u)}var Ud=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new _n(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Ty(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(jS("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Ty=class extends Ud{data(){return super.data()}};function jS(n,e){return typeof e=="string"?LM(n,e):e instanceof Fd?e._internalPath:e._delegate._internalPath}function MM(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new re(J.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ay=class{convertValue(e,t="none"){switch(Ti(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Le(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(br(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ue(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Du(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){let t=e.fields?.[Iu].arrayValue?.values?.map(r=>Le(r.doubleValue));return new na(t)}convertGeoPoint(e){return new ta(Le(e.latitude),Le(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=jd(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(yu(e));default:return null}}convertTimestamp(e){let t=Ar(e);return new kt(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ht.fromString(e);Me(AS(r),9688,{name:e});let i=new Id(r.get(1),r.get(3)),s=new ce(r.popFirst(5));return i.isEqual(t)||Tr(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function FM(){return new wy("count")}var ks=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Ns=class n extends Ud{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ra(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(jS("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new re(J.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Ns._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ns._jsonSchema={type:Xe("string",Ns._jsonSchemaVersion),bundleSource:Xe("string","DocumentSnapshot"),bundleName:Xe("string"),bundle:Xe("string")};var ra=class extends Ns{data(e={}){return super.data(e)}},ia=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ks(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ra(this._firestore,this._userDataWriter,r.key,r,new ks(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new re(J.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new ra(i._firestore,i._userDataWriter,a.doc.key,a.doc,new ks(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new ra(i._firestore,i._userDataWriter,a.doc.key,a.doc,new ks(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,d=-1;return a.type!==0&&(h=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:UM(a.type),doc:u,oldIndex:h,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new re(J.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=pd.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function UM(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ue(61501,{type:n})}}ia._jsonSchemaVersion="firestore/querySnapshot/1.0",ia._jsonSchema={type:Xe("string",ia._jsonSchemaVersion),bundleSource:Xe("string","QuerySnapshot"),bundleName:Xe("string"),bundle:Xe("string")};var ku=class extends Ay{constructor(e){super(),this.firestore=e}convertBytes(e){return new ea(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new _n(this.firestore,null,t)}};function $S(n,...e){n=On(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||kb(e[r])||(t=e[r++]);let i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(kb(e[r])){let u=e[r];e[r]=u.next?.bind(u),e[r+1]=u.error?.bind(u),e[r+2]=u.complete?.bind(u)}let s,o,a;if(n instanceof _n)o=ld(n.firestore,_a),a=Ny(n._key.path),s={next:u=>{e[r]&&e[r](BM(o,n,u))},error:e[r+1],complete:e[r+2]};else{let u=ld(n,Ld);o=ld(u.firestore,_a),a=u._query;let h=new ku(o);s={next:d=>{e[r]&&e[r](new ia(o,h,u,d))},error:e[r+1],complete:e[r+2]},MM(n._query)}return function(h,d,m,v){let C=new yy(v),k=new hy(d,C,m);return h.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return gM(yield bb(h),k)})),()=>{C.Nu(),h.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return _M(yield bb(h),k)}))}}(qS(o),a,i,s)}function BM(n,e,t){let r=t.docs.get(e._key),i=new ku(n);return new Ns(n,i,e._key,r,new ks(t.hasPendingWrites,t.fromCache),e.converter)}function zS(n){return qM(n,{count:FM()})}function qM(n,e){let t=ld(n.firestore,_a),r=qS(t),i=mL(e,(s,o)=>new I_(o,s.aggregateType,s._internalFieldPath));return DM(r,n._query,i).then(s=>function(a,u,h){let d=new ku(a);return new vy(u,d,h)}(t,n,s))}(function(e,t=!0){(function(i){ya=i})(jo),gi(new pn("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new _a(new Hg(r.getProvider("auth-internal")),new Yg(o,r.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new re(J.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Id(h.options.projectId,d)}(o,i),o);return s=je({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),hr($A,zA,e),hr($A,zA,"esm2020")})();var Wd=function(){return Wd=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Wd.apply(this,arguments)};function jy(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var jM={includeMetadataChanges:!1};function xu(n,e){return e===void 0&&(e=jM),new ir(function(t){var r=$S(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function $y(n){return xu(n,{includeMetadataChanges:!0})}function GS(n,e){return e===void 0&&(e={}),$y(n).pipe(ms(function(t){return Kd(t,e)}))}function Kd(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Wd(Wd({},r),(t={},t[e.idField]=n.id,t))}var WS=["added","modified","removed"],$M=function(n){return jp(function(e){for(var t=!1,r=0;r<e.length;r++){var i=e[r];if(n&&n.indexOf(i.type)>=0){t=!0;break}}return t})};function By(n,e,t){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var s=n.slice();return s.splice.apply(s,jy([e,t],r,!1)),s}function zM(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&wa(n[e.newIndex].doc.ref,e.doc.ref)))return By(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||wa(n[e.oldIndex].doc.ref,e.doc.ref))if(e.oldIndex!==e.newIndex){var t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return By(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&wa(n[e.oldIndex].doc.ref,e.doc.ref))return By(n,e.oldIndex,1);break}return n}function GM(n,e,t){return t===void 0&&(t=WS),e.forEach(function(r){t.indexOf(r.type)>-1&&(n=zM(n,r))}),n}var KS=function(){return Up(lv(void 0),uv())},qy=function(n,e){return JSON.stringify(n.metadata)===JSON.stringify(e.metadata)},WM=function(){return Up(KS(),jp(function(n){var e=n[0],t=n[1];return t.length>0||e===void 0}),ms(function(n){var e=n[1];return e}))};function Hd(n,e){return e===void 0&&(e={}),xu(n,{includeMetadataChanges:!0}).pipe(KS(),ms(function(t){var r=t[0],i=t[1],s=i.docChanges();return r&&!qy(r,i)&&i.docs.forEach(function(o,a){var u=s.find(function(d){return wa(d.doc.ref,o.ref)});if(u){if(qy(u.doc,o))return}else{var h=r?.docs.find(function(d){return wa(d.ref,o.ref)});if(h&&qy(h,o))return}s.push({oldIndex:a,newIndex:a,type:"modified",doc:o})}),s}),$M(e.events||WS),WM())}function zy(n){return xu(n,{includeMetadataChanges:!0}).pipe(ms(function(e){return e.docs}))}function HS(n,e){return e===void 0&&(e={}),Hd(n,e).pipe($p(function(t,r){return GM(t,r,e.events)},[]),cv())}function QS(n,e){return e===void 0&&(e={}),Hd(n,e).pipe($p(function(t,r){return jy(jy([],t,!0),r,!0)},[]))}function JS(n,e){return e===void 0&&(e={}),zy(n).pipe(ms(function(t){return t.map(function(r){return Kd(r,e)})}))}function Gy(n){return Fc(zS(n))}function YS(n){return Gy(n).pipe(ms(function(e){return e.data().count}))}var XS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ZS={};var Rr,Wy;(function(){var n;function e(T,y){function E(){}E.prototype=y.prototype,T.D=y.prototype,T.prototype=new E,T.prototype.constructor=T,T.C=function(b,A,P){for(var I=Array(arguments.length-2),xe=2;xe<arguments.length;xe++)I[xe-2]=arguments[xe];return y.prototype[A].apply(b,I)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,y,E){E||(E=0);var b=Array(16);if(typeof y=="string")for(var A=0;16>A;++A)b[A]=y.charCodeAt(E++)|y.charCodeAt(E++)<<8|y.charCodeAt(E++)<<16|y.charCodeAt(E++)<<24;else for(A=0;16>A;++A)b[A]=y[E++]|y[E++]<<8|y[E++]<<16|y[E++]<<24;y=T.g[0],E=T.g[1],A=T.g[2];var P=T.g[3],I=y+(P^E&(A^P))+b[0]+3614090360&4294967295;y=E+(I<<7&4294967295|I>>>25),I=P+(A^y&(E^A))+b[1]+3905402710&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(E^P&(y^E))+b[2]+606105819&4294967295,A=P+(I<<17&4294967295|I>>>15),I=E+(y^A&(P^y))+b[3]+3250441966&4294967295,E=A+(I<<22&4294967295|I>>>10),I=y+(P^E&(A^P))+b[4]+4118548399&4294967295,y=E+(I<<7&4294967295|I>>>25),I=P+(A^y&(E^A))+b[5]+1200080426&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(E^P&(y^E))+b[6]+2821735955&4294967295,A=P+(I<<17&4294967295|I>>>15),I=E+(y^A&(P^y))+b[7]+4249261313&4294967295,E=A+(I<<22&4294967295|I>>>10),I=y+(P^E&(A^P))+b[8]+1770035416&4294967295,y=E+(I<<7&4294967295|I>>>25),I=P+(A^y&(E^A))+b[9]+2336552879&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(E^P&(y^E))+b[10]+4294925233&4294967295,A=P+(I<<17&4294967295|I>>>15),I=E+(y^A&(P^y))+b[11]+2304563134&4294967295,E=A+(I<<22&4294967295|I>>>10),I=y+(P^E&(A^P))+b[12]+1804603682&4294967295,y=E+(I<<7&4294967295|I>>>25),I=P+(A^y&(E^A))+b[13]+4254626195&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(E^P&(y^E))+b[14]+2792965006&4294967295,A=P+(I<<17&4294967295|I>>>15),I=E+(y^A&(P^y))+b[15]+1236535329&4294967295,E=A+(I<<22&4294967295|I>>>10),I=y+(A^P&(E^A))+b[1]+4129170786&4294967295,y=E+(I<<5&4294967295|I>>>27),I=P+(E^A&(y^E))+b[6]+3225465664&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^E&(P^y))+b[11]+643717713&4294967295,A=P+(I<<14&4294967295|I>>>18),I=E+(P^y&(A^P))+b[0]+3921069994&4294967295,E=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(E^A))+b[5]+3593408605&4294967295,y=E+(I<<5&4294967295|I>>>27),I=P+(E^A&(y^E))+b[10]+38016083&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^E&(P^y))+b[15]+3634488961&4294967295,A=P+(I<<14&4294967295|I>>>18),I=E+(P^y&(A^P))+b[4]+3889429448&4294967295,E=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(E^A))+b[9]+568446438&4294967295,y=E+(I<<5&4294967295|I>>>27),I=P+(E^A&(y^E))+b[14]+3275163606&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^E&(P^y))+b[3]+4107603335&4294967295,A=P+(I<<14&4294967295|I>>>18),I=E+(P^y&(A^P))+b[8]+1163531501&4294967295,E=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(E^A))+b[13]+2850285829&4294967295,y=E+(I<<5&4294967295|I>>>27),I=P+(E^A&(y^E))+b[2]+4243563512&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^E&(P^y))+b[7]+1735328473&4294967295,A=P+(I<<14&4294967295|I>>>18),I=E+(P^y&(A^P))+b[12]+2368359562&4294967295,E=A+(I<<20&4294967295|I>>>12),I=y+(E^A^P)+b[5]+4294588738&4294967295,y=E+(I<<4&4294967295|I>>>28),I=P+(y^E^A)+b[8]+2272392833&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^E)+b[11]+1839030562&4294967295,A=P+(I<<16&4294967295|I>>>16),I=E+(A^P^y)+b[14]+4259657740&4294967295,E=A+(I<<23&4294967295|I>>>9),I=y+(E^A^P)+b[1]+2763975236&4294967295,y=E+(I<<4&4294967295|I>>>28),I=P+(y^E^A)+b[4]+1272893353&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^E)+b[7]+4139469664&4294967295,A=P+(I<<16&4294967295|I>>>16),I=E+(A^P^y)+b[10]+3200236656&4294967295,E=A+(I<<23&4294967295|I>>>9),I=y+(E^A^P)+b[13]+681279174&4294967295,y=E+(I<<4&4294967295|I>>>28),I=P+(y^E^A)+b[0]+3936430074&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^E)+b[3]+3572445317&4294967295,A=P+(I<<16&4294967295|I>>>16),I=E+(A^P^y)+b[6]+76029189&4294967295,E=A+(I<<23&4294967295|I>>>9),I=y+(E^A^P)+b[9]+3654602809&4294967295,y=E+(I<<4&4294967295|I>>>28),I=P+(y^E^A)+b[12]+3873151461&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^E)+b[15]+530742520&4294967295,A=P+(I<<16&4294967295|I>>>16),I=E+(A^P^y)+b[2]+3299628645&4294967295,E=A+(I<<23&4294967295|I>>>9),I=y+(A^(E|~P))+b[0]+4096336452&4294967295,y=E+(I<<6&4294967295|I>>>26),I=P+(E^(y|~A))+b[7]+1126891415&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~E))+b[14]+2878612391&4294967295,A=P+(I<<15&4294967295|I>>>17),I=E+(P^(A|~y))+b[5]+4237533241&4294967295,E=A+(I<<21&4294967295|I>>>11),I=y+(A^(E|~P))+b[12]+1700485571&4294967295,y=E+(I<<6&4294967295|I>>>26),I=P+(E^(y|~A))+b[3]+2399980690&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~E))+b[10]+4293915773&4294967295,A=P+(I<<15&4294967295|I>>>17),I=E+(P^(A|~y))+b[1]+2240044497&4294967295,E=A+(I<<21&4294967295|I>>>11),I=y+(A^(E|~P))+b[8]+1873313359&4294967295,y=E+(I<<6&4294967295|I>>>26),I=P+(E^(y|~A))+b[15]+4264355552&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~E))+b[6]+2734768916&4294967295,A=P+(I<<15&4294967295|I>>>17),I=E+(P^(A|~y))+b[13]+1309151649&4294967295,E=A+(I<<21&4294967295|I>>>11),I=y+(A^(E|~P))+b[4]+4149444226&4294967295,y=E+(I<<6&4294967295|I>>>26),I=P+(E^(y|~A))+b[11]+3174756917&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~E))+b[2]+718787259&4294967295,A=P+(I<<15&4294967295|I>>>17),I=E+(P^(A|~y))+b[9]+3951481745&4294967295,T.g[0]=T.g[0]+y&4294967295,T.g[1]=T.g[1]+(A+(I<<21&4294967295|I>>>11))&4294967295,T.g[2]=T.g[2]+A&4294967295,T.g[3]=T.g[3]+P&4294967295}r.prototype.u=function(T,y){y===void 0&&(y=T.length);for(var E=y-this.blockSize,b=this.B,A=this.h,P=0;P<y;){if(A==0)for(;P<=E;)i(this,T,P),P+=this.blockSize;if(typeof T=="string"){for(;P<y;)if(b[A++]=T.charCodeAt(P++),A==this.blockSize){i(this,b),A=0;break}}else for(;P<y;)if(b[A++]=T[P++],A==this.blockSize){i(this,b),A=0;break}}this.h=A,this.o+=y},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var y=1;y<T.length-8;++y)T[y]=0;var E=8*this.o;for(y=T.length-8;y<T.length;++y)T[y]=E&255,E/=256;for(this.u(T),T=Array(16),y=E=0;4>y;++y)for(var b=0;32>b;b+=8)T[E++]=this.g[y]>>>b&255;return T};function s(T,y){var E=a;return Object.prototype.hasOwnProperty.call(E,T)?E[T]:E[T]=y(T)}function o(T,y){this.h=y;for(var E=[],b=!0,A=T.length-1;0<=A;A--){var P=T[A]|0;b&&P==y||(E[A]=P,b=!1)}this.g=E}var a={};function u(T){return-128<=T&&128>T?s(T,function(y){return new o([y|0],0>y?-1:0)}):new o([T|0],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return m;if(0>T)return N(h(-T));for(var y=[],E=1,b=0;T>=E;b++)y[b]=T/E|0,E*=4294967296;return new o(y,0)}function d(T,y){if(T.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(T.charAt(0)=="-")return N(d(T.substring(1),y));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=h(Math.pow(y,8)),b=m,A=0;A<T.length;A+=8){var P=Math.min(8,T.length-A),I=parseInt(T.substring(A,A+P),y);8>P?(P=h(Math.pow(y,P)),b=b.j(P).add(h(I))):(b=b.j(E),b=b.add(h(I)))}return b}var m=u(0),v=u(1),C=u(16777216);n=o.prototype,n.m=function(){if(V(this))return-N(this).m();for(var T=0,y=1,E=0;E<this.g.length;E++){var b=this.i(E);T+=(0<=b?b:4294967296+b)*y,y*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(k(this))return"0";if(V(this))return"-"+N(this).toString(T);for(var y=h(Math.pow(T,6)),E=this,b="";;){var A=te(E,y).g;E=q(E,A.j(y));var P=((0<E.g.length?E.g[0]:E.h)>>>0).toString(T);if(E=A,k(E))return P+b;for(;6>P.length;)P="0"+P;b=P+b}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function k(T){if(T.h!=0)return!1;for(var y=0;y<T.g.length;y++)if(T.g[y]!=0)return!1;return!0}function V(T){return T.h==-1}n.l=function(T){return T=q(this,T),V(T)?-1:k(T)?0:1};function N(T){for(var y=T.g.length,E=[],b=0;b<y;b++)E[b]=~T.g[b];return new o(E,~T.h).add(v)}n.abs=function(){return V(this)?N(this):this},n.add=function(T){for(var y=Math.max(this.g.length,T.g.length),E=[],b=0,A=0;A<=y;A++){var P=b+(this.i(A)&65535)+(T.i(A)&65535),I=(P>>>16)+(this.i(A)>>>16)+(T.i(A)>>>16);b=I>>>16,P&=65535,I&=65535,E[A]=I<<16|P}return new o(E,E[E.length-1]&-2147483648?-1:0)};function q(T,y){return T.add(N(y))}n.j=function(T){if(k(this)||k(T))return m;if(V(this))return V(T)?N(this).j(N(T)):N(N(this).j(T));if(V(T))return N(this.j(N(T)));if(0>this.l(C)&&0>T.l(C))return h(this.m()*T.m());for(var y=this.g.length+T.g.length,E=[],b=0;b<2*y;b++)E[b]=0;for(b=0;b<this.g.length;b++)for(var A=0;A<T.g.length;A++){var P=this.i(b)>>>16,I=this.i(b)&65535,xe=T.i(A)>>>16,Dt=T.i(A)&65535;E[2*b+2*A]+=I*Dt,G(E,2*b+2*A),E[2*b+2*A+1]+=P*Dt,G(E,2*b+2*A+1),E[2*b+2*A+1]+=I*xe,G(E,2*b+2*A+1),E[2*b+2*A+2]+=P*xe,G(E,2*b+2*A+2)}for(b=0;b<y;b++)E[b]=E[2*b+1]<<16|E[2*b];for(b=y;b<2*y;b++)E[b]=0;return new o(E,0)};function G(T,y){for(;(T[y]&65535)!=T[y];)T[y+1]+=T[y]>>>16,T[y]&=65535,y++}function $(T,y){this.g=T,this.h=y}function te(T,y){if(k(y))throw Error("division by zero");if(k(T))return new $(m,m);if(V(T))return y=te(N(T),y),new $(N(y.g),N(y.h));if(V(y))return y=te(T,N(y)),new $(N(y.g),y.h);if(30<T.g.length){if(V(T)||V(y))throw Error("slowDivide_ only works with positive integers.");for(var E=v,b=y;0>=b.l(T);)E=oe(E),b=oe(b);var A=Z(E,1),P=Z(b,1);for(b=Z(b,2),E=Z(E,2);!k(b);){var I=P.add(b);0>=I.l(T)&&(A=A.add(E),P=I),b=Z(b,1),E=Z(E,1)}return y=q(T,A.j(y)),new $(A,y)}for(A=m;0<=T.l(y);){for(E=Math.max(1,Math.floor(T.m()/y.m())),b=Math.ceil(Math.log(E)/Math.LN2),b=48>=b?1:Math.pow(2,b-48),P=h(E),I=P.j(y);V(I)||0<I.l(T);)E-=b,P=h(E),I=P.j(y);k(P)&&(P=v),A=A.add(P),T=q(T,I)}return new $(A,T)}n.A=function(T){return te(this,T).h},n.and=function(T){for(var y=Math.max(this.g.length,T.g.length),E=[],b=0;b<y;b++)E[b]=this.i(b)&T.i(b);return new o(E,this.h&T.h)},n.or=function(T){for(var y=Math.max(this.g.length,T.g.length),E=[],b=0;b<y;b++)E[b]=this.i(b)|T.i(b);return new o(E,this.h|T.h)},n.xor=function(T){for(var y=Math.max(this.g.length,T.g.length),E=[],b=0;b<y;b++)E[b]=this.i(b)^T.i(b);return new o(E,this.h^T.h)};function oe(T){for(var y=T.g.length+1,E=[],b=0;b<y;b++)E[b]=T.i(b)<<1|T.i(b-1)>>>31;return new o(E,T.h)}function Z(T,y){var E=y>>5;y%=32;for(var b=T.g.length-E,A=[],P=0;P<b;P++)A[P]=0<y?T.i(P+E)>>>y|T.i(P+E+1)<<32-y:T.i(P+E);return new o(A,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Wy=ZS.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,Rr=ZS.Integer=o}).apply(typeof XS<"u"?XS:typeof self<"u"?self:typeof window<"u"?window:{});var Qd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Pr={};var Ky,KM,va,Hy,Lu,Jd,Qy,Jy,Yy;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,f,g){return c==Array.prototype||c==Object.prototype||(c[f]=g.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qd=="object"&&Qd];for(var f=0;f<c.length;++f){var g=c[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function i(c,f){if(f)e:{var g=r;c=c.split(".");for(var S=0;S<c.length-1;S++){var O=c[S];if(!(O in g))break e;g=g[O]}c=c[c.length-1],S=g[c],f=f(S),f!=S&&f!=null&&e(g,c,{configurable:!0,writable:!0,value:f})}}function s(c,f){c instanceof String&&(c+="");var g=0,S=!1,O={next:function(){if(!S&&g<c.length){var F=g++;return{value:f(F,c[F]),done:!1}}return S=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}i("Array.prototype.values",function(c){return c||function(){return s(this,function(f,g){return g})}});var o=o||{},a=this||self;function u(c){var f=typeof c;return f=f!="object"?f:c?Array.isArray(c)?"array":f:"null",f=="array"||f=="object"&&typeof c.length=="number"}function h(c){var f=typeof c;return f=="object"&&c!=null||f=="function"}function d(c,f,g){return c.call.apply(c.bind,arguments)}function m(c,f,g){if(!c)throw Error();if(2<arguments.length){var S=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,S),c.apply(f,O)}}return function(){return c.apply(f,arguments)}}function v(c,f,g){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:m,v.apply(null,arguments)}function C(c,f){var g=Array.prototype.slice.call(arguments,1);return function(){var S=g.slice();return S.push.apply(S,arguments),c.apply(this,S)}}function k(c,f){function g(){}g.prototype=f.prototype,c.aa=f.prototype,c.prototype=new g,c.prototype.constructor=c,c.Qb=function(S,O,F){for(var z=Array(arguments.length-2),ve=2;ve<arguments.length;ve++)z[ve-2]=arguments[ve];return f.prototype[O].apply(S,z)}}function V(c){let f=c.length;if(0<f){let g=Array(f);for(let S=0;S<f;S++)g[S]=c[S];return g}return[]}function N(c,f){for(let g=1;g<arguments.length;g++){let S=arguments[g];if(u(S)){let O=c.length||0,F=S.length||0;c.length=O+F;for(let z=0;z<F;z++)c[O+z]=S[z]}else c.push(S)}}class q{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function G(c){return/^[\s\xa0]*$/.test(c)}function $(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function te(c){return te[" "](c),c}te[" "]=function(){};var oe=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function Z(c,f,g){for(let S in c)f.call(g,c[S],S,c)}function T(c,f){for(let g in c)f.call(void 0,c[g],g,c)}function y(c){let f={};for(let g in c)f[g]=c[g];return f}let E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(c,f){let g,S;for(let O=1;O<arguments.length;O++){S=arguments[O];for(g in S)c[g]=S[g];for(let F=0;F<E.length;F++)g=E[F],Object.prototype.hasOwnProperty.call(S,g)&&(c[g]=S[g])}}function A(c){var f=1;c=c.split(":");let g=[];for(;0<f&&c.length;)g.push(c.shift()),f--;return c.length&&g.push(c.join(":")),g}function P(c){a.setTimeout(()=>{throw c},0)}function I(){var c=Br;let f=null;return c.g&&(f=c.g,c.g=c.g.next,c.g||(c.h=null),f.next=null),f}class xe{constructor(){this.h=this.g=null}add(f,g){let S=Dt.get();S.set(f,g),this.h?this.h.next=S:this.g=S,this.h=S}}var Dt=new q(()=>new Vp,c=>c.reset());class Vp{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Yi,Tn=!1,Br=new xe,Fl=()=>{let c=a.Promise.resolve(void 0);Yi=()=>{c.then(Ul)}};var Ul=()=>{for(var c;c=I();){try{c.h.call(c.g)}catch(g){P(g)}var f=Dt;f.j(c),100>f.h&&(f.h++,c.next=f.g,f.g=c)}Tn=!1};function rn(){this.s=this.s,this.C=this.C}rn.prototype.s=!1,rn.prototype.ma=function(){this.s||(this.s=!0,this.N())},rn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ot(c,f){this.type=c,this.g=this.target=f,this.defaultPrevented=!1}ot.prototype.h=function(){this.defaultPrevented=!0};var ao=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,f=Object.defineProperty({},"passive",{get:function(){c=!0}});try{let g=()=>{};a.addEventListener("test",g,f),a.removeEventListener("test",g,f)}catch{}return c}();function Qn(c,f){if(ot.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var g=this.type=c.type,S=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=f,f=c.relatedTarget){if(oe){e:{try{te(f.nodeName);var O=!0;break e}catch{}O=!1}O||(f=null)}}else g=="mouseover"?f=c.fromElement:g=="mouseout"&&(f=c.toElement);this.relatedTarget=f,S?(this.clientX=S.clientX!==void 0?S.clientX:S.pageX,this.clientY=S.clientY!==void 0?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:mc[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&Qn.aa.h.call(this)}}k(Qn,ot);var mc={2:"touch",3:"pen",4:"mouse"};Qn.prototype.h=function(){Qn.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Jn="closure_listenable_"+(1e6*Math.random()|0),gc=0;function Bl(c,f,g,S,O){this.listener=c,this.proxy=null,this.src=f,this.type=g,this.capture=!!S,this.ha=O,this.key=++gc,this.da=this.fa=!1}function Xi(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function co(c){this.src=c,this.g={},this.h=0}co.prototype.add=function(c,f,g,S,O){var F=c.toString();c=this.g[F],c||(c=this.g[F]=[],this.h++);var z=lo(c,f,S,O);return-1<z?(f=c[z],g||(f.fa=!1)):(f=new Bl(f,this.src,F,!!S,O),f.fa=g,c.push(f)),f};function uo(c,f){var g=f.type;if(g in c.g){var S=c.g[g],O=Array.prototype.indexOf.call(S,f,void 0),F;(F=0<=O)&&Array.prototype.splice.call(S,O,1),F&&(Xi(f),c.g[g].length==0&&(delete c.g[g],c.h--))}}function lo(c,f,g,S){for(var O=0;O<c.length;++O){var F=c[O];if(!F.da&&F.listener==f&&F.capture==!!g&&F.ha==S)return O}return-1}var Zi="closure_lm_"+(1e6*Math.random()|0),ho={};function ql(c,f,g,S,O){if(S&&S.once)return po(c,f,g,S,O);if(Array.isArray(f)){for(var F=0;F<f.length;F++)ql(c,f[F],g,S,O);return null}return g=Yn(g),c&&c[Jn]?c.K(f,g,h(S)?!!S.capture:!!S,O):fo(c,f,g,!1,S,O)}function fo(c,f,g,S,O,F){if(!f)throw Error("Invalid event type");var z=h(O)?!!O.capture:!!O,ve=mo(c);if(ve||(c[Zi]=ve=new co(c)),g=ve.add(f,g,S,z,F),g.proxy)return g;if(S=_c(),g.proxy=S,S.src=c,S.listener=g,c.addEventListener)ao||(O=z),O===void 0&&(O=!1),c.addEventListener(f.toString(),S,O);else if(c.attachEvent)c.attachEvent(es(f.toString()),S);else if(c.addListener&&c.removeListener)c.addListener(S);else throw Error("addEventListener and attachEvent are unavailable.");return g}function _c(){function c(g){return f.call(c.src,c.listener,g)}let f=xp;return c}function po(c,f,g,S,O){if(Array.isArray(f)){for(var F=0;F<f.length;F++)po(c,f[F],g,S,O);return null}return g=Yn(g),c&&c[Jn]?c.L(f,g,h(S)?!!S.capture:!!S,O):fo(c,f,g,!0,S,O)}function at(c,f,g,S,O){if(Array.isArray(f))for(var F=0;F<f.length;F++)at(c,f[F],g,S,O);else S=h(S)?!!S.capture:!!S,g=Yn(g),c&&c[Jn]?(c=c.i,f=String(f).toString(),f in c.g&&(F=c.g[f],g=lo(F,g,S,O),-1<g&&(Xi(F[g]),Array.prototype.splice.call(F,g,1),F.length==0&&(delete c.g[f],c.h--)))):c&&(c=mo(c))&&(f=c.g[f.toString()],c=-1,f&&(c=lo(f,g,S,O)),(g=-1<c?f[c]:null)&&ct(g))}function ct(c){if(typeof c!="number"&&c&&!c.da){var f=c.src;if(f&&f[Jn])uo(f.i,c);else{var g=c.type,S=c.proxy;f.removeEventListener?f.removeEventListener(g,S,c.capture):f.detachEvent?f.detachEvent(es(g),S):f.addListener&&f.removeListener&&f.removeListener(S),(g=mo(f))?(uo(g,c),g.h==0&&(g.src=null,f[Zi]=null)):Xi(c)}}}function es(c){return c in ho?ho[c]:ho[c]="on"+c}function xp(c,f){if(c.da)c=!0;else{f=new Qn(f,this);var g=c.listener,S=c.ha||c.src;c.fa&&ct(c),c=g.call(S,f)}return c}function mo(c){return c=c[Zi],c instanceof co?c:null}var yc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Yn(c){return typeof c=="function"?c:(c[yc]||(c[yc]=function(f){return c.handleEvent(f)}),c[yc])}function ut(){rn.call(this),this.i=new co(this),this.M=this,this.F=null}k(ut,rn),ut.prototype[Jn]=!0,ut.prototype.removeEventListener=function(c,f,g,S){at(this,c,f,g,S)};function pt(c,f){var g,S=c.F;if(S)for(g=[];S;S=S.F)g.push(S);if(c=c.M,S=f.type||f,typeof f=="string")f=new ot(f,c);else if(f instanceof ot)f.target=f.target||c;else{var O=f;f=new ot(S,c),b(f,O)}if(O=!0,g)for(var F=g.length-1;0<=F;F--){var z=f.g=g[F];O=qr(z,S,!0,f)&&O}if(z=f.g=c,O=qr(z,S,!0,f)&&O,O=qr(z,S,!1,f)&&O,g)for(F=0;F<g.length;F++)z=f.g=g[F],O=qr(z,S,!1,f)&&O}ut.prototype.N=function(){if(ut.aa.N.call(this),this.i){var c=this.i,f;for(f in c.g){for(var g=c.g[f],S=0;S<g.length;S++)Xi(g[S]);delete c.g[f],c.h--}}this.F=null},ut.prototype.K=function(c,f,g,S){return this.i.add(String(c),f,!1,g,S)},ut.prototype.L=function(c,f,g,S){return this.i.add(String(c),f,!0,g,S)};function qr(c,f,g,S){if(f=c.i.g[String(f)],!f)return!0;f=f.concat();for(var O=!0,F=0;F<f.length;++F){var z=f[F];if(z&&!z.da&&z.capture==g){var ve=z.listener,ze=z.ha||z.src;z.fa&&uo(c.i,z),O=ve.call(ze,S)!==!1&&O}}return O&&!S.defaultPrevented}function jl(c,f,g){if(typeof c=="function")g&&(c=v(c,g));else if(c&&typeof c.handleEvent=="function")c=v(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:a.setTimeout(c,f||0)}function $l(c){c.g=jl(()=>{c.g=null,c.i&&(c.i=!1,$l(c))},c.l);let f=c.h;c.h=null,c.m.apply(null,f)}class zl extends rn{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:$l(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function jr(c){rn.call(this),this.h=c,this.g={}}k(jr,rn);var $r=[];function go(c){Z(c.g,function(f,g){this.g.hasOwnProperty(g)&&ct(f)},c),c.g={}}jr.prototype.N=function(){jr.aa.N.call(this),go(this)},jr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ts=a.JSON.stringify,Xn=a.JSON.parse,Gl=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function zr(){}zr.prototype.h=null;function Ic(c){return c.h||(c.h=c.i())}function Gr(){}var Wr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function lt(){ot.call(this,"d")}k(lt,ot);function _o(){ot.call(this,"c")}k(_o,ot);var Ft={},Kr=null;function yo(){return Kr=Kr||new ut}Ft.La="serverreachability";function Wl(c){ot.call(this,Ft.La,c)}k(Wl,ot);function Qt(c){let f=yo();pt(f,new Wl(f))}Ft.STAT_EVENT="statevent";function Kl(c,f){ot.call(this,Ft.STAT_EVENT,c),this.stat=f}k(Kl,ot);function _t(c){let f=yo();pt(f,new Kl(f,c))}Ft.Ma="timingevent";function ns(c,f){ot.call(this,Ft.Ma,c),this.size=f}k(ns,ot);function Hr(c,f){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},f)}function Qr(){this.g=!0}Qr.prototype.xa=function(){this.g=!1};function Ec(c,f,g,S,O,F){c.info(function(){if(c.g)if(F)for(var z="",ve=F.split("&"),ze=0;ze<ve.length;ze++){var Te=ve[ze].split("=");if(1<Te.length){var It=Te[0];Te=Te[1];var Et=It.split("_");z=2<=Et.length&&Et[1]=="type"?z+(It+"="+Te+"&"):z+(It+"=redacted&")}}else z=null;else z=F;return"XMLHTTP REQ ("+S+") [attempt "+O+"]: "+f+`
`+g+`
`+z})}function rs(c,f,g,S,O,F,z){c.info(function(){return"XMLHTTP RESP ("+S+") [ attempt "+O+"]: "+f+`
`+g+`
`+F+" "+z})}function Jr(c,f,g,S){c.info(function(){return"XMLHTTP TEXT ("+f+"): "+Hl(c,g)+(S?" "+S:"")})}function An(c,f){c.info(function(){return"TIMEOUT: "+f})}Qr.prototype.info=function(){};function Hl(c,f){if(!c.g)return f;if(!f)return null;try{var g=JSON.parse(f);if(g){for(c=0;c<g.length;c++)if(Array.isArray(g[c])){var S=g[c];if(!(2>S.length)){var O=S[1];if(Array.isArray(O)&&!(1>O.length)){var F=O[0];if(F!="noop"&&F!="stop"&&F!="close")for(var z=1;z<O.length;z++)O[z]=""}}}}return ts(g)}catch{return f}}var is={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Io={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ss;function os(){}k(os,zr),os.prototype.g=function(){return new XMLHttpRequest},os.prototype.i=function(){return{}},ss=new os;function bn(c,f,g,S){this.j=c,this.i=f,this.l=g,this.R=S||1,this.U=new jr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new wc}function wc(){this.i=null,this.g="",this.h=!1}var Ql={},Yr={};function Eo(c,f,g){c.L=1,c.v=Ao(sn(f)),c.m=g,c.P=!0,wo(c,null)}function wo(c,f){c.F=Date.now(),Zr(c),c.A=sn(c.v);var g=c.A,S=c.R;Array.isArray(S)||(S=[String(S)]),rh(g.i,"t",S),c.C=0,g=c.j.J,c.h=new wc,c.g=p(c.j,g?f:null,!c.m),0<c.O&&(c.M=new zl(v(c.Y,c,c.g),c.O)),f=c.U,g=c.g,S=c.ca;var O="readystatechange";Array.isArray(O)||(O&&($r[0]=O.toString()),O=$r);for(var F=0;F<O.length;F++){var z=ql(g,O[F],S||f.handleEvent,!1,f.h||f);if(!z)break;f.g[z.key]=z}f=c.H?y(c.H):{},c.m?(c.u||(c.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,f)):(c.u="GET",c.g.ea(c.A,c.u,null,f)),Qt(),Ec(c.i,c.u,c.A,c.l,c.R,c.m)}bn.prototype.ca=function(c){c=c.target;let f=this.M;f&&Vt(c)==3?f.j():this.Y(c)},bn.prototype.Y=function(c){try{if(c==this.g)e:{let Et=Vt(this.g);var f=this.g.Ba();let Oo=this.g.Z();if(!(3>Et)&&(Et!=3||this.g&&(this.h.h||this.g.oa()||ch(this.g)))){this.J||Et!=4||f==7||(f==8||0>=Oo?Qt(3):Qt(2)),vo(this);var g=this.g.Z();this.X=g;t:if(Xr(this)){var S=ch(this.g);c="";var O=S.length,F=Vt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Sn(this),ei(this);var z="";break t}this.h.i=new a.TextDecoder}for(f=0;f<O;f++)this.h.h=!0,c+=this.h.i.decode(S[f],{stream:!(F&&f==O-1)});S.length=0,this.h.g+=c,this.C=0,z=this.h.g}else z=this.g.oa();if(this.o=g==200,rs(this.i,this.u,this.A,this.l,this.R,Et,g),this.o){if(this.T&&!this.K){t:{if(this.g){var ve,ze=this.g;if((ve=ze.g?ze.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(ve)){var Te=ve;break t}}Te=null}if(g=Te)Jr(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,as(this,g);else{this.o=!1,this.s=3,_t(12),Sn(this),ei(this);break e}}if(this.P){g=!0;let ln;for(;!this.J&&this.C<z.length;)if(ln=Zn(this,z),ln==Yr){Et==4&&(this.s=4,_t(14),g=!1),Jr(this.i,this.l,null,"[Incomplete Response]");break}else if(ln==Ql){this.s=4,_t(15),Jr(this.i,this.l,z,"[Invalid Chunk]"),g=!1;break}else Jr(this.i,this.l,ln,null),as(this,ln);if(Xr(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Et!=4||z.length!=0||this.h.h||(this.s=1,_t(16),g=!1),this.o=this.o&&g,!g)Jr(this.i,this.l,z,"[Invalid Chunked Response]"),Sn(this),ei(this);else if(0<z.length&&!this.W){this.W=!0;var It=this.j;It.g==this&&It.ba&&!It.M&&(It.j.info("Great, no buffering proxy detected. Bytes received: "+z.length),Do(It),It.M=!0,_t(11))}}else Jr(this.i,this.l,z,null),as(this,z);Et==4&&Sn(this),this.o&&!this.J&&(Et==4?yt(this.j,this):(this.o=!1,Zr(this)))}else uh(this.g),g==400&&0<z.indexOf("Unknown SID")?(this.s=3,_t(12)):(this.s=0,_t(13)),Sn(this),ei(this)}}}catch{}finally{}};function Xr(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function Zn(c,f){var g=c.C,S=f.indexOf(`
`,g);return S==-1?Yr:(g=Number(f.substring(g,S)),isNaN(g)?Ql:(S+=1,S+g>f.length?Yr:(f=f.slice(S,S+g),c.C=S+g,f)))}bn.prototype.cancel=function(){this.J=!0,Sn(this)};function Zr(c){c.S=Date.now()+c.I,Jl(c,c.I)}function Jl(c,f){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Hr(v(c.ba,c),f)}function vo(c){c.B&&(a.clearTimeout(c.B),c.B=null)}bn.prototype.ba=function(){this.B=null;let c=Date.now();0<=c-this.S?(An(this.i,this.A),this.L!=2&&(Qt(),_t(17)),Sn(this),this.s=2,ei(this)):Jl(this,this.S-c)};function ei(c){c.j.G==0||c.J||yt(c.j,c)}function Sn(c){vo(c);var f=c.M;f&&typeof f.ma=="function"&&f.ma(),c.M=null,go(c.U),c.g&&(f=c.g,c.g=null,f.abort(),f.ma())}function as(c,f){try{var g=c.j;if(g.G!=0&&(g.g==c||Sc(g.h,c))){if(!c.K&&Sc(g.h,c)&&g.G==3){try{var S=g.Da.g.parse(f)}catch{S=null}if(Array.isArray(S)&&S.length==3){var O=S;if(O[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<c.F)tr(g),ai(g);else break e;No(g),_t(18)}}else g.za=O[1],0<g.za-g.T&&37500>O[2]&&g.F&&g.v==0&&!g.C&&(g.C=Hr(v(g.Za,g),6e3));if(1>=bc(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Cn(g,11)}else if((c.K||g.g==c)&&tr(g),!G(f))for(O=g.Da.g.parse(f),f=0;f<O.length;f++){let Te=O[f];if(g.T=Te[0],Te=Te[1],g.G==2)if(Te[0]=="c"){g.K=Te[1],g.ia=Te[2];let It=Te[3];It!=null&&(g.la=It,g.j.info("VER="+g.la));let Et=Te[4];Et!=null&&(g.Aa=Et,g.j.info("SVER="+g.Aa));let Oo=Te[5];Oo!=null&&typeof Oo=="number"&&0<Oo&&(S=1.5*Oo,g.L=S,g.j.info("backChannelRequestTimeoutMs_="+S)),S=g;let ln=c.g;if(ln){let lh=ln.g?ln.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(lh){var F=S.h;F.g||lh.indexOf("spdy")==-1&&lh.indexOf("quic")==-1&&lh.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(Jt(F,F.h),F.h=null))}if(S.D){let Mp=ln.g?ln.g.getResponseHeader("X-HTTP-Session-Id"):null;Mp&&(S.ya=Mp,De(S.I,S.D,Mp))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-c.F,g.j.info("Handshake RTT: "+g.R+"ms")),S=g;var z=c;if(S.qa=l(S,S.J?S.ia:null,S.W),z.K){Ut(S.h,z);var ve=z,ze=S.L;ze&&(ve.I=ze),ve.B&&(vo(ve),Zr(ve)),S.g=z}else xc(S);0<g.i.length&&ps(g)}else Te[0]!="stop"&&Te[0]!="close"||Cn(g,7);else g.G==3&&(Te[0]=="stop"||Te[0]=="close"?Te[0]=="stop"?Cn(g,7):Po(g):Te[0]!="noop"&&g.l&&g.l.ta(Te),g.v=0)}}Qt(4)}catch{}}var vc=class{constructor(c,f){this.g=c,this.map=f}};function Tc(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ac(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function bc(c){return c.h?1:c.g?c.g.size:0}function Sc(c,f){return c.h?c.h==f:c.g?c.g.has(f):!1}function Jt(c,f){c.g?c.g.add(f):c.h=f}function Ut(c,f){c.h&&c.h==f?c.h=null:c.g&&c.g.has(f)&&c.g.delete(f)}Tc.prototype.cancel=function(){if(this.i=ti(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let c of this.g.values())c.cancel();this.g.clear()}};function ti(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let f=c.i;for(let g of c.g.values())f=f.concat(g.D);return f}return V(c.i)}function cs(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(u(c)){for(var f=[],g=c.length,S=0;S<g;S++)f.push(c[S]);return f}f=[],g=0;for(S in c)f[g++]=c[S];return f}function Rc(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(u(c)||typeof c=="string"){var f=[];c=c.length;for(var g=0;g<c;g++)f.push(g);return f}f=[],g=0;for(let S in c)f[g++]=S;return f}}}function Ce(c,f){if(c.forEach&&typeof c.forEach=="function")c.forEach(f,void 0);else if(u(c)||typeof c=="string")Array.prototype.forEach.call(c,f,void 0);else for(var g=Rc(c),S=cs(c),O=S.length,F=0;F<O;F++)f.call(void 0,S[F],g&&g[F],c)}var us=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ls(c,f){if(c){c=c.split("&");for(var g=0;g<c.length;g++){var S=c[g].indexOf("="),O=null;if(0<=S){var F=c[g].substring(0,S);O=c[g].substring(S+1)}else F=c[g];f(F,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function Bt(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Bt){this.h=c.h,hs(this,c.j),this.o=c.o,this.g=c.g,To(this,c.s),this.l=c.l;var f=c.i,g=new ds;g.i=f.i,f.g&&(g.g=new Map(f.g),g.h=f.h),Yl(this,g),this.m=c.m}else c&&(f=String(c).match(us))?(this.h=!1,hs(this,f[1]||"",!0),this.o=on(f[2]||""),this.g=on(f[3]||"",!0),To(this,f[4]),this.l=on(f[5]||"",!0),Yl(this,f[6]||"",!0),this.m=on(f[7]||"")):(this.h=!1,this.i=new ds(null,this.h))}Bt.prototype.toString=function(){var c=[],f=this.j;f&&c.push(qt(f,Pc,!0),":");var g=this.g;return(g||f=="file")&&(c.push("//"),(f=this.o)&&c.push(qt(f,Pc,!0),"@"),c.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&c.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&c.push("/"),c.push(qt(g,g.charAt(0)=="/"?eh:Zl,!0))),(g=this.i.toString())&&c.push("?",g),(g=this.m)&&c.push("#",qt(g,ni)),c.join("")};function sn(c){return new Bt(c)}function hs(c,f,g){c.j=g?on(f,!0):f,c.j&&(c.j=c.j.replace(/:$/,""))}function To(c,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);c.s=f}else c.s=null}function Yl(c,f,g){f instanceof ds?(c.i=f,bo(c.i,c.h)):(g||(f=qt(f,th)),c.i=new ds(f,c.h))}function De(c,f,g){c.i.set(f,g)}function Ao(c){return De(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function on(c,f){return c?f?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function qt(c,f,g){return typeof c=="string"?(c=encodeURI(c).replace(f,Xl),g&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function Xl(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Pc=/[#\/\?@]/g,Zl=/[#\?:]/g,eh=/[#\?]/g,th=/[#\?@]/g,ni=/#/g;function ds(c,f){this.h=this.g=null,this.i=c||null,this.j=!!f}function Rn(c){c.g||(c.g=new Map,c.h=0,c.i&&ls(c.i,function(f,g){c.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}n=ds.prototype,n.add=function(c,f){Rn(this),this.i=null,c=cn(this,c);var g=this.g.get(c);return g||this.g.set(c,g=[]),g.push(f),this.h+=1,this};function nh(c,f){Rn(c),f=cn(c,f),c.g.has(f)&&(c.i=null,c.h-=c.g.get(f).length,c.g.delete(f))}function an(c,f){return Rn(c),f=cn(c,f),c.g.has(f)}n.forEach=function(c,f){Rn(this),this.g.forEach(function(g,S){g.forEach(function(O){c.call(f,O,S,this)},this)},this)},n.na=function(){Rn(this);let c=Array.from(this.g.values()),f=Array.from(this.g.keys()),g=[];for(let S=0;S<f.length;S++){let O=c[S];for(let F=0;F<O.length;F++)g.push(f[S])}return g},n.V=function(c){Rn(this);let f=[];if(typeof c=="string")an(this,c)&&(f=f.concat(this.g.get(cn(this,c))));else{c=Array.from(this.g.values());for(let g=0;g<c.length;g++)f=f.concat(c[g])}return f},n.set=function(c,f){return Rn(this),this.i=null,c=cn(this,c),an(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[f]),this.h+=1,this},n.get=function(c,f){return c?(c=this.V(c),0<c.length?String(c[0]):f):f};function rh(c,f,g){nh(c,f),0<g.length&&(c.i=null,c.g.set(cn(c,f),V(g)),c.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let c=[],f=Array.from(this.g.keys());for(var g=0;g<f.length;g++){var S=f[g];let F=encodeURIComponent(String(S)),z=this.V(S);for(S=0;S<z.length;S++){var O=F;z[S]!==""&&(O+="="+encodeURIComponent(String(z[S]))),c.push(O)}}return this.i=c.join("&")};function cn(c,f){return f=String(f),c.j&&(f=f.toLowerCase()),f}function bo(c,f){f&&!c.j&&(Rn(c),c.i=null,c.g.forEach(function(g,S){var O=S.toLowerCase();S!=O&&(nh(this,S),rh(this,O,g))},c)),c.j=f}function ih(c,f){let g=new Qr;if(a.Image){let S=new Image;S.onload=C(Ot,g,"TestLoadImage: loaded",!0,f,S),S.onerror=C(Ot,g,"TestLoadImage: error",!1,f,S),S.onabort=C(Ot,g,"TestLoadImage: abort",!1,f,S),S.ontimeout=C(Ot,g,"TestLoadImage: timeout",!1,f,S),a.setTimeout(function(){S.ontimeout&&S.ontimeout()},1e4),S.src=c}else f(!1)}function fs(c,f){let g=new Qr,S=new AbortController,O=setTimeout(()=>{S.abort(),Ot(g,"TestPingServer: timeout",!1,f)},1e4);fetch(c,{signal:S.signal}).then(F=>{clearTimeout(O),F.ok?Ot(g,"TestPingServer: ok",!0,f):Ot(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(O),Ot(g,"TestPingServer: error",!1,f)})}function Ot(c,f,g,S,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),S(g)}catch{}}function sh(){this.g=new Gl}function Cc(c,f,g){let S=g||"";try{Ce(c,function(O,F){let z=O;h(O)&&(z=ts(O)),f.push(S+F+"="+encodeURIComponent(z))})}catch(O){throw f.push(S+"type="+encodeURIComponent("_badmap")),O}}function ke(c){this.l=c.Ub||null,this.j=c.eb||!1}k(ke,zr),ke.prototype.g=function(){return new So(this.l,this.j)},ke.prototype.i=function(c){return function(){return c}}({});function So(c,f){ut.call(this),this.D=c,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(So,ut),n=So.prototype,n.open=function(c,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=f,this.readyState=1,ii(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(f.body=c),(this.D||a).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ri(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,ii(this)),this.g&&(this.readyState=3,ii(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;oh(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function oh(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var f=c.value?c.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!c.done}))&&(this.response=this.responseText+=f)}c.done?ri(this):ii(this),this.readyState==3&&oh(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,ri(this))},n.Qa=function(c){this.g&&(this.response=c,ri(this))},n.ga=function(){this.g&&ri(this)};function ri(c){c.readyState=4,c.l=null,c.j=null,c.v=null,ii(c)}n.setRequestHeader=function(c,f){this.u.append(c,f)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let c=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,c.push(g[0]+": "+g[1]),g=f.next();return c.join(`\r
`)};function ii(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(So.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function kc(c){let f="";return Z(c,function(g,S){f+=S,f+=":",f+=g,f+=`\r
`}),f}function si(c,f,g){e:{for(S in g){var S=!1;break e}S=!0}S||(g=kc(g),typeof c=="string"?g!=null&&encodeURIComponent(String(g)):De(c,f,g))}function Ae(c){ut.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(Ae,ut);var ah=/^https?$/i,Lp=["POST","PUT"];n=Ae.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,f,g,S){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);f=f?f.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ss.g(),this.v=this.o?Ic(this.o):Ic(ss),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(f,String(c),!0),this.B=!1}catch(F){oi(this,F);return}if(c=g||"",g=new Map(this.headers),S)if(Object.getPrototypeOf(S)===Object.prototype)for(var O in S)g.set(O,S[O]);else if(typeof S.keys=="function"&&typeof S.get=="function")for(let F of S.keys())g.set(F,S.get(F));else throw Error("Unknown input type for opt_headers: "+String(S));S=Array.from(g.keys()).find(F=>F.toLowerCase()=="content-type"),O=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Lp,f,void 0))||S||O||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[F,z]of g)this.g.setRequestHeader(F,z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Dc(this),this.u=!0,this.g.send(c),this.u=!1}catch(F){oi(this,F)}};function oi(c,f){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=f,c.m=5,Nc(c),er(c)}function Nc(c){c.A||(c.A=!0,pt(c,"complete"),pt(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,pt(this,"complete"),pt(this,"abort"),er(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),er(this,!0)),Ae.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ro(this):this.bb())},n.bb=function(){Ro(this)};function Ro(c){if(c.h&&typeof o<"u"&&(!c.v[1]||Vt(c)!=4||c.Z()!=2)){if(c.u&&Vt(c)==4)jl(c.Ea,0,c);else if(pt(c,"readystatechange"),Vt(c)==4){c.h=!1;try{let z=c.Z();e:switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var g;if(!(g=f)){var S;if(S=z===0){var O=String(c.D).match(us)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),S=!ah.test(O?O.toLowerCase():"")}g=S}if(g)pt(c,"complete"),pt(c,"success");else{c.m=6;try{var F=2<Vt(c)?c.g.statusText:""}catch{F=""}c.l=F+" ["+c.Z()+"]",Nc(c)}}finally{er(c)}}}}function er(c,f){if(c.g){Dc(c);let g=c.g,S=c.v[0]?()=>{}:null;c.g=null,c.v=null,f||pt(c,"ready");try{g.onreadystatechange=S}catch{}}}function Dc(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function Vt(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<Vt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var f=this.g.responseText;return c&&f.indexOf(c)==0&&(f=f.substring(c.length)),Xn(f)}};function ch(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function uh(c){let f={};c=(c.g&&2<=Vt(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let S=0;S<c.length;S++){if(G(c[S]))continue;var g=A(c[S]);let O=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();let F=f[O]||[];f[O]=F,F.push(g)}T(f,function(S){return S.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function un(c,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[c]||f}function Oc(c){this.Aa=0,this.i=[],this.j=new Qr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=un("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=un("baseRetryDelayMs",5e3,c),this.cb=un("retryDelaySeedMs",1e4,c),this.Wa=un("forwardChannelMaxRetries",2,c),this.wa=un("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new Tc(c&&c.concurrentRequestLimit),this.Da=new sh,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Oc.prototype,n.la=8,n.G=1,n.connect=function(c,f,g,S){_t(0),this.W=c,this.H=f||{},g&&S!==void 0&&(this.H.OSID=g,this.H.OAID=S),this.F=this.X,this.I=l(this,null,this.W),ps(this)};function Po(c){if(Co(c),c.G==3){var f=c.U++,g=sn(c.I);if(De(g,"SID",c.K),De(g,"RID",f),De(g,"TYPE","terminate"),ci(c,g),f=new bn(c,c.j,f),f.L=2,f.v=Ao(sn(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(f.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=f.v,g=!0),g||(f.g=p(f.j,null),f.g.ea(f.v)),f.F=Date.now(),Zr(f)}nr(c)}function ai(c){c.g&&(Do(c),c.g.cancel(),c.g=null)}function Co(c){ai(c),c.u&&(a.clearTimeout(c.u),c.u=null),tr(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function ps(c){if(!Ac(c.h)&&!c.s){c.s=!0;var f=c.Ga;Yi||Fl(),Tn||(Yi(),Tn=!0),Br.add(f,c),c.B=0}}function ko(c,f){return bc(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=f.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Hr(v(c.Ga,c,f),Mc(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;let O=new bn(this,this.j,c),F=this.o;if(this.S&&(F?(F=y(F),b(F,this.S)):F=this.S),this.m!==null||this.O||(O.H=F,F=null),this.P)e:{for(var f=0,g=0;g<this.i.length;g++){t:{var S=this.i[g];if("__data__"in S.map&&(S=S.map.__data__,typeof S=="string")){S=S.length;break t}S=void 0}if(S===void 0)break;if(f+=S,4096<f){f=g;break e}if(f===4096||g===this.i.length-1){f=g+1;break e}}f=1e3}else f=1e3;f=Pn(this,O,f),g=sn(this.I),De(g,"RID",c),De(g,"CVER",22),this.D&&De(g,"X-HTTP-Session-Id",this.D),ci(this,g),F&&(this.O?f="headers="+encodeURIComponent(String(kc(F)))+"&"+f:this.m&&si(g,this.m,F)),Jt(this.h,O),this.Ua&&De(g,"TYPE","init"),this.P?(De(g,"$req",f),De(g,"SID","null"),O.T=!0,Eo(O,g,null)):Eo(O,g,f),this.G=2}}else this.G==3&&(c?Vc(this,c):this.i.length==0||Ac(this.h)||Vc(this))};function Vc(c,f){var g;f?g=f.l:g=c.U++;let S=sn(c.I);De(S,"SID",c.K),De(S,"RID",g),De(S,"AID",c.T),ci(c,S),c.m&&c.o&&si(S,c.m,c.o),g=new bn(c,c.j,g,c.B+1),c.m===null&&(g.H=c.o),f&&(c.i=f.D.concat(c.i)),f=Pn(c,g,1e3),g.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),Jt(c.h,g),Eo(g,S,f)}function ci(c,f){c.H&&Z(c.H,function(g,S){De(f,S,g)}),c.l&&Ce({},function(g,S){De(f,S,g)})}function Pn(c,f,g){g=Math.min(c.i.length,g);var S=c.l?v(c.l.Na,c.l,c):null;e:{var O=c.i;let F=-1;for(;;){let z=["count="+g];F==-1?0<g?(F=O[0].g,z.push("ofs="+F)):F=0:z.push("ofs="+F);let ve=!0;for(let ze=0;ze<g;ze++){let Te=O[ze].g,It=O[ze].map;if(Te-=F,0>Te)F=Math.max(0,O[ze].g-100),ve=!1;else try{Cc(It,z,"req"+Te+"_")}catch{S&&S(It)}}if(ve){S=z.join("&");break e}}}return c=c.i.splice(0,g),f.D=c,S}function xc(c){if(!c.g&&!c.u){c.Y=1;var f=c.Fa;Yi||Fl(),Tn||(Yi(),Tn=!0),Br.add(f,c),c.v=0}}function No(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Hr(v(c.Fa,c),Mc(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,Lc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Hr(v(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,_t(10),ai(this),Lc(this))};function Do(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function Lc(c){c.g=new bn(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var f=sn(c.qa);De(f,"RID","rpc"),De(f,"SID",c.K),De(f,"AID",c.T),De(f,"CI",c.F?"0":"1"),!c.F&&c.ja&&De(f,"TO",c.ja),De(f,"TYPE","xmlhttp"),ci(c,f),c.m&&c.o&&si(f,c.m,c.o),c.L&&(c.g.I=c.L);var g=c.g;c=c.ia,g.L=1,g.v=Ao(sn(f)),g.m=null,g.P=!0,wo(g,c)}n.Za=function(){this.C!=null&&(this.C=null,ai(this),No(this),_t(19))};function tr(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function yt(c,f){var g=null;if(c.g==f){tr(c),Do(c),c.g=null;var S=2}else if(Sc(c.h,f))g=f.D,Ut(c.h,f),S=1;else return;if(c.G!=0){if(f.o)if(S==1){g=f.m?f.m.length:0,f=Date.now()-f.F;var O=c.B;S=yo(),pt(S,new ns(S,g)),ps(c)}else xc(c);else if(O=f.s,O==3||O==0&&0<f.X||!(S==1&&ko(c,f)||S==2&&No(c)))switch(g&&0<g.length&&(f=c.h,f.i=f.i.concat(g)),O){case 1:Cn(c,5);break;case 4:Cn(c,10);break;case 3:Cn(c,6);break;default:Cn(c,2)}}}function Mc(c,f){let g=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(g*=2),g*f}function Cn(c,f){if(c.j.info("Error code "+f),f==2){var g=v(c.fb,c),S=c.Xa;let O=!S;S=new Bt(S||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||hs(S,"https"),Ao(S),O?ih(S.toString(),g):fs(S.toString(),g)}else _t(2);c.G=0,c.l&&c.l.sa(f),nr(c),Co(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),_t(2)):(this.j.info("Failed to ping google.com"),_t(1))};function nr(c){if(c.G=0,c.ka=[],c.l){let f=ti(c.h);(f.length!=0||c.i.length!=0)&&(N(c.ka,f),N(c.ka,c.i),c.h.i.length=0,V(c.i),c.i.length=0),c.l.ra()}}function l(c,f,g){var S=g instanceof Bt?sn(g):new Bt(g);if(S.g!="")f&&(S.g=f+"."+S.g),To(S,S.s);else{var O=a.location;S=O.protocol,f=f?f+"."+O.hostname:O.hostname,O=+O.port;var F=new Bt(null);S&&hs(F,S),f&&(F.g=f),O&&To(F,O),g&&(F.l=g),S=F}return g=c.D,f=c.ya,g&&f&&De(S,g,f),De(S,"VER",c.la),ci(c,S),S}function p(c,f,g){if(f&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=c.Ca&&!c.pa?new Ae(new ke({eb:g})):new Ae(c.pa),f.Ha(c.J),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function _(){}n=_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function R(){}R.prototype.g=function(c,f){return new D(c,f)};function D(c,f){ut.call(this),this.g=new Oc(f),this.l=c,this.h=f&&f.messageUrlParams||null,c=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(c?c["X-WebChannel-Content-Type"]=f.messageContentType:c={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(c?c["X-WebChannel-Client-Profile"]=f.va:c={"X-WebChannel-Client-Profile":f.va}),this.g.S=c,(c=f&&f.Sb)&&!G(c)&&(this.g.m=c),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!G(f)&&(this.g.D=f,c=this.h,c!==null&&f in c&&(c=this.h,f in c&&delete c[f])),this.j=new ae(this)}k(D,ut),D.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},D.prototype.close=function(){Po(this.g)},D.prototype.o=function(c){var f=this.g;if(typeof c=="string"){var g={};g.__data__=c,c=g}else this.u&&(g={},g.__data__=ts(c),c=g);f.i.push(new vc(f.Ya++,c)),f.G==3&&ps(f)},D.prototype.N=function(){this.g.l=null,delete this.j,Po(this.g),delete this.g,D.aa.N.call(this)};function M(c){lt.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var f=c.__sm__;if(f){e:{for(let g in f){c=g;break e}c=void 0}(this.i=c)&&(c=this.i,f=f!==null&&c in f?f[c]:void 0),this.data=f}else this.data=c}k(M,lt);function W(){_o.call(this),this.status=1}k(W,_o);function ae(c){this.g=c}k(ae,_),ae.prototype.ua=function(){pt(this.g,"a")},ae.prototype.ta=function(c){pt(this.g,new M(c))},ae.prototype.sa=function(c){pt(this.g,new W)},ae.prototype.ra=function(){pt(this.g,"b")},R.prototype.createWebChannel=R.prototype.g,D.prototype.send=D.prototype.o,D.prototype.open=D.prototype.m,D.prototype.close=D.prototype.close,Yy=Pr.createWebChannelTransport=function(){return new R},Jy=Pr.getStatEventTarget=function(){return yo()},Qy=Pr.Event=Ft,Jd=Pr.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},is.NO_ERROR=0,is.TIMEOUT=8,is.HTTP_ERROR=6,Lu=Pr.ErrorCode=is,Io.COMPLETE="complete",Hy=Pr.EventType=Io,Gr.EventType=Wr,Wr.OPEN="a",Wr.CLOSE="b",Wr.ERROR="c",Wr.MESSAGE="d",ut.prototype.listen=ut.prototype.K,va=Pr.WebChannel=Gr,KM=Pr.FetchXmlHttpFactory=ke,Ae.prototype.listenOnce=Ae.prototype.L,Ae.prototype.getLastError=Ae.prototype.Ka,Ae.prototype.getLastErrorCode=Ae.prototype.Ba,Ae.prototype.getStatus=Ae.prototype.Z,Ae.prototype.getResponseJson=Ae.prototype.Oa,Ae.prototype.getResponseText=Ae.prototype.oa,Ae.prototype.send=Ae.prototype.ea,Ae.prototype.setWithCredentials=Ae.prototype.Ha,Ky=Pr.XhrIo=Ae}).apply(typeof Qd<"u"?Qd:typeof self<"u"?self:typeof window<"u"?window:{});var e0="@firebase/firestore",t0="4.8.0";var tt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};tt.UNAUTHENTICATED=new tt(null),tt.GOOGLE_CREDENTIALS=new tt("google-credentials-uid"),tt.FIRST_PARTY=new tt("first-party-uid"),tt.MOCK_USER=new tt("mock-user");var ac="11.10.0";var xi=new Nn("@firebase/firestore");function Ca(){return xi.logLevel}function yR(n){xi.setLogLevel(n)}function B(n,...e){if(xi.logLevel<=de.DEBUG){let t=e.map(pw);xi.debug(`Firestore (${ac}): ${n}`,...t)}}function Ke(n,...e){if(xi.logLevel<=de.ERROR){let t=e.map(pw);xi.error(`Firestore (${ac}): ${n}`,...t)}}function Nt(n,...e){if(xi.logLevel<=de.WARN){let t=e.map(pw);xi.warn(`Firestore (${ac}): ${n}`,...t)}}function pw(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function Y(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,IR(n,r,t)}function IR(n,e,t){let r=`FIRESTORE (${ac}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Ke(r),new Error(r)}function ee(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||IR(e,i,r)}function H9(n,e){n||Y(57014,e)}function K(n,e){return n}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},U=class extends jt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var rt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var df=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},sI=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tt.UNAUTHENTICATED))}shutdown(){}},oI=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},aI=class{constructor(e){this.t=e,this.currentUser=tt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ee(this.o===void 0,42304);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new rt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new rt,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>w(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{B("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(B("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new rt)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(B("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ee(typeof r.accessToken=="string",31837,{l:r}),new df(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ee(e===null||typeof e=="string",2055,{h:e}),new tt(e)}},cI=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=tt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},uI=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new cI(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Yu=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},lI=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ct(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ee(this.o===void 0,3512);let r=s=>{s.error!=null&&B("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,B("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{B("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):B("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Yu(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ee(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Yu(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}},n0=class{getToken(){return Promise.resolve(new Yu(""))}invalidateToken(){}start(e,t){}shutdown(){}};function HM(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function mw(){return new TextEncoder}var Xu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=HM(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function ie(n,e){return n<e?-1:n>e?1:0}function hI(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return ie(r,i);{let s=mw(),o=QM(s.encode(r0(n,t)),s.encode(r0(e,t)));return o!==0?o:ie(r,i)}}t+=r>65535?2:1}return ie(n.length,e.length)}function r0(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function QM(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return ie(n[t],e[t]);return ie(n.length,e.length)}function Fa(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function ER(n){return n+"\0"}var dI="__name__",ff=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&Y(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&Y(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return ie(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):hI(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Rr.fromString(e.substring(4,e.length-2))}},ge=class n extends ff{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new U(x.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},JM=/^[_a-zA-Z][_a-zA-Z0-9]*$/,it=class n extends ff{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return JM.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===dI}static keyField(){return new n([dI])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new U(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new U(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new U(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new U(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var Q=class n{constructor(e){this.path=e}static fromPath(e){return new n(ge.fromString(e))}static fromName(e){return new n(ge.fromString(e).popFirst(5))}static empty(){return new n(ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ge.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ge.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ge(e.slice()))}};function gw(n,e,t){if(!t)throw new U(x.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function YM(n,e,t,r){if(e===!0&&r===!0)throw new U(x.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function i0(n){if(!Q.isDocumentKey(n))throw new U(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function s0(n){if(Q.isDocumentKey(n))throw new U(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function wR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function mp(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Y(12329,{type:typeof n})}function pe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new U(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=mp(n);throw new U(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function vR(n,e){if(e<=0)throw new U(x.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function nt(n,e){let t={typeString:n};return e&&(t.value=e),t}function ro(n,e){if(!wR(n))throw new U(x.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new U(x.INVALID_ARGUMENT,t);return!0}var o0=-62135596800,a0=1e6,Ue=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*a0);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new U(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new U(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<o0)throw new U(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new U(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/a0}_compareTo(e){return this.seconds===e.seconds?ie(this.nanoseconds,e.nanoseconds):ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ro(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-o0;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};Ue._jsonSchemaVersion="firestore/timestamp/1.0",Ue._jsonSchema={type:nt("string",Ue._jsonSchemaVersion),seconds:nt("number"),nanoseconds:nt("number")};var ne=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Ue(0,0))}static max(){return new n(new Ue(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ua=-1,Li=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function fI(n){return n.fields.find(e=>e.kind===2)}function xs(n){return n.fields.filter(e=>e.kind!==2)}function XM(n,e){let t=ie(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=ZM(n.fields[r],e.fields[r]),t!==0)return t;return ie(n.fields.length,e.fields.length)}Li.UNKNOWN_ID=-1;var kr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};function ZM(n,e){let t=it.comparator(n.fieldPath,e.fieldPath);return t!==0?t:ie(n.kind,e.kind)}var Ba=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,nn.min())}};function TR(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ne.fromTimestamp(r===1e9?new Ue(t+1,0):new Ue(t,r));return new nn(i,Q.empty(),e)}function AR(n){return new nn(n.readTime,n.key,Ua)}var nn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(ne.min(),Q.empty(),Ua)}static max(){return new n(ne.max(),Q.empty(),Ua)}};function _w(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Q.comparator(n.documentKey,e.documentKey),t!==0?t:ie(n.largestBatchId,e.largestBatchId))}var bR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",pf=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Wi(n){return w(this,null,function*(){if(n.code!==x.FAILED_PRECONDITION||n.message!==bR)throw n;B("LocalStore","Unexpectedly lost primary lease")})}var L=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Y(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(d=>{o[h]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var zt="SimpleDb",mf=class n{static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new $s(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new rt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new $s(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{let i=yw(r.target.error);this.S.reject(new $s(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(B(zt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new mI(t)}},Mi=class n{static delete(e){return B(zt,"Removing database:",e),Ms(gh().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Lo())return!1;if(n.F())return!0;let e=Ge(),t=n.M(e),r=0<t&&t<10,i=SR(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,n.M(Ge())===12.2&&Ke("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(e){return w(this,null,function*(){return this.db||(B(zt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new $s(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new U(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new U(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new $s(e,o))},i.onupgradeneeded=s=>{B(zt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,i.transaction,s.oldVersion,this.version).next(()=>{B(zt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{let r=t.target;this.L=r.version},{passive:!0})),this.db.addEventListener("versionchange",t=>{var r;t.newVersion===null&&(Nt('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(r=this.databaseDeletedListener)===null||r===void 0||r.call(this))},{passive:!0}),this.db})}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}runTransaction(e,t,r,i){return w(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.k(e);let a=mf.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(h=>(a.v(),h)).catch(h=>(a.abort(h),L.reject(h))).toPromise();return u.catch(()=>{}),yield a.D,u}catch(a){let u=a,h=u.name!=="FirebaseError"&&o<3;if(B(zt,"Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function SR(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var pI=class{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return Ms(this.$.delete())}},$s=class extends U{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ki(n){return n.name==="IndexedDbTransactionError"}var mI=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(B(zt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(B(zt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ms(r)}add(e){return B(zt,"ADD",this.store.name,e,e),Ms(this.store.add(e))}get(e){return Ms(this.store.get(e)).next(t=>(t===void 0&&(t=null),B(zt,"GET",this.store.name,e,t),t))}delete(e){return B(zt,"DELETE",this.store.name,e),Ms(this.store.delete(e))}count(){return B(zt,"COUNT",this.store.name),Ms(this.store.count())}j(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new L((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.J(s,(a,u)=>{o.push(u)}).next(()=>o)}}H(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new L((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}Y(e,t){B(zt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Z=!1;let i=this.cursor(r);return this.J(i,(s,o,a)=>a.delete())}X(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.J(i,t)}ee(e){let t=this.cursor({});return new L((r,i)=>{t.onerror=s=>{let o=yw(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}J(e,t){let r=[];return new L((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new pI(a),h=t(a.primaryKey,a.value,u);if(h instanceof L){let d=h.catch(m=>(u.done(),L.reject(m)));r.push(d)}u.isDone?i():u.W===null?a.continue():a.continue(u.W)}}).next(()=>L.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Z?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Ms(n){return new L((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=yw(r.target.error);t(i)}})}var c0=!1;function yw(n){let e=Mi.M(Ge());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new U("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return c0||(c0=!0,setTimeout(()=>{throw r},0)),r}}return n}var $u="IndexBackfiller",gI=class{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(e){B($u,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>w(this,null,function*(){this.task=null;try{let t=yield this.te.re();B($u,`Documents written: ${t}`)}catch(t){Ki(t)?B($u,"Ignoring IndexedDB error during index backfill: ",t):yield Wi(t)}yield this.ne(6e4)}))}},_I=class{constructor(e,t){this.localStore=e,this.persistence=t}re(e=50){return w(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))})}ie(e,t){let r=new Set,i=t,s=!0;return L.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return B($u,`Processing collection: ${o}`),this.se(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}se(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.oe(i,s)).next(a=>(B($u,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}oe(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=AR(s);_w(o,r)>0&&(r=o)}),new nn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Gt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),Oi=-1;function kl(n){return n==null}function Zu(n){return n===0&&1/n==-1/0}function RR(n){return typeof n=="number"&&Number.isInteger(n)&&!Zu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var gf="";function St(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=u0(e)),e=eF(n.get(t),e);return u0(e)}function eF(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case gf:t+="";break;default:t+=s}}return t}function u0(n){return n+gf+""}function Bn(n){let e=n.length;if(ee(e>=2,64408,{path:n}),e===2)return ee(n.charAt(0)===gf&&n.charAt(1)==="",56145,{path:n}),ge.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(gf,s);switch((o<0||o>t)&&Y(50515,{path:n}),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:Y(61167,{path:n})}s=o+2}return new ge(r)}var Ls="remoteDocuments",Nl="owner",Ta="owner",el="mutationQueues",tF="userId",In="mutations",l0="batchId",qs="userMutationsIndex",h0=["userId","batchId"];function rf(n,e){return[n,St(e)]}function PR(n,e,t){return[n,St(e),t]}var nF={},qa="documentMutations",_f="remoteDocumentsV14",rF=["prefixPath","collectionGroup","readTime","documentId"],sf="documentKeyIndex",iF=["prefixPath","collectionGroup","documentId"],CR="collectionGroupIndex",sF=["collectionGroup","readTime","prefixPath","documentId"],tl="remoteDocumentGlobal",yI="remoteDocumentGlobalKey",ja="targets",kR="queryTargetsIndex",oF=["canonicalId","targetId"],$a="targetDocuments",aF=["targetId","path"],Iw="documentTargetsIndex",cF=["path","targetId"],yf="targetGlobalKey",zs="targetGlobal",nl="collectionParents",uF=["collectionId","parent"],za="clientMetadata",lF="clientId",gp="bundles",hF="bundleId",_p="namedQueries",dF="name",Ew="indexConfiguration",fF="indexId",II="collectionGroupIndex",pF="collectionGroup",zu="indexState",mF=["indexId","uid"],NR="sequenceNumberIndex",gF=["uid","sequenceNumber"],Gu="indexEntries",_F=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],DR="documentKeyIndex",yF=["indexId","uid","orderedDocumentKey"],yp="documentOverlays",IF=["userId","collectionPath","documentId"],EI="collectionPathOverlayIndex",EF=["userId","collectionPath","largestBatchId"],OR="collectionGroupOverlayIndex",wF=["userId","collectionGroup","largestBatchId"],ww="globals",vF="name",VR=[el,In,qa,Ls,ja,Nl,zs,$a,za,tl,nl,gp,_p],TF=[...VR,yp],xR=[el,In,qa,_f,ja,Nl,zs,$a,za,tl,nl,gp,_p,yp],LR=xR,vw=[...LR,Ew,zu,Gu],AF=vw,MR=[...vw,ww],bF=MR;var rl=class extends pf{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}};function ft(n,e){let t=K(n);return Mi.N(t.ce,e)}function d0(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Hi(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function FR(n,e){let t=[];for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function UR(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Ve=class n{constructor(e,t){this.comparator=e,this.root=t||$n.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,$n.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$n.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Oa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Oa(this.root,e,this.comparator,!1)}getReverseIterator(){return new Oa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Oa(this.root,e,this.comparator,!0)}},Oa=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},$n=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Y(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Y(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw Y(27949);return e+(this.isRed()?0:1)}};$n.EMPTY=null,$n.RED=!0,$n.BLACK=!1;$n.EMPTY=new class{constructor(){this.size=0}get key(){throw Y(57766)}get value(){throw Y(16141)}get color(){throw Y(16727)}get left(){throw Y(29726)}get right(){throw Y(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new $n(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ne=class n{constructor(e){this.comparator=e,this.data=new Ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new If(this.data.getIterator())}getIteratorFrom(e){return new If(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},If=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Aa(n){return n.hasNext()?n.getNext():void 0}var Wt=class n{constructor(e){this.fields=e,e.sort(it.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ne(it.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fa(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Ef=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function J9(){return typeof atob<"u"}var Qe=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ef("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Qe.EMPTY_BYTE_STRING=new Qe("");var SF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Or(n){if(ee(!!n,39018),typeof n=="string"){let e=0,t=SF.exec(n);if(ee(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Fe(n.seconds),nanos:Fe(n.nanos)}}function Fe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Vr(n){return typeof n=="string"?Qe.fromBase64String(n):Qe.fromUint8Array(n)}var BR="server_timestamp",qR="__type__",jR="__previous_value__",$R="__local_write_time__";function Ip(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[qR])===null||t===void 0?void 0:t.stringValue)===BR}function Ep(n){let e=n.mapValue.fields[jR];return Ip(e)?Ep(e):e}function il(n){let e=Or(n.mapValue.fields[$R].timestampValue);return new Ue(e.seconds,e.nanos)}var wI=class{constructor(e,t,r,i,s,o,a,u,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=d}},sl="(default)",Ga=class n{constructor(e,t){this.projectId=e,this.database=t||sl}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===sl}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Tw="__type__",zR="__max__",Ni={mapValue:{fields:{__type__:{stringValue:zR}}}},Aw="__vector__",Wa="value",of={nullValue:"NULL_VALUE"};function Fi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ip(n)?4:GR(n)?9007199254740991:wp(n)?10:11:Y(28295,{value:n})}function Wn(n,e){if(n===e)return!0;let t=Fi(n);if(t!==Fi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return il(n).isEqual(il(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Or(i.timestampValue),a=Or(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Vr(i.bytesValue).isEqual(Vr(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Fe(i.geoPointValue.latitude)===Fe(s.geoPointValue.latitude)&&Fe(i.geoPointValue.longitude)===Fe(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Fe(i.integerValue)===Fe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Fe(i.doubleValue),a=Fe(s.doubleValue);return o===a?Zu(o)===Zu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Fa(n.arrayValue.values||[],e.arrayValue.values||[],Wn);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(d0(o)!==d0(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Wn(o[u],a[u])))return!1;return!0}(n,e);default:return Y(52216,{left:n})}}function ol(n,e){return(n.values||[]).find(t=>Wn(t,e))!==void 0}function Ui(n,e){if(n===e)return 0;let t=Fi(n),r=Fi(e);if(t!==r)return ie(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ie(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=Fe(s.integerValue||s.doubleValue),u=Fe(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return f0(n.timestampValue,e.timestampValue);case 4:return f0(il(n),il(e));case 5:return hI(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Vr(s),u=Vr(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let h=0;h<a.length&&h<u.length;h++){let d=ie(a[h],u[h]);if(d!==0)return d}return ie(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=ie(Fe(s.latitude),Fe(o.latitude));return a!==0?a:ie(Fe(s.longitude),Fe(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return p0(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,u,h,d;let m=s.fields||{},v=o.fields||{},C=(a=m[Wa])===null||a===void 0?void 0:a.arrayValue,k=(u=v[Wa])===null||u===void 0?void 0:u.arrayValue,V=ie(((h=C?.values)===null||h===void 0?void 0:h.length)||0,((d=k?.values)===null||d===void 0?void 0:d.length)||0);return V!==0?V:p0(C,k)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Ni.mapValue&&o===Ni.mapValue)return 0;if(s===Ni.mapValue)return 1;if(o===Ni.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),h=o.fields||{},d=Object.keys(h);u.sort(),d.sort();for(let m=0;m<u.length&&m<d.length;++m){let v=hI(u[m],d[m]);if(v!==0)return v;let C=Ui(a[u[m]],h[d[m]]);if(C!==0)return C}return ie(u.length,d.length)}(n.mapValue,e.mapValue);default:throw Y(23264,{le:t})}}function f0(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ie(n,e);let t=Or(n),r=Or(e),i=ie(t.seconds,r.seconds);return i!==0?i:ie(t.nanos,r.nanos)}function p0(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Ui(t[i],r[i]);if(s)return s}return ie(t.length,r.length)}function Ka(n){return vI(n)}function vI(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Or(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Vr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Q.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=vI(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${vI(t.fields[o])}`;return i+"}"}(n.mapValue):Y(61005,{value:n})}function af(n){switch(Fi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Ep(n);return e?16+af(e):16;case 5:return 2*n.stringValue.length;case 6:return Vr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+af(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return Hi(r.fields,(s,o)=>{i+=s.length+af(o)}),i}(n.mapValue);default:throw Y(13486,{value:n})}}function Gs(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function TI(n){return!!n&&"integerValue"in n}function al(n){return!!n&&"arrayValue"in n}function m0(n){return!!n&&"nullValue"in n}function g0(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function cf(n){return!!n&&"mapValue"in n}function wp(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Tw])===null||t===void 0?void 0:t.stringValue)===Aw}function Wu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Hi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Wu(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Wu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function GR(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===zR}var WR={mapValue:{fields:{[Tw]:{stringValue:Aw},[Wa]:{arrayValue:{}}}}};function RF(n){return"nullValue"in n?of:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Gs(Ga.empty(),Q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?wp(n)?WR:{mapValue:{}}:Y(35942,{value:n})}function PF(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Gs(Ga.empty(),Q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?WR:"mapValue"in n?wp(n)?{mapValue:{}}:Ni:Y(61959,{value:n})}function _0(n,e){let t=Ui(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function y0(n,e){let t=Ui(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var bt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!cf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Wu(t)}setAll(e){let t=it.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Wu(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());cf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Wn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];cf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Hi(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Wu(this.value))}};function KR(n){let e=[];return Hi(n.fields,(t,r)=>{let i=new it([t]);if(cf(r)){let s=KR(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Wt(e)}var st=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,ne.min(),ne.min(),ne.min(),bt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,ne.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,ne.min(),ne.min(),bt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,ne.min(),ne.min(),bt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ne.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=bt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ne.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Kn=class{constructor(e,t){this.position=e,this.inclusive=t}};function I0(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=Q.comparator(Q.fromName(o.referenceValue),t.key):r=Ui(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function E0(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Wn(n.position[t],e.position[t]))return!1;return!0}var Ws=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function CF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var wf=class{},_e=class n extends wf{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new SI(e,t,r):t==="array-contains"?new CI(e,r):t==="in"?new vf(e,r):t==="not-in"?new kI(e,r):t==="array-contains-any"?new NI(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new RI(e,r):new PI(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Ui(t,this.value)):t!==null&&Fi(this.value)===Fi(t)&&this.matchesComparison(Ui(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Y(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Re=class n extends wf{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return Ha(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function Ha(n){return n.op==="and"}function AI(n){return n.op==="or"}function bw(n){return HR(n)&&Ha(n)}function HR(n){for(let e of n.filters)if(e instanceof Re)return!1;return!0}function bI(n){if(n instanceof _e)return n.field.canonicalString()+n.op.toString()+Ka(n.value);if(bw(n))return n.filters.map(e=>bI(e)).join(",");{let e=n.filters.map(t=>bI(t)).join(",");return`${n.op}(${e})`}}function QR(n,e){return n instanceof _e?function(r,i){return i instanceof _e&&r.op===i.op&&r.field.isEqual(i.field)&&Wn(r.value,i.value)}(n,e):n instanceof Re?function(r,i){return i instanceof Re&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&QR(o,i.filters[a]),!0):!1}(n,e):void Y(19439)}function JR(n,e){let t=n.filters.concat(e);return Re.create(t,n.op)}function YR(n){return n instanceof _e?function(t){return`${t.field.canonicalString()} ${t.op} ${Ka(t.value)}`}(n):n instanceof Re?function(t){return t.op.toString()+" {"+t.getFilters().map(YR).join(" ,")+"}"}(n):"Filter"}var SI=class extends _e{constructor(e,t,r){super(e,t,r),this.key=Q.fromName(r.referenceValue)}matches(e){let t=Q.comparator(e.key,this.key);return this.matchesComparison(t)}},RI=class extends _e{constructor(e,t){super(e,"in",t),this.keys=XR("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},PI=class extends _e{constructor(e,t){super(e,"not-in",t),this.keys=XR("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function XR(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Q.fromName(r.referenceValue))}var CI=class extends _e{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return al(t)&&ol(t.arrayValue,this.value)}},vf=class extends _e{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ol(this.value.arrayValue,t)}},kI=class extends _e{constructor(e,t){super(e,"not-in",t)}matches(e){if(ol(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ol(this.value.arrayValue,t)}},NI=class extends _e{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!al(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ol(this.value.arrayValue,r))}};var DI=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.Pe=null}};function OI(n,e=null,t=[],r=[],i=null,s=null,o=null){return new DI(n,e,t,r,i,s,o)}function Ks(n){let e=K(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>bI(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),kl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ka(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ka(r)).join(",")),e.Pe=t}return e.Pe}function Dl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!CF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!QR(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!E0(n.startAt,e.startAt)&&E0(n.endAt,e.endAt)}function Tf(n){return Q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Af(n,e){return n.filters.filter(t=>t instanceof _e&&t.field.isEqual(e))}function w0(n,e,t){let r=of,i=!0;for(let s of Af(n,e)){let o=of,a=!0;switch(s.op){case"<":case"<=":o=RF(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=of}_0({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];_0({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function v0(n,e,t){let r=Ni,i=!0;for(let s of Af(n,e)){let o=Ni,a=!0;switch(s.op){case">=":case">":o=PF(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Ni}y0({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];y0({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var En=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function ZR(n,e,t,r,i,s,o,a){return new En(n,e,t,r,i,s,o,a)}function cc(n){return new En(n)}function T0(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sw(n){return n.collectionGroup!==null}function Va(n){let e=K(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ne(it.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(a=a.add(h.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new Ws(s,r))}),t.has(it.keyField().canonicalString())||e.Te.push(new Ws(it.keyField(),r))}return e.Te}function Rt(n){let e=K(n);return e.Ie||(e.Ie=tP(e,Va(n))),e.Ie}function eP(n){let e=K(n);return e.de||(e.de=tP(e,n.explicitOrderBy)),e.de}function tP(n,e){if(n.limitType==="F")return OI(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Ws(i.field,s)});let t=n.endAt?new Kn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Kn(n.startAt.position,n.startAt.inclusive):null;return OI(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function VI(n,e){let t=n.filters.concat([e]);return new En(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function bf(n,e,t){return new En(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ol(n,e){return Dl(Rt(n),Rt(e))&&n.limitType===e.limitType}function nP(n){return`${Ks(Rt(n))}|lt:${n.limitType}`}function ka(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>YR(i)).join(", ")}]`),kl(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Ka(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Ka(i)).join(",")),`Target(${r})`}(Rt(n))}; limitType=${n.limitType})`}function Vl(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Q.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Va(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let h=I0(o,a,u);return o.inclusive?h<=0:h<0}(r.startAt,Va(r),i)||r.endAt&&!function(o,a,u){let h=I0(o,a,u);return o.inclusive?h>=0:h>0}(r.endAt,Va(r),i))}(n,e)}function rP(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function iP(n){return(e,t)=>{let r=!1;for(let i of Va(n)){let s=kF(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function kF(n,e,t){let r=n.field.isKeyField()?Q.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),h=a.data.field(s);return u!==null&&h!==null?Ui(u,h):Y(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Y(19790,{direction:n.dir})}}var wn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Hi(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return UR(this.inner)}size(){return this.innerSize}};var NF=new Ve(Q.comparator);function Mt(){return NF}var sP=new Ve(Q.comparator);function qu(...n){let e=sP;for(let t of n)e=e.insert(t.key,t);return e}function oP(n){let e=sP;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function qn(){return Ku()}function aP(){return Ku()}function Ku(){return new wn(n=>n.toString(),(n,e)=>n.isEqual(e))}var DF=new Ve(Q.comparator),OF=new Ne(Q.comparator);function le(...n){let e=OF;for(let t of n)e=e.add(t);return e}var VF=new Ne(ie);function Rw(){return VF}function Pw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zu(e)?"-0":e}}function cP(n){return{integerValue:""+n}}function uP(n,e){return RR(e)?cP(e):Pw(n,e)}var Qa=class{constructor(){this._=void 0}};function xF(n,e,t){return n instanceof Bi?function(i,s){let o={fields:{[qR]:{stringValue:BR},[$R]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ip(s)&&(s=Ep(s)),s&&(o.fields[jR]=s),{mapValue:o}}(t,e):n instanceof xr?hP(n,e):n instanceof Lr?dP(n,e):function(i,s){let o=lP(i,s),a=A0(o)+A0(i.Ee);return TI(o)&&TI(i.Ee)?cP(a):Pw(i.serializer,a)}(n,e)}function LF(n,e,t){return n instanceof xr?hP(n,e):n instanceof Lr?dP(n,e):t}function lP(n,e){return n instanceof qi?function(r){return TI(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Bi=class extends Qa{},xr=class extends Qa{constructor(e){super(),this.elements=e}};function hP(n,e){let t=fP(e);for(let r of n.elements)t.some(i=>Wn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Lr=class extends Qa{constructor(e){super(),this.elements=e}};function dP(n,e){let t=fP(e);for(let r of n.elements)t=t.filter(i=>!Wn(i,r));return{arrayValue:{values:t}}}var qi=class extends Qa{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function A0(n){return Fe(n.integerValue||n.doubleValue)}function fP(n){return al(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Hs=class{constructor(e,t){this.field=e,this.transform=t}};function MF(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof xr&&i instanceof xr||r instanceof Lr&&i instanceof Lr?Fa(r.elements,i.elements,Wn):r instanceof qi&&i instanceof qi?Wn(r.Ee,i.Ee):r instanceof Bi&&i instanceof Bi}(n.transform,e.transform)}var xI=class{constructor(e,t){this.version=e,this.transformResults=t}},$e=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function uf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Ja=class{};function pP(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new $i(n.key,$e.none()):new ji(n.key,n.data,$e.none());{let t=n.data,r=bt.empty(),i=new Ne(it.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new vn(n.key,r,new Wt(i.toArray()),$e.none())}}function FF(n,e,t){n instanceof ji?function(i,s,o){let a=i.value.clone(),u=S0(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof vn?function(i,s,o){if(!uf(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=S0(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(mP(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Hu(n,e,t,r){return n instanceof ji?function(s,o,a,u){if(!uf(s.precondition,o))return a;let h=s.value.clone(),d=R0(s.fieldTransforms,u,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,e,t,r):n instanceof vn?function(s,o,a,u){if(!uf(s.precondition,o))return a;let h=R0(s.fieldTransforms,u,o),d=o.data;return d.setAll(mP(s)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(s,o,a){return uf(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function UF(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=lP(r.transform,i||null);s!=null&&(t===null&&(t=bt.empty()),t.set(r.field,s))}return t||null}function b0(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Fa(r,i,(s,o)=>MF(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var ji=class extends Ja{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},vn=class extends Ja{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function mP(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function S0(n,e,t){let r=new Map;ee(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,LF(o,a,t[i]))}return r}function R0(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,xF(s,o,e))}return r}var $i=class extends Ja{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},cl=class extends Ja{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ul=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&FF(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Hu(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Hu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=aP();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=pP(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(ne.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),le())}isEqual(e){return this.batchId===e.batchId&&Fa(this.mutations,e.mutations,(t,r)=>b0(t,r))&&Fa(this.baseMutations,e.baseMutations,(t,r)=>b0(t,r))}},LI=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){ee(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=function(){return DF}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var ll=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Sf=class{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}};var MI=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ze,Ee;function gP(n){switch(n){case x.OK:return Y(64938);case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return Y(15467,{code:n})}}function _P(n){if(n===void 0)return Ke("GRPC error has no .code"),x.UNKNOWN;switch(n){case Ze.OK:return x.OK;case Ze.CANCELLED:return x.CANCELLED;case Ze.UNKNOWN:return x.UNKNOWN;case Ze.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case Ze.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case Ze.INTERNAL:return x.INTERNAL;case Ze.UNAVAILABLE:return x.UNAVAILABLE;case Ze.UNAUTHENTICATED:return x.UNAUTHENTICATED;case Ze.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case Ze.NOT_FOUND:return x.NOT_FOUND;case Ze.ALREADY_EXISTS:return x.ALREADY_EXISTS;case Ze.PERMISSION_DENIED:return x.PERMISSION_DENIED;case Ze.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case Ze.ABORTED:return x.ABORTED;case Ze.OUT_OF_RANGE:return x.OUT_OF_RANGE;case Ze.UNIMPLEMENTED:return x.UNIMPLEMENTED;case Ze.DATA_LOSS:return x.DATA_LOSS;default:return Y(39323,{code:n})}}(Ee=Ze||(Ze={}))[Ee.OK=0]="OK",Ee[Ee.CANCELLED=1]="CANCELLED",Ee[Ee.UNKNOWN=2]="UNKNOWN",Ee[Ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ee[Ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ee[Ee.NOT_FOUND=5]="NOT_FOUND",Ee[Ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ee[Ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ee[Ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ee[Ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ee[Ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ee[Ee.ABORTED=10]="ABORTED",Ee[Ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ee[Ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ee[Ee.INTERNAL=13]="INTERNAL",Ee[Ee.UNAVAILABLE=14]="UNAVAILABLE",Ee[Ee.DATA_LOSS=15]="DATA_LOSS";var Rf=null;var BF=new Rr([4294967295,4294967295],0);function P0(n){let e=mw().encode(n),t=new Wy;return t.update(e),new Uint8Array(t.digest())}function C0(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Rr([t,r],0),new Rr([i,s],0)]}var FI=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new js(`Invalid padding: ${t}`);if(r<0)throw new js(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new js(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new js(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Rr.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(Rr.fromNumber(r)));return i.compare(BF)===1&&(i=new Rr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=P0(e),[r,i]=C0(t);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);if(!this.ye(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.fe===0)return;let t=P0(e),[r,i]=C0(t);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);this.we(o)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},js=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var hl=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,dl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(ne.min(),i,new Ve(ie),Mt(),le())}},dl=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,le(),le(),le())}};var xa=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},Pf=class{constructor(e,t){this.targetId=e,this.De=t}},Cf=class{constructor(e,t,r=Qe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},kf=class{constructor(){this.ve=0,this.Ce=k0(),this.Fe=Qe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=le(),t=le(),r=le();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Y(38017,{changeType:s})}}),new dl(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=k0()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,ee(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},UI=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=Mt(),this.je=Yd(),this.Je=Yd(),this.He=new Ve(ie)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:Y(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(Tf(s))if(r===0){let o=new Q(s.path);this.Xe(t,o,st.newNoDocument(o,ne.min()))}else ee(r===1,20013,{expectedCount:r});else{let o=this.ot(t);if(o!==r){let a=this._t(e),u=a?this.ut(a,e,o):1;if(u!==0){this.rt(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,h)}Rf?.ct(function(d,m,v,C,k){var V,N,q,G,$,te;let oe={localCacheCount:d,existenceFilterCount:m.count,databaseId:v.database,projectId:v.projectId},Z=m.unchangedNames;return Z&&(oe.bloomFilter={applied:k===0,hashCount:(V=Z?.hashCount)!==null&&V!==void 0?V:0,bitmapLength:(G=(q=(N=Z?.bits)===null||N===void 0?void 0:N.bitmap)===null||q===void 0?void 0:q.length)!==null&&G!==void 0?G:0,padding:(te=($=Z?.bits)===null||$===void 0?void 0:$.padding)!==null&&te!==void 0?te:0,mightContain:T=>{var y;return(y=C?.mightContain(T))!==null&&y!==void 0&&y}}),oe}(o,e.De,this.We.lt(),a,u))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Vr(r).toUint8Array()}catch(u){if(u instanceof Ef)return Nt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new FI(o,i,s)}catch(u){return Nt(u instanceof js?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.fe===0?null:a}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.We.lt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,o)=>{let a=this.st(o);if(a){if(s.current&&Tf(a.target)){let u=new Q(a.target.path);this.Tt(u).has(o)||this.It(o,u)||this.Xe(o,u,st.newNoDocument(u,e))}s.Ne&&(t.set(o,s.Le()),s.ke())}});let r=le();this.Je.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let h=this.st(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ze.forEach((s,o)=>o.setReadTime(e));let i=new hl(e,t,this.He,this.ze,r);return this.ze=Mt(),this.je=Yd(),this.Je=Yd(),this.He=new Ve(ie),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new kf,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new Ne(ie),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new Ne(ie),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||B("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new kf),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function Yd(){return new Ve(Q.comparator)}function k0(){return new Ve(Q.comparator)}var qF={asc:"ASCENDING",desc:"DESCENDING"},jF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},$F={and:"AND",or:"OR"},BI=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function qI(n,e){return n.useProto3Json||kl(e)?e:{value:e}}function Ya(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function yP(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function zF(n,e){return Ya(n,e.toTimestamp())}function He(n){return ee(!!n,49232),ne.fromTimestamp(function(t){let r=Or(t);return new Ue(r.seconds,r.nanos)}(n))}function Cw(n,e){return jI(n,e).canonicalString()}function jI(n,e){let t=function(i){return new ge(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function IP(n){let e=ge.fromString(n);return ee(PP(e),10190,{key:e.toString()}),e}function fl(n,e){return Cw(n.databaseId,e.path)}function zn(n,e){let t=IP(e);if(t.get(1)!==n.databaseId.projectId)throw new U(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new U(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Q(vP(t))}function EP(n,e){return Cw(n.databaseId,e)}function wP(n){let e=IP(n);return e.length===4?ge.emptyPath():vP(e)}function $I(n){return new ge(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function vP(n){return ee(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function N0(n,e,t){return{name:fl(n,e),fields:t.value.mapValue.fields}}function vp(n,e,t){let r=zn(n,e.name),i=He(e.updateTime),s=e.createTime?He(e.createTime):ne.min(),o=new bt({mapValue:{fields:e.fields}}),a=st.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function GF(n,e){return"found"in e?function(r,i){ee(!!i.found,43571),i.found.name,i.found.updateTime;let s=zn(r,i.found.name),o=He(i.found.updateTime),a=i.found.createTime?He(i.found.createTime):ne.min(),u=new bt({mapValue:{fields:i.found.fields}});return st.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){ee(!!i.missing,3894),ee(!!i.readTime,22933);let s=zn(r,i.missing),o=He(i.readTime);return st.newNoDocument(s,o)}(n,e):Y(7234,{result:e})}function WF(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Y(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,d){return h.useProto3Json?(ee(d===void 0||typeof d=="string",58123),Qe.fromBase64String(d||"")):(ee(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Qe.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(h){let d=h.code===void 0?x.UNKNOWN:_P(h.code);return new U(d,h.message||"")}(o);t=new Cf(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=zn(n,r.document.name),s=He(r.document.updateTime),o=r.document.createTime?He(r.document.createTime):ne.min(),a=new bt({mapValue:{fields:r.document.fields}}),u=st.newFoundDocument(i,s,o,a),h=r.targetIds||[],d=r.removedTargetIds||[];t=new xa(h,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=zn(n,r.document),s=r.readTime?He(r.readTime):ne.min(),o=st.newNoDocument(i,s),a=r.removedTargetIds||[];t=new xa([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=zn(n,r.document),s=r.removedTargetIds||[];t=new xa([],s,i,null)}else{if(!("filter"in e))return Y(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new MI(i,s),a=r.targetId;t=new Pf(a,o)}}return t}function pl(n,e){let t;if(e instanceof ji)t={update:N0(n,e.key,e.value)};else if(e instanceof $i)t={delete:fl(n,e.key)};else if(e instanceof vn)t={update:N0(n,e.key,e.data),updateMask:XF(e.fieldMask)};else{if(!(e instanceof cl))return Y(16599,{Rt:e.type});t={verify:fl(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Bi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof xr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Lr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof qi)return{fieldPath:o.field.canonicalString(),increment:a.Ee};throw Y(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:zF(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Y(27497)}(n,e.precondition)),t}function zI(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?$e.updateTime(He(s.updateTime)):s.exists!==void 0?$e.exists(s.exists):$e.none()}(e.currentDocument):$e.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)ee(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),u=new Bi;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];u=new xr(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];u=new Lr(d)}else"increment"in a?u=new qi(o,a.increment):Y(16584,{proto:a});let h=it.fromServerFormat(a.fieldPath);return new Hs(h,u)}(n,i)):[];if(e.update){e.update.name;let i=zn(n,e.update.name),s=new bt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let h=u.fieldPaths||[];return new Wt(h.map(d=>it.fromServerFormat(d)))}(e.updateMask);return new vn(i,s,o,t,r)}return new ji(i,s,t,r)}if(e.delete){let i=zn(n,e.delete);return new $i(i,t)}if(e.verify){let i=zn(n,e.verify);return new cl(i,t)}return Y(1463,{proto:e})}function KF(n,e){return n&&n.length>0?(ee(e!==void 0,14353),n.map(t=>function(i,s){let o=i.updateTime?He(i.updateTime):He(s);return o.isEqual(ne.min())&&(o=He(s)),new xI(o,i.transformResults||[])}(t,e))):[]}function TP(n,e){return{documents:[EP(n,e.path)]}}function Tp(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=EP(n,i);let s=function(h){if(h.length!==0)return RP(Re.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(d=>function(v){return{field:Ci(v.field),direction:QF(v.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=qI(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{Vt:t,parent:i}}function AP(n,e,t,r){let{Vt:i,parent:s}=Tp(n,e),o={},a=[],u=0;return t.forEach(h=>{let d=r?h.alias:"aggregate_"+u++;o[d]=h.alias,h.aggregateType==="count"?a.push({alias:d,count:{}}):h.aggregateType==="avg"?a.push({alias:d,avg:{field:Ci(h.fieldPath)}}):h.aggregateType==="sum"&&a.push({alias:d,sum:{field:Ci(h.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:i.structuredQuery},parent:i.parent},ft:o,parent:s}}function bP(n){let e=wP(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){ee(r===1,65062);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(m){let v=SP(m);return v instanceof Re&&bw(v)?v.getFilters():[v]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(v=>function(k){return new Ws(Na(k.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(v))}(t.orderBy));let a=null;t.limit&&(a=function(m){let v;return v=typeof m=="object"?m.value:m,kl(v)?null:v}(t.limit));let u=null;t.startAt&&(u=function(m){let v=!!m.before,C=m.values||[];return new Kn(C,v)}(t.startAt));let h=null;return t.endAt&&(h=function(m){let v=!m.before,C=m.values||[];return new Kn(C,v)}(t.endAt)),ZR(e,i,o,s,a,"F",u,h)}function HF(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Y(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function SP(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Na(t.unaryFilter.field);return _e.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Na(t.unaryFilter.field);return _e.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Na(t.unaryFilter.field);return _e.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Na(t.unaryFilter.field);return _e.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Y(61313);default:return Y(60726)}}(n):n.fieldFilter!==void 0?function(t){return _e.create(Na(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Y(58110);default:return Y(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Re.create(t.compositeFilter.filters.map(r=>SP(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Y(1026)}}(t.compositeFilter.op))}(n):Y(30097,{filter:n})}function QF(n){return qF[n]}function JF(n){return jF[n]}function YF(n){return $F[n]}function Ci(n){return{fieldPath:n.canonicalString()}}function Na(n){return it.fromServerFormat(n.fieldPath)}function RP(n){return n instanceof _e?function(t){if(t.op==="=="){if(g0(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NAN"}};if(m0(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(g0(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NOT_NAN"}};if(m0(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ci(t.field),op:JF(t.op),value:t.value}}}(n):n instanceof Re?function(t){let r=t.getFilters().map(i=>RP(i));return r.length===1?r[0]:{compositeFilter:{op:YF(t.op),filters:r}}}(n):Y(54877,{filter:n})}function XF(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function PP(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Xa=class n{constructor(e,t,r,i,s=ne.min(),o=ne.min(),a=Qe.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Nf=class{constructor(e){this.gt=e}};function ZF(n,e){let t;if(e.document)t=vp(n.gt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=Q.fromSegments(e.noDocument.path),i=Js(e.noDocument.readTime);t=st.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Y(56709);{let r=Q.fromSegments(e.unknownDocument.path),i=Js(e.unknownDocument.version);t=st.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Ue(i[0],i[1]);return ne.fromTimestamp(s)}(e.readTime)),t}function D0(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Df(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:fl(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Ya(s,o.version.toTimestamp()),createTime:Ya(s,o.createTime.toTimestamp())}}(n.gt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Qs(e.version)};else{if(!e.isUnknownDocument())return Y(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Qs(e.version)}}return r}function Df(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Qs(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Js(n){let e=new Ue(n.seconds,n.nanoseconds);return ne.fromTimestamp(e)}function Fs(n,e){let t=(e.baseMutations||[]).map(s=>zI(n.gt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>zI(n.gt,s)),i=Ue.fromMillis(e.localWriteTimeMs);return new ul(e.batchId,i,t,r)}function ju(n){let e=Js(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Js(n.lastLimboFreeSnapshotVersion):ne.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){let o=s.documents.length;return ee(o===1,1966,{count:o}),Rt(cc(wP(s.documents[0])))}(n.query):function(s){return Rt(bP(s))}(n.query),new Xa(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Qe.fromBase64String(n.resumeToken))}function CP(n,e){let t=Qs(e.snapshotVersion),r=Qs(e.lastLimboFreeSnapshotVersion),i;i=Tf(e.target)?TP(n.gt,e.target):Tp(n.gt,e.target).Vt;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ks(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ap(n){let e=bP({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?bf(e,e.limit,"L"):e}function Xy(n,e){return new ll(e.largestBatchId,zI(n.gt,e.overlayMutation))}function O0(n,e){let t=e.path.lastSegment();return[n,St(e.path.popLast()),t]}function V0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Qs(r.readTime),documentKey:St(r.documentKey.path),largestBatchId:r.largestBatchId}}var GI=class{getBundleMetadata(e,t){return x0(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Js(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return x0(e).put(function(i){return{bundleId:i.id,createTime:Qs(He(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return L0(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Ap(s.bundledQuery),readTime:Js(s.readTime)}}(r)})}saveNamedQuery(e,t){return L0(e).put(function(i){return{name:i.name,readTime:Qs(He(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function x0(n){return ft(n,gp)}function L0(n){return ft(n,_p)}var Of=class n{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Mu(e).get(O0(this.userId,t)).next(r=>r?Xy(this.serializer,r):null)}getOverlays(e,t){let r=qn();return L.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new ll(t,o);i.push(this.wt(e,a))}),L.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(St(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Mu(e).Y(EI,a))}),L.waitFor(s)}getOverlaysForCollection(e,t,r){let i=qn(),s=St(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Mu(e).j(EI,o).next(a=>{for(let u of a){let h=Xy(this.serializer,u);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=qn(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Mu(e).X({index:OR,range:a},(u,h,d)=>{let m=Xy(this.serializer,h);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):d.done()}).next(()=>s)}wt(e,t){return Mu(e).put(function(i,s,o){let[a,u,h]=O0(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:pl(i.gt,o.mutation)}}(this.serializer,this.userId,t))}};function Mu(n){return ft(n,yp)}var WI=class{St(e){return ft(e,ww)}getSessionToken(e){return this.St(e).get("sessionToken").next(t=>{let r=t?.value;return r?Qe.fromUint8Array(r):Qe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Cr=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(Fe(e.integerValue));else if("doubleValue"in e){let r=Fe(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Zu(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=Or(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Vr(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?GR(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):wp(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):Y(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let o=Wa,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(Fe(a)),this.xt(o,t),this.Dt(s[o],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),Q.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};Cr.Ut=new Cr;var ba=255;function e2(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function M0(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=e2(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var KI=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Wt(r.value),r=t.next();this.Gt()}zt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.jt(r.value),r=t.next();this.Jt()}Ht(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Wt(r);else if(r<2048)this.Wt(960|r>>>6),this.Wt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Wt(480|r>>>12),this.Wt(128|63&r>>>6),this.Wt(128|63&r);else{let i=t.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.jt(r);else if(r<2048)this.jt(960|r>>>6),this.jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.jt(480|r>>>12),this.jt(128|63&r>>>6),this.jt(128|63&r);else{let i=t.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(e){let t=this.Xt(e),r=M0(t);this.en(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}tn(e){let t=this.Xt(e),r=M0(t);this.en(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}nn(){this.rn(ba),this.rn(255)}sn(){this._n(ba),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Wt(e){let t=255&e;t===0?(this.rn(0),this.rn(255)):t===ba?(this.rn(ba),this.rn(0)):this.rn(t)}jt(e){let t=255&e;t===0?(this._n(0),this._n(255)):t===ba?(this._n(ba),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},HI=class{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}},QI=class{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}},Us=class{constructor(){this.un=new KI,this.cn=new HI(this.un),this.ln=new QI(this.un)}seed(e){this.un.seed(e)}hn(e){return e===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var Bs=class n{constructor(e,t,r,i){this.Pn=e,this.Tn=t,this.In=r,this.dn=i}En(){let e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new n(this.Pn,this.Tn,this.In,r)}An(e,t,r){return{indexId:this.Pn,uid:e,arrayValue:lf(this.In),directionalValue:lf(this.dn),orderedDocumentKey:lf(t),documentKey:r.path.toArray()}}Rn(e,t,r){let i=this.An(e,t,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function Si(n,e){let t=n.Pn-e.Pn;return t!==0?t:(t=F0(n.In,e.In),t!==0?t:(t=F0(n.dn,e.dn),t!==0?t:Q.comparator(n.Tn,e.Tn)))}function F0(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function lf(n){return Xp()?function(t){let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r}(n):n}function U0(n){return typeof n!="string"?n:function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(n)}var Vf=class{constructor(e){this.Vn=new Ne((t,r)=>it.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Vn=this.Vn.add(r):this.fn.push(r)}}get gn(){return this.Vn.size>1}pn(e){if(ee(e.collectionGroup===this.collectionId,49279),this.gn)return!1;let t=fI(e);if(t!==void 0&&!this.yn(t))return!1;let r=xs(e),i=new Set,s=0,o=0;for(;s<r.length&&this.yn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Vn.size>0){let a=this.Vn.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.wn(a,u)||!this.Sn(this.mn[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.mn.length||!this.Sn(this.mn[o++],a))return!1}return!0}bn(){if(this.gn)return null;let e=new Ne(it.comparator),t=[];for(let r of this.fn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new kr(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new kr(r.field,0))}for(let r of this.mn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new kr(r.field,r.dir==="asc"?0:1)));return new Li(Li.UNKNOWN_ID,this.collectionId,t,Ba.empty())}yn(e){for(let t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function kP(n){var e,t;if(ee(n instanceof _e||n instanceof Re,20012),n instanceof _e){if(n instanceof vf){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>_e.create(n.field,"==",s)))||[];return Re.create(i,"or")}return n}let r=n.filters.map(i=>kP(i));return Re.create(r,n.op)}function t2(n){if(n.getFilters().length===0)return[];let e=XI(kP(n));return ee(NP(e),7391),JI(e)||YI(e)?[e]:e.getFilters()}function JI(n){return n instanceof _e}function YI(n){return n instanceof Re&&bw(n)}function NP(n){return JI(n)||YI(n)||function(t){if(t instanceof Re&&AI(t)){for(let r of t.getFilters())if(!JI(r)&&!YI(r))return!1;return!0}return!1}(n)}function XI(n){if(ee(n instanceof _e||n instanceof Re,34018),n instanceof _e)return n;if(n.filters.length===1)return XI(n.filters[0]);let e=n.filters.map(r=>XI(r)),t=Re.create(e,n.op);return t=xf(t),NP(t)?t:(ee(t instanceof Re,64498),ee(Ha(t),40251),ee(t.filters.length>1,57927),t.filters.reduce((r,i)=>kw(r,i)))}function kw(n,e){let t;return ee(n instanceof _e||n instanceof Re,38388),ee(e instanceof _e||e instanceof Re,25473),t=n instanceof _e?e instanceof _e?function(i,s){return Re.create([i,s],"and")}(n,e):B0(n,e):e instanceof _e?B0(e,n):function(i,s){if(ee(i.filters.length>0&&s.filters.length>0,48005),Ha(i)&&Ha(s))return JR(i,s.getFilters());let o=AI(i)?i:s,a=AI(i)?s:i,u=o.filters.map(h=>kw(h,a));return Re.create(u,"or")}(n,e),xf(t)}function B0(n,e){if(Ha(e))return JR(e,n.getFilters());{let t=e.filters.map(r=>kw(n,r));return Re.create(t,"or")}}function xf(n){if(ee(n instanceof _e||n instanceof Re,11850),n instanceof _e)return n;let e=n.getFilters();if(e.length===1)return xf(e[0]);if(HR(n))return n;let t=e.map(i=>xf(i)),r=[];return t.forEach(i=>{i instanceof _e?r.push(i):i instanceof Re&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Re.create(r,n.op)}var ZI=class{constructor(){this.Dn=new ml}addToCollectionParentIndex(e,t){return this.Dn.add(t),L.resolve()}getCollectionParents(e,t){return L.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return L.resolve()}deleteFieldIndex(e,t){return L.resolve()}deleteAllFieldIndexes(e){return L.resolve()}createTargetIndexes(e,t){return L.resolve()}getDocumentsMatchingTarget(e,t){return L.resolve(null)}getIndexType(e,t){return L.resolve(0)}getFieldIndexes(e,t){return L.resolve([])}getNextCollectionGroupToUpdate(e){return L.resolve(null)}getMinOffset(e,t){return L.resolve(nn.min())}getMinOffsetFromCollectionGroup(e,t){return L.resolve(nn.min())}updateCollectionGroup(e,t,r){return L.resolve()}updateIndexEntries(e,t){return L.resolve()}},ml=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ne(ge.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ne(ge.comparator)).toArray()}};var q0="IndexedDbIndexManager",Xd=new Uint8Array(0),eE=class{constructor(e,t){this.databaseId=t,this.vn=new ml,this.Cn=new wn(r=>Ks(r),(r,i)=>Dl(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let s={collectionId:r,parent:St(i)};return j0(e).put(s)}return L.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[ER(t),""],!1,!0);return j0(e).j(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Bn(o.parent))}return r})}addFieldIndex(e,t){let r=Fu(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Ra(e);return s.next(a=>{o.put(V0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Fu(e),i=Ra(e),s=Sa(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Fu(e),r=Sa(e),i=Ra(e);return t.Y().next(()=>r.Y()).next(()=>i.Y())}createTargetIndexes(e,t){return L.forEach(this.Fn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Vf(r).bn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Sa(e),i=!0,s=new Map;return L.forEach(this.Fn(t),o=>this.Mn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=le(),a=[];return L.forEach(s,(u,h)=>{B(q0,`Using index ${function($){return`id=${$.indexId}|cg=${$.collectionGroup}|f=${$.fields.map(te=>`${te.fieldPath}:${te.kind}`).join(",")}`}(u)} to execute ${Ks(t)}`);let d=function($,te){let oe=fI(te);if(oe===void 0)return null;for(let Z of Af($,oe.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(h,u),m=function($,te){let oe=new Map;for(let Z of xs(te))for(let T of Af($,Z.fieldPath))switch(T.op){case"==":case"in":oe.set(Z.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return oe.set(Z.fieldPath.canonicalString(),T.value),Array.from(oe.values())}return null}(h,u),v=function($,te){let oe=[],Z=!0;for(let T of xs(te)){let y=T.kind===0?w0($,T.fieldPath,$.startAt):v0($,T.fieldPath,$.startAt);oe.push(y.value),Z&&(Z=y.inclusive)}return new Kn(oe,Z)}(h,u),C=function($,te){let oe=[],Z=!0;for(let T of xs(te)){let y=T.kind===0?v0($,T.fieldPath,$.endAt):w0($,T.fieldPath,$.endAt);oe.push(y.value),Z&&(Z=y.inclusive)}return new Kn(oe,Z)}(h,u),k=this.xn(u,h,v),V=this.xn(u,h,C),N=this.On(u,h,m),q=this.Nn(u.indexId,d,k,v.inclusive,V,C.inclusive,N);return L.forEach(q,G=>r.H(G,t.limit).next($=>{$.forEach(te=>{let oe=Q.fromSegments(te.documentKey);o.has(oe)||(o=o.add(oe),a.push(oe))})}))}).next(()=>a)}return L.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=t2(Re.create(e.filters,"and")).map(r=>OI(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),h=u/(t!=null?t.length:1),d=[];for(let m=0;m<u;++m){let v=t?this.Bn(t[m/h]):Xd,C=this.Ln(e,v,r[m%h],i),k=this.kn(e,v,s[m%h],o),V=a.map(N=>this.Ln(e,v,N,!0));d.push(...this.createRange(C,k,V))}return d}Ln(e,t,r,i){let s=new Bs(e,Q.empty(),t,r);return i?s:s.En()}kn(e,t,r,i){let s=new Bs(e,Q.empty(),t,r);return i?s.En():s}Mn(e,t){let r=new Vf(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.pn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.Fn(t);return L.forEach(i,s=>this.Mn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let h=new Ne(it.comparator),d=!1;for(let m of u.filters)for(let v of m.getFlattenedFilters())v.field.isKeyField()||(v.op==="array-contains"||v.op==="array-contains-any"?d=!0:h=h.add(v.field));for(let m of u.orderBy)m.field.isKeyField()||(h=h.add(m.field));return h.size+(d?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}qn(e,t){let r=new Us;for(let i of xs(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.hn(i.kind);Cr.Ut.bt(s,o)}return r.an()}Bn(e){let t=new Us;return Cr.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){let r=new Us;return Cr.Ut.bt(Gs(this.databaseId,t),r.hn(function(s){let o=xs(s);return o.length===0?0:o[o.length-1].kind}(e))),r.an()}On(e,t,r){if(r===null)return[];let i=[];i.push(new Us);let s=0;for(let o of xs(e)){let a=r[s++];for(let u of i)if(this.$n(t,o.fieldPath)&&al(a))i=this.Un(i,o,a);else{let h=u.hn(o.kind);Cr.Ut.bt(a,h)}}return this.Kn(i)}xn(e,t,r){return this.On(e,t,r.position)}Kn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].an();return t}Un(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new Us;u.seed(a.an()),Cr.Ut.bt(o,u.hn(t.kind)),s.push(u)}return s}$n(e,t){return!!e.filters.find(r=>r instanceof _e&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Fu(e),i=Ra(e);return(t?r.j(II,IDBKeyRange.bound(t,t)):r.j()).next(s=>{let o=[];return L.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(d,m){let v=m?new Ba(m.sequenceNumber,new nn(Js(m.readTime),new Q(Bn(m.documentKey)),m.largestBatchId)):Ba.empty(),C=d.fields.map(([k,V])=>new kr(it.fromServerFormat(k),V));return new Li(d.indexId,d.collectionGroup,C,v)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ie(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Fu(e),s=Ra(e);return this.Wn(e).next(o=>i.j(II,IDBKeyRange.bound(t,t)).next(a=>L.forEach(a,u=>s.put(V0(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return L.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?L.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),L.forEach(a,u=>this.Gn(e,i,u).next(h=>{let d=this.zn(s,u);return h.isEqual(d)?L.resolve():this.jn(e,s,u,h,d)}))))})}Jn(e,t,r,i){return Sa(e).put(i.An(this.uid,this.Qn(r,t.key),t.key))}Hn(e,t,r,i){return Sa(e).delete(i.Rn(this.uid,this.Qn(r,t.key),t.key))}Gn(e,t,r){let i=Sa(e),s=new Ne(Si);return i.X({index:DR,range:IDBKeyRange.only([r.indexId,this.uid,lf(this.Qn(r,t))])},(o,a)=>{s=s.add(new Bs(r.indexId,t,U0(a.arrayValue),U0(a.directionalValue)))}).next(()=>s)}zn(e,t){let r=new Ne(Si),i=this.qn(t,e);if(i==null)return r;let s=fI(t);if(s!=null){let o=e.data.field(s.fieldPath);if(al(o))for(let a of o.arrayValue.values||[])r=r.add(new Bs(t.indexId,e.key,this.Bn(a),i))}else r=r.add(new Bs(t.indexId,e.key,Xd,i));return r}jn(e,t,r,i,s){B(q0,"Updating index entries for document '%s'",t.key);let o=[];return function(u,h,d,m,v){let C=u.getIterator(),k=h.getIterator(),V=Aa(C),N=Aa(k);for(;V||N;){let q=!1,G=!1;if(V&&N){let $=d(V,N);$<0?G=!0:$>0&&(q=!0)}else V!=null?G=!0:q=!0;q?(m(N),N=Aa(k)):G?(v(V),V=Aa(C)):(V=Aa(C),N=Aa(k))}}(i,s,Si,a=>{o.push(this.Jn(e,t,r,a))},a=>{o.push(this.Hn(e,t,r,a))}),L.waitFor(o)}Wn(e){let t=1;return Ra(e).X({index:NR,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Si(o,a)).filter((o,a,u)=>!a||Si(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Si(o,e),u=Si(o,t);if(a===0)i[0]=e.En();else if(a>0&&u<0)i.push(o),i.push(o.En());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Yn(i[o],i[o+1]))return[];let a=i[o].Rn(this.uid,Xd,Q.empty()),u=i[o+1].Rn(this.uid,Xd,Q.empty());s.push(IDBKeyRange.bound(a,u))}return s}Yn(e,t){return Si(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($0)}getMinOffset(e,t){return L.mapArray(this.Fn(t),r=>this.Mn(e,r).next(i=>i||Y(44426))).next($0)}};function j0(n){return ft(n,nl)}function Sa(n){return ft(n,Gu)}function Fu(n){return ft(n,Ew)}function Ra(n){return ft(n,zu)}function $0(n){ee(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;_w(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new nn(e.readTime,e.documentKey,t)}var z0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},DP=41943040,Lt=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};function OP(n,e,t){let r=n.store(In),i=n.store(qa),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.X({range:o},(d,m,v)=>(a++,v.delete()));s.push(u.next(()=>{ee(a===1,47070,{batchId:t.batchId})}));let h=[];for(let d of t.mutations){let m=PR(e,d.key.path,t.batchId);s.push(i.delete(m)),h.push(d.key)}return L.waitFor(s).next(()=>h)}function Lf(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Y(14731);e=n.noDocument}return JSON.stringify(e).length}Lt.DEFAULT_COLLECTION_PERCENTILE=10,Lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lt.DEFAULT=new Lt(DP,Lt.DEFAULT_COLLECTION_PERCENTILE,Lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lt.DISABLED=new Lt(-1,0,0);var Mf=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Zn={}}static yt(e,t,r,i){ee(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ri(e).X({index:qs,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Da(e),o=Ri(e);return o.add({}).next(a=>{ee(typeof a=="number",49019);let u=new ul(a,t,r,i),h=function(C,k,V){let N=V.baseMutations.map(G=>pl(C.gt,G)),q=V.mutations.map(G=>pl(C.gt,G));return{userId:k,batchId:V.batchId,localWriteTimeMs:V.localWriteTime.toMillis(),baseMutations:N,mutations:q}}(this.serializer,this.userId,u),d=[],m=new Ne((v,C)=>ie(v.canonicalString(),C.canonicalString()));for(let v of i){let C=PR(this.userId,v.key.path,a);m=m.add(v.key.path.popLast()),d.push(o.put(h)),d.push(s.put(C,nF))}return m.forEach(v=>{d.push(this.indexManager.addToCollectionParentIndex(e,v))}),e.addOnCommittedListener(()=>{this.Zn[a]=u.keys()}),L.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return Ri(e).get(t).next(r=>r?(ee(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Fs(this.serializer,r)):null)}Xn(e,t){return this.Zn[t]?L.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Zn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Ri(e).X({index:qs,range:i},(o,a,u)=>{a.userId===this.userId&&(ee(a.batchId>=r,47524,{er:r}),s=Fs(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Oi;return Ri(e).X({index:qs,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Oi],[this.userId,Number.POSITIVE_INFINITY]);return Ri(e).j(qs,t).next(r=>r.map(i=>Fs(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=rf(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Da(e).X({range:i},(o,a,u)=>{let[h,d,m]=o,v=Bn(d);if(h===this.userId&&t.path.isEqual(v))return Ri(e).get(m).next(C=>{if(!C)throw Y(61480,{tr:o,batchId:m});ee(C.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:C.userId,batchId:m}),s.push(Fs(this.serializer,C))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ne(ie),i=[];return t.forEach(s=>{let o=rf(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Da(e).X({range:a},(h,d,m)=>{let[v,C,k]=h,V=Bn(C);v===this.userId&&s.path.isEqual(V)?r=r.add(k):m.done()});i.push(u)}),L.waitFor(i).next(()=>this.nr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=rf(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ne(ie);return Da(e).X({range:o},(u,h,d)=>{let[m,v,C]=u,k=Bn(v);m===this.userId&&r.isPrefixOf(k)?k.length===i&&(a=a.add(C)):d.done()}).next(()=>this.nr(e,a))}nr(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Ri(e).get(s).next(o=>{if(o===null)throw Y(35274,{batchId:s});ee(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),r.push(Fs(this.serializer,o))}))}),L.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return OP(e.ce,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),L.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return L.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Da(e).X({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=Bn(s[1]);i.push(u)}else a.done()}).next(()=>{ee(i.length===0,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return VP(e,this.userId,t)}sr(e){return xP(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Oi,lastStreamToken:""})}};function VP(n,e,t){let r=rf(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Da(n).X({range:s,Z:!0},(a,u,h)=>{let[d,m,v]=a;d===e&&m===i&&(o=!0),h.done()}).next(()=>o)}function Ri(n){return ft(n,In)}function Da(n){return ft(n,qa)}function xP(n){return ft(n,el)}var Za=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var tE=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{let r=new Za(t.highestTargetId);return t.highestTargetId=r.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(t=>ne.fromTimestamp(new Ue(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.cr(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.lr(e,i)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(r=>(r.targetCount+=1,this.Pr(t,r),this.lr(e,r))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Pa(e).delete(t.targetId)).next(()=>this.cr(e)).next(r=>(ee(r.targetCount>0,8065),r.targetCount-=1,this.lr(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Pa(e).X((o,a)=>{let u=ju(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>L.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Pa(e).X((r,i)=>{let s=ju(i);t(s)})}cr(e){return G0(e).get(yf).next(t=>(ee(t!==null,2888),t))}lr(e,t){return G0(e).put(yf,t)}hr(e,t){return Pa(e).put(CP(this.serializer,t))}Pr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.cr(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Ks(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Pa(e).X({range:i,index:kR},(o,a,u)=>{let h=ju(a);Dl(t,h.target)&&(s=h,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=ki(e);return t.forEach(o=>{let a=St(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),L.waitFor(i)}removeMatchingKeys(e,t,r){let i=ki(e);return L.forEach(t,s=>{let o=St(s.path);return L.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=ki(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=ki(e),s=le();return i.X({range:r,Z:!0},(o,a,u)=>{let h=Bn(o[1]),d=new Q(h);s=s.add(d)}).next(()=>s)}containsKey(e,t){let r=St(t.path),i=IDBKeyRange.bound([r],[ER(r)],!1,!0),s=0;return ki(e).X({index:Iw,Z:!0,range:i},([o,a],u,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}Et(e,t){return Pa(e).get(t).next(r=>r?ju(r):null)}};function Pa(n){return ft(n,ja)}function G0(n){return ft(n,zs)}function ki(n){return ft(n,$a)}var W0="LruGarbageCollector",LP=1048576;function K0([n,e],[t,r]){let i=ie(n,t);return i===0?ie(e,r):i}var nE=class{constructor(e){this.Tr=e,this.buffer=new Ne(K0),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();K0(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ff=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){B(W0,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>w(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ki(t)?B(W0,"Ignoring IndexedDB error during garbage collection: ",t):yield Wi(t)}yield this.Rr(3e5)}))}},rE=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return L.resolve(Gt.ue);let r=new nE(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(B("LruGarbageCollector","Garbage collection skipped; disabled"),L.resolve(z0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),z0):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,o,a,u,h,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(B("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(h=Date.now(),Ca()<=de.DEBUG&&B("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-d}ms`),L.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function MP(n,e){return new rE(n,e)}var iE=class{constructor(e,t){this.db=e,this.garbageCollector=MP(this,t)}mr(e){let t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(r,i)=>t(i))}addReference(e,t,r){return Zd(e,r)}removeReference(e,t,r){return Zd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Zd(e,t)}Sr(e,t){return function(i,s){let o=!1;return xP(i).ee(a=>VP(i,a,s).next(u=>(u&&(o=!0),L.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.wr(e,(o,a)=>{if(a<=t){let u=this.Sr(e,o).next(h=>{if(!h)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ne.min()),ki(e).delete(function(m){return[0,St(m.path)]}(o))))});i.push(u)}}).next(()=>L.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Zd(e,t)}wr(e,t){let r=ki(e),i,s=Gt.ue;return r.X({index:Iw},([o,a],{path:u,sequenceNumber:h})=>{o===0?(s!==Gt.ue&&t(new Q(Bn(i)),s),s=h,i=u):s=Gt.ue}).next(()=>{s!==Gt.ue&&t(new Q(Bn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Zd(n,e){return ki(n).put(function(r,i){return{targetId:0,path:St(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var Uf=class{constructor(){this.changes=new wn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,st.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?L.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var sE=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Vs(e).put(r)}removeEntry(e,t,r){return Vs(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Df(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=st.newInvalidDocument(t);return Vs(e).X({index:sf,range:IDBKeyRange.only(Uu(t))},(i,s)=>{r=this.Dr(t,s)}).next(()=>r)}vr(e,t){let r={size:0,document:st.newInvalidDocument(t)};return Vs(e).X({index:sf,range:IDBKeyRange.only(Uu(t))},(i,s)=>{r={document:this.Dr(t,s),size:Lf(s)}}).next(()=>r)}getEntries(e,t){let r=Mt();return this.Cr(e,t,(i,s)=>{let o=this.Dr(i,s);r=r.insert(i,o)}).next(()=>r)}Fr(e,t){let r=Mt(),i=new Ve(Q.comparator);return this.Cr(e,t,(s,o)=>{let a=this.Dr(s,o);r=r.insert(s,a),i=i.insert(s,Lf(o))}).next(()=>({documents:r,Mr:i}))}Cr(e,t,r){if(t.isEmpty())return L.resolve();let i=new Ne(J0);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(Uu(i.first()),Uu(i.last())),o=i.getIterator(),a=o.getNext();return Vs(e).X({index:sf,range:s},(u,h,d)=>{let m=Q.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;a&&J0(a,m)<0;)r(a,null),a=o.getNext();a&&a.isEqual(m)&&(r(a,h),a=o.hasNext()?o.getNext():null),a?d.G(Uu(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Df(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Vs(e).j(IDBKeyRange.bound(a,u,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let d=Mt();for(let m of h){let v=this.Dr(Q.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);v.isFoundDocument()&&(Vl(t,v)||i.has(v.key))&&(d=d.insert(v.key,v))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=Mt(),o=Q0(t,r),a=Q0(t,nn.max());return Vs(e).X({index:CR,range:IDBKeyRange.bound(o,a,!0)},(u,h,d)=>{let m=this.Dr(Q.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(m.key,m),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new oE(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return H0(e).get(yI).next(t=>(ee(!!t,20021),t))}br(e,t){return H0(e).put(yI,t)}Dr(e,t){if(t){let r=ZF(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ne.min())))return r}return st.newInvalidDocument(e)}};function FP(n){return new sE(n)}var oE=class extends Uf{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new wn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ne((s,o)=>ie(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.Nr.get(s);if(t.push(this.Or.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=D0(this.Or.serializer,o);i=i.add(s.path.popLast());let h=Lf(u);r+=h-a.size,t.push(this.Or.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=D0(this.Or.serializer,o.convertToNoDocument(ne.min()));t.push(this.Or.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Or.updateMetadata(e,r)),L.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(r=>(this.Nr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:r,Mr:i})=>(i.forEach((s,o)=>{this.Nr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function H0(n){return ft(n,tl)}function Vs(n){return ft(n,_f)}function Uu(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Q0(n,e){let t=e.documentKey.path.toArray();return[n,Df(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function J0(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ie(t[s],r[s]),i)return i;return i=ie(t.length,r.length),i||(i=ie(t[t.length-2],r[r.length-2]),i||ie(t[t.length-1],r[r.length-1]))}var aE=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Bf=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Hu(r.mutation,i,Wt.empty(),Ue.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,le()).next(()=>r))}getLocalViewOfDocuments(e,t,r=le()){let i=qn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=qu();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=qn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,le()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Mt(),o=Ku(),a=function(){return Ku()}();return t.forEach((u,h)=>{let d=r.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof vn)?s=s.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),Hu(d.mutation,h,d.mutation.getFieldMask(),Ue.now())):o.set(h.key,Wt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,d)=>o.set(h,d)),t.forEach((h,d)=>{var m;return a.set(h,new aE(d,(m=o.get(h))!==null&&m!==void 0?m:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Ku(),i=new Ve((o,a)=>o-a),s=le();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let d=r.get(u)||Wt.empty();d=a.applyToLocalView(h,d),r.set(u,d);let m=(i.get(a.batchId)||le()).add(u);i=i.insert(a.batchId,m)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),h=u.key,d=u.value,m=aP();d.forEach(v=>{if(!s.has(v)){let C=pP(t.get(v),r.get(v));C!==null&&m.set(v,C),s=s.add(v)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,m))}return L.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return Q.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Sw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):L.resolve(qn()),a=Ua,u=s;return o.next(h=>L.forEach(h,(d,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(d)?L.resolve():this.remoteDocumentCache.getEntry(e,d).next(v=>{u=u.insert(d,v)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,le())).next(d=>({batchId:a,changes:oP(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Q(t)).next(r=>{let i=qu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=qu();return this.indexManager.getCollectionParents(e,s).next(a=>L.forEach(a,u=>{let h=function(m,v){return new En(v,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next(d=>{d.forEach((m,v)=>{o=o.insert(m,v)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,h)=>{let d=h.getKey();o.get(d)===null&&(o=o.insert(d,st.newInvalidDocument(d)))});let a=qu();return o.forEach((u,h)=>{let d=s.get(u);d!==void 0&&Hu(d.mutation,h,Wt.empty(),Ue.now()),Vl(t,h)&&(a=a.insert(u,h))}),a})}};var cE=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return L.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(i){return{id:i.id,version:i.version,createTime:He(i.createTime)}}(t)),L.resolve()}getNamedQuery(e,t){return L.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(i){return{name:i.name,query:Ap(i.bundledQuery),readTime:He(i.readTime)}}(t)),L.resolve()}};var uE=class{constructor(){this.overlays=new Ve(Q.comparator),this.kr=new Map}getOverlay(e,t){return L.resolve(this.overlays.get(t))}getOverlays(e,t){let r=qn();return L.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),L.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),L.resolve()}getOverlaysForCollection(e,t,r){let i=qn(),s=t.length+1,o=new Q(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return L.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ve((h,d)=>h-d),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=s.get(h.largestBatchId);d===null&&(d=qn(),s=s.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}let a=qn(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,d)=>a.set(h,d)),!(a.size()>=i)););return L.resolve(a)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new ll(t,r));let s=this.kr.get(t);s===void 0&&(s=le(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};var lE=class{constructor(){this.sessionToken=Qe.EMPTY_BYTE_STRING}getSessionToken(e){return L.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,L.resolve()}};var gl=class{constructor(){this.qr=new Ne(et.Qr),this.$r=new Ne(et.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new et(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new et(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new Q(new ge([])),r=new et(t,e),i=new et(t,e+1),s=[];return this.$r.forEachInRange([r,i],o=>{this.Wr(o),s.push(o.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new Q(new ge([])),r=new et(t,e),i=new et(t,e+1),s=le();return this.$r.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new et(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},et=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return Q.comparator(e.key,t.key)||ie(e.Hr,t.Hr)}static Ur(e,t){return ie(e.Hr,t.Hr)||Q.comparator(e.key,t.key)}};var hE=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Ne(et.Qr)}checkEmpty(e){return L.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ul(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.Yr=this.Yr.add(new et(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return L.resolve(o)}lookupMutationBatch(e,t){return L.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return L.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return L.resolve(this.mutationQueue.length===0?Oi:this.er-1)}getAllMutationBatches(e){return L.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new et(t,0),i=new et(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],o=>{let a=this.Zr(o.Hr);s.push(a)}),L.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ne(ie);return t.forEach(i=>{let s=new et(i,0),o=new et(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,o],a=>{r=r.add(a.Hr)})}),L.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;Q.isDocumentKey(s)||(s=s.child(""));let o=new et(new Q(s),0),a=new Ne(ie);return this.Yr.forEachWhile(u=>{let h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(a=a.add(u.Hr)),!0)},o),L.resolve(this.ei(a))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){ee(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return L.forEach(t.mutations,i=>{let s=new et(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new et(t,0),i=this.Yr.firstAfterOrEqual(r);return L.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,L.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var dE=class{constructor(e){this.ni=e,this.docs=function(){return new Ve(Q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return L.resolve(r?r.document.mutableCopy():st.newInvalidDocument(t))}getEntries(e,t){let r=Mt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():st.newInvalidDocument(i))}),L.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Mt(),o=t.path,a=new Q(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:h,value:{document:d}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||_w(AR(d),r)<=0||(i.has(d.key)||Vl(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return L.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Y(9500)}ri(e,t){return L.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new fE(this)}getSize(e){return L.resolve(this.size)}},fE=class extends Uf{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),L.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var pE=class{constructor(e){this.persistence=e,this.ii=new wn(t=>Ks(t),Dl),this.lastRemoteSnapshotVersion=ne.min(),this.highestTargetId=0,this.si=0,this.oi=new gl,this.targetCount=0,this._i=Za.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),L.resolve()}getLastRemoteSnapshotVersion(e){return L.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return L.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),L.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),L.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Za(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,L.resolve()}updateTargetData(e,t){return this.hr(t),L.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,L.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.ii.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),L.waitFor(s).next(()=>i)}getTargetCount(e){return L.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return L.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),L.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),L.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),L.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return L.resolve(r)}containsKey(e,t){return L.resolve(this.oi.containsKey(t))}};var _l=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new Gt(0),this.ci=!1,this.ci=!0,this.li=new lE,this.referenceDelegate=e(this),this.hi=new pE(this),this.indexManager=new ZI,this.remoteDocumentCache=function(i){return new dE(i)}(r=>this.referenceDelegate.Pi(r)),this.serializer=new Nf(t),this.Ti=new cE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uE,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new hE(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){B("MemoryPersistence","Starting transaction:",e);let i=new mE(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return L.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},mE=class extends pf{constructor(e){super(),this.currentSequenceNumber=e}},qf=class n{constructor(e){this.persistence=e,this.Ai=new gl,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw Y(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),L.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),L.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),L.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return L.forEach(this.mi,r=>{let i=Q.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,ne.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return L.or([()=>L.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},jf=class n{constructor(e,t){this.persistence=e,this.gi=new wn(r=>St(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=MP(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return L.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return L.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?L.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,o=>this.Sr(e,o,t).next(a=>{a||(r++,s.removeEntry(o,ne.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),L.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),L.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),L.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),L.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=af(e.data.value)),t}Sr(e,t,r){return L.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return L.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var gE=class{constructor(e){this.serializer=e}q(e,t,r,i){let s=new mf("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore(Nl)}(e),function(u){u.createObjectStore(el,{keyPath:tF}),u.createObjectStore(In,{keyPath:l0,autoIncrement:!0}).createIndex(qs,h0,{unique:!0}),u.createObjectStore(qa)}(e),Y0(e),function(u){u.createObjectStore(Ls)}(e));let o=L.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore($a),u.deleteObjectStore(ja),u.deleteObjectStore(zs)}(e),Y0(e)),o=o.next(()=>function(u){let h=u.store(zs),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ne.min().toTimestamp(),targetCount:0};return h.put(yf,d)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,h){return h.store(In).j().next(m=>{u.deleteObjectStore(In),u.createObjectStore(In,{keyPath:l0,autoIncrement:!0}).createIndex(qs,h0,{unique:!0});let v=h.store(In),C=m.map(k=>v.put(k));return L.waitFor(C)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore(za,{keyPath:lF})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.pi(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore(tl)}(e),this.yi(s)))),r<7&&i>=7&&(o=o.next(()=>this.wi(s))),r<8&&i>=8&&(o=o.next(()=>this.Si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.bi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore(gp,{keyPath:hF})})(e),function(u){u.createObjectStore(_p,{keyPath:dF})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let h=u.createObjectStore(yp,{keyPath:IF});h.createIndex(EI,EF,{unique:!1}),h.createIndex(OR,wF,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let h=u.createObjectStore(_f,{keyPath:rF});h.createIndex(sf,iF),h.createIndex(CR,sF)}(e)).next(()=>this.Di(e,s)).next(()=>e.deleteObjectStore(Ls))),r<14&&i>=14&&(o=o.next(()=>this.Ci(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore(Ew,{keyPath:fF,autoIncrement:!0}).createIndex(II,pF,{unique:!1}),u.createObjectStore(zu,{keyPath:mF}).createIndex(NR,gF,{unique:!1}),u.createObjectStore(Gu,{keyPath:_F}).createIndex(DR,yF,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(zu).clear()}).next(()=>{t.objectStore(Gu).clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore(ww,{keyPath:vF})})(e)})),r<18&&i>=18&&Xp()&&(o=o.next(()=>{t.objectStore(zu).clear()}).next(()=>{t.objectStore(Gu).clear()})),o}yi(e){let t=0;return e.store(Ls).X((r,i)=>{t+=Lf(i)}).next(()=>{let r={byteSize:t};return e.store(tl).put(yI,r)})}pi(e){let t=e.store(el),r=e.store(In);return t.j().next(i=>L.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Oi],[s.userId,s.lastAcknowledgedBatchId]);return r.j(qs,o).next(a=>L.forEach(a,u=>{ee(u.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});let h=Fs(this.serializer,u);return OP(e,s.userId,h).next(()=>{})}))}))}wi(e){let t=e.store($a),r=e.store(Ls);return e.store(zs).get(yf).next(i=>{let s=[];return r.X((o,a)=>{let u=new ge(o),h=function(m){return[0,St(m)]}(u);s.push(t.get(h).next(d=>d?L.resolve():(m=>t.put({targetId:0,path:St(m),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>L.waitFor(s))})}Si(e,t){e.createObjectStore(nl,{keyPath:uF});let r=t.store(nl),i=new ml,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:St(u)})}};return t.store(Ls).X({Z:!0},(o,a)=>{let u=new ge(o);return s(u.popLast())}).next(()=>t.store(qa).X({Z:!0},([o,a,u],h)=>{let d=Bn(a);return s(d.popLast())}))}bi(e){let t=e.store(ja);return t.X((r,i)=>{let s=ju(i),o=CP(this.serializer,s);return t.put(o)})}Di(e,t){let r=t.store(Ls),i=[];return r.X((s,o)=>{let a=t.store(_f),u=function(m){return m.document?new Q(ge.fromString(m.document.name).popFirst(5)):m.noDocument?Q.fromSegments(m.noDocument.path):m.unknownDocument?Q.fromSegments(m.unknownDocument.path):Y(36783)}(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(h))}).next(()=>L.waitFor(i))}Ci(e,t){let r=t.store(In),i=FP(this.serializer),s=new _l(qf.Vi,this.serializer.gt);return r.j().next(o=>{let a=new Map;return o.forEach(u=>{var h;let d=(h=a.get(u.userId))!==null&&h!==void 0?h:le();Fs(this.serializer,u).keys().forEach(m=>d=d.add(m)),a.set(u.userId,d)}),L.forEach(a,(u,h)=>{let d=new tt(h),m=Of.yt(this.serializer,d),v=s.getIndexManager(d),C=Mf.yt(d,this.serializer,v,s.referenceDelegate);return new Bf(i,C,m,v).recalculateAndSaveOverlaysForDocumentKeys(new rl(t,Gt.ue),u).next()})})}};function Y0(n){n.createObjectStore($a,{keyPath:aF}).createIndex(Iw,cF,{unique:!0}),n.createObjectStore(ja,{keyPath:"targetId"}).createIndex(kR,oF,{unique:!0}),n.createObjectStore(zs)}var Pi="IndexedDbPersistence",Zy=18e5,eI=5e3,tI="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",UP="main",_E=class n{constructor(e,t,r,i,s,o,a,u,h,d,m=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Fi=s,this.window=o,this.document=a,this.Mi=h,this.xi=d,this.Oi=m,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=v=>Promise.resolve(),!n.C())throw new U(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new iE(this,i),this.Qi=t+UP,this.serializer=new Nf(u),this.$i=new Mi(this.Qi,this.Oi,new gE(this.serializer)),this.li=new WI,this.hi=new tE(this.referenceDelegate,this.serializer),this.remoteDocumentCache=FP(this.serializer),this.Ti=new GI,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,d===!1&&Ke(Pi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new U(x.FAILED_PRECONDITION,tI);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new Gt(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=t=>w(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(()=>w(this,null,function*(){this.started&&(yield this.Ki())})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ef(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(t=>{t||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(Ki(e))return B(Pi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return B(Pi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return Bu(e).get(Ta).next(t=>L.resolve(this.Xi(t)))}es(e){return ef(e).delete(this.clientId)}ts(){return w(this,null,function*(){if(this.isPrimary&&!this.ns(this.ki,Zy)){this.ki=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=ft(t,za);return r.j().next(i=>{let s=this.rs(i,Zy),o=i.filter(a=>s.indexOf(a)===-1);return L.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.ss(t.clientId))}})}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?L.resolve(!0):Bu(e).get(Ta).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,eI)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new U(x.FAILED_PRECONDITION,tI);return!1}}return!(!this.networkEnabled||!this.inForeground)||ef(e).j().next(r=>this.rs(r,eI).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&B(Pi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return w(this,null,function*(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),yield this.$i.runTransaction("shutdown","readwrite",[Nl,za],e=>{let t=new rl(e,Gt.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()})}rs(e,t){return e.filter(r=>this.ns(r.updateTimeMs,t)&&!this._s(r.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>ef(e).j().next(t=>this.rs(t,Zy).map(r=>r.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return Mf.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new eE(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return Of.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,r){B(Pi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===18?bF:u===17?MR:u===16?AF:u===15?vw:u===14?LR:u===13?xR:u===12?TF:u===11?VR:void Y(60245)}(this.Oi),o;return this.$i.runTransaction(e,i,s,a=>(o=new rl(a,this.ui?this.ui.next():Gt.ue),t==="readwrite-primary"?this.Ji(o).next(u=>!!u||this.Hi(o)).next(u=>{if(!u)throw Ke(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new U(x.FAILED_PRECONDITION,bR);return r(o)}).next(u=>this.Zi(o).next(()=>u)):this.Ts(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ts(e){return Bu(e).get(Ta).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,eI)&&!this._s(t.ownerId)&&!this.Xi(t)&&!(this.xi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new U(x.FAILED_PRECONDITION,tI)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Bu(e).put(Ta,t)}static C(){return Mi.C()}Yi(e){let t=Bu(e);return t.get(Ta).next(r=>this.Xi(r)?(B(Pi,"Releasing primary lease."),t.delete(Ta)):L.resolve())}ns(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Ke(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ni=()=>{this.us();let t=/(?:Version|Mobile)\/1[456]/;Yp()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{let r=((t=this.Ui)===null||t===void 0?void 0:t.getItem(this.ss(e)))!==null;return B(Pi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ke(Pi,"Failed to get zombied client id.",r),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){Ke("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Bu(n){return ft(n,Nl)}function ef(n){return ft(n,za)}function Nw(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var yE=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=le(),i=le();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var IE=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var $f=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return Yp()?8:SR(Ge())>0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new IE;return this.ws(e,t,o).next(a=>{if(s.result=a,this.Rs)return this.Ss(e,t,o,a.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Ca()<=de.DEBUG&&B("QueryEngine","SDK will not create cache indexes for query:",ka(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),L.resolve()):(Ca()<=de.DEBUG&&B("QueryEngine","Query:",ka(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Ca()<=de.DEBUG&&B("QueryEngine","The SDK decides to create cache indexes for query:",ka(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Rt(t))):L.resolve())}ps(e,t){if(T0(t))return L.resolve(null);let r=Rt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=bf(t,null,"F"),r=Rt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=le(...s);return this.gs.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let h=this.bs(t,a);return this.Ds(t,h,o,u.readTime)?this.ps(e,bf(t,null,"F")):this.vs(e,h,t,u)}))})))}ys(e,t,r,i){return T0(t)||i.isEqual(ne.min())?L.resolve(null):this.gs.getDocuments(e,r).next(s=>{let o=this.bs(t,s);return this.Ds(t,o,r,i)?L.resolve(null):(Ca()<=de.DEBUG&&B("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ka(t)),this.vs(e,o,t,TR(i,Ua)).next(a=>a))})}bs(e,t){let r=new Ne(iP(e));return t.forEach((i,s)=>{Vl(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return Ca()<=de.DEBUG&&B("QueryEngine","Using full collection scan to execute query:",ka(t)),this.gs.getDocumentsMatchingQuery(e,t,nn.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Dw="LocalStore",n2=3e8,EE=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new Ve(ie),this.Ms=new wn(s=>Ks(s),Dl),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Bf(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function BP(n,e,t,r){return new EE(n,e,t,r)}function qP(n,e){return w(this,null,function*(){let t=K(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=le();for(let h of i){o.push(h.batchId);for(let d of h.mutations)u=u.add(d.key)}for(let h of s){a.push(h.batchId);for(let d of h.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next(h=>({Bs:h,removedBatchIds:o,addedBatchIds:a}))})})})}function r2(n,e){let t=K(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(a,u,h,d){let m=h.batch,v=m.keys(),C=L.resolve();return v.forEach(k=>{C=C.next(()=>d.getEntry(u,k)).next(V=>{let N=h.docVersions.get(k);ee(N!==null,48541),V.version.compareTo(N)<0&&(m.applyToRemoteDocument(V,h),V.isValidDocument()&&(V.setReadTime(h.commitVersion),d.addEntry(V)))})}),C.next(()=>a.mutationQueue.removeMutationBatch(u,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=le();for(let h=0;h<a.mutationResults.length;++h)a.mutationResults[h].transformResults.length>0&&(u=u.add(a.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function jP(n){let e=K(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function i2(n,e){let t=K(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let a=[];e.targetChanges.forEach((d,m)=>{let v=i.get(m);if(!v)return;a.push(t.hi.removeMatchingKeys(s,d.removedDocuments,m).next(()=>t.hi.addMatchingKeys(s,d.addedDocuments,m)));let C=v.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?C=C.withResumeToken(Qe.EMPTY_BYTE_STRING,ne.min()).withLastLimboFreeSnapshotVersion(ne.min()):d.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(d.resumeToken,r)),i=i.insert(m,C),function(V,N,q){return V.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=n2?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(v,C,d)&&a.push(t.hi.updateTargetData(s,C))});let u=Mt(),h=le();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push($P(s,o,e.documentUpdates).next(d=>{u=d.Ls,h=d.ks})),!r.isEqual(ne.min())){let d=t.hi.getLastRemoteSnapshotVersion(s).next(m=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return L.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.Fs=i,s))}function $P(n,e,t){let r=le(),i=le();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Mt();return t.forEach((a,u)=>{let h=s.get(a);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(ne.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):B(Dw,"Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",u.version)}),{Ls:o,ks:i}})}function s2(n,e){let t=K(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Oi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ec(n,e){let t=K(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,L.resolve(i)):t.hi.allocateTargetId(r).next(o=>(i=new Xa(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}function tc(n,e,t){return w(this,null,function*(){let r=K(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ki(o))throw o;B(Dw,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})}function zf(n,e,t){let r=K(n),i=ne.min(),s=le();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,d){let m=K(u),v=m.Ms.get(d);return v!==void 0?L.resolve(m.Fs.get(v)):m.hi.getTargetData(h,d)}(r,o,Rt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.Cs.getDocumentsMatchingQuery(o,e,t?i:ne.min(),t?s:le())).next(a=>(WP(r,rP(e),a),{documents:a,qs:s})))}function zP(n,e){let t=K(n),r=K(t.hi),i=t.Fs.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.Et(s,e).next(o=>o?o.target:null))}function GP(n,e){let t=K(n),r=t.xs.get(e)||ne.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Os.getAllFromCollectionGroup(i,e,TR(r,Ua),Number.MAX_SAFE_INTEGER)).then(i=>(WP(t,e,i),i))}function WP(n,e,t){let r=n.xs.get(e)||ne.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}function o2(n,e,t,r){return w(this,null,function*(){let i=K(n),s=le(),o=Mt();for(let h of t){let d=e.Qs(h.metadata.name);h.document&&(s=s.add(d));let m=e.$s(h);m.setReadTime(e.Us(h.metadata.readTime)),o=o.insert(d,m)}let a=i.Os.newChangeBuffer({trackRemovals:!0}),u=yield ec(i,function(d){return Rt(cc(ge.fromString(`__bundle__/docs/${d}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>$P(h,a,o).next(d=>(a.apply(h),d)).next(d=>i.hi.removeMatchingKeysForTargetId(h,u.targetId).next(()=>i.hi.addMatchingKeys(h,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,d.Ls,d.ks)).next(()=>d.Ls)))})}function a2(r,i){return w(this,arguments,function*(n,e,t=le()){let s=yield ec(n,Rt(Ap(e.bundledQuery))),o=K(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=He(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Ti.saveNamedQuery(a,e);let h=s.withResumeToken(Qe.EMPTY_BYTE_STRING,u);return o.Fs=o.Fs.insert(h.targetId,h),o.hi.updateTargetData(a,h).next(()=>o.hi.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.hi.addMatchingKeys(a,t,s.targetId)).next(()=>o.Ti.saveNamedQuery(a,e))})})}var KP="firestore_clients";function X0(n,e){return`${KP}_${n}_${e}`}var HP="firestore_mutations";function Z0(n,e,t){let r=`${HP}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var QP="firestore_targets";function nI(n,e){return`${QP}_${n}_${e}`}var Un="SharedClientState",Gf=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ks(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new U(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Ke(Un,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Qu=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ks(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new U(r.error.code,r.error.message))),s?new n(e,r.state,i):(Ke(Un,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Wf=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Rw();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=RR(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ke(Un,`Failed to parse client data for instance '${e}': ${t}`),null)}},wE=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ke(Un,`Failed to parse online state: ${e}`),null)}},yl=class{constructor(){this.activeTargetIds=Rw()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ju=class{constructor(e,t,r,i,s){this.window=e,this.Fi=t,this.persistenceKey=r,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new Ve(ie),this.started=!1,this.Zs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=X0(this.persistenceKey,this.js),this.eo=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new yl),this.no=new RegExp(`^${KP}_${o}_([^_]*)$`),this.ro=new RegExp(`^${HP}_${o}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${QP}_${o}_(\\d+)$`),this.so=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.oo=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}start(){return w(this,null,function*(){let e=yield this.syncEngine.Ps();for(let r of e){if(r===this.js)continue;let i=this.getItem(X0(this.persistenceKey,r));if(i){let s=Wf.Ks(r,i);s&&(this.Ys=this.Ys.insert(s.clientId,s))}}this._o();let t=this.storage.getItem(this.so);if(t){let r=this.ao(t);r&&this.uo(r)}for(let r of this.Zs)this.Hs(r);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,r){this.lo(e,t,r),this.ho(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(nI(this.persistenceKey,e));if(i){let s=Qu.Ks(e,i);s&&(r=s.state)}}return t&&this.Po.Gs(e),this._o(),r}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(nI(this.persistenceKey,e))}updateQueryState(e,t,r){this.To(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.ho(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return B(Un,"READ",e,t),t}setItem(e,t){B(Un,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){B(Un,"REMOVE",e),this.storage.removeItem(e)}Hs(e){let t=e;if(t.storageArea===this.storage){if(B(Un,"EVENT",t.key,t.newValue),t.key===this.Xs)return void Ke("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(()=>w(this,null,function*(){if(this.started){if(t.key!==null){if(this.no.test(t.key)){if(t.newValue==null){let r=this.Ao(t.key);return this.Ro(r,null)}{let r=this.Vo(t.key,t.newValue);if(r)return this.Ro(r.clientId,r)}}else if(this.ro.test(t.key)){if(t.newValue!==null){let r=this.mo(t.key,t.newValue);if(r)return this.fo(r)}}else if(this.io.test(t.key)){if(t.newValue!==null){let r=this.po(t.key,t.newValue);if(r)return this.yo(r)}}else if(t.key===this.so){if(t.newValue!==null){let r=this.ao(t.newValue);if(r)return this.uo(r)}}else if(t.key===this.eo){let r=function(s){let o=Gt.ue;if(s!=null)try{let a=JSON.parse(s);ee(typeof a=="number",30636,{wo:s}),o=a}catch(a){Ke(Un,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Gt.ue&&this.sequenceNumberHandler(r)}else if(t.key===this.oo){let r=this.So(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.bo(i)))}}}else this.Zs.push(t)}))}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,r){let i=new Gf(this.currentUser,e,t,r),s=Z0(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Ws())}ho(e){let t=Z0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){let t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,r){let i=nI(this.persistenceKey,e),s=new Qu(e,t,r);this.setItem(i,s.Ws())}Eo(e){let t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){let t=this.no.exec(e);return t?t[1]:null}Vo(e,t){let r=this.Ao(e);return Wf.Ks(r,t)}mo(e,t){let r=this.ro.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Gf.Ks(new tt(s),i,t)}po(e,t){let r=this.io.exec(e),i=Number(r[1]);return Qu.Ks(i,t)}ao(e){return wE.Ks(e)}So(e){return JSON.parse(e)}fo(e){return w(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);B(Un,`Ignoring mutation for non-active user ${e.user.uid}`)})}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Ys.insert(e,t):this.Ys.remove(e),i=this.co(this.Ys),s=this.co(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Co(o,a).then(()=>{this.Ys=r})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=Rw();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Kf=class{constructor(){this.Fo=new yl,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new yl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var vE=class{xo(e){}shutdown(){}};var eR="ConnectivityMonitor",Hf=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){B(eR,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){B(eR,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var tf=null;function TE(){return tf===null?tf=function(){return 268435456+Math.round(2147483648*Math.random())}():tf++,"0x"+tf.toString(16)}var rI="RestConnection",c2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},AE=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===sl?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let o=TE(),a=this.Go(e,t.toUriEncodedString());B(rI,`Sending RPC '${e}' ${o}:`,a,r);let u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(u,i,s);let{host:h}=new URL(a),d=or(h);return this.jo(e,a,u,r,d).then(m=>(B(rI,`Received RPC '${e}' ${o}: `,m),m),m=>{throw Nt(rI,`RPC '${e}' ${o} failed with error: `,m,"url: ",a,"request:",r),m})}Jo(e,t,r,i,s,o){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ac}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=c2[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var bE=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var At="WebChannelConnection",SE=class extends AE{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let o=TE();return new Promise((a,u)=>{let h=new Ky;h.setWithCredentials(!0),h.listenOnce(Hy.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Lu.NO_ERROR:let m=h.getResponseJson();B(At,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),a(m);break;case Lu.TIMEOUT:B(At,`RPC '${e}' ${o} timed out`),u(new U(x.DEADLINE_EXCEEDED,"Request time out"));break;case Lu.HTTP_ERROR:let v=h.getStatus();if(B(At,`RPC '${e}' ${o} failed with status:`,v,"response text:",h.getResponseText()),v>0){let C=h.getResponseJson();Array.isArray(C)&&(C=C[0]);let k=C?.error;if(k&&k.status&&k.message){let V=function(q){let G=q.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(G)>=0?G:x.UNKNOWN}(k.status);u(new U(V,k.message))}else u(new U(x.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new U(x.UNAVAILABLE,"Connection failed."));break;default:Y(9055,{c_:e,streamId:o,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{B(At,`RPC '${e}' ${o} completed.`)}});let d=JSON.stringify(i);B(At,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",d,r,15)})}P_(e,t,r){let i=TE(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Yy(),a=Jy(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.zo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let d=s.join("");B(At,`Creating RPC '${e}' stream ${i}: ${d}`,u);let m=o.createWebChannel(d,u);this.T_(m);let v=!1,C=!1,k=new bE({Ho:N=>{C?B(At,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(v||(B(At,`Opening RPC '${e}' stream ${i} transport.`),m.open(),v=!0),B(At,`RPC '${e}' stream ${i} sending:`,N),m.send(N))},Yo:()=>m.close()}),V=(N,q,G)=>{N.listen(q,$=>{try{G($)}catch(te){setTimeout(()=>{throw te},0)}})};return V(m,va.EventType.OPEN,()=>{C||(B(At,`RPC '${e}' stream ${i} transport opened.`),k.s_())}),V(m,va.EventType.CLOSE,()=>{C||(C=!0,B(At,`RPC '${e}' stream ${i} transport closed`),k.__(),this.I_(m))}),V(m,va.EventType.ERROR,N=>{C||(C=!0,Nt(At,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),k.__(new U(x.UNAVAILABLE,"The operation could not be completed")))}),V(m,va.EventType.MESSAGE,N=>{var q;if(!C){let G=N.data[0];ee(!!G,16349);let $=G,te=$?.error||((q=$[0])===null||q===void 0?void 0:q.error);if(te){B(At,`RPC '${e}' stream ${i} received error:`,te);let oe=te.status,Z=function(E){let b=Ze[E];if(b!==void 0)return _P(b)}(oe),T=te.message;Z===void 0&&(Z=x.INTERNAL,T="Unknown error status: "+oe+" with message "+te.message),C=!0,k.__(new U(Z,T)),m.close()}else B(At,`RPC '${e}' stream ${i} received:`,G),k.a_(G)}}),V(a,Qy.STAT_EVENT,N=>{N.stat===Jd.PROXY?B(At,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===Jd.NOPROXY&&B(At,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.o_()},0),k}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function JP(){return typeof window<"u"?window:null}function hf(){return typeof document<"u"?document:null}function io(n){return new BI(n,!0)}var Il=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&B("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var tR="PersistentStream",Qf=class{constructor(e,t,r,i,s,o,a,u){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Il(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return w(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return w(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return w(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(Ke(t.toString()),Ke("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new U(x.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>w(this,null,function*(){this.state=0,this.start()}))}G_(e){return B(tR,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(B(tR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},RE=class extends Qf{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=WF(this.serializer,e),r=function(s){if(!("targetChange"in s))return ne.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?ne.min():o.readTime?He(o.readTime):ne.min()}(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=$I(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=Tf(u)?{documents:TP(s,u)}:{query:Tp(s,u).Vt},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=yP(s,o.resumeToken);let h=qI(s,o.expectedCount);h!==null&&(a.expectedCount=h)}else if(o.snapshotVersion.compareTo(ne.min())>0){a.readTime=Ya(s,o.snapshotVersion.toTimestamp());let h=qI(s,o.expectedCount);h!==null&&(a.expectedCount=h)}return a}(this.serializer,e);let r=HF(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=$I(this.serializer),t.removeTarget=e,this.k_(t)}},PE=class extends Qf{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return ee(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ee(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){ee(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=KF(e.writeResults,e.commitTime),r=He(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=$I(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>pl(this.serializer,r))};this.k_(t)}};var CE=class{},kE=class extends CE{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new U(x.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,jI(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new U(x.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Jo(e,jI(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new U(x.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},NE=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Ke(t),this._a=!1):B("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var Ys="RemoteStore",DE=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(o=>{r.enqueueAndForget(()=>w(this,null,function*(){Qi(this)&&(B(Ys,"Restarting streams for network reachability change."),yield function(u){return w(this,null,function*(){let h=K(u);h.Ia.add(4),yield uc(h),h.Aa.set("Unknown"),h.Ia.delete(4),yield xl(h)})}(this))}))}),this.Aa=new NE(r,i)}};function xl(n){return w(this,null,function*(){if(Qi(n))for(let e of n.da)yield e(!0)})}function uc(n){return w(this,null,function*(){for(let e of n.da)yield e(!1)})}function bp(n,e){let t=K(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),xw(t)?Vw(t):hc(t).x_()&&Ow(t,e))}function nc(n,e){let t=K(n),r=hc(t);t.Ta.delete(e),r.x_()&&YP(t,e),t.Ta.size===0&&(r.x_()?r.B_():Qi(t)&&t.Aa.set("Unknown"))}function Ow(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ne.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}hc(n).H_(e)}function YP(n,e){n.Ra.$e(e),hc(n).Y_(e)}function Vw(n){n.Ra=new UI({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),hc(n).start(),n.Aa.aa()}function xw(n){return Qi(n)&&!hc(n).M_()&&n.Ta.size>0}function Qi(n){return K(n).Ia.size===0}function XP(n){n.Ra=void 0}function u2(n){return w(this,null,function*(){n.Aa.set("Online")})}function l2(n){return w(this,null,function*(){n.Ta.forEach((e,t)=>{Ow(n,e)})})}function h2(n,e){return w(this,null,function*(){XP(n),xw(n)?(n.Aa.la(e),Vw(n)):n.Aa.set("Unknown")})}function d2(n,e,t){return w(this,null,function*(){if(n.Aa.set("Online"),e instanceof Cf&&e.state===2&&e.cause)try{yield function(i,s){return w(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.Ta.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.Ta.delete(a),i.Ra.removeTarget(a))})}(n,e)}catch(r){B(Ys,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Jf(n,r)}else if(e instanceof xa?n.Ra.Ye(e):e instanceof Pf?n.Ra.it(e):n.Ra.et(e),!t.isEqual(ne.min()))try{let r=yield jP(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.Ra.Pt(o);return a.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let d=s.Ta.get(h);d&&s.Ta.set(h,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,h)=>{let d=s.Ta.get(u);if(!d)return;s.Ta.set(u,d.withResumeToken(Qe.EMPTY_BYTE_STRING,d.snapshotVersion)),YP(s,u);let m=new Xa(d.target,u,h,d.sequenceNumber);Ow(s,m)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){B(Ys,"Failed to raise snapshot:",r),yield Jf(n,r)}})}function Jf(n,e,t){return w(this,null,function*(){if(!Ki(e))throw e;n.Ia.add(1),yield uc(n),n.Aa.set("Offline"),t||(t=()=>jP(n.localStore)),n.asyncQueue.enqueueRetryable(()=>w(this,null,function*(){B(Ys,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield xl(n)}))})}function ZP(n,e){return e().catch(t=>Jf(n,t,e))}function lc(n){return w(this,null,function*(){let e=K(n),t=zi(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Oi;for(;f2(e);)try{let i=yield s2(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,p2(e,i)}catch(i){yield Jf(e,i)}eC(e)&&tC(e)})}function f2(n){return Qi(n)&&n.Pa.length<10}function p2(n,e){n.Pa.push(e);let t=zi(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function eC(n){return Qi(n)&&!zi(n).M_()&&n.Pa.length>0}function tC(n){zi(n).start()}function m2(n){return w(this,null,function*(){zi(n).na()})}function g2(n){return w(this,null,function*(){let e=zi(n);for(let t of n.Pa)e.X_(t.mutations)})}function _2(n,e,t){return w(this,null,function*(){let r=n.Pa.shift(),i=LI.from(r,e,t);yield ZP(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield lc(n)})}function y2(n,e){return w(this,null,function*(){e&&zi(n).Z_&&(yield function(r,i){return w(this,null,function*(){if(function(o){return gP(o)&&o!==x.ABORTED}(i.code)){let s=r.Pa.shift();zi(r).N_(),yield ZP(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield lc(r)}})}(n,e)),eC(n)&&tC(n)})}function nR(n,e){return w(this,null,function*(){let t=K(n);t.asyncQueue.verifyOperationInProgress(),B(Ys,"RemoteStore received new credentials");let r=Qi(t);t.Ia.add(3),yield uc(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield xl(t)})}function OE(n,e){return w(this,null,function*(){let t=K(n);e?(t.Ia.delete(2),yield xl(t)):e||(t.Ia.add(2),yield uc(t),t.Aa.set("Unknown"))})}function hc(n){return n.Va||(n.Va=function(t,r,i){let s=K(t);return s.ia(),new RE(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:u2.bind(null,n),e_:l2.bind(null,n),n_:h2.bind(null,n),J_:d2.bind(null,n)}),n.da.push(e=>w(this,null,function*(){e?(n.Va.N_(),xw(n)?Vw(n):n.Aa.set("Unknown")):(yield n.Va.stop(),XP(n))}))),n.Va}function zi(n){return n.ma||(n.ma=function(t,r,i){let s=K(t);return s.ia(),new PE(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:m2.bind(null,n),n_:y2.bind(null,n),ea:g2.bind(null,n),ta:_2.bind(null,n)}),n.da.push(e=>w(this,null,function*(){e?(n.ma.N_(),yield lc(n)):(yield n.ma.stop(),n.Pa.length>0&&(B(Ys,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var VE=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function dc(n,e){if(Ke("AsyncQueue",`${e}: ${n}`),Ki(n))return new U(x.UNAVAILABLE,`${e}: ${n}`);throw n}var El=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Q.comparator(t.key,r.key):(t,r)=>Q.comparator(t.key,r.key),this.keyedMap=qu(),this.sortedSet=new Ve(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Yf=class{constructor(){this.fa=new Ve(Q.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):Y(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},Xs=class n{constructor(e,t,r,i,s,o,a,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,El.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ol(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var xE=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},LE=class{constructor(){this.queries=rR(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=K(t),s=i.queries;i.queries=rR(),s.forEach((o,a)=>{for(let u of a.wa)u.onError(r)})})(this,new U(x.ABORTED,"Firestore shutting down"))}};function rR(){return new wn(n=>nP(n),Ol)}function Lw(n,e){return w(this,null,function*(){let t=K(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new xE,r=e.ba()?0:1);try{switch(r){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=dc(o,`Initialization of query '${ka(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Fw(t)})}function Mw(n,e){return w(this,null,function*(){let t=K(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.wa.indexOf(e);o>=0&&(s.wa.splice(o,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function I2(n,e){let t=K(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.wa)a.Ca(i)&&(r=!0);o.ya=i}}r&&Fw(t)}function E2(n,e,t){let r=K(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function Fw(n){n.Da.forEach(e=>{e.next()})}var ME,iR;(iR=ME||(ME={})).Fa="default",iR.Cache="cache";var wl=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Xs(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=Xs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==ME.Cache}};var Xf=class{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}};var Zf=class{constructor(e){this.serializer=e}Qs(e){return zn(this.serializer,e)}$s(e){return e.metadata.exists?vp(this.serializer,e.document,!1):st.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return He(e)}},vl=class{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=nC(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=ge.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){let t=new Map,r=new Zf(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Qs(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||le()).add(s);t.set(o,a)}}return t}za(e){return w(this,null,function*(){let t=yield o2(e,new Zf(this.serializer),this.Ka,this.$a.id),r=this.Ga(this.documents);for(let i of this.Ua)yield a2(e,i,r.get(i.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:t}})}};function nC(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var ep=class{constructor(e){this.key=e}},tp=class{constructor(e){this.key=e}},np=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=le(),this.mutatedKeys=le(),this.Xa=iP(e),this.eu=new El(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new Yf,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,m)=>{let v=i.get(d),C=Vl(this.query,m)?m:null,k=!!v&&this.mutatedKeys.has(v.key),V=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations),N=!1;v&&C?v.data.isEqual(C.data)?k!==V&&(r.track({type:3,doc:C}),N=!0):this.iu(v,C)||(r.track({type:2,doc:C}),N=!0,(u&&this.Xa(C,u)>0||h&&this.Xa(C,h)<0)&&(a=!0)):!v&&C?(r.track({type:0,doc:C}),N=!0):v&&!C&&(r.track({type:1,doc:v}),N=!0,(u||h)&&(a=!0)),N&&(C?(o=o.add(C),s=V?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{eu:o,ru:r,Ds:a,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let o=e.ru.pa();o.sort((d,m)=>function(C,k){let V=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Y(20277,{At:N})}};return V(C)-V(k)}(d.type,m.type)||this.Xa(d.doc,m.doc)),this.su(r),i=i!=null&&i;let a=t&&!i?this.ou():[],u=this.Za.size===0&&this.current&&!i?1:0,h=u!==this.Ya;return this.Ya=u,o.length!==0||h?{snapshot:new Xs(this.query,e.eu,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Yf,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=le(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new tp(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new ep(r))}),t}uu(e){this.Ha=e.qs,this.Za=le();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return Xs.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Ji="SyncEngine",FE=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},UE=class{constructor(e){this.key=e,this.lu=!1}},BE=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new wn(a=>nP(a),Ol),this.Tu=new Map,this.Iu=new Set,this.du=new Ve(Q.comparator),this.Eu=new Map,this.Au=new gl,this.Ru={},this.Vu=new Map,this.mu=Za.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function w2(n,e,t=!0){return w(this,null,function*(){let r=Sp(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield rC(r,e,t,!0),i})}function v2(n,e){return w(this,null,function*(){let t=Sp(n);yield rC(t,e,!0,!1)})}function rC(n,e,t,r){return w(this,null,function*(){let i=yield ec(n.localStore,Rt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield Uw(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&bp(n.remoteStore,i),a})}function Uw(n,e,t,r,i){return w(this,null,function*(){n.gu=(m,v,C)=>function(V,N,q,G){return w(this,null,function*(){let $=N.view.nu(q);$.Ds&&($=yield zf(V.localStore,N.query,!1).then(({documents:T})=>N.view.nu(T,$)));let te=G&&G.targetChanges.get(N.targetId),oe=G&&G.targetMismatches.get(N.targetId)!=null,Z=N.view.applyChanges($,V.isPrimaryClient,te,oe);return qE(V,N.targetId,Z._u),Z.snapshot})}(n,m,v,C);let s=yield zf(n.localStore,e,!0),o=new np(e,s.qs),a=o.nu(s.documents),u=dl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(a,n.isPrimaryClient,u);qE(n,t,h._u);let d=new FE(e,t,o);return n.Pu.set(e,d),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),h.snapshot})}function T2(n,e,t){return w(this,null,function*(){let r=K(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(o=>!Ol(o,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield tc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&nc(r.remoteStore,i.targetId),rc(r,i.targetId)}).catch(Wi))):(rc(r,i.targetId),yield tc(r.localStore,i.targetId,!0))})}function A2(n,e){return w(this,null,function*(){let t=K(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),nc(t.remoteStore,r.targetId))})}function b2(n,e,t){return w(this,null,function*(){let r=$w(n);try{let i=yield function(o,a){let u=K(o),h=Ue.now(),d=a.reduce((C,k)=>C.add(k.key),le()),m,v;return u.persistence.runTransaction("Locally write mutations","readwrite",C=>{let k=Mt(),V=le();return u.Os.getEntries(C,d).next(N=>{k=N,k.forEach((q,G)=>{G.isValidDocument()||(V=V.add(q))})}).next(()=>u.localDocuments.getOverlayedDocuments(C,k)).next(N=>{m=N;let q=[];for(let G of a){let $=UF(G,m.get(G.key).overlayedDocument);$!=null&&q.push(new vn(G.key,$,KR($.value.mapValue),$e.exists(!0)))}return u.mutationQueue.addMutationBatch(C,h,q,a)}).next(N=>{v=N;let q=N.applyToLocalDocumentSet(m,V);return u.documentOverlayCache.saveOverlays(C,N.batchId,q)})}).then(()=>({batchId:v.batchId,changes:oP(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let h=o.Ru[o.currentUser.toKey()];h||(h=new Ve(ie)),h=h.insert(a,u),o.Ru[o.currentUser.toKey()]=h}(r,i.batchId,t),yield Ur(r,i.changes),yield lc(r.remoteStore)}catch(i){let s=dc(i,"Failed to persist write");t.reject(s)}})}function iC(n,e){return w(this,null,function*(){let t=K(n);try{let r=yield i2(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Eu.get(s);o&&(ee(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.lu=!0:i.modifiedDocuments.size>0?ee(o.lu,14607):i.removedDocuments.size>0&&(ee(o.lu,42227),o.lu=!1))}),yield Ur(t,r,e)}catch(r){yield Wi(r)}})}function sR(n,e,t){let r=K(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,o)=>{let a=o.view.va(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=K(o);u.onlineState=a;let h=!1;u.queries.forEach((d,m)=>{for(let v of m.wa)v.va(a)&&(h=!0)}),h&&Fw(u)}(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function S2(n,e,t){return w(this,null,function*(){let r=K(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let o=new Ve(Q.comparator);o=o.insert(s,st.newNoDocument(s,ne.min()));let a=le().add(s),u=new hl(ne.min(),new Map,new Ve(ie),o,a);yield iC(r,u),r.du=r.du.remove(s),r.Eu.delete(e),jw(r)}else yield tc(r.localStore,e,!1).then(()=>rc(r,e,t)).catch(Wi)})}function R2(n,e){return w(this,null,function*(){let t=K(n),r=e.batch.batchId;try{let i=yield r2(t.localStore,e);qw(t,r,null),Bw(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ur(t,i)}catch(i){yield Wi(i)}})}function P2(n,e,t){return w(this,null,function*(){let r=K(n);try{let i=yield function(o,a){let u=K(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let d;return u.mutationQueue.lookupMutationBatch(h,a).next(m=>(ee(m!==null,37113),d=m.keys(),u.mutationQueue.removeMutationBatch(h,m))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d)).next(()=>u.localDocuments.getDocuments(h,d))})}(r.localStore,e);qw(r,e,t),Bw(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ur(r,i)}catch(i){yield Wi(i)}})}function C2(n,e){return w(this,null,function*(){let t=K(n);Qi(t.remoteStore)||B(Ji,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=K(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===Oi)return void e.resolve();let i=t.Vu.get(r)||[];i.push(e),t.Vu.set(r,i)}catch(r){let i=dc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Bw(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function qw(n,e,t){let r=K(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function rc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||sC(n,r)})}function sC(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(nc(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),jw(n))}function qE(n,e,t){for(let r of t)r instanceof ep?(n.Au.addReference(r.key,e),k2(n,r)):r instanceof tp?(B(Ji,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||sC(n,r.key)):Y(19791,{yu:r})}function k2(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(B(Ji,"New document in limbo: "+t),n.Iu.add(r),jw(n))}function jw(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new Q(ge.fromString(e)),r=n.mu.next();n.Eu.set(r,new UE(t)),n.du=n.du.insert(t,r),bp(n.remoteStore,new Xa(Rt(cc(t.path)),r,"TargetPurposeLimboResolution",Gt.ue))}}function Ur(n,e,t){return w(this,null,function*(){let r=K(n),i=[],s=[],o=[];r.Pu.isEmpty()||(r.Pu.forEach((a,u)=>{o.push(r.gu(u,e,t).then(h=>{var d;if((h||t)&&r.isPrimaryClient){let m=h?!h.fromCache:(d=t?.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(h){i.push(h);let m=yE.Es(u.targetId,h);s.push(m)}}))}),yield Promise.all(o),r.hu.J_(i),yield function(u,h){return w(this,null,function*(){let d=K(u);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>L.forEach(h,v=>L.forEach(v.Is,C=>d.persistence.referenceDelegate.addReference(m,v.targetId,C)).next(()=>L.forEach(v.ds,C=>d.persistence.referenceDelegate.removeReference(m,v.targetId,C)))))}catch(m){if(!Ki(m))throw m;B(Dw,"Failed to update sequence numbers: "+m)}for(let m of h){let v=m.targetId;if(!m.fromCache){let C=d.Fs.get(v),k=C.snapshotVersion,V=C.withLastLimboFreeSnapshotVersion(k);d.Fs=d.Fs.insert(v,V)}}})}(r.localStore,s))})}function N2(n,e){return w(this,null,function*(){let t=K(n);if(!t.currentUser.isEqual(e)){B(Ji,"User change. New user:",e.toKey());let r=yield qP(t.localStore,e);t.currentUser=e,function(s,o){s.Vu.forEach(a=>{a.forEach(u=>{u.reject(new U(x.CANCELLED,o))})}),s.Vu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ur(t,r.Bs)}})}function D2(n,e){let t=K(n),r=t.Eu.get(e);if(r&&r.lu)return le().add(r.key);{let i=le(),s=t.Tu.get(e);if(!s)return i;for(let o of s){let a=t.Pu.get(o);i=i.unionWith(a.view.tu)}return i}}function O2(n,e){return w(this,null,function*(){let t=K(n),r=yield zf(t.localStore,e.query,!0),i=e.view.uu(r);return t.isPrimaryClient&&qE(t,e.targetId,i._u),i})}function V2(n,e){return w(this,null,function*(){let t=K(n);return GP(t.localStore,e).then(r=>Ur(t,r))})}function x2(n,e,t,r){return w(this,null,function*(){let i=K(n),s=yield function(a,u){let h=K(a),d=K(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",m=>d.Xn(m,u).next(v=>v?h.localDocuments.getDocuments(m,v):L.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield lc(i.remoteStore):t==="acknowledged"||t==="rejected"?(qw(i,e,r||null),Bw(i,e),function(a,u){K(K(a).mutationQueue).rr(u)}(i.localStore,e)):Y(6720,"Unknown batchState",{wu:t}),yield Ur(i,s)):B(Ji,"Cannot apply mutation batch with id: "+e)})}function L2(n,e){return w(this,null,function*(){let t=K(n);if(Sp(t),$w(t),e===!0&&t.fu!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield oR(t,r.toArray());t.fu=!0,yield OE(t.remoteStore,!0);for(let s of i)bp(t.remoteStore,s)}else if(e===!1&&t.fu!==!1){let r=[],i=Promise.resolve();t.Tu.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(rc(t,o),tc(t.localStore,o,!0))),nc(t.remoteStore,o)}),yield i,yield oR(t,r),function(o){let a=K(o);a.Eu.forEach((u,h)=>{nc(a.remoteStore,h)}),a.Au.jr(),a.Eu=new Map,a.du=new Ve(Q.comparator)}(t),t.fu=!1,yield OE(t.remoteStore,!1)}})}function oR(n,e,t){return w(this,null,function*(){let r=K(n),i=[],s=[];for(let o of e){let a,u=r.Tu.get(o);if(u&&u.length!==0){a=yield ec(r.localStore,Rt(u[0]));for(let h of u){let d=r.Pu.get(h),m=yield O2(r,d);m.snapshot&&s.push(m.snapshot)}}else{let h=yield zP(r.localStore,o);a=yield ec(r.localStore,h),yield Uw(r,oC(h),o,!1,a.resumeToken)}i.push(a)}return r.hu.J_(s),i})}function oC(n){return ZR(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function M2(n){return function(t){return K(K(t).persistence).Ps()}(K(n).localStore)}function F2(n,e,t,r){return w(this,null,function*(){let i=K(n);if(i.fu)return void B(Ji,"Ignoring unexpected query state notification.");let s=i.Tu.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield GP(i.localStore,rP(s[0])),a=hl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Qe.EMPTY_BYTE_STRING);yield Ur(i,o,a);break}case"rejected":yield tc(i.localStore,e,!0),rc(i,e,r);break;default:Y(64155,t)}})}function U2(n,e,t){return w(this,null,function*(){let r=Sp(n);if(r.fu){for(let i of e){if(r.Tu.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){B(Ji,"Adding an already active target "+i);continue}let s=yield zP(r.localStore,i),o=yield ec(r.localStore,s);yield Uw(r,oC(s),o.targetId,!1,o.resumeToken),bp(r.remoteStore,o)}for(let i of t)r.Tu.has(i)&&(yield tc(r.localStore,i,!1).then(()=>{nc(r.remoteStore,i),rc(r,i)}).catch(Wi))}})}function Sp(n){let e=K(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=iC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=D2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=S2.bind(null,e),e.hu.J_=I2.bind(null,e.eventManager),e.hu.pu=E2.bind(null,e.eventManager),e}function $w(n){let e=K(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=R2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=P2.bind(null,e),e}function B2(n,e,t){let r=K(n);(function(s,o,a){return w(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(C,k){let V=K(C),N=He(k.createTime);return V.persistence.runTransaction("hasNewerBundle","readonly",q=>V.Ti.getBundleMetadata(q,k.id)).then(q=>!!q&&q.createTime.compareTo(N)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(C){return{taskState:"Success",documentsLoaded:C.totalDocuments,bytesLoaded:C.totalBytes,totalDocuments:C.totalDocuments,totalBytes:C.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(nC(u));let h=new vl(u,o.serializer),d=yield o.Su();for(;d;){let v=yield h.Wa(d);v&&a._updateProgress(v),d=yield o.Su()}let m=yield h.za(s.localStore);return yield Ur(s,m.Ja,void 0),yield function(C,k){let V=K(C);return V.persistence.runTransaction("Save bundle","readwrite",N=>V.Ti.saveBundleMetadata(N,k))}(s.localStore,u),a._completeWith(m.progress),Promise.resolve(m.ja)}catch(u){return Nt(Ji,`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Rp=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return w(this,null,function*(){this.serializer=io(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,r){return null}Fu(t,r){return null}vu(t){return BP(this.persistence,new $f,t.initialUser,this.serializer)}Du(t){return new _l(qf.Vi,this.serializer)}bu(t){return new Kf}terminate(){return w(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Tl=class extends Rp{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){ee(this.persistence.referenceDelegate instanceof jf,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Ff(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?Lt.withCacheSize(this.cacheSizeBytes):Lt.DEFAULT;return new _l(r=>jf.Vi(r,t),this.serializer)}},Al=class n extends Rp{constructor(e,t,r){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return w(this,null,function*(){yield Yt(n.prototype,this,"initialize").call(this,e),yield this.Mu.initialize(this,e),yield $w(this.Mu.syncEngine),yield lc(this.Mu.remoteStore),yield this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(e){return BP(this.persistence,new $f,e.initialUser,this.serializer)}Cu(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Ff(r,e.asyncQueue,t)}Fu(e,t){let r=new _I(t,this.persistence);return new gI(e.asyncQueue,r)}Du(e){let t=Nw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Lt.withCacheSize(this.cacheSizeBytes):Lt.DEFAULT;return new _E(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,JP(),hf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new Kf}},rp=class n extends Al{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return w(this,null,function*(){yield Yt(n.prototype,this,"initialize").call(this,e);let t=this.Mu.syncEngine;this.sharedClientState instanceof Ju&&(this.sharedClientState.syncEngine={Do:x2.bind(null,t),vo:F2.bind(null,t),Co:U2.bind(null,t),Ps:M2.bind(null,t),bo:V2.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.ji(r=>w(this,null,function*(){yield L2(this.Mu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}bu(e){let t=JP();if(!Ju.C(t))throw new U(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Nw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ju(t,e.asyncQueue,r,e.clientId,e.initialUser)}},fc=(()=>{class n{initialize(t,r){return w(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>sR(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=N2.bind(null,this.syncEngine),yield OE(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new LE}()}createDatastore(t){let r=io(t.databaseInfo.databaseId),i=function(o){return new SE(o)}(t.databaseInfo);return function(o,a,u,h){return new kE(o,a,u,h)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,o,a,u){return new DE(i,s,o,a,u)}(this.localStore,this.datastore,t.asyncQueue,r=>sR(this.syncEngine,r,0),function(){return Hf.C()?new Hf:new vE}())}createSyncEngine(t,r){return function(s,o,a,u,h,d,m){let v=new BE(s,o,a,u,h,d);return m&&(v.fu=!0),v}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return w(this,null,function*(){var t,r;yield function(s){return w(this,null,function*(){let o=K(s);B(Ys,"RemoteStore shutting down."),o.Ia.add(5),yield uc(o),o.Ea.shutdown(),o.Aa.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();function aR(n,e=10240){let t=0;return{read(){return w(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return w(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var ic=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Ke("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var jE=class{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new rt,this.buffer=new Uint8Array,this.Bu=function(){return new TextDecoder("utf-8")}(),this.Lu().then(r=>{r&&r.Qa()?this.metadata.resolve(r.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.qa)}`))},r=>this.metadata.reject(r))}close(){return this.Nu.cancel()}getMetadata(){return w(this,null,function*(){return this.metadata.promise})}Su(){return w(this,null,function*(){return yield this.getMetadata(),this.Lu()})}Lu(){return w(this,null,function*(){let e=yield this.ku();if(e===null)return null;let t=this.Bu.decode(e),r=Number(t);isNaN(r)&&this.qu(`length string (${t}) is not valid number`);let i=yield this.Qu(r);return new Xf(JSON.parse(i),e.length+r)})}$u(){return this.buffer.findIndex(e=>e===123)}ku(){return w(this,null,function*(){for(;this.$u()<0&&!(yield this.Uu()););if(this.buffer.length===0)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Qu(e){return w(this,null,function*(){for(;this.buffer.length<e;)(yield this.Uu())&&this.qu("Reached the end of bundle when more is expected.");let t=this.Bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}qu(e){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${e}`)}Uu(){return w(this,null,function*(){let e=yield this.Nu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var $E=class{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Qa())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do r=this.Su(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Ku(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.ku(),t=this.Qu(e);return new Xf(JSON.parse(t),e)}Qu(e){if(this.cursor+e>this.bundleData.length)throw new U(x.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}};var zE=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return w(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new U(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return w(this,null,function*(){let o=K(i),a={documents:s.map(m=>fl(o.serializer,m))},u=yield o.Jo("BatchGetDocuments",o.serializer.databaseId,ge.emptyPath(),a,s.length),h=new Map;u.forEach(m=>{let v=GF(o.serializer,m);h.set(v.key.toString(),v)});let d=[];return s.forEach(m=>{let v=h.get(m.toString());ee(!!v,55234,{key:m}),d.push(v)}),d})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new $i(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return w(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=Q.fromPath(r);this.mutations.push(new cl(i,this.precondition(i)))}),yield function(r,i){return w(this,null,function*(){let s=K(r),o={writes:i.map(a=>pl(s.serializer,a))};yield s.Wo("Commit",s.serializer.databaseId,ge.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Y(50498,{Wu:e.constructor.name});t=ne.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new U(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ne.min())?$e.exists(!1):$e.updateTime(t):$e.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ne.min()))throw new U(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $e.updateTime(t)}return $e.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var GE=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Gu=r.maxAttempts,this.F_=new Il(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(()=>w(this,null,function*(){let e=new zE(this.datastore),t=this.Ju(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Hu(i)}))}).catch(r=>{this.Hu(r)})}))}Ju(e){try{let t=this.updateFunction(e);return!kl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!gP(t)}return!1}};var Gi="FirestoreClient",WE=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=tt.UNAUTHENTICATED,this.clientId=Xu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>w(this,null,function*(){B(Gi,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(B(Gi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>w(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=dc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function iI(n,e){return w(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),B(Gi,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>w(this,null,function*(){r.isEqual(i)||(yield qP(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>{Nt("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{B("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Nt("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e})}function cR(n,e){return w(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield zw(n);B(Gi,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>nR(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>nR(e.remoteStore,i)),n._onlineComponents=e})}function zw(n){return w(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){B(Gi,"Using user provided OfflineComponentProvider");try{yield iI(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===x.FAILED_PRECONDITION||i.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Nt("Error using user provided cache. Falling back to memory cache: "+t),yield iI(n,new Rp)}}else B(Gi,"Using default OfflineComponentProvider"),yield iI(n,new Tl(void 0));return n._offlineComponents})}function Pp(n){return w(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(B(Gi,"Using user provided OnlineComponentProvider"),yield cR(n,n._uninitializedComponentsProvider._online)):(B(Gi,"Using default OnlineComponentProvider"),yield cR(n,new fc))),n._onlineComponents})}function aC(n){return zw(n).then(e=>e.persistence)}function pc(n){return zw(n).then(e=>e.localStore)}function cC(n){return Pp(n).then(e=>e.remoteStore)}function Gw(n){return Pp(n).then(e=>e.syncEngine)}function uC(n){return Pp(n).then(e=>e.datastore)}function sc(n){return w(this,null,function*(){let e=yield Pp(n),t=e.eventManager;return t.onListen=w2.bind(null,e.syncEngine),t.onUnlisten=T2.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=v2.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=A2.bind(null,e.syncEngine),t})}function q2(n){return n.asyncQueue.enqueue(()=>w(this,null,function*(){let e=yield aC(n),t=yield cC(n);return e.setNetworkEnabled(!0),function(i){let s=K(i);return s.Ia.delete(0),xl(s)}(t)}))}function j2(n){return n.asyncQueue.enqueue(()=>w(this,null,function*(){let e=yield aC(n),t=yield cC(n);return e.setNetworkEnabled(!1),function(i){return w(this,null,function*(){let s=K(i);s.Ia.add(0),yield uc(s),s.Aa.set("Offline")})}(t)}))}function $2(n,e){let t=new rt;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return function(i,s,o){return w(this,null,function*(){try{let a=yield function(h,d){let m=K(h);return m.persistence.runTransaction("read document","readonly",v=>m.localDocuments.getDocument(v,d))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new U(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=dc(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield pc(n),e,t)})),t.promise}function lC(n,e,t={}){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return function(s,o,a,u,h){let d=new ic({next:v=>{d.Ou(),o.enqueueAndForget(()=>Mw(s,m));let C=v.docs.has(a);!C&&v.fromCache?h.reject(new U(x.UNAVAILABLE,"Failed to get document because the client is offline.")):C&&v.fromCache&&u&&u.source==="server"?h.reject(new U(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(v)},error:v=>h.reject(v)}),m=new wl(cc(a.path),d,{includeMetadataChanges:!0,ka:!0});return Lw(s,m)}(yield sc(n),n.asyncQueue,e,t,r)})),r.promise}function z2(n,e){let t=new rt;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return function(i,s,o){return w(this,null,function*(){try{let a=yield zf(i,s,!0),u=new np(s,a.qs),h=u.nu(a.documents),d=u.applyChanges(h,!1);o.resolve(d.snapshot)}catch(a){let u=dc(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield pc(n),e,t)})),t.promise}function hC(n,e,t={}){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return function(s,o,a,u,h){let d=new ic({next:v=>{d.Ou(),o.enqueueAndForget(()=>Mw(s,m)),v.fromCache&&u.source==="server"?h.reject(new U(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(v)},error:v=>h.reject(v)}),m=new wl(a,d,{includeMetadataChanges:!0,ka:!0});return Lw(s,m)}(yield sc(n),n.asyncQueue,e,t,r)})),r.promise}function G2(n,e,t){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){try{let i=yield uC(n);r.resolve(function(o,a,u){return w(this,null,function*(){var h;let d=K(o),{request:m,ft:v,parent:C}=AP(d.serializer,eP(a),u);d.connection.Qo||delete m.parent;let k=(yield d.Jo("RunAggregationQuery",d.serializer.databaseId,C,m,1)).filter(N=>!!N.result);ee(k.length===1,64727);let V=(h=k[0].result)===null||h===void 0?void 0:h.aggregateFields;return Object.keys(V).reduce((N,q)=>(N[v[q]]=V[q],N),{})})}(i,e,t))}catch(i){r.reject(i)}})),r.promise}function W2(n,e){let t=new ic(e);return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return function(i,s){K(i).Da.add(s),s.next()}(yield sc(n),t)})),()=>{t.Ou(),n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return function(i,s){K(i).Da.delete(s)}(yield sc(n),t)}))}}function K2(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?mw().encode(o):o,function(d,m){return new jE(d,m)}(function(d,m){if(d instanceof Uint8Array)return aR(d,m);if(d instanceof ArrayBuffer)return aR(new Uint8Array(d),m);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,io(e));n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){B2(yield Gw(n),i,r)}))}function H2(n,e){return n.asyncQueue.enqueue(()=>w(this,null,function*(){return function(r,i){let s=K(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Ti.getNamedQuery(o,i))}(yield pc(n),e)}))}function dC(n,e){return function(r,i){return new $E(r,i)}(n,e)}function Q2(n,e){return n.asyncQueue.enqueue(()=>w(this,null,function*(){return function(r,i){return w(this,null,function*(){let s=K(r),o=s.indexManager,a=[];return s.persistence.runTransaction("Configure indexes","readwrite",u=>o.getFieldIndexes(u).next(h=>function(m,v,C,k,V){m=[...m],v=[...v],m.sort(C),v.sort(C);let N=m.length,q=v.length,G=0,$=0;for(;G<q&&$<N;){let te=C(m[$],v[G]);te<0?V(m[$++]):te>0?k(v[G++]):(G++,$++)}for(;G<q;)k(v[G++]);for(;$<N;)V(m[$++])}(h,i,XM,d=>{a.push(o.addFieldIndex(u,d))},d=>{a.push(o.deleteFieldIndex(u,d))})).next(()=>L.waitFor(a)))})}(yield pc(n),e)}))}function J2(n,e){return n.asyncQueue.enqueue(()=>w(this,null,function*(){return function(r,i){K(r).Cs.Rs=i}(yield pc(n),e)}))}function Y2(n){return n.asyncQueue.enqueue(()=>w(this,null,function*(){return function(t){let r=K(t),i=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",s=>i.deleteAllFieldIndexes(s))}(yield pc(n))}))}function fC(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var uR=new Map;var pC="firestore.googleapis.com",lR=!0,ip=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new U(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pC,this.ssl=lR}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:lR;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=DP;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<LP)throw new U(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}YM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fC((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new U(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new U(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new U(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Zs=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ip({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new U(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ip(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new sI;switch(r.type){case"firstParty":return new uI(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new U(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return w(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=uR.get(t);r&&(B("ComponentProvider","Removing Datastore"),uR.delete(t),r.terminate())}(this),Promise.resolve()}};function Ww(n,e,t,r={}){var i;n=pe(n,Zs);let s=or(e),o=n._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;s&&(qc(`https://${u}`),yh("Firestore",!0)),o.host!==pC&&o.host!==u&&Nt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},o),{host:u,ssl:s,emulatorOptions:r});if(!xt(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,m;if(typeof r.mockUserToken=="string")d=r.mockUserToken,m=tt.MOCK_USER;else{d=Av(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new U(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new tt(v)}n._authCredentials=new oI(new df(d,m))}}var gt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Oe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ro(t,n._jsonSchema))return new n(e,r||null,new Q(ge.fromString(t.referencePath)))}};Oe._jsonSchemaVersion="firestore/documentReference/1.0",Oe._jsonSchema={type:nt("string",Oe._jsonSchemaVersion),referencePath:nt("string")};var Gn=class n extends gt{constructor(e,t,r){super(e,t,cc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Oe(this.firestore,null,new Q(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function mC(n,e,...t){if(n=be(n),gw("collection","path",e),n instanceof Zs){let r=ge.fromString(e,...t);return s0(r),new Gn(n,null,r)}{if(!(n instanceof Oe||n instanceof Gn))throw new U(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ge.fromString(e,...t));return s0(r),new Gn(n.firestore,null,r)}}function gC(n,e){if(n=pe(n,Zs),gw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new U(x.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new gt(n,null,function(r){return new En(ge.emptyPath(),r)}(e))}function Kw(n,e,...t){if(n=be(n),arguments.length===1&&(e=Xu.newId()),gw("doc","path",e),n instanceof Zs){let r=ge.fromString(e,...t);return i0(r),new Oe(n,null,new Q(r))}{if(!(n instanceof Oe||n instanceof Gn))throw new U(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ge.fromString(e,...t));return i0(r),new Oe(n.firestore,n instanceof Gn?n.converter:null,new Q(r))}}function _C(n,e){return n=be(n),e=be(e),(n instanceof Oe||n instanceof Gn)&&(e instanceof Oe||e instanceof Gn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Cp(n,e){return n=be(n),e=be(e),n instanceof gt&&e instanceof gt&&n.firestore===e.firestore&&Ol(n._query,e._query)&&n.converter===e.converter}var hR="AsyncQueue",sp=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Il(this,"async_queue_retry"),this.oc=()=>{let r=hf();r&&B(hR,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=hf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=hf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new rt;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return w(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Ki(e))throw e;B(hR,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,Ke("INTERNAL UNHANDLED ERROR: ",dR(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=VE.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&Y(47125,{hc:dR(this.tc)})}verifyOperationInProgress(){}Pc(){return w(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function dR(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function La(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var KE=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new rt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var Y9=-1,Pe=class extends Zs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new sp,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return w(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new sp(e),this._firestoreClient=void 0,yield e}})}};function yC(n,e,t){t||(t=sl);let r=hi(n,"firestore");if(r.isInitialized(t)){let i=r.getImmediate({identifier:t}),s=r.getOptions(t);if(xt(s,e))return i;throw new U(x.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new U(x.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<LP)throw new U(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&or(e.host)&&qc(e.host),r.initialize({options:e,instanceIdentifier:t})}function IC(n,e){let t=typeof n=="object"?n:ys(),r=typeof n=="string"?n:e||sl,i=hi(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Tv("firestore");s&&Ww(i,...s)}return i}function qe(n){if(n._terminated)throw new U(x.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||EC(n),n._firestoreClient}function EC(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,h,d){return new wI(a,u,h,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,fC(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new WE(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let u=a?._online.build();return{_offline:a?._offline.build(u),_online:u}}(n._componentsProvider))}function wC(n,e){Nt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return TC(n,fc.provider,{build:r=>new Al(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function vC(n){return w(this,null,function*(){Nt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();TC(n,fc.provider,{build:t=>new rp(t,e.cacheSizeBytes)})})}function TC(n,e,t){if((n=pe(n,Pe))._firestoreClient||n._terminated)throw new U(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new U(x.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},EC(n)}function AC(n){if(n._initialized&&!n._terminated)throw new U(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new rt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>w(this,null,function*(){try{yield function(r){return w(this,null,function*(){if(!Mi.C())return Promise.resolve();let i=r+UP;yield Mi.delete(i)})}(Nw(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function bC(n){return function(t){let r=new rt;return t.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return C2(yield Gw(t),r)})),r.promise}(qe(n=pe(n,Pe)))}function SC(n){return q2(qe(n=pe(n,Pe)))}function RC(n){return j2(qe(n=pe(n,Pe)))}function PC(n){return Gv(n.app,"firestore",n._databaseId.database),n._delete()}function op(n,e){let t=qe(n=pe(n,Pe)),r=new KE;return K2(t,n._databaseId,e,r),r}function Hw(n,e){return H2(qe(n=pe(n,Pe)),e).then(t=>t?new gt(n,null,t.query):null)}var eo=class{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}},HE=class{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}};var Nr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Qe.fromBase64String(e))}catch(t){throw new U(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Qe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ro(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Nr._jsonSchemaVersion="firestore/bytes/1.0",Nr._jsonSchema={type:nt("string",Nr._jsonSchemaVersion),bytes:nt("string")};var Mr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new U(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new it(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};function CC(){return new Mr(dI)}var Fr=class{constructor(e){this._methodName=e}};var Vi=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new U(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new U(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ie(this._lat,e._lat)||ie(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(ro(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};Vi._jsonSchemaVersion="firestore/geoPoint/1.0",Vi._jsonSchema={type:nt("string",Vi._jsonSchemaVersion),latitude:nt("number"),longitude:nt("number")};var Dr=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ro(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new U(x.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Dr._jsonSchemaVersion="firestore/vectorValue/1.0",Dr._jsonSchema={type:nt("string",Dr._jsonSchemaVersion),vectorValues:nt("object")};var X2=/^__.*__$/,QE=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new vn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ji(e,this.data,t,this.fieldTransforms)}},ap=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new vn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function kC(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Y(40011,{Ec:n})}}var cp=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return up(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(kC(this.Ec)&&X2.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},JE=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||io(e)}Dc(e,t,r,i=!1){return new cp({Ec:e,methodName:t,bc:r,path:it.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function so(n){let e=n._freezeSettings(),t=io(n._databaseId);return new JE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function kp(n,e,t,r,i,s={}){let o=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);Yw("Data must be an object, but it was:",o,r);let a=OC(r,o),u,h;if(s.merge)u=new Wt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let m of s.mergeFields){let v=Sl(e,m,t);if(!o.contains(v))throw new U(x.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);xC(d,v)||d.push(v)}u=new Wt(d),h=o.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,h=o.fieldTransforms;return new QE(new bt(a),u,h)}var bl=class n extends Fr{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function NC(n,e,t){return new cp({Ec:3,bc:e.settings.bc,methodName:n._methodName,mc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var YE=class n extends Fr{_toFieldTransform(e){return new Hs(e.path,new Bi)}isEqual(e){return e instanceof n}},XE=class n extends Fr{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=NC(this,e,!0),r=this.vc.map(s=>oo(s,t)),i=new xr(r);return new Hs(e.path,i)}isEqual(e){return e instanceof n&&xt(this.vc,e.vc)}},ZE=class n extends Fr{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=NC(this,e,!0),r=this.vc.map(s=>oo(s,t)),i=new Lr(r);return new Hs(e.path,i)}isEqual(e){return e instanceof n&&xt(this.vc,e.vc)}},ew=class n extends Fr{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){let t=new qi(e.serializer,uP(e.serializer,this.Cc));return new Hs(e.path,t)}isEqual(e){return e instanceof n&&this.Cc===e.Cc}};function Qw(n,e,t,r){let i=n.Dc(1,e,t);Yw("Data must be an object, but it was:",i,r);let s=[],o=bt.empty();Hi(r,(u,h)=>{let d=Np(e,u,t);h=be(h);let m=i.gc(d);if(h instanceof bl)s.push(d);else{let v=oo(h,m);v!=null&&(s.push(d),o.set(d,v))}});let a=new Wt(s);return new ap(o,a,i.fieldTransforms)}function Jw(n,e,t,r,i,s){let o=n.Dc(1,e,t),a=[Sl(e,r,t)],u=[i];if(s.length%2!=0)throw new U(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<s.length;v+=2)a.push(Sl(e,s[v])),u.push(s[v+1]);let h=[],d=bt.empty();for(let v=a.length-1;v>=0;--v)if(!xC(h,a[v])){let C=a[v],k=u[v];k=be(k);let V=o.gc(C);if(k instanceof bl)h.push(C);else{let N=oo(k,V);N!=null&&(h.push(C),d.set(C,N))}}let m=new Wt(h);return new ap(d,m,o.fieldTransforms)}function DC(n,e,t,r=!1){return oo(t,n.Dc(r?4:3,e))}function oo(n,e){if(VC(n=be(n)))return Yw("Unsupported field value:",e,n),OC(n,e);if(n instanceof Fr)return function(r,i){if(!kC(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=oo(a,i.yc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=be(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return uP(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Ue.fromDate(r);return{timestampValue:Ya(i.serializer,s)}}if(r instanceof Ue){let s=new Ue(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ya(i.serializer,s)}}if(r instanceof Vi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Nr)return{bytesValue:yP(i.serializer,r._byteString)};if(r instanceof Oe){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Cw(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Dr)return function(o,a){return{mapValue:{fields:{[Tw]:{stringValue:Aw},[Wa]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw a.wc("VectorValues must only contain numeric values.");return Pw(a.serializer,h)})}}}}}}(r,i);throw i.wc(`Unsupported field value: ${mp(r)}`)}(n,e)}function OC(n,e){let t={};return UR(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hi(n,(r,i)=>{let s=oo(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function VC(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ue||n instanceof Vi||n instanceof Nr||n instanceof Oe||n instanceof Fr||n instanceof Dr)}function Yw(n,e,t){if(!VC(t)||!wR(t)){let r=mp(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function Sl(n,e,t){if((e=be(e))instanceof Mr)return e._internalPath;if(typeof e=="string")return Np(n,e);throw up("Field path arguments must be of type string or ",n,!1,void 0,t)}var Z2=new RegExp("[~\\*/\\[\\]]");function Np(n,e,t){if(e.search(Z2)>=0)throw up(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Mr(...e.split("."))._internalPath}catch{throw up(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function up(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new U(x.INVALID_ARGUMENT,a+n+u)}function xC(n,e){return n.some(t=>t.isEqual(e))}var to=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Oe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new tw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Dp("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},tw=class extends to{data(){return super.data()}};function Dp(n,e){return typeof e=="string"?Np(n,e):e instanceof Mr?e._internalPath:e._delegate._internalPath}function LC(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new U(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Rl=class{},no=class extends Rl{};function MC(n,e,...t){let r=[];e instanceof Rl&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof oc).length,a=s.filter(u=>u instanceof Pl).length;if(o>1||o>0&&a>0)throw new U(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Pl=class n extends no{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return QC(e._query,t),new gt(e.firestore,e.converter,VI(e._query,t))}_parse(e){let t=so(e.firestore);return function(s,o,a,u,h,d,m){let v;if(h.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new U(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){pR(m,d);let k=[];for(let V of m)k.push(fR(u,s,V));v={arrayValue:{values:k}}}else v=fR(u,s,m)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||pR(m,d),v=DC(a,o,m,d==="in"||d==="not-in");return _e.create(h,d,v)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function FC(n,e,t){let r=e,i=Dp("where",n);return Pl._create(i,r,t)}var oc=class n extends Rl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Re.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)QC(o,u),o=VI(o,u)}(e._query,t),new gt(e.firestore,e.converter,VI(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function UC(...n){return n.forEach(e=>JC("or",e)),oc._create("or",n)}function BC(...n){return n.forEach(e=>JC("and",e)),oc._create("and",n)}var nw=class n extends no{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new U(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new U(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ws(s,o)}(e._query,this._field,this._direction);return new gt(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new En(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function qC(n,e="asc"){let t=e,r=Dp("orderBy",n);return nw._create(r,t)}var lp=class n extends no{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new gt(e.firestore,e.converter,bf(e._query,this._limit,this._limitType))}};function jC(n){return vR("limit",n),lp._create("limit",n,"F")}function $C(n){return vR("limitToLast",n),lp._create("limitToLast",n,"L")}var hp=class n extends no{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=HC(e,this.type,this._docOrFields,this._inclusive);return new gt(e.firestore,e.converter,function(i,s){return new En(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function zC(...n){return hp._create("startAt",n,!0)}function GC(...n){return hp._create("startAfter",n,!1)}var dp=class n extends no{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=HC(e,this.type,this._docOrFields,this._inclusive);return new gt(e.firestore,e.converter,function(i,s){return new En(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function WC(...n){return dp._create("endBefore",n,!1)}function KC(...n){return dp._create("endAt",n,!0)}function HC(n,e,t,r){if(t[0]=be(t[0]),t[0]instanceof to)return function(s,o,a,u,h){if(!u)throw new U(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let m of Va(s))if(m.field.isKeyField())d.push(Gs(o,u.key));else{let v=u.data.field(m.field);if(Ip(v))throw new U(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(v===null){let C=m.field.canonicalString();throw new U(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${C}' (used as the orderBy) does not exist.`)}d.push(v)}return new Kn(d,h)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=so(n.firestore);return function(o,a,u,h,d,m){let v=o.explicitOrderBy;if(d.length>v.length)throw new U(x.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let C=[];for(let k=0;k<d.length;k++){let V=d[k];if(v[k].field.isKeyField()){if(typeof V!="string")throw new U(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof V}`);if(!Sw(o)&&V.indexOf("/")!==-1)throw new U(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${V}' contains a slash.`);let N=o.path.child(ge.fromString(V));if(!Q.isDocumentKey(N))throw new U(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);let q=new Q(N);C.push(Gs(a,q))}else{let N=DC(u,h,V);C.push(N)}}return new Kn(C,m)}(n._query,n.firestore._databaseId,i,e,t,r)}}function fR(n,e,t){if(typeof(t=be(t))=="string"){if(t==="")throw new U(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sw(e)&&t.indexOf("/")!==-1)throw new U(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ge.fromString(t));if(!Q.isDocumentKey(r))throw new U(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Gs(n,new Q(r))}if(t instanceof Oe)return Gs(n,t._key);throw new U(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mp(t)}.`)}function pR(n,e){if(!Array.isArray(n)||n.length===0)throw new U(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function QC(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new U(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new U(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function JC(n,e){if(!(e instanceof Pl||e instanceof oc))throw new U(x.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}var fp=class{convertValue(e,t="none"){switch(Fi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Y(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Hi(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Wa].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Fe(o.doubleValue));return new Dr(s)}convertGeoPoint(e){return new Vi(Fe(e.latitude),Fe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Ep(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(il(e));default:return null}}convertTimestamp(e){let t=Or(e);return new Ue(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ge.fromString(e);ee(PP(r),9688,{name:e});let i=new Ga(r.get(1),r.get(3)),s=new Q(r.popFirst(5));return i.isEqual(t)||Ke(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Op(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Cl=class extends fp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Oe(this.firestore,null,t)}};function YC(n){return new eo("sum",Sl("sum",n))}function X9(n){return new eo("avg",Sl("average",n))}function eU(){return new eo("count")}function XC(n,e){var t,r;return n instanceof eo&&e instanceof eo&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function ZC(n,e){return Cp(n.query,e.query)&&xt(n.data(),e.data())}var ek="NOT SUPPORTED",jn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Kt=class n extends to{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Ma(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Dp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(x.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};function Z9(n,e,t){if(ro(e,Kt._jsonSchema)){if(e.bundle===ek)throw new U(x.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let r=io(n._databaseId),i=dC(e.bundle,r),s=i.Ku(),o=new vl(i.getMetadata(),r);for(let d of s)o.Wa(d);let a=o.documents;if(a.length!==1)throw new U(x.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);let u=vp(r,a[0].document),h=new Q(ge.fromString(e.bundleName));return new Kt(n,new Cl(n),h,u,new jn(!1,!1),t||null)}}Kt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Kt._jsonSchema={type:nt("string",Kt._jsonSchemaVersion),bundleSource:nt("string","DocumentSnapshot"),bundleName:nt("string"),bundle:nt("string")};var Ma=class extends Kt{data(e={}){return super.data(e)}},Ht=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new jn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ma(this._firestore,this._userDataWriter,r.key,r,new jn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new U(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Ma(i._firestore,i._userDataWriter,a.doc.key,a.doc,new jn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Ma(i._firestore,i._userDataWriter,a.doc.key,a.doc,new jn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,d=-1;return a.type!==0&&(h=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:tU(a.type),doc:u,oldIndex:h,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(x.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Xu.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function ej(n,e,t){if(ro(e,Ht._jsonSchema)){if(e.bundle===ek)throw new U(x.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let r=io(n._databaseId),i=dC(e.bundle,r),s=i.Ku(),o=new vl(i.getMetadata(),r);for(let v of s)o.Wa(v);if(o.queries.length!==1)throw new U(x.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let a=Ap(o.queries[0].bundledQuery),u=o.documents,h=new El;u.map(v=>{let C=vp(r,v.document);h=h.add(C)});let d=Xs.fromInitialDocuments(a,h,le(),!1,!1),m=new gt(n,t||null,a);return new Ht(n,new Cl(n),m,d)}}function tU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Y(61501,{type:n})}}function tk(n,e){return n instanceof Kt&&e instanceof Kt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ht&&e instanceof Ht&&n._firestore===e._firestore&&Cp(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function nk(n){n=pe(n,Oe);let e=pe(n.firestore,Pe);return lC(qe(e),n._key).then(t=>Xw(e,n,t))}Ht._jsonSchemaVersion="firestore/querySnapshot/1.0",Ht._jsonSchema={type:nt("string",Ht._jsonSchemaVersion),bundleSource:nt("string","QuerySnapshot"),bundleName:nt("string"),bundle:nt("string")};var Hn=class extends fp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Oe(this.firestore,null,t)}};function rk(n){n=pe(n,Oe);let e=pe(n.firestore,Pe),t=qe(e),r=new Hn(e);return $2(t,n._key).then(i=>new Kt(e,r,n._key,i,new jn(i!==null&&i.hasLocalMutations,!0),n.converter))}function ik(n){n=pe(n,Oe);let e=pe(n.firestore,Pe);return lC(qe(e),n._key,{source:"server"}).then(t=>Xw(e,n,t))}function sk(n){n=pe(n,gt);let e=pe(n.firestore,Pe),t=qe(e),r=new Hn(e);return LC(n._query),hC(t,n._query).then(i=>new Ht(e,r,n,i))}function ok(n){n=pe(n,gt);let e=pe(n.firestore,Pe),t=qe(e),r=new Hn(e);return z2(t,n._query).then(i=>new Ht(e,r,n,i))}function ak(n){n=pe(n,gt);let e=pe(n.firestore,Pe),t=qe(e),r=new Hn(e);return hC(t,n._query,{source:"server"}).then(i=>new Ht(e,r,n,i))}function ck(n,e,t){n=pe(n,Oe);let r=pe(n.firestore,Pe),i=Op(n.converter,e,t);return Ll(r,[kp(so(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,$e.none())])}function uk(n,e,t,...r){n=pe(n,Oe);let i=pe(n.firestore,Pe),s=so(i),o;return o=typeof(e=be(e))=="string"||e instanceof Mr?Jw(s,"updateDoc",n._key,e,t,r):Qw(s,"updateDoc",n._key,e),Ll(i,[o.toMutation(n._key,$e.exists(!0))])}function lk(n){return Ll(pe(n.firestore,Pe),[new $i(n._key,$e.none())])}function hk(n,e){let t=pe(n.firestore,Pe),r=Kw(n),i=Op(n.converter,e);return Ll(t,[kp(so(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,$e.exists(!1))]).then(()=>r)}function pp(n,...e){var t,r,i;n=be(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||La(e[o])||(s=e[o++]);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(La(e[o])){let m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let u,h,d;if(n instanceof Oe)h=pe(n.firestore,Pe),d=cc(n._key.path),u={next:m=>{e[o]&&e[o](Xw(h,n,m))},error:e[o+1],complete:e[o+2]};else{let m=pe(n,gt);h=pe(m.firestore,Pe),d=m._query;let v=new Hn(h);u={next:C=>{e[o]&&e[o](new Ht(h,v,m,C))},error:e[o+1],complete:e[o+2]},LC(n._query)}return function(v,C,k,V){let N=new ic(V),q=new wl(C,N,k);return v.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return Lw(yield sc(v),q)})),()=>{N.Ou(),v.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return Mw(yield sc(v),q)}))}}(qe(h),d,a,u)}function tj(n,e,...t){let r=be(n),i=function(u){let h={bundle:"",bundleName:"",bundleSource:""},d=["bundle","bundleName","bundleSource"];for(let m of d){if(!(m in u)){h.error=`snapshotJson missing required field: ${m}`;break}let v=u[m];if(typeof v!="string"){h.error=`snapshotJson field '${m}' must be a string.`;break}if(v.length===0){h.error=`snapshotJson field '${m}' cannot be an empty string.`;break}m==="bundle"?h.bundle=v:m==="bundleName"?h.bundleName=v:m==="bundleSource"&&(h.bundleSource=v)}return h}(e);if(i.error)throw new U(x.INVALID_ARGUMENT,i.error);let s,o=0;if(typeof t[o]!="object"||La(t[o])||(s=t[o++]),i.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&La(t[o])){let u=t[o++];a={next:u.next,error:u.error,complete:u.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(h,d,m,v,C){let k,V=!1;return op(h,d.bundle).then(()=>Hw(h,d.bundleName)).then(q=>{q&&!V&&(C&&q.withConverter(C),k=pp(q,m||{},v))}).catch(q=>(v.error&&v.error(q),()=>{})),()=>{V||(V=!0,k&&k())}}(r,i,s,a,t[o])}if(i.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&La(t[o])){let u=t[o++];a={next:u.next,error:u.error,complete:u.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(h,d,m,v,C){let k,V=!1;return op(h,d.bundle).then(()=>{if(!V){let q=new Oe(h,C||null,Q.fromPath(d.bundleName));k=pp(q,m||{},v)}}).catch(q=>(v.error&&v.error(q),()=>{})),()=>{V||(V=!0,k&&k())}}(r,i,s,a,t[o])}throw new U(x.INVALID_ARGUMENT,`unsupported bundle source: ${i.bundleSource}`)}function dk(n,e){return W2(qe(n=pe(n,Pe)),La(e)?e:{next:e})}function Ll(n,e){return function(r,i){let s=new rt;return r.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return b2(yield Gw(r),i,s)})),s.promise}(qe(n),e)}function Xw(n,e,t){let r=t.docs.get(e._key),i=new Hn(n);return new Kt(n,i,e._key,r,new jn(t.hasPendingWrites,t.fromCache),e.converter)}function fk(n){return Zw(n,{count:eU()})}function Zw(n,e){let t=pe(n.firestore,Pe),r=qe(t),i=FR(e,(s,o)=>new Sf(o,s.aggregateType,s._internalFieldPath));return G2(r,n._query,i).then(s=>function(a,u,h){let d=new Hn(a);return new HE(u,d,h)}(t,n,s))}var rw=class{constructor(e){this.kind="memory",this._onlineComponentProvider=fc.provider,e?.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new Tl(void 0)}}toJSON(){return{kind:this.kind}}},iw=class{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=nU(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}},sw=class{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Rp.provider}toJSON(){return{kind:this.kind}}},ow=class{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Tl(e)}}toJSON(){return{kind:this.kind}}};function nj(){return new sw}function rj(n){return new ow(n?.cacheSizeBytes)}function ij(n){return new rw(n)}function sj(n){return new iw(n)}var aw=class{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=fc.provider,this._offlineComponentProvider={build:t=>new Al(t,e?.cacheSizeBytes,this.forceOwnership)}}},cw=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=fc.provider,this._offlineComponentProvider={build:t=>new rp(t,e?.cacheSizeBytes)}}};function nU(n){return new aw(n?.forceOwnership)}function oj(){return new cw}var rU={maxAttempts:5};var uw=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=so(e)}set(e,t,r){this._verifyNotCommitted();let i=Di(e,this._firestore),s=Op(i.converter,t,r),o=kp(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,$e.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Di(e,this._firestore),o;return o=typeof(t=be(t))=="string"||t instanceof Mr?Jw(this._dataReader,"WriteBatch.update",s._key,t,r,i):Qw(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,$e.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Di(e,this._firestore);return this._mutations=this._mutations.concat(new $i(t._key,$e.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new U(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Di(n,e){if((n=be(n)).firestore!==e)throw new U(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var lw=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=so(e)}get(e){let t=Di(e,this._firestore),r=new Cl(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return Y(24041);let s=i[0];if(s.isFoundDocument())return new to(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new to(this._firestore,r,t._key,null,t.converter);throw Y(18433,{doc:s})})}set(e,t,r){let i=Di(e,this._firestore),s=Op(i.converter,t,r),o=kp(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Di(e,this._firestore),o;return o=typeof(t=be(t))=="string"||t instanceof Mr?Jw(this._dataReader,"Transaction.update",s._key,t,r,i):Qw(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Di(e,this._firestore);return this._transaction.delete(t._key),this}};var hw=class extends lw{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Di(e,this._firestore),r=new Hn(this._firestore);return super.get(e).then(i=>new Kt(this._firestore,r,t._key,i._document,new jn(!1,!1),t.converter))}};function pk(n,e,t){n=pe(n,Pe);let r=Object.assign(Object.assign({},rU),t);return function(s){if(s.maxAttempts<1)throw new U(x.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new rt;return s.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let h=yield uC(s);new GE(s.asyncQueue,h,a,o,u).zu()})),u.promise}(qe(n),i=>e(new hw(n,i)),r)}function mk(){return new bl("deleteField")}function aj(){return new YE("serverTimestamp")}function cj(...n){return new XE("arrayUnion",n)}function uj(...n){return new ZE("arrayRemove",n)}function gk(n){return new ew("increment",n)}function _k(n){return new Dr(n)}function yk(n){return qe(n=pe(n,Pe)),new uw(n,e=>Ll(n,e))}function Ik(n,e){let t=qe(n=pe(n,Pe));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Nt("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(s){let o=typeof s=="string"?function(h){try{return JSON.parse(h)}catch(d){throw new U(x.INVALID_ARGUMENT,"Failed to parse JSON: "+d?.message)}}(s):s,a=[];if(Array.isArray(o.indexes))for(let u of o.indexes){let h=mR(u,"collectionGroup"),d=[];if(Array.isArray(u.fields))for(let m of u.fields){let v=Np("setIndexConfiguration",mR(m,"fieldPath"));m.arrayConfig==="CONTAINS"?d.push(new kr(v,2)):m.order==="ASCENDING"?d.push(new kr(v,0)):m.order==="DESCENDING"&&d.push(new kr(v,1))}a.push(new Li(Li.UNKNOWN_ID,h,d,Ba.empty()))}return a}(e);return Q2(t,r)}function mR(n,e){if(typeof n[e]!="string")throw new U(x.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}var dw=class{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}};function Ek(n){var e;n=pe(n,Pe);let t=gR.get(n);if(t)return t;if(((e=qe(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;let r=new dw(n);return gR.set(n,r),r}function wk(n){Ak(n,!0)}function vk(n){Ak(n,!1)}function Tk(n){Y2(qe(n._firestore)).then(e=>B("deleting all persistent cache indexes succeeded")).catch(e=>Nt("deleting all persistent cache indexes failed",e))}function Ak(n,e){J2(qe(n._firestore),e).then(t=>B(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Nt(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}var gR=new WeakMap;function lj(n){var e;let t=(e=qe(pe(n.firestore,Pe))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Tp(t,Rt(n._query)).Vt}function hj(n,e){var t;let r=FR(e,(s,o)=>new Sf(o,s.aggregateType,s._internalFieldPath)),i=(t=qe(pe(n.firestore,Pe))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return i===void 0?null:AP(i,eP(n._query),r,!0).request}var _R=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return fw.instance.onExistenceFilterMismatch(e)}},fw=class n{constructor(){this.Fc=new Map}static get instance(){return nf||(nf=new n,function(t){if(Rf)throw new Error("a TestingHooksSpi instance is already set");Rf=t}(nf)),nf}ct(e){this.Fc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.Fc;return r.set(t,e),()=>r.delete(t)}},nf=null;(function(e,t=!0){(function(i){ac=i})(di),dn(new Pt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Pe(new aI(r.getProvider("auth-internal")),new lI(o,r.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new U(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ga(h.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Be(e0,t0,e),Be(e0,t0,"esm2017")})();var Ml=class{constructor(e){return e}},tv="firestore",ev=class{constructor(){return Es(tv)}},Rj=sv(0,300).pipe(ov(()=>Fc(Es(tv))),av()),nv=new Vo("angularfire2.firestore-instances");function iU(n,e){let t=zc(tv,n,e);return t&&new Ml(t)}function sU(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Ml(r)}}var bk={provide:ev,deps:[[new Xt,nv]]},Sk={provide:Ml,useFactory:iU,deps:[[new Xt,nv],ur]},Pj=(()=>{class n{constructor(){Be("angularfire",cr.full,"fst")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=gv({type:n});static \u0275inj=dv({providers:[Sk,bk]})}return n})();function Cj(n,...e){return Be("angularfire",cr.full,"fst"),xo([Sk,bk,{provide:nv,useFactory:sU(n),multi:!0,deps:[kn,ui,fi,ws,[new Xt,cu],[new Xt,qo],...e]}])}var kj=H(QS,!0),Nj=H(zy,!0),Dj=H(Hd,!0),Oj=H(YS,!0),Vj=H(Gy,!0),xj=H(JS,!0),Lj=H($y,!0),Mj=H(GS,!0),Fj=H(xu,!0),Uj=H(Kd,!0),Bj=H(HS,!0),qj=H(hk,!0,2),jj=H(XC,!0,2),$j=H(ZC,!0,2),zj=H(BC,!0,2),Gj=H(AC,!0),Wj=H(mC,!0,2),Kj=H(gC,!0,2),Hj=H(Ww,!0),Qj=H(Tk,!0),Jj=H(lk,!0,2),Yj=H(mk,!0,2),Xj=H(RC,!0),Zj=H(vk,!0),e$=H(Kw,!0,2),t$=H(CC,!0,2),n$=H(wC,!0),r$=H(vC,!0),i$=H(SC,!0),s$=H(wk,!0),o$=H(KC,!0,2),a$=H(WC,!0,2),c$=H(Zw,!0),u$=H(fk,!0),l$=H(nk,!0),h$=H(rk,!0),d$=H(ik,!0),f$=H(sk,!0),p$=H(ok,!0),m$=H(ak,!0),g$=H(IC,!0),_$=H(Ek,!0),y$=H(gk,!0,2),I$=H(yC,!0),E$=H(jC,!0,2),w$=H($C,!0,2),v$=H(op,!0),T$=H(Hw,!0,2),A$=H(pp,!0),b$=H(dk,!0),S$=H(UC,!0,2),R$=H(qC,!0,2),P$=H(MC,!0,2),C$=H(Cp,!0,2),k$=H(_C,!0,2),N$=H(pk,!0),D$=H(ck,!0,2),O$=H(Ik,!0),V$=H(yR,!0),x$=H(tk,!0,2),L$=H(GC,!0,2),M$=H(zC,!0,2),F$=H(YC,!0,2),U$=H(PC,!0),B$=H(uk,!0,2),q$=H(_k,!0,2),j$=H(bC,!0),$$=H(FC,!0,2),z$=H(yk,!0,2);export{Tv as a,or as b,qc as c,Av as d,yh as e,jt as f,be as g,Pt as h,dn as i,hi as j,Ct as k,di as l,ys as m,Be as n,cr as o,zc as p,Es as q,fi as r,H as s,ur as t,ws as u,h4 as v,d4 as w,qo as x,qO as y,au as z,cu as A,e9 as B,t9 as C,n9 as D,r9 as E,i9 as F,s9 as G,o9 as H,a9 as I,Nt as J,H9 as K,U as L,sI as M,n0 as N,Xu as O,it as P,Q,YM as R,pe as S,Ue as T,J9 as U,Qe as V,Ga as W,gt as X,Oe as Y,Gn as Z,KE as _,Y9 as $,qe as aa,eo as ba,HE as ca,Nr as da,Mr as ea,Fr as fa,Vi as ga,Dr as ha,no as ia,Pl as ja,oc as ka,nw as la,lp as ma,hp as na,dp as oa,fp as pa,X9 as qa,eU as ra,jn as sa,Kt as ta,Z9 as ua,Ma as va,Ht as wa,ej as xa,tj as ya,Ll as za,nj as Aa,rj as Ba,ij as Ca,sj as Da,nU as Ea,oj as Fa,uw as Ga,hw as Ha,aj as Ia,cj as Ja,uj as Ka,dw as La,lj as Ma,hj as Na,_R as Oa,Ml as Pa,ev as Qa,Rj as Ra,Pj as Sa,Cj as Ta,kj as Ua,Nj as Va,Dj as Wa,Oj as Xa,Vj as Ya,xj as Za,Lj as _a,Mj as $a,Fj as ab,Uj as bb,Bj as cb,qj as db,jj as eb,$j as fb,zj as gb,Gj as hb,Wj as ib,Kj as jb,Hj as kb,Qj as lb,Jj as mb,Yj as nb,Xj as ob,Zj as pb,e$ as qb,t$ as rb,n$ as sb,r$ as tb,i$ as ub,s$ as vb,o$ as wb,a$ as xb,c$ as yb,u$ as zb,l$ as Ab,h$ as Bb,d$ as Cb,f$ as Db,p$ as Eb,m$ as Fb,g$ as Gb,_$ as Hb,y$ as Ib,I$ as Jb,E$ as Kb,w$ as Lb,v$ as Mb,T$ as Nb,A$ as Ob,b$ as Pb,S$ as Qb,R$ as Rb,P$ as Sb,C$ as Tb,k$ as Ub,N$ as Vb,D$ as Wb,O$ as Xb,V$ as Yb,x$ as Zb,L$ as _b,M$ as $b,F$ as ac,U$ as bc,B$ as cc,q$ as dc,j$ as ec,$$ as fc,z$ as gc};
