<div class="gallery-container">
  <div class="gallery-header">
    <div class="header-content">
      <div class="header-text">
        <h2>ğŸŒ Entdecke {{ filteredAfroshops.length }} afrikanische GeschÃ¤fte in deiner NÃ¤he</h2>
      </div>

      <!-- HinzufÃ¼gen-Button nur fÃ¼r angemeldete Benutzer sichtbar -->
      <div class="header-actions" *ngIf="user$ | async as user">
        <button class="add-afroshop-btn primary" (click)="goToAddAfroshop()" title="Neuen Afroshop hinzufÃ¼gen">
          â• Afroshop hinzufÃ¼gen
        </button>
        
        <!-- Admin-Link fÃ¼r Administratoren -->
        <button class="admin-link-btn" (click)="goToAdmin()" title="Administration" *ngIf="isAdminUser(user)">
          âš™ï¸
        </button>
      </div>
      
      <!-- Nachricht wenn nicht angemeldet -->
      <div class="header-actions" *ngIf="!(user$ | async)">
        <button class="add-afroshop-btn disabled" (click)="addNewAfroshop()" title="Anmelden um einen Afroshop hinzuzufÃ¼gen">
          ğŸ” Anmelden zum HinzufÃ¼gen
        </button>
      </div>
    </div>

    <!-- Controls Desktop Layout -->
    <div class="controls-desktop-layout">
      <!-- Filter nach Typ -->
      <div class="filter-container unified-control-group">
        <label for="type-filter" class="unified-label">Nach Typ filtern:</label>
        <div class="unified-input-group">
          <select id="type-filter" [(ngModel)]="selectedType" (change)="onTypeFilterChange()" class="unified-select">
            <option value="">Alle Typen</option>
            <option *ngFor="let type of getAllBusinessTypes()" [value]="type.value">
              {{type.icon}} {{type.label}}
            </option>
          </select>
          <div class="unified-spacer"></div>
        </div>
      </div>

      <!-- Stadtauswahl Gruppe -->
      <div class="location-container">
        <label for="city-input" class="unified-label">ğŸ“ Deine Stadt:</label>
        
        <!-- Desktop: Controls in einer Zeile -->
        <div class="desktop-city-controls">
          <!-- Freie Stadteingabe -->
          <div class="city-search-group">
            <div class="unified-input-group">
              <input 
                type="text" 
                id="city-input"
                [(ngModel)]="customCityName"
                name="cityInput"
                placeholder="Jede deutsche Stadt..."
                class="unified-input city-input-compact"
                (keyup.enter)="searchCity()"
              />
              <button 
                (click)="searchCity()" 
                class="unified-btn search-btn"
                [disabled]="!customCityName || !customCityName.trim()"
                title="Stadt suchen">
                ğŸ” Suchen
              </button>
            </div>
          </div>
            
          <!-- Oder Dropdown fÃ¼r hÃ¤ufige StÃ¤dte -->
          <div class="quick-cities-group">
            <div class="unified-input-group">
              <select [(ngModel)]="selectedCity" class="unified-select city-select-compact">
                <option value="">Beliebte StÃ¤dte...</option>
                <option value="berlin">Berlin</option>
                <option value="hamburg">Hamburg</option>
                <option value="mÃ¼nchen">MÃ¼nchen</option>
                <option value="kÃ¶ln">KÃ¶ln</option>
                <option value="frankfurt">Frankfurt am Main</option>
                <option value="stuttgart">Stuttgart</option>
                <option value="dÃ¼sseldorf">DÃ¼sseldorf</option>
                <option value="dortmund">Dortmund</option>
                <option value="essen">Essen</option>
                <option value="leipzig">Leipzig</option>
              </select>
              <button 
                (click)="onCityChange()" 
                class="unified-btn confirm-btn"
                [disabled]="!selectedCity"
                title="AusgewÃ¤hlte Stadt bestÃ¤tigen">
                âœ“ BestÃ¤tigen
              </button>
            </div>
          </div>
            
          <!-- Standort-Button -->
          <div class="gps-group">
            <button (click)="useCurrentLocation()" class="location-btn gps-btn-desktop" title="GPS aktivieren und Standort verwenden">
              ğŸ“¡ GPS aktivieren
            </button>
          </div>
        </div>
        
        <!-- GPS Hint nur fÃ¼r mobile -->
        <small class="location-hint mobile-only">
          ğŸ¯ Findet automatisch Afroshops in deiner NÃ¤he
        </small>
      </div>
    </div>

      <!-- Suchradius-Anzeige -->
      <div class="radius-info" *ngIf="userLocation && (selectedCity || filteredAfroshops.length < allAfroshops.length)">
        <div class="radius-indicator">
          ğŸ¯ Suche in 50km Umkreis
          <span *ngIf="selectedCity" class="city-name">um {{ getSelectedCityName() }}</span>
          <span *ngIf="!selectedCity" class="current-location">um deinen Standort</span>
        </div>
        <div class="results-count">
          {{ filteredAfroshops.length }} von {{ allAfroshops.length }} Afroshops angezeigt
        </div>
      </div>
    </div>
  </div>

  <!-- Kartenansicht -->
  <div class="map-view" *ngIf="showMap && filteredAfroshops.length > 0">
    <app-map [afroshops]="filteredAfroshops" [userLocation]="userLocation"
      (shopSelected)="viewAfroshopDetail($event)"></app-map>
  </div>

  <!-- Afroshops-Raster -->
  <div class="gallery-grid" *ngIf="!showMap && filteredAfroshops.length > 0">
    <div *ngFor="let shop of filteredAfroshops" class="shop-card">
      <div class="image-wrapper" (click)="viewAfroshopDetail(shop.id)">
        <img [src]="shop.image || getDefaultImage(shop.type)" [alt]="shop.name" class="gallery-image"
          (error)="onImageError($event, shop.type)" />
        <div class="type-badge" [class]="shop.type">
          {{ getBusinessTypeDisplay(shop.type) }}
        </div>
        
        <!-- Bearbeiten-Button (nur fÃ¼r Ersteller sichtbar) -->
        <button 
          *ngIf="canEditAfroshop(shop)" 
          (click)="editAfroshop($event, shop.id)" 
          class="edit-btn"
          title="Bearbeiten">
          âœï¸
        </button>
        
        <div class="image-overlay">
          <span class="click-hint">ğŸ“ Details ansehen</span>
        </div>
      </div>
      
      <!-- Immer sichtbare Informationen -->
      <div class="card-info">
        <h3 class="shop-name">{{ shop.name }}</h3>
        <p class="shop-location">ğŸ“ {{ getLocationDisplay(shop.address) }}</p>
        <div class="shop-meta">
          <span class="rating">â­ {{ shop.rating }}</span>
          <span class="price">{{ getPriceLevel(shop.priceLevel) }}</span>
          <span class="type">{{ shop.type | titlecase }}</span>
        </div>
        <div class="distance" *ngIf="userLocation">
          ğŸ¯ {{ getDistanceFromUser(shop) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Nachricht wenn keine Ergebnisse -->
  <div class="no-results" *ngIf="filteredAfroshops.length === 0 && (searchTerm || selectedType)">
    <div class="no-results-content">
      <div class="no-results-icon">ğŸ”</div>
      <h3>Kein GeschÃ¤ft gefunden</h3>
      <p>Kein Afroshop entspricht deinen Suchkriterien</p>
      <button (click)="clearSearch()" class="btn-clear-search">
        Alle GeschÃ¤fte anzeigen
      </button>
    </div>
  </div>