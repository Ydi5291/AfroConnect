<section class="intro-section">
  <div class="intro-message">
    üåç {{ texts.discover }} {{ allAfroshops.length }} {{ texts.shopsNearYou }}
  </div>
  <div class="intro-actions">
  <button class="add-shop-btn" (click)="goToAddAfroshop()">‚ûï {{ texts.addShopBtn }}</button>
  <button class="settings-btn" (click)="openSettings()" *ngIf="isAdmin">‚öôÔ∏è</button>
  </div>
</section>

<section class="controls-section">
  <div class="controls-main">
    <div class="controls-row">
      <div class="filter-gps-column">
        <div class="type-filter-group">
          <label for="type-filter" class="unified-label type-filter-label">{{ texts.filterByType }}</label>
          <select id="type-filter" [(ngModel)]="selectedType" (change)="onTypeFilterChange()" class="unified-select type-select-compact">
            <option value="">{{ texts.allTypes }}</option>
            <option value="restaurant">{{ texts.restaurant }}</option>
            <option value="epicerie">{{ texts.epicerie }}</option>
            <option value="coiffeur">{{ texts.coiffeur }}</option>
            <option value="vetement">{{ texts.vetement }}</option>
            <option value="services">{{ texts.services }}</option>
          </select>
        </div>
        <div class="gps-group">
          <button (click)="useCurrentLocation()" class="location-btn gps-btn-desktop" [title]="texts.activateGPS">
            üì° {{ texts.activateGPS }}
          </button>
        </div>
      </div>
  <div class="radius-info" *ngIf="userLocation || selectedCity">
        <div class="radius-indicator">
          üéØ {{ texts.searchRadius }}
          <span *ngIf="selectedCity" class="city-name">{{ texts.around }} {{ getSelectedCityName() }}</span>
          <span *ngIf="!selectedCity" class="current-location">{{ texts.around }} {{ texts.yourLocation }}</span>
        </div>
        <div class="results-count">
          {{ filteredAfroshops.length }} {{ texts.resultsCount }} {{ allAfroshops.length }} {{ texts.shopsDisplayed }}
        </div>
      </div>
    </div>
    <div class="controls-row">
      <div class="location-container">
        <label for="city-input" class="unified-label">üìç {{ texts.yourCity }}</label>
        <div class="city-search-group">
          <div class="unified-input-group">
            <input 
              type="text" 
              id="city-input"
              [(ngModel)]="customCityName"
              name="cityInput"
              [placeholder]="texts.anyCityPlaceholder"
              class="unified-input city-input-compact"
              (keyup.enter)="searchCity()"
            />
            <button 
              (click)="searchCity()" 
              class="unified-btn search-btn"
              [disabled]="!customCityName || !customCityName.trim()"
              [title]="texts.search">
              üîç {{ texts.search }}
            </button>
          </div>
        </div>
        <div class="quick-cities-group">
          <div class="unified-input-group">
            <select [(ngModel)]="selectedCity" class="unified-select city-select-compact">
              <option value="">{{ texts.popularCities }}</option>
              
              <optgroup label="üá©üá™ Deutschland / Allemagne / Germany">
                <option value="berlin">Berlin</option>
                <option value="hamburg">Hamburg</option>
                <option value="m√ºnchen">M√ºnchen</option>
                <option value="k√∂ln">K√∂ln</option>
                <option value="frankfurt">Frankfurt am Main</option>
                <option value="stuttgart">Stuttgart</option>
                <option value="d√ºsseldorf">D√ºsseldorf</option>
                <option value="dortmund">Dortmund</option>
                <option value="essen">Essen</option>
                <option value="hamm">Hamm</option>
                <option value="siegen">Siegen</option>
                <option value="leipzig">Leipzig</option>
                <option value="bremen">Bremen</option>
                <option value="dresden">Dresden</option>
                <option value="hannover">Hannover</option>
                <option value="n√ºrnberg">N√ºrnberg</option>
              </optgroup>
              
              <optgroup label="üá´üá∑ France / Frankreich">
                <option value="paris">Paris</option>
                <option value="marseille">Marseille</option>
                <option value="lyon">Lyon</option>
                <option value="toulouse">Toulouse</option>
                <option value="nice">Nice</option>
                <option value="nantes">Nantes</option>
                <option value="strasbourg">Strasbourg</option>
                <option value="montpellier">Montpellier</option>
                <option value="bordeaux">Bordeaux</option>
                <option value="lille">Lille</option>
              </optgroup>
              
              <optgroup label="üáßüá™ Belgique / Belgi√´ / Belgium">
                <option value="bruxelles">Bruxelles / Brussel</option>
                <option value="anvers">Anvers / Antwerpen</option>
                <option value="gand">Gand / Gent</option>
                <option value="charleroi">Charleroi</option>
                <option value="li√®ge">Li√®ge / Luik</option>
              </optgroup>
              
              <optgroup label="üá≥üá± Nederland / Pays-Bas / Netherlands">
                <option value="amsterdam">Amsterdam</option>
                <option value="rotterdam">Rotterdam</option>
                <option value="la-haye">Den Haag / La Haye</option>
                <option value="utrecht">Utrecht</option>
                <option value="eindhoven">Eindhoven</option>
              </optgroup>
              
              <optgroup label="üá®üá≠ Schweiz / Suisse / Switzerland">
                <option value="zurich">Z√ºrich</option>
                <option value="gen√®ve">Gen√®ve / Genf</option>
                <option value="b√¢le">Basel / B√¢le</option>
                <option value="berne">Bern / Berne</option>
                <option value="lausanne">Lausanne</option>
              </optgroup>
              
              <optgroup label="üá±üá∫ Luxembourg / Luxemburg">
                <option value="luxembourg">Luxembourg</option>
              </optgroup>
              
              <optgroup label="üáÆüáπ Italia / Italie / Italy">
                <option value="rome">Roma / Rome</option>
                <option value="milan">Milano / Milan</option>
                <option value="naples">Napoli / Naples</option>
                <option value="turin">Torino / Turin</option>
                <option value="florence">Firenze / Florence</option>
                <option value="bologne">Bologna / Bologne</option>
                <option value="venise">Venezia / Venise</option>
              </optgroup>
              
              <optgroup label="üá™üá∏ Espa√±a / Espagne / Spain">
                <option value="madrid">Madrid</option>
                <option value="barcelone">Barcelona / Barcelone</option>
                <option value="valence">Valencia / Valence</option>
                <option value="s√©ville">Sevilla / S√©ville</option>
                <option value="saragosse">Zaragoza / Saragosse</option>
                <option value="malaga">M√°laga</option>
                <option value="bilbao">Bilbao</option>
              </optgroup>
            </select>
            <button 
              (click)="onCityChange()" 
              class="unified-btn confirm-btn"
              [disabled]="!selectedCity"
              [title]="texts.confirm">
              ‚úì {{ texts.confirm }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="gallery-section">
  <div class="map-view" *ngIf="showMap && filteredAfroshops.length > 0">
    <app-map [afroshops]="filteredAfroshops" [userLocation]="userLocation"
      (shopSelected)="viewAfroshopDetail($event)"></app-map>
  </div>

  <div class="gallery-grid" *ngIf="!showMap && filteredAfroshops.length > 0">
    <div *ngFor="let shop of filteredAfroshops" class="shop-card">
      <div class="image-wrapper" (click)="viewAfroshopDetail(shop.id)">
        <img [src]="shop.image || getDefaultImage(shop.type)" [alt]="shop.name" class="gallery-image"
          (error)="onImageError($event, shop.type)" />
        <div class="type-badge" [class]="shop.type">
          {{ getBusinessTypeDisplay(shop.type) }}
        </div>
        <!-- Bearbeiten-Button (nur f√ºr Ersteller sichtbar) -->
        <button 
          *ngIf="canEditAfroshop(shop)" 
          (click)="editAfroshop($event, shop.id)" 
          class="edit-btn"
          [title]="texts.edit">
          ‚úèÔ∏è
        </button>
        <div class="image-overlay">
          <span class="click-hint">üìç {{ texts.viewDetails }}</span>
        </div>
      </div>
      <!-- Toujours visible -->
      <div class="card-info">
        <h3 class="shop-name">{{ shop.name }}</h3>
        <p class="shop-location">üìç {{ getLocationDisplay(shop.address) }}</p>
        <div class="shop-meta">
          <span class="rating">‚≠ê {{ shop.rating }}</span>
          <span class="price">{{ getPriceLevel(shop.priceLevel) }}</span>
          <span class="type">{{ shop.type | titlecase }}</span>
        </div>
        <div class="distance" *ngIf="userLocation">
          üéØ {{ getDistanceFromUser(shop) }}
          <span *ngIf="getTravelDurationDisplay(shop)">
            <!-- Appel de la m√©thode pour d√©clencher le calcul -->
            {{ getDirectionsDuration(shop) }}
            ‚Äì {{ getTravelDurationDisplay(shop) }}
          </span>
        </div>
        <div class="map-buttons">
          <a [href]="getGoogleMapsUrl(shop.address)" target="_blank" class="map-btn">üó∫Ô∏è {{ texts.showOnMap }}</a>
          <a [href]="getGoogleMapsRouteUrl(shop.address)" target="_blank" class="route-btn">üöó {{ texts.route }}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Message "Aucun r√©sultat" - Affich√© quand aucun commerce n'est trouv√© -->
  <div class="no-results" *ngIf="filteredAfroshops.length === 0 && (searchTerm || selectedType || hasGeoFilter())">
    <div class="no-results-content">
      <div class="no-results-icon">üìç</div>
      
      <!-- Titre -->
      <h3>{{ texts.noResults }}</h3>
      
      <!-- Message selon le contexte -->
      <p *ngIf="userLocation && !selectedCity">
        {{ texts.noResultsGPS }}
      </p>
      <p *ngIf="selectedCity && !userLocation">
        {{ texts.noResultsCity.replace('{{city}}', getSearchedCityName()) }}
      </p>
      <p *ngIf="!userLocation && !selectedCity">
        {{ texts.noResultsMessage }}
      </p>
      
      <!-- Boutons d'action -->
      <div class="no-results-actions">
        <button (click)="clearSearch()" class="btn-back-gallery">
          üè† {{ texts.backToGallery }}
        </button>
      </div>
      
      <!-- Message encourageant -->
      <p class="no-results-hint">
        üí° {{ texts.tryAnother }}
      </p>
    </div>
  </div>
</section>
