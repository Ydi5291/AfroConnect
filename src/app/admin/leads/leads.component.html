<div class="leads-container">
  <!-- Header -->
  <div class="header">
    <h1>{{ texts.title }}</h1>
    <button class="export-btn" (click)="exportToCSV()">
      ğŸ“¥ {{ texts.exportCSV }}
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Laden...</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid" *ngIf="!isLoading">
    <div class="stat-card total">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <h3>{{ stats.total }}</h3>
        <p>Total</p>
      </div>
    </div>
    <div class="stat-card new">
      <div class="stat-icon">ğŸ†•</div>
      <div class="stat-content">
        <h3>{{ stats.new }}</h3>
        <p>{{ texts.newLeads }}</p>
      </div>
    </div>
    <div class="stat-card contacted">
      <div class="stat-icon">ğŸ“</div>
      <div class="stat-content">
        <h3>{{ stats.contacted }}</h3>
        <p>{{ texts.contacted }}</p>
      </div>
    </div>
    <div class="stat-card interested">
      <div class="stat-icon">â­</div>
      <div class="stat-content">
        <h3>{{ stats.interested }}</h3>
        <p>{{ texts.interested }}</p>
      </div>
    </div>
    <div class="stat-card registered">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <h3>{{ stats.registered }}</h3>
        <p>{{ texts.registered }}</p>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section" *ngIf="!isLoading">
    <div class="filter-group">
      <label>{{ texts.search }}</label>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="applyFilters()"
        [placeholder]="texts.search"
        class="filter-input"
      />
    </div>

    <div class="filter-group">
      <label>Status</label>
      <select [(ngModel)]="filterStatus" (ngModelChange)="applyFilters()" class="filter-select">
        <option value="all">{{ texts.allStatus }}</option>
        <option value="new">{{ texts.newLeads }}</option>
        <option value="contacted">{{ texts.contacted }}</option>
        <option value="interested">{{ texts.interested }}</option>
        <option value="registered">{{ texts.registered }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label>{{ texts.category }}</label>
      <select [(ngModel)]="filterCategory" (ngModelChange)="applyFilters()" class="filter-select">
        <option value="all">{{ texts.allCategories }}</option>
        <option value="shop">ğŸª Shop</option>
        <option value="restaurant">ğŸ½ï¸ Restaurant</option>
        <option value="salon">ğŸ’‡ Salon</option>
        <option value="other">ğŸ¢ Other</option>
      </select>
    </div>

    <div class="filter-group">
      <label>{{ texts.city }}</label>
      <input
        type="text"
        [(ngModel)]="filterCity"
        (ngModelChange)="applyFilters()"
        [placeholder]="texts.city"
        class="filter-input"
      />
    </div>
  </div>

  <!-- Leads Table -->
  <div class="table-container" *ngIf="!isLoading">
    <div *ngIf="filteredLeads.length === 0" class="no-leads">
      <p>{{ texts.noLeads }}</p>
    </div>

    <div class="leads-grid" *ngIf="filteredLeads.length > 0">
      <div class="lead-card" *ngFor="let lead of filteredLeads">
        <!-- Lead Header -->
        <div class="lead-header">
          <div class="lead-title">
            <span class="category-icon">{{ getCategoryIcon(lead.category) }}</span>
            <h3>{{ lead.name }}</h3>
          </div>
          <span class="status-badge" [style.background-color]="getStatusColor(lead.status)">
            {{ lead.status }}
          </span>
        </div>

        <!-- Lead Info -->
        <div class="lead-info">
          <div class="info-row" *ngIf="lead.ownerName">
            <span class="info-label">ğŸ‘¤ Owner:</span>
            <span class="info-value">{{ lead.ownerName }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ“± {{ texts.phone }}:</span>
            <span class="info-value">{{ lead.phone }}</span>
          </div>
          <div class="info-row" *ngIf="lead.email">
            <span class="info-label">ğŸ“§ {{ texts.email }}:</span>
            <span class="info-value">{{ lead.email }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ“ {{ texts.city }}:</span>
            <span class="info-value">{{ lead.city }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ“… {{ texts.created }}:</span>
            <span class="info-value">{{ formatDate(lead.createdAt) }}</span>
          </div>
          <div class="info-row" *ngIf="lead.notes">
            <span class="info-label">ğŸ“ Notes:</span>
            <span class="info-value">{{ lead.notes }}</span>
          </div>
        </div>

        <!-- Actions -->
        <div class="lead-actions">
          <!-- Create Firebase Account Button -->
          <button
            *ngIf="lead.status !== 'registered' && lead.email"
            class="action-btn create-account"
            (click)="createFirebaseAccount(lead)"
            title="Firebase-Konto erstellen"
          >
            ğŸ” {{ texts.createAccount }}
          </button>

          <!-- WhatsApp Button -->
          <button
            class="action-btn whatsapp"
            (click)="openWhatsApp(lead)"
            title="WhatsApp Ã¶ffnen"
          >
            ğŸ’¬ {{ texts.contactWhatsApp }}
          </button>

          <!-- Status Change Dropdown -->
          <select
            class="status-select"
            [value]="lead.status"
            (change)="updateStatus(lead, $any($event.target).value)"
          >
            <option value="new">{{ texts.newLeads }}</option>
            <option value="contacted">{{ texts.contacted }}</option>
            <option value="interested">{{ texts.interested }}</option>
            <option value="registered">{{ texts.registered }}</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>
