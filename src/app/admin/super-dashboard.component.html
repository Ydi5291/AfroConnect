<div class="dashboard-container">

  <h2><span style="font-size:1.5em;">ğŸŒ</span> Super Admin Dashboard - Toutes les Commandes</h2>
  
  <div class="super-admin-controls">
    <button class="modern-btn dashboard-return" (click)="goToAdmin()">â† ZurÃ¼ck zur Admin</button>
    <button class="modern-btn" (click)="goToGallery()">Zur Gallery</button>
  </div>

  <!-- Statistiques globales -->
  <div class="stats-container" *ngIf="!isLoading">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“¦</div>
      <div class="stat-content">
        <div class="stat-value">{{ getTotalOrders() }}</div>
        <div class="stat-label">Gesamtbestellungen</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ’°</div>
      <div class="stat-content">
        <div class="stat-value">â‚¬{{ getTotalRevenue().toFixed(2) }}</div>
        <div class="stat-label">Gesamtumsatz</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸª</div>
      <div class="stat-content">
        <div class="stat-value">{{ allShops.length }}</div>
        <div class="stat-label">Aktive Shops</div>
      </div>
    </div>
  </div>

  <!-- Filtre par shop -->
  <div class="filter-section">
    <label for="shopFilter">ğŸ” Filtern nach Shop:</label>
    <select id="shopFilter" [(ngModel)]="selectedShopId" (change)="onShopFilterChange()" class="shop-filter">
      <option value="all">ğŸ“Š Alle Shops anzeigen</option>
      <option *ngFor="let shop of allShops" [value]="shop.id">{{ shop.name }} ({{ shop.city || 'Keine Stadt' }})</option>
    </select>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="dashboard-empty">
    <p>â³ Lade Bestellungen...</p>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && filteredOrders.length === 0" class="dashboard-empty">
    <p>Keine Bestellungen gefunden.</p>
  </div>

  <!-- Tip -->
  <div class="dashboard-info" *ngIf="!isLoading && filteredOrders.length > 0">
    <p style="color: #1e88e5; font-size: 0.9rem; margin-bottom: 0.5rem;">
      ğŸ’¡ <em>Tipp: Wischen Sie nach links/rechts und oben/unten, um alle Informationen zu sehen.</em>
    </p>
  </div>

  <!-- Tables groupÃ©es par jour -->
  <div class="dashboard-table-wrapper" *ngIf="!isLoading && filteredOrders.length > 0">
    <ng-container *ngFor="let group of groupedOrders">
      <div class="date-separator">
        <h3>
          {{ group.label }}
          <span class="order-count">{{ group.orders.length }} Bestellung(en)</span>
        </h3>
      </div>
      
      <table class="dashboard-table">
        <thead>
          <tr>
            <th>Uhrzeit</th>
            <th>Shop</th>
            <th>Kunde</th>
            <th>Produkte</th>
            <th>Menge</th>
            <th>Gesamtbetrag (â‚¬)</th>
            <th>Zahlungsart</th>
            <th>Lieferart</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of group.orders">
            <td><strong>{{ order.createdAt?.toDate() | date:'HH:mm' }}</strong></td>
            <td><strong style="color: #1a8917;">{{ getShopName(order.shopId) }}</strong></td>
            <td>
              <ng-container *ngIf="order.clientInfo; else noClientInfo">
                <strong>{{ order.clientInfo.firstName }} {{ order.clientInfo.lastName }}</strong><br>
                <!-- Format nouveau: street + number -->
                <ng-container *ngIf="order.clientInfo.street && order.clientInfo.number">
                  {{ order.clientInfo.street }} {{ order.clientInfo.number }}<br>
                  {{ order.clientInfo.plz }} {{ order.clientInfo.city }}<br>
                </ng-container>
                <!-- Format ancien: address complÃ¨te -->
                <ng-container *ngIf="!order.clientInfo.street && order.clientInfo.address">
                  {{ order.clientInfo.address }}<br>
                </ng-container>
                Tel: {{ order.clientInfo.phone }}<br>
                <span *ngIf="order.clientInfo.email">E-Mail: {{ order.clientInfo.email }}</span>
              </ng-container>
              <ng-template #noClientInfo>
                <span style="color:#888">Keine Kundeninfo</span>
              </ng-template>
            </td>
            <td>
              <ul>
                <li *ngFor="let product of order.products">{{ product.name }}</li>
              </ul>
            </td>
            <td>
              <ul>
                <li *ngFor="let product of order.products">{{ product.quantity }}</li>
              </ul>
            </td>
            <td><strong>â‚¬{{ order.total.toFixed(2) }}</strong></td>
            <td>{{ order.paymentMethod }}</td>
            <td>
              <span *ngIf="order.deliveryType === 'abholung'" style="color: #1a8917;">ğŸª Abholung</span>
              <span *ngIf="order.deliveryType === 'lieferung'" style="color: #ff6b35;">ğŸšš Lieferung</span>
              <span *ngIf="!order.deliveryType" style="color: #888;">-</span>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>
  </div>
</div>
