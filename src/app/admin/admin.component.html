<div class="admin-container">
  <div class="admin-header">
    <h1>ğŸ”§ AfroConnect - Administration</h1>
    <p>Outils pour gÃ©rer la base de donnÃ©es d'Afroshops</p>
    <div class="admin-nav-btns">
      <button class="modern-btn primary" (click)="goToSuperDashboard()">ğŸŒ Super Dashboard - Alle Bestellungen</button>
      <button class="modern-btn" (click)="goToGallery()">Zur Gallery</button>
    </div>
  </div>

  <div class="admin-panel" *ngIf="isAuthenticated">
    
    <!-- Section de nettoyage simplifiÃ© -->
    <div class="seeding-section">
      <div class="section-header">
        <h2>ğŸ§¹ Datenbank-Wartung</h2>
        <p>Doublons entfernen und Datenbank optimieren</p>
      </div>

      <div class="action-section">
        <button 
          (click)="cleanDuplicates()" 
          [disabled]="isCleaning || isSeeding"
          class="clean-btn">
          <span *ngIf="!isCleaning">ğŸ§¹ Doublons entfernen</span>
          <span *ngIf="isCleaning">â³ Nettoyage lÃ¤uft...</span>
        </button>

        <div class="progress-indicator" *ngIf="isCleaning">
          <div class="spinner"></div>
          <p>Doublons werden entfernt... Bitte warten.</p>
        </div>
      </div>

      <div class="message" [class]="cleaningMessage.includes('âŒ') ? 'error' : 'success'" *ngIf="cleaningMessage">
        {{ cleaningMessage }}
      </div>
    </div>

    <!-- Section de gestion des Afroshops -->
    <div class="management-section">
      <div class="section-header">
        <h2>ğŸª Verwaltung der Afroshops</h2>
        <p>Afroshops bearbeiten oder lÃ¶schen</p>
      </div>

      <div class="afroshops-list" *ngIf="afroshops.length > 0">
        <div class="list-header">
          <h3>ğŸ“‹ Liste des Afroshops ({{ afroshops.length }})</h3>
          <button (click)="loadAfroshops()" class="refresh-btn" [disabled]="isLoading">
            <span *ngIf="!isLoading">ğŸ”„ Actualiser</span>
            <span *ngIf="isLoading">â³ Chargement...</span>
          </button>
        </div>

        <div class="afroshop-item" *ngFor="let afroshop of afroshops; trackBy: trackByAfroshop">
          <div class="afroshop-info">
            <div class="basic-info">
              <h4>{{ afroshop.name }}</h4>
              <p class="type">{{ getGermanBusinessType(afroshop.type) }}</p>
              <p class="location">ğŸ“ {{ afroshop.address }}</p>
            </div>
            <div class="meta-info">
              <span class="id">ID: {{ afroshop.id }}</span>
            </div>
          </div>
          <div class="actions">
            <button 
              (click)="editAfroshop(afroshop)" 
              class="edit-btn"
              title="Afroshop bearbeiten">
              âœï¸ Bearbeiten
            </button>
            <button 
              (click)="confirmDelete(afroshop)" 
              class="delete-btn"
              [disabled]="isDeleting"
              title="Afroshop lÃ¶schen">
              ğŸ—‘ï¸ LÃ¶schen
            </button>
          </div>
        </div>
      </div>

      <div class="load-button" *ngIf="afroshops.length === 0">
        <button (click)="loadAfroshops()" class="load-btn" [disabled]="isLoading">
          <span *ngIf="!isLoading">ğŸ“‹ Afroshops anzeigen</span>
          <span *ngIf="isLoading">â³ Wird geladen...</span>
        </button>
      </div>

      <div class="message" [class]="deleteMessage.includes('âŒ') ? 'error' : 'success'" *ngIf="deleteMessage">
        {{ deleteMessage }}
      </div>
    </div>

    <!-- Section de gestion des leads -->
    <div class="leads-section">
      <div class="section-header">
        <h2>ğŸ“Š Lead-Verwaltung (/join Registrierungen)</h2>
        <p>GeschÃ¤ftsinhaber kontaktieren und Firebase-Konten erstellen</p>
      </div>

      <!-- Stats Cards -->
      <div class="leads-stats" *ngIf="leadsLoaded">
        <div class="stat-card">
          <div class="stat-number">{{ leadsStats.total }}</div>
          <div class="stat-label">Total Leads</div>
        </div>
        <div class="stat-card new">
          <div class="stat-number">{{ leadsStats.new }}</div>
          <div class="stat-label">Neu</div>
        </div>
        <div class="stat-card contacted">
          <div class="stat-number">{{ leadsStats.contacted }}</div>
          <div class="stat-label">Kontaktiert</div>
        </div>
        <div class="stat-card interested">
          <div class="stat-number">{{ leadsStats.interested }}</div>
          <div class="stat-label">Interessiert</div>
        </div>
        <div class="stat-card registered">
          <div class="stat-number">{{ leadsStats.registered }}</div>
          <div class="stat-label">Registriert</div>
        </div>
      </div>

      <!-- Load Leads Button -->
      <div class="load-button" *ngIf="!leadsLoaded">
        <button (click)="loadLeads()" class="load-btn" [disabled]="isLoadingLeads">
          <span *ngIf="!isLoadingLeads">ğŸ“‹ Leads anzeigen</span>
          <span *ngIf="isLoadingLeads">â³ Wird geladen...</span>
        </button>
      </div>

      <!-- Leads List -->
      <div class="leads-list" *ngIf="leadsLoaded && leads.length > 0">
        <div class="list-header">
          <h3>ğŸ“‹ Liste der Leads ({{ leads.length }})</h3>
          <button (click)="loadLeads()" class="refresh-btn" [disabled]="isLoadingLeads">
            ğŸ”„ Actualiser
          </button>
        </div>

        <div class="lead-item" *ngFor="let lead of leads">
          <div class="lead-header-section">
            <div class="lead-title">
              <span class="category-icon">{{ getLeadCategoryIcon(lead.category) }}</span>
              <h4>{{ lead.name }}</h4>
            </div>
            <span class="status-badge" [ngClass]="'status-' + lead.status">
              {{ getLeadStatusText(lead.status) }}
            </span>
          </div>

          <div class="lead-info">
            <div class="info-row" *ngIf="lead.ownerName">
              <span class="info-label">ğŸ‘¤ Inhaber:</span>
              <span class="info-value">{{ lead.ownerName }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">ğŸ“± Telefon:</span>
              <span class="info-value">{{ lead.phone }}</span>
            </div>
            <div class="info-row" *ngIf="lead.email">
              <span class="info-label">ğŸ“§ E-Mail:</span>
              <span class="info-value">{{ lead.email }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">ğŸ“ Stadt:</span>
              <span class="info-value">{{ lead.city }}</span>
            </div>
            <div class="info-row" *ngIf="lead.notes">
              <span class="info-label">ğŸ“ Notizen:</span>
              <span class="info-value">{{ lead.notes }}</span>
            </div>
          </div>

          <div class="lead-actions">
            <button
              *ngIf="lead.status !== 'registered' && lead.email"
              class="action-btn create-account-btn"
              (click)="createFirebaseAccount(lead)"
              [disabled]="isCreatingAccount"
              title="Firebase-Konto erstellen">
              ğŸ” Konto erstellen
            </button>

            <button
              class="action-btn whatsapp-btn"
              (click)="openLeadWhatsApp(lead)"
              title="WhatsApp Ã¶ffnen">
              ğŸ’¬ WhatsApp
            </button>

            <select
              class="status-select"
              [value]="lead.status"
              (change)="updateLeadStatus(lead, $any($event.target).value)">
              <option value="new">Neu</option>
              <option value="contacted">Kontaktiert</option>
              <option value="interested">Interessiert</option>
              <option value="registered">Registriert</option>
            </select>
          </div>
        </div>
      </div>

      <div class="no-leads" *ngIf="leadsLoaded && leads.length === 0">
        <p>Keine Leads gefunden.</p>
      </div>

      <div class="message" [class]="leadMessage.includes('âŒ') ? 'error' : 'success'" *ngIf="leadMessage">
        {{ leadMessage }}
      </div>
    </div>

    <!-- Section de diagnostic technique -->
    <div class="diagnostic-section">
      <div class="section-header">
        <h2>ğŸ”§ Technische Tools</h2>
        <p>GÃ©ocodage und Koordinaten Ã¼berprÃ¼fen</p>
      </div>
      
      <div class="action-section">
        <a routerLink="/geocoding-diagnostic" class="diagnostic-btn">
          ğŸ—ºï¸ GÃ©ocodage-Diagnose
        </a>
      </div>
    </div>

    <div class="navigation-section">
      <button (click)="goToGallery()" class="nav-btn">
        ğŸª Zur Galerie
      </button>
    </div>
  </div>

  <div class="auth-required" *ngIf="!isAuthenticated">
    <h2>ğŸ” Authentification requise</h2>
    <p>Vous devez Ãªtre connectÃ© pour accÃ©der aux outils d'administration.</p>
  </div>
</div>
